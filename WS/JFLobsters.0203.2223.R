################################################################################
#                                                                              #
#           Stock assessment of the JF lobster by generalized                  #
#               depletion models (GDP) in R package CatDyn                     #
#                    Example for U. do Algarve course                          #
#                       Ruben H. Roa-Ureta                                     #
#                                                                              #
################################################################################
#
wdir <- "/home/ruben/Workplace/Consultancy/PortugalUdoAlgarve/Course2/Day3/"
setwd(wdir)
options(max.print=12000,scipen=6)
library(CatDyn)
library(mice)
#
################################################################################
#                                                                              #
# 1.- Data                                                                     #
#                                                                              #
################################################################################
#
cateff1.Crusoe <- read.csv("WS/RobinsonCrusoeLobster.csv",header=TRUE)
#
################################################################################
# 2.- Stock assessment                                                         #
################################################################################
#
################################################################################
# 2.1.- Robinson Crusoe                                                        #
################################################################################
#
################################################################################
# 2.1.1.- Depletion models season: 2002-2003                                   #
################################################################################
#
# Data object
jflcrusoe0203  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==1,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2002-09-28","2003-05-22"))
#
plot(x=jflcrusoe0203,mark=TRUE,offset=c(9,10),hem="S")                          # 43 51 candidate input weeks
#
# Initial values for pure depletion variant
max.age   <- 45
time.step <- "week"
M.Hoenig(max.age,time.step)
#   M.pred.week M.pred.SE.week
# 1 0.001937482   0.0004004866
sum(jflcrusoe0203$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 21.98468
M.ini       <- 2*0.001937482
N0.ini      <- 7*21.98468
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0203$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0203$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0203.0P.apn.ini <- catdynexp(x=jflcrusoe0203,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0203.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0203.0P.apn.fit  <- CatDynFit(x=jflcrusoe0203,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0203.0P.apn.pred.spg <- CatDynPred(jflcrusoe0203.0P.apn.fit,"spg")     # +43
plot(x=jflcrusoe0203.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.0P.apn.pred.CG <- CatDynPred(jflcrusoe0203.0P.apn.fit,"CG")       # +43
plot(x=jflcrusoe0203.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.0P.apln.fit  <- CatDynFit(x=jflcrusoe0203,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0203.0P.apln.pred.spg <- CatDynPred(jflcrusoe0203.0P.apln.fit,"spg")   # +43
plot(x=jflcrusoe0203.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.0P.apln.pred.CG <- CatDynPred(jflcrusoe0203.0P.apln.fit,"CG")     # +43
plot(x=jflcrusoe0203.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001886792
N0.ini      <- 3*21.98468
P1.ini      <- 50
k.ini       <- 1e-4
alpha.ini   <- 1
beta.ini    <- 1.1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0203$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflcrusoe0203$Data$nasas$time.step,1))
#
jflcrusoe0203.1P.apn.ini <- catdynexp(x=jflcrusoe0203,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0203.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0203.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0203,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0203.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0203.1P.1.apn.fit,"spg") ###01 39
plot(x=jflcrusoe0203.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0203.1P.1.apn.fit,"CG")   ###02 39
plot(x=jflcrusoe0203.1P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0203,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0203.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0203.1P.1.apln.fit,"spg") ###03 39
plot(x=jflcrusoe0203.1P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0203.1P.1.apln.fit,"CG") ###04 39
plot(x=jflcrusoe0203.1P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0203$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0203$Data$nasas$obscat.thou))^2)
#
jflcrusoe0203.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0203,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0203.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0203.1P.1.n.fit,"spg")     ###05 
plot(x=jflcrusoe0203.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0203.1P.1.n.fit,"CG")       ###06
plot(x=jflcrusoe0203.1P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0203,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0203.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0203.1P.1.ln.fit,"spg")   ###07
plot(x=jflcrusoe0203.1P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0203.1P.1.ln.fit,"CG")     ###08
plot(x=jflcrusoe0203.1P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001886792
N0.ini      <- 3*21.98468
P1.ini      <- 15
P2.ini      <- 45
k.ini       <- 1e-4
alpha.ini   <- 1
beta.ini    <- 1.1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0203$Data$nasas$time.step,1),                    # now the dates vector also has
                 39,
                 43,                                                            # the week of one input of abundance
                 tail(jflcrusoe0203$Data$nasas$time.step,1))
#
jflcrusoe0203.2P.apn.ini <- catdynexp(x=jflcrusoe0203,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0203.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0203.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0203,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0203.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0203.2P.1.apn.fit,"spg") ###09
plot(x=jflcrusoe0203.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0203.2P.1.apn.fit,"CG")   ###10
plot(x=jflcrusoe0203.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0203,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0203.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0203.2P.1.apln.fit,"spg") ###11
plot(x=jflcrusoe0203.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0203.2P.1.apln.fit,"CG") ###12
plot(x=jflcrusoe0203.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0203,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0203.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0203.2P.1.n.fit,"spg")     ###13 
plot(x=jflcrusoe0203.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0203.2P.1.n.fit,"CG")       ###14
plot(x=jflcrusoe0203.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0203,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0203.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0203.2P.1.ln.fit,"spg")   ###15
plot(x=jflcrusoe0203.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0203.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0203.2P.1.ln.fit,"CG")     ###16
plot(x=jflcrusoe0203.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0203.1P.1.apn.fit,     ###01
           jflcrusoe0203.1P.1.apn.fit,     ###02
           jflcrusoe0203.1P.1.apln.fit,    ###03
           jflcrusoe0203.1P.1.apln.fit,    ###04
           jflcrusoe0203.1P.1.n.fit,       ###05
           jflcrusoe0203.1P.1.n.fit,       ###06
           jflcrusoe0203.1P.1.ln.fit,      ###07
           jflcrusoe0203.1P.1.ln.fit,      ###08
           jflcrusoe0203.2P.1.apn.fit,     ###09
           jflcrusoe0203.2P.1.apn.fit,     ###10
           jflcrusoe0203.2P.1.apln.fit,    ###11
           jflcrusoe0203.2P.1.apln.fit,    ###12
           jflcrusoe0203.2P.1.n.fit,       ###13
           jflcrusoe0203.2P.1.n.fit,       ###14
           jflcrusoe0203.2P.1.ln.fit,      ###15
           jflcrusoe0203.2P.1.ln.fit)      ###16
m1 <- rep(c("spg","CG"),8)
#
jflcrusoe0203.sum.0  <- CatDynSum(x=x1,season="2003-2003",method=m1)      
# All fits have good gradients
# All fits have too low M but 1P variants are closer
# The AIC favors 1P variants over 2P variants inside each likelihood model
jflcrusoe0203.sum.1  <- jflcrusoe0203.sum.0[jflcrusoe0203.sum.0$Max.Abs.Grads. < 1 & jflcrusoe0203.sum.0$M > 1e-4,]
#
# Correlations
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0203.sum.1))],                     
          ttl=paste(jflcrusoe0203.sum.1$Model,
                    substring(jflcrusoe0203.sum.1$Distribution, 1,8),
                    jflcrusoe0203.sum.1$Method,
                    as.numeric(row.names(jflcrusoe0203.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe0203.sum.1))],
          arr=c(4,2))
# Best correlations in variants ###01 ###06 ###09 ###10
#
(jflcrusoe0203.1P.1.apn.spg.partable    <- CatDynPar(x=jflcrusoe0203.1P.1.apn.fit,method="spg"))    ###01
(jflcrusoe0203.1P.1.n.CG.partable       <- CatDynPar(x=jflcrusoe0203.1P.1.n.fit,method="CG"))       ###06
(jflcrusoe0203.2P.1.apn.spg.partable    <- CatDynPar(x=jflcrusoe0203.2P.1.apn.fit,method="spg"))    ###09
(jflcrusoe0203.2P.1.apn.CG.partable     <- CatDynPar(x=jflcrusoe0203.2P.1.apn.fit,method="CG"))     ###10
#
# CVs are poor but variant ###06 somewhat better, also closer to realistic M
#
jflcrusoe0203.sum.0$Sel.Model[6] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.2.- Depletion models season: 2003-2004                                   #
################################################################################
#
# Data object
#
jflcrusoe0304  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==2,][1:37,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2003-09-01","2004-05-05"))
#
plot(x=jflcrusoe0304,mark=TRUE,offset=c(9,10),hem="S")                          # 40 45 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0304$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 54.24035
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0304$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0304$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0304.0P.apn.ini <- catdynexp(x=jflcrusoe0304,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0304.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0304.0P.apn.fit  <- CatDynFit(x=jflcrusoe0304,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0304.0P.apn.pred.spg <- CatDynPred(jflcrusoe0304.0P.apn.fit,"spg")     # +43 +46 +47
plot(x=jflcrusoe0304.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.0P.apn.pred.CG <- CatDynPred(jflcrusoe0304.0P.apn.fit,"CG")       # +43 +46 +47
plot(x=jflcrusoe0304.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.0P.apln.fit  <- CatDynFit(x=jflcrusoe0304,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0304.0P.apln.pred.spg <- CatDynPred(jflcrusoe0304.0P.apln.fit,"spg")   # +51
plot(x=jflcrusoe0304.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.0P.apln.pred.CG <- CatDynPred(jflcrusoe0304.0P.apln.fit,"CG")     # +51
plot(x=jflcrusoe0304.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 25
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0304$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jflcrusoe0304$Data$nasas$time.step,1))
#
jflcrusoe0304.1P.apn.ini <- catdynexp(x=jflcrusoe0304,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0304.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0304.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0304,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0304.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0304.1P.1.apn.fit,"spg") ###01 45 46
plot(x=jflcrusoe0304.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0304.1P.1.apn.fit,"CG")   ###02 45 46
plot(x=jflcrusoe0304.1P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0304,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0304.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0304.1P.1.apln.fit,"spg") ###03
plot(x=jflcrusoe0304.1P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0304.1P.1.apln.fit,"CG") ###04
plot(x=jflcrusoe0304.1P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0304$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0304$Data$nasas$obscat.thou))^2)
#
jflcrusoe0304.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0304,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0304.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0304.1P.1.n.fit,"spg")     ###05 45 46
plot(x=jflcrusoe0304.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0304.1P.1.n.fit,"CG")       ###06 45 46
plot(x=jflcrusoe0304.1P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0304,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0304.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0304.1P.1.ln.fit,"spg")   ###07
plot(x=jflcrusoe0304.1P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0304.1P.1.ln.fit,"CG")     ###08
plot(x=jflcrusoe0304.1P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 25
P2.ini      <- 45
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0304$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 47,                                                            # the week of one input of abundance
                 tail(jflcrusoe0304$Data$nasas$time.step,1))
#
jflcrusoe0304.2P.apn.ini <- catdynexp(x=jflcrusoe0304,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0304.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 2-input depletion variant
jflcrusoe0304.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0304,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0304.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0304.2P.1.apn.fit,"spg") ###09
plot(x=jflcrusoe0304.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0304.2P.1.apn.fit,"CG")   ###10
plot(x=jflcrusoe0304.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0304,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0304.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0304.2P.1.apln.fit,"spg") ###11
plot(x=jflcrusoe0304.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0304.2P.1.apln.fit,"CG") ###12
plot(x=jflcrusoe0304.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0304,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0304.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0304.2P.1.n.fit,"spg")     ###13 
plot(x=jflcrusoe0304.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0304.2P.1.n.fit,"CG")       ###14
plot(x=jflcrusoe0304.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0304,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0304.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0304.2P.1.ln.fit,"spg")   ###15
plot(x=jflcrusoe0304.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0304.2P.1.ln.fit,"CG")     ###16
plot(x=jflcrusoe0304.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 9*54.24035
P1.ini      <- 45
P2.ini      <- 25
P3.ini      <- 25
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.8                                                              # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0304$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 46,
                 47,                                                            # the week of one input of abundance
                 tail(jflcrusoe0304$Data$nasas$time.step,1))
#
jflcrusoe0304.3P.apn.ini <- catdynexp(x=jflcrusoe0304,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0304.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 3-input depletion variant
jflcrusoe0304.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe0304,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0304.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe0304.3P.1.apn.fit,"spg") ###17
plot(x=jflcrusoe0304.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe0304.3P.1.apn.fit,"CG")   ###18
plot(x=jflcrusoe0304.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe0304,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0304.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe0304.3P.1.apln.fit,"spg") ###19
plot(x=jflcrusoe0304.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe0304.3P.1.apln.fit,"CG") ###20
plot(x=jflcrusoe0304.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.n.fit  <- CatDynFit(x=jflcrusoe0304,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0304.3P.1.n.pred.spg <- CatDynPred(jflcrusoe0304.3P.1.n.fit,"spg")     ###21 
plot(x=jflcrusoe0304.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.n.pred.CG <- CatDynPred(jflcrusoe0304.3P.1.n.fit,"CG")       ###22
plot(x=jflcrusoe0304.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe0304,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0304.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe0304.3P.1.ln.fit,"spg")   ###23
plot(x=jflcrusoe0304.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0304.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe0304.3P.1.ln.fit,"CG")     ###24
plot(x=jflcrusoe0304.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0304.1P.1.apn.fit,     ###01
           jflcrusoe0304.1P.1.apn.fit,     ###02
           jflcrusoe0304.1P.1.apln.fit,    ###03
           jflcrusoe0304.1P.1.apln.fit,    ###04
           jflcrusoe0304.1P.1.n.fit,       ###05
           jflcrusoe0304.1P.1.n.fit,       ###06
           jflcrusoe0304.1P.1.ln.fit,      ###07
           jflcrusoe0304.1P.1.ln.fit,      ###08
           jflcrusoe0304.2P.1.apn.fit,     ###09
           jflcrusoe0304.2P.1.apn.fit,     ###10
           jflcrusoe0304.2P.1.apln.fit,    ###11
           jflcrusoe0304.2P.1.apln.fit,    ###12
           jflcrusoe0304.2P.1.n.fit,       ###13
           jflcrusoe0304.2P.1.n.fit,       ###14
           jflcrusoe0304.2P.1.ln.fit,      ###15
           jflcrusoe0304.2P.1.ln.fit,      ###16
           jflcrusoe0304.3P.1.apn.fit,     ###17
           jflcrusoe0304.3P.1.apn.fit,     ###18
           jflcrusoe0304.3P.1.apln.fit,    ###19
           jflcrusoe0304.3P.1.apln.fit,    ###20
           jflcrusoe0304.3P.1.n.fit,       ###21
           jflcrusoe0304.3P.1.n.fit,       ###22
           jflcrusoe0304.3P.1.ln.fit,      ###23
           jflcrusoe0304.3P.1.ln.fit)      ###24
m1 <- rep(c("spg","CG"),12)
#
jflcrusoe0304.sum.0  <- CatDynSum(x=x1,season="2003-2003",method=m1)      
# All fits have good gradients
# Lognormal likelihood models (aplnormal, lognormal) predict unrealistic abundance
jflcrusoe0304.sum.1 <- jflcrusoe0304.sum.0[jflcrusoe0304.sum.0$Distribution=="apnormal" | jflcrusoe0304.sum.0$Distribution=="normal",]
jflcrusoe0304.sum.1[jflcrusoe0304.sum.1$Distribution=="apnormal",]
jflcrusoe0304.sum.1[jflcrusoe0304.sum.1$Distribution=="normal",]
# The AIC favors 2P variants over 1P and 3P variants inside normal likelihood models
jflcrusoe0304.sum.2 <- jflcrusoe0304.sum.1[jflcrusoe0304.sum.1$Model=="2P",]
# Correlations
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0304.sum.2))],                     
          ttl=paste(jflcrusoe0304.sum.2$Model,
                    substring(jflcrusoe0304.sum.2$Distribution, 1,8),
                    jflcrusoe0304.sum.2$Method,
                    as.numeric(row.names(jflcrusoe0304.sum.2))),
          method=m1[as.numeric(row.names(jflcrusoe0304.sum.2))],
          arr=c(2,2))
# Best correlations in variants ###09 
#
(jflcrusoe0304.2P.1.apn.spg.partable    <- CatDynPar(x=jflcrusoe0304.2P.1.apn.fit,method="spg"))    ###09
#
# Many CVs missing but good for M and main recruitment
#
jflcrusoe0304.sum.0$Sel.Model[9] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.3.- Depletion models season: 2004-2005                                   #
################################################################################
#
# Data object
#
jflcrusoe0405  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==3,][2:34,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2004-09-29","2005-05-05"))
#
plot(x=jflcrusoe0405,mark=TRUE,offset=c(9,10),hem="S")                          # 47 51 52 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0405$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 54.64382
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.64382
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0405$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0405$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0405.0P.apn.ini <- catdynexp(x=jflcrusoe0405,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0405.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0405.0P.apn.fit  <- CatDynFit(x=jflcrusoe0405,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0405.0P.apn.pred.spg <- CatDynPred(jflcrusoe0405.0P.apn.fit,"spg")     # +53
plot(x=jflcrusoe0405.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.0P.apn.pred.CG <- CatDynPred(jflcrusoe0405.0P.apn.fit,"CG")       # +53
plot(x=jflcrusoe0405.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.0P.apln.fit  <- CatDynFit(x=jflcrusoe0405,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0405.0P.apln.pred.spg <- CatDynPred(jflcrusoe0405.0P.apln.fit,"spg")   # +59
plot(x=jflcrusoe0405.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.0P.apln.pred.CG <- CatDynPred(jflcrusoe0405.0P.apln.fit,"CG")     # +59
plot(x=jflcrusoe0405.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*54.24035
P1.ini      <- 75
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.95                                                             # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0405$Data$nasas$time.step,1),                    # now the dates vector also has
                 53,                                                            # the week of one input of abundance
                 tail(jflcrusoe0405$Data$nasas$time.step,1))
#
jflcrusoe0405.1P.apn.ini <- catdynexp(x=jflcrusoe0405,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0405.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0405.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0405,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0405.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0405.1P.1.apn.fit,"spg") ###01 47
plot(x=jflcrusoe0405.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0405.1P.1.apn.fit,"CG")   ###02 47
plot(x=jflcrusoe0405.1P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0405,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0405.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0405.1P.1.apln.fit,"spg") ###03 47
plot(x=jflcrusoe0405.1P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0405.1P.1.apln.fit,"CG") ###04 47
plot(x=jflcrusoe0405.1P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0405$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0405$Data$nasas$obscat.thou))^2)
#
jflcrusoe0405.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0405,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0405.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0405.1P.1.n.fit,"spg")     ###05 47
plot(x=jflcrusoe0405.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0405.1P.1.n.fit,"CG")       ###06 47
plot(x=jflcrusoe0405.1P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0405,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0405.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0405.1P.1.ln.fit,"spg")   ###07 47
plot(x=jflcrusoe0405.1P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0405.1P.1.ln.fit,"CG")     ###08 47
plot(x=jflcrusoe0405.1P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*54.24035
P1.ini      <- 75
P2.ini      <- 45
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0405$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,
                 53,                                                            # the week of one input of abundance
                 tail(jflcrusoe0405$Data$nasas$time.step,1))
#
jflcrusoe0405.2P.apn.ini <- catdynexp(x=jflcrusoe0405,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0405.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0405.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0405,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0405.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0405.2P.1.apn.fit,"spg") ###09
plot(x=jflcrusoe0405.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0405.2P.1.apn.fit,"CG")   ###10
plot(x=jflcrusoe0405.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0405,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0405.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0405.2P.1.apln.fit,"spg") ###11
plot(x=jflcrusoe0405.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0405.2P.1.apln.fit,"CG") ###12
plot(x=jflcrusoe0405.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0405,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0405.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0405.2P.1.n.fit,"spg")     ###13 
plot(x=jflcrusoe0405.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0405.2P.1.n.fit,"CG")       ###14
plot(x=jflcrusoe0405.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0405,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0405.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0405.2P.1.ln.fit,"spg")   ###15
plot(x=jflcrusoe0405.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0405.2P.1.ln.fit,"CG")     ###16
plot(x=jflcrusoe0405.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0405.1P.1.apn.fit,     ###01
           jflcrusoe0405.1P.1.apn.fit,     ###02
           jflcrusoe0405.1P.1.apln.fit,    ###03
           jflcrusoe0405.1P.1.apln.fit,    ###04
           jflcrusoe0405.1P.1.n.fit,       ###05
           jflcrusoe0405.1P.1.n.fit,       ###06
           jflcrusoe0405.1P.1.ln.fit,      ###07
           jflcrusoe0405.1P.1.ln.fit,      ###08
           jflcrusoe0405.2P.1.apn.fit,     ###09
           jflcrusoe0405.2P.1.apn.fit,     ###10
           jflcrusoe0405.2P.1.apln.fit,    ###11
           jflcrusoe0405.2P.1.apln.fit,    ###12
           jflcrusoe0405.2P.1.n.fit,       ###13
           jflcrusoe0405.2P.1.n.fit,       ###14
           jflcrusoe0405.2P.1.ln.fit,      ###15
           jflcrusoe0405.2P.1.ln.fit)      ###16
m1 <- rep(c("spg","CG"),8)
#
jflcrusoe0405.sum.0  <- CatDynSum(x=x1,season="2003-2003",method=m1)      
# All fits have good gradients
jflcrusoe0405.sum.0[jflcrusoe0405.sum.0$Distribution=="apnormal",]
jflcrusoe0405.sum.0[jflcrusoe0405.sum.0$Distribution=="normal",]
jflcrusoe0405.sum.0[jflcrusoe0405.sum.0$Distribution=="aplnormal",]
jflcrusoe0405.sum.0[jflcrusoe0405.sum.0$Distribution=="lognormal",]
# The AIC favors 2P variants over 1P variants inside all four likelihood models
jflcrusoe0405.sum.1 <- jflcrusoe0405.sum.0[jflcrusoe0405.sum.0$Model=="2P",]
# Correlations
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0405.sum.1))],                     
          ttl=paste(jflcrusoe0405.sum.1$Model,
                    substring(jflcrusoe0405.sum.1$Distribution, 1,8),
                    jflcrusoe0405.sum.1$Method,
                    as.numeric(row.names(jflcrusoe0405.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe0405.sum.1))],
          arr=c(4,2))
# Best correlations in variants ###09 
#
(jflcrusoe0405.2P.1.apn.spg.partable    <- CatDynPar(x=jflcrusoe0405.2P.1.apn.fit,method="spg"))    ###09
#
# Some CVs missing but good for recruitments 
#
plot(x=jflcrusoe0405.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0405.sum.0$Sel.Model[9] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.4.- Depletion models season: 2005-2006                                   #
################################################################################
#
# Data object
#
jflcrusoe0506  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==4,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2003-08-30","2004-05-08"))
#
plot(x=jflcrusoe0506,mark=TRUE,offset=c(9,10),hem="S")                          # 40 42 57 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0506$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 54.32931
M.ini       <- 3*0.001937482
N0.ini      <- 10*54.32931
k.ini       <- 1e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0506$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0506.0P.apn.ini <- catdynexp(x=jflcrusoe0506,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0506.0P.apn.fit  <- CatDynFit(x=jflcrusoe0506,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0506.0P.apn.pred.spg <- CatDynPred(jflcrusoe0506.0P.apn.fit,"spg")     # +42 +56 +57
plot(x=jflcrusoe0506.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.0P.apn.pred.CG <- CatDynPred(jflcrusoe0506.0P.apn.fit,"CG")       # +42 +56 +57
plot(x=jflcrusoe0506.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.0P.apln.fit  <- CatDynFit(x=jflcrusoe0506,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0506.0P.apln.pred.spg <- CatDynPred(jflcrusoe0506.0P.apln.fit,"spg")   # +56 57
plot(x=jflcrusoe0506.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.0P.apln.pred.CG <- CatDynPred(jflcrusoe0506.0P.apln.fit,"CG")     # +56 57
plot(x=jflcrusoe0506.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                                  
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 25
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.1P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0506.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0506.1P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0506.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0506.1P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0506.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0506.1P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0506.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0506.1P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0506.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0506$Data$nasas$obscat.thou)^2)              
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0506$Data$nasas$obscat.thou))^2)
#
jflcrusoe0506.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0506.1P.1.n.fit,"spg")     
# plot(x=jflcrusoe0506.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0506.1P.1.n.fit,"CG")     
# plot(x=jflcrusoe0506.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
jflcrusoe0506.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0506.1P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0506.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0506.1P.1.ln.fit,"CG")   
# plot(x=jflcrusoe0506.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
M.ini       <- 3*0.001937482
N0.ini      <- 2*54.24035
P1.ini      <- 45
k.ini       <- 4e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.1P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0506.1P.2.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0506.1P.2.apn.pred.spg <- CatDynPred(jflcrusoe0506.1P.2.apn.fit,"spg") ###01 57 103
plot(x=jflcrusoe0506.1P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.1P.2.apn.pred.CG <- CatDynPred(jflcrusoe0506.1P.2.apn.fit,"CG")   ###02 57 105
plot(x=jflcrusoe0506.1P.2.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.1P.2.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.1P.2.apln.pred.spg <- CatDynPred(jflcrusoe0506.1P.2.apln.fit,"spg")
# plot(x=jflcrusoe0506.1P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.2.apln.pred.CG <- CatDynPred(jflcrusoe0506.1P.2.apln.fit,"CG") 
# plot(x=jflcrusoe0506.1P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0506$Data$nasas$obscat.thou)^2)              
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0506$Data$nasas$obscat.thou))^2)
#
jflcrusoe0506.1P.2.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0506.1P.2.n.pred.spg <- CatDynPred(jflcrusoe0506.1P.2.n.fit,"spg")     ###03 57 94
plot(x=jflcrusoe0506.1P.2.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.1P.2.n.pred.CG <- CatDynPred(jflcrusoe0506.1P.2.n.fit,"CG")       ###04 57 105
plot(x=jflcrusoe0506.1P.2.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.1P.2.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.1P.2.ln.pred.spg <- CatDynPred(jflcrusoe0506.1P.2.ln.fit,"spg") 
# plot(x=jflcrusoe0506.1P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.1P.2.ln.pred.CG <- CatDynPred(jflcrusoe0506.1P.2.ln.fit,"CG")   
# plot(x=jflcrusoe0506.1P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 25
P2.ini      <- 35
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 56,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.2P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0506.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0506.2P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0506.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0506.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0506.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0506.2P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0506.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0506.2P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0506.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0506.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe0506.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0506.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe0506.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0506.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0506.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0506.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0506.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*54.24035
P1.ini      <- 45
P2.ini      <- 10
k.ini       <- 4e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.2P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0506.2P.2.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.2P.2.apn.pred.spg <- CatDynPred(jflcrusoe0506.2P.2.apn.fit,"spg")
# plot(x=jflcrusoe0506.2P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.2.apn.pred.CG <- CatDynPred(jflcrusoe0506.2P.2.apn.fit,"CG")   
# plot(x=jflcrusoe0506.2P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.2.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.2P.2.apln.pred.spg <- CatDynPred(jflcrusoe0506.2P.2.apln.fit,"spg") 
# plot(x=jflcrusoe0506.2P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.2.apln.pred.CG <- CatDynPred(jflcrusoe0506.2P.2.apln.fit,"CG") 
# plot(x=jflcrusoe0506.2P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.2.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.2P.2.n.pred.spg <- CatDynPred(jflcrusoe0506.2P.2.n.fit,"spg")
# plot(x=jflcrusoe0506.2P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.2.n.pred.CG <- CatDynPred(jflcrusoe0506.2P.2.n.fit,"CG")       
# plot(x=jflcrusoe0506.2P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.2P.2.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.2P.2.ln.pred.spg <- CatDynPred(jflcrusoe0506.2P.2.ln.fit,"spg")   
# plot(x=jflcrusoe0506.2P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.2P.2.ln.pred.CG <- CatDynPred(jflcrusoe0506.2P.2.ln.fit,"CG")     
# plot(x=jflcrusoe0506.2P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 25
P2.ini      <- 25
P3.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 53,
                 56,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.3P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 3-input depletion variant
jflcrusoe0506.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe0506.3P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0506.3P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe0506.3P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0506.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe0506.3P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0506.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe0506.3P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0506.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.1.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.3P.1.n.pred.spg <- CatDynPred(jflcrusoe0506.3P.1.n.fit,"spg")     
# plot(x=jflcrusoe0506.3P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.1.n.pred.CG <- CatDynPred(jflcrusoe0506.3P.1.n.fit,"CG")     
# plot(x=jflcrusoe0506.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe0506.3P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0506.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe0506.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0506.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 3*54.24035
P1.ini      <- 25
P2.ini      <- 5
P3.ini      <- 5
k.ini       <- 3.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 56,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.3P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 3-input depletion variant
jflcrusoe0506.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe0506.3P.2.apn.fit,"spg") 
# plot(x=jflcrusoe0506.3P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.2.apn.pred.CG <- CatDynPred(jflcrusoe0506.3P.2.apn.fit,"CG")   
# plot(x=jflcrusoe0506.3P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe0506.3P.2.apln.fit,"spg")
# plot(x=jflcrusoe0506.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.2.apln.pred.CG <- CatDynPred(jflcrusoe0506.3P.2.apln.fit,"CG") 
# plot(x=jflcrusoe0506.3P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.2.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.3P.2.n.pred.spg <- CatDynPred(jflcrusoe0506.3P.2.n.fit,"spg")     
# plot(x=jflcrusoe0506.3P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.2.n.pred.CG <- CatDynPred(jflcrusoe0506.3P.2.n.fit,"CG")       
# plot(x=jflcrusoe0506.3P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe0506.3P.2.ln.fit,"spg")   
# plot(x=jflcrusoe0506.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.3P.2.ln.pred.CG <- CatDynPred(jflcrusoe0506.3P.2.ln.fit,"CG")     
# plot(x=jflcrusoe0506.3P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 6*54.24035
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 53,
                 56,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.4P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 3-input depletion variant
jflcrusoe0506.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0506.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe0506.4P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0506.4P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe0506.4P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0506.4P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe0506.4P.1.apln.fit,"spg")
# plot(x=jflcrusoe0506.4P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe0506.4P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0506.4P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.4P.1.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0506.4P.1.n.pred.spg <- CatDynPred(jflcrusoe0506.4P.1.n.fit,"spg")     
# plot(x=jflcrusoe0506.4P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.4P.1.n.pred.CG <- CatDynPred(jflcrusoe0506.4P.1.n.fit,"CG")       
# plot(x=jflcrusoe0506.4P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe0506.4P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0506.4P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.4P.1.ln.pred.CG <- CatDynPred(jflcrusoe0506.4P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0506.4P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 5 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*54.24035
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 5
P4.ini      <- 2
P5.ini      <- 2
k.ini       <- 3.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 0.9                                                              # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe0506$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 46,
                 53,
                 56,
                 57,                                                            # the week of one input of abundance
                 tail(jflcrusoe0506$Data$nasas$time.step,1))
#
jflcrusoe0506.5P.apn.ini <- catdynexp(x=jflcrusoe0506,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0506.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 5-input depletion variant
jflcrusoe0506.5P.1.apn.fit  <- CatDynFit(x=jflcrusoe0506,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0506.5P.1.apn.pred.spg <- CatDynPred(jflcrusoe0506.5P.1.apn.fit,"spg") ###05 93
plot(x=jflcrusoe0506.5P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.5P.1.apn.pred.CG <- CatDynPred(jflcrusoe0506.5P.1.apn.fit,"CG")   ###06 150
plot(x=jflcrusoe0506.5P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.5P.1.apln.fit  <- CatDynFit(x=jflcrusoe0506,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0506.5P.1.apln.pred.spg <- CatDynPred(jflcrusoe0506.5P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0506.5P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.5P.1.apln.pred.CG <- CatDynPred(jflcrusoe0506.5P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0506.5P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0506.5P.1.n.fit  <- CatDynFit(x=jflcrusoe0506,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0506.5P.1.n.pred.spg <- CatDynPred(jflcrusoe0506.5P.1.n.fit,"spg")     ###07 102
plot(x=jflcrusoe0506.5P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.5P.1.n.pred.CG <- CatDynPred(jflcrusoe0506.5P.1.n.fit,"CG")       ###08 127
plot(x=jflcrusoe0506.5P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.5P.1.ln.fit  <- CatDynFit(x=jflcrusoe0506,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0506.5P.1.ln.pred.spg <- CatDynPred(jflcrusoe0506.5P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0506.5P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0506.5P.1.ln.pred.CG <- CatDynPred(jflcrusoe0506.5P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0506.5P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0506.1P.2.apn.fit,     ###01
           jflcrusoe0506.1P.2.apn.fit,     ###02
           jflcrusoe0506.1P.2.n.fit,       ###03
           jflcrusoe0506.1P.2.n.fit,       ###04
           jflcrusoe0506.5P.1.apn.fit,     ###05
           jflcrusoe0506.5P.1.apn.fit,     ###06
           jflcrusoe0506.5P.1.n.fit,       ###07
           jflcrusoe0506.5P.1.n.fit)       ###08
m1 <- rep(c("spg","CG"),4)
#
jflcrusoe0506.sum.0  <- CatDynSum(x=x1,season="2003-2003",method=m1)  
# All variants have good gradients
jflcrusoe0506.sum.0$M*53
# 5P variants estimate unrealistic M
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0506.sum.1))],                     
          ttl=paste(jflcrusoe0506.sum.1$Model,
                    substring(jflcrusoe0506.sum.1$Distribution, 1,8),
                    jflcrusoe0506.sum.1$Method,
                    as.numeric(row.names(jflcrusoe0506.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe0506.sum.1))],
          arr=c(2,2))
# Best correlations in variants ###01 
#
(jflcrusoe0506.1P.2.apn.spg.partable    <- CatDynPar(x=jflcrusoe0506.1P.2.apn.fit,method="spg"))    ###01
# Good CVs in variant ###01
#
plot(x=jflcrusoe0506.1P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0506.sum.0$Sel.Model[1] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.5.- Depletion models season: 2006-2007                                   #
################################################################################
#
# Data object
#
jflcrusoe0607  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==5,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2003-09-25","2004-05-15"))
#
plot(x=jflcrusoe0607,mark=TRUE,offset=c(9,10,4),hem="S")                        # 41 45 56 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0607$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 53.11087
M.ini       <- 3*0.001937482
N0.ini      <- 3*53.11087
k.ini       <- 1.5e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                              # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0607$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0607$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0607.0P.apn.ini <- catdynexp(x=jflcrusoe0607,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0607.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0607.0P.apn.fit  <- CatDynFit(x=jflcrusoe0607,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0607.0P.apn.pred.spg <- CatDynPred(jflcrusoe0607.0P.apn.fit,"spg")     # 43 56
plot(x=jflcrusoe0607.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.0P.apn.pred.CG <- CatDynPred(jflcrusoe0607.0P.apn.fit,"CG")       # 43 56
plot(x=jflcrusoe0607.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.0P.apln.fit  <- CatDynFit(x=jflcrusoe0607,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0607.0P.apln.pred.spg <- CatDynPred(jflcrusoe0607.0P.apln.fit,"spg")   # 45 55
plot(x=jflcrusoe0607.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.0P.apln.pred.CG <- CatDynPred(jflcrusoe0607.0P.apln.fit,"CG")     # 45 55
plot(x=jflcrusoe0607.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*53.11087
P1.ini      <- 25
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0607$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflcrusoe0607$Data$nasas$time.step,1))
#
jflcrusoe0607.1P.apn.ini <- catdynexp(x=jflcrusoe0607,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0607.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0607.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0607,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0607.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0607.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe0607.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0607.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0607.1P.1.apn.fit,"CG")  
# plot(x=jflcrusoe0607.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0607.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0607,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0607.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0607.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe0607.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0607.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0607.1P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0607.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0607$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0607$Data$nasas$obscat.thou))^2)
#
jflcrusoe0607.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0607,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0607.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0607.1P.1.n.fit,"spg")     
# plot(x=jflcrusoe0607.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0607.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0607.1P.1.n.fit,"CG")       
# plot(x=jflcrusoe0607.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0607.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0607,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0607.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0607.1P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0607.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0607.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0607.1P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0607.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*53.11087
P1.ini      <- 15
P2.ini      <- 10
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0607$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 56,                                                            # the week of one input of abundance
                 tail(jflcrusoe0607$Data$nasas$time.step,1))
#
jflcrusoe0607.2P.apn.ini <- catdynexp(x=jflcrusoe0607,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0607.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0607.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0607,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0607.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0607.2P.1.apn.fit,"spg") ###01 55
plot(x=jflcrusoe0607.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0607.2P.1.apn.fit,"CG")   ###02 51
plot(x=jflcrusoe0607.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0607,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0607.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0607.2P.1.apln.fit,"spg") ###03 94
plot(x=jflcrusoe0607.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0607.2P.1.apln.fit,"CG") ###04 100
plot(x=jflcrusoe0607.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0607,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0607.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0607.2P.1.n.fit,"spg")     ###05 55 
plot(x=jflcrusoe0607.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0607.2P.1.n.fit,"CG")       ###06 50
plot(x=jflcrusoe0607.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0607,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0607.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0607.2P.1.ln.fit,"spg")   ###07 94
plot(x=jflcrusoe0607.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0607.2P.1.ln.fit,"CG")     ###08 101
plot(x=jflcrusoe0607.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0607.2P.1.apn.fit,     ###01
           jflcrusoe0607.2P.1.apn.fit,     ###02
           jflcrusoe0607.2P.1.apln.fit,    ###03
           jflcrusoe0607.2P.1.apln.fit,    ###04
           jflcrusoe0607.2P.1.n.fit,       ###05
           jflcrusoe0607.2P.1.n.fit,       ###06
           jflcrusoe0607.2P.1.ln.fit,      ###07
           jflcrusoe0607.2P.1.ln.fit)      ###08
m1 <- rep(c("spg","CG"),4)
#
jflcrusoe0607.sum.0  <- CatDynSum(x=x1,season="2006-2007",method=m1)      
# All fits have good gradients
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0607.sum.0))],                     
          ttl=paste(jflcrusoe0607.sum.0$Model,
                    substring(jflcrusoe0607.sum.0$Distribution, 1,8),
                    jflcrusoe0607.sum.0$Method,
                    as.numeric(row.names(jflcrusoe0607.sum.0))),
          method=m1[as.numeric(row.names(jflcrusoe0607.sum.0))],
          arr=c(4,2))
# Best correlations in variant ###01, but somewaht good in variants ###02 and ###04 
#
(jflcrusoe0607.2P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe0607.2P.1.apn.fit,method="spg"))    ###01
(jflcrusoe0607.2P.1.apn.CG.partable  <- CatDynPar(x=jflcrusoe0607.2P.1.apn.fit,method="CG"))     ###02
(jflcrusoe0607.2P.1.apln.CG.partable <- CatDynPar(x=jflcrusoe0607.2P.1.apln.fit,method="CG"))    ###04
# Many CVs missing but slightly better in variant ###02
#
plot(x=jflcrusoe0607.2P.1.apn.pred.CG,                                          ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0607.sum.0$Sel.Model[2] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.6.- Depletion models season: 2007-2008                                   #
################################################################################
#
# Data object
#
jflcrusoe0708  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==6,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2007-09-25","2008-05-15"))
#
plot(x=jflcrusoe0708,mark=TRUE,offset=c(9,10,4),hem="S")                        # 43 46 52 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0708$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 39.04745
M.ini       <- 3*0.001937482
N0.ini      <- 3*39.04745
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0708$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0708$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0708.0P.apn.ini <- catdynexp(x=jflcrusoe0708,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0708.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0708.0P.apn.fit  <- CatDynFit(x=jflcrusoe0708,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0708.0P.apn.pred.spg <- CatDynPred(jflcrusoe0708.0P.apn.fit,"spg")     # 59
plot(x=jflcrusoe0708.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.0P.apn.pred.CG <- CatDynPred(jflcrusoe0708.0P.apn.fit,"CG")       # 59
plot(x=jflcrusoe0708.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.0P.apln.fit  <- CatDynFit(x=jflcrusoe0708,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0708.0P.apln.pred.spg <- CatDynPred(jflcrusoe0708.0P.apln.fit,"spg")   # 58
plot(x=jflcrusoe0708.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.0P.apln.pred.CG <- CatDynPred(jflcrusoe0708.0P.apln.fit,"CG")     # 58
plot(x=jflcrusoe0708.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*39.04745
P1.ini      <- 25
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0708$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflcrusoe0708$Data$nasas$time.step,1))
#
jflcrusoe0708.1P.apn.ini <- catdynexp(x=jflcrusoe0708,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0708.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0708.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0708,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0708.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0708.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe0708.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0708.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe0708.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0708.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0708,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0708.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0708.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe0708.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0708.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe0708.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0708$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0708$Data$nasas$obscat.thou))^2)
#
jflcrusoe0708.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0708,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0708.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0708.1P.1.n.fit,"spg")
# plot(x=jflcrusoe0708.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0708.1P.1.n.fit,"CG")
# plot(x=jflcrusoe0708.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0708.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0708,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0708.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0708.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe0708.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0708.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe0708.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*39.04745
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0708$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 46,                                                            # the week of one input of abundance
                 tail(jflcrusoe0708$Data$nasas$time.step,1))
#
jflcrusoe0708.2P.apn.ini <- catdynexp(x=jflcrusoe0708,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0708.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0708.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0708,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0708.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0708.2P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0708.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0708.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0708.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0708.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0708,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0708.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0708.2P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0708.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0708.2P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0708.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0708.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0708,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0708.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0708.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe0708.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0708.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe0708.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0708.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0708,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0708.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0708.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0708.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0708.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0708.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0708.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*39.04745
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0708$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 46,                                                            # the week of one input of abundance
                 57,
                 tail(jflcrusoe0708$Data$nasas$time.step,1))
#
jflcrusoe0708.3P.apn.ini <- catdynexp(x=jflcrusoe0708,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0708.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0708.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe0708,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0708.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe0708.3P.1.apn.fit,"spg") ###01 46
plot(x=jflcrusoe0708.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe0708.3P.1.apn.fit,"CG")   ###02 45
plot(x=jflcrusoe0708.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe0708,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0708.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe0708.3P.1.apln.fit,"spg") ###03 56
plot(x=jflcrusoe0708.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe0708.3P.1.apln.fit,"CG") ###04 59
plot(x=jflcrusoe0708.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.n.fit  <- CatDynFit(x=jflcrusoe0708,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0708.3P.1.n.pred.spg <- CatDynPred(jflcrusoe0708.3P.1.n.fit,"spg")     ###05 46
plot(x=jflcrusoe0708.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.n.pred.CG <- CatDynPred(jflcrusoe0708.3P.1.n.fit,"CG")       ###06 43
plot(x=jflcrusoe0708.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe0708,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0708.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe0708.3P.1.ln.fit,"spg")   ###07 56
plot(x=jflcrusoe0708.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe0708.3P.1.ln.fit,"CG")     ###08 75
plot(x=jflcrusoe0708.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflcrusoe0708.3P.1.apn.fit,     ###01
           jflcrusoe0708.3P.1.apn.fit,     ###02
           jflcrusoe0708.3P.1.apln.fit,    ###03
           jflcrusoe0708.3P.1.apln.fit,    ###04
           jflcrusoe0708.3P.1.n.fit,       ###05
           jflcrusoe0708.3P.1.n.fit,       ###06
           jflcrusoe0708.3P.1.ln.fit,      ###07
           jflcrusoe0708.3P.1.ln.fit)      ###08
m1 <- rep(c("spg","CG"),4)
#
jflcrusoe0708.sum.0  <- CatDynSum(x=x1,season="2007-2008",method=m1)
jflcrusoe0708.sum.1  <- jflcrusoe0708.sum.0[jflcrusoe0708.sum.0$Max.Abs.Grads. < 1,]
# 
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0708.sum.1))],                     
          ttl=paste(jflcrusoe0708.sum.1$Model,
                    substring(jflcrusoe0708.sum.1$Distribution, 1,8),
                    jflcrusoe0708.sum.1$Method,
                    as.numeric(row.names(jflcrusoe0708.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe0708.sum.1))],
          arr=c(4,2))
# Best correlations in variant ###01, ###02 and ###03 
#
(jflcrusoe0708.3P.1.apn.spg.partable  <- CatDynPar(x=jflcrusoe0708.3P.1.apn.fit,method="spg"))     ###01
(jflcrusoe0708.3P.1.apn.CG.partable   <- CatDynPar(x=jflcrusoe0708.3P.1.apn.fit,method="CG"))      ###02
(jflcrusoe0708.3P.1.apln.spg.partable <- CatDynPar(x=jflcrusoe0708.3P.1.apln.fit,method="spg"))    ###04
# All have poor CV for M but ###01 slightly better overall 
#
plot(x=jflcrusoe0708.3P.1.apn.pred.spg,                                         ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0708.sum.0$Sel.Model[1] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.7.- Depletion models season: 2008-2009                                   #
################################################################################
#
# Data object
#
jflcrusoe0809  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==7,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2008-09-16","2009-05-15"))
#
plot(x=jflcrusoe0809,mark=TRUE,offset=c(9,10,4),hem="S")                        # 44 54 55 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0809$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 48.26034
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0809$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0809.0P.apn.ini <- catdynexp(x=jflcrusoe0809,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0809.0P.apn.fit  <- CatDynFit(x=jflcrusoe0809,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0809.0P.apn.pred.spg <- CatDynPred(jflcrusoe0809.0P.apn.fit,"spg")     # 44 54 55
plot(x=jflcrusoe0809.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.0P.apn.pred.CG <- CatDynPred(jflcrusoe0809.0P.apn.fit,"CG")       # 44 54 55
plot(x=jflcrusoe0809.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.0P.apln.fit  <- CatDynFit(x=jflcrusoe0809,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.0P.apln.pred.spg <- CatDynPred(jflcrusoe0809.0P.apln.fit,"spg")   # 58
# plot(x=jflcrusoe0809.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.0P.apln.pred.CG <- CatDynPred(jflcrusoe0809.0P.apln.fit,"CG")     # 58
# plot(x=jflcrusoe0809.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
P1.ini      <- 25
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,                                                            # the week of one input of abundance
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.1P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0809.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0809.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe0809.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0809.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe0809.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0809.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe0809.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0809.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe0809.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0809$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0809$Data$nasas$obscat.thou))^2)
#
jflcrusoe0809.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0809.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0809.1P.1.n.fit,"spg")
# plot(x=jflcrusoe0809.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0809.1P.1.n.fit,"CG")
# plot(x=jflcrusoe0809.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0809.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe0809.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0809.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe0809.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 54,                                                            # the week of one input of abundance
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.2P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0809.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0809.2P.1.apn.fit,"spg") ###01 181
plot(x=jflcrusoe0809.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0809.2P.1.apn.fit,"CG")   ###02 275
plot(x=jflcrusoe0809.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0809.2P.1.apln.fit,"spg") 
# plot(x=jflcrusoe0809.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0809.2P.1.apln.fit,"CG") 
# plot(x=jflcrusoe0809.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0809.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0809.2P.1.n.fit,"spg")     ###03 188
plot(x=jflcrusoe0809.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0809.2P.1.n.fit,"CG")       ###04 279
plot(x=jflcrusoe0809.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0809.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0809.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0809.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0809.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*48.26034
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 44,                                                            # the week of one input of abundance
                 55,
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.3P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0809.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe0809.3P.1.apn.fit,"spg") ###05 128
plot(x=jflcrusoe0809.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe0809.3P.1.apn.fit,"CG")   ###06 179
plot(x=jflcrusoe0809.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe0809.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe0809.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe0809.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe0809.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.3P.1.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0809.3P.1.n.pred.spg <- CatDynPred(jflcrusoe0809.3P.1.n.fit,"spg")     ###07 129
plot(x=jflcrusoe0809.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.3P.1.n.pred.CG <- CatDynPred(jflcrusoe0809.3P.1.n.fit,"CG")       ###08 171
plot(x=jflcrusoe0809.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe0809.3P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0809.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe0809.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0809.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*48.26034
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 44,                                                            # the week of one input of abundance
                 55,
                 58,
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.4P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0809.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe0809.4P.1.apn.fit,"spg") ###09 108
plot(x=jflcrusoe0809.4P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe0809.4P.1.apn.fit,"CG")   ###10 132
plot(x=jflcrusoe0809.4P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe0809.4P.1.apln.fit,"spg")
# plot(x=jflcrusoe0809.4P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe0809.4P.1.apln.fit,"CG")
# plot(x=jflcrusoe0809.4P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.4P.1.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0809.4P.1.n.pred.spg <- CatDynPred(jflcrusoe0809.4P.1.n.fit,"spg")     ###11 113
plot(x=jflcrusoe0809.4P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.1.n.pred.CG <- CatDynPred(jflcrusoe0809.4P.1.n.fit,"CG")       ###12 132
plot(x=jflcrusoe0809.4P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe0809.4P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0809.4P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.1.ln.pred.CG <- CatDynPred(jflcrusoe0809.4P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0809.4P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*48.26034
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 38, #38
                 43, #44                                                        # the week of one input of abundance
                 51, #51
                 58, #54
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.4P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.4P.2.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0809.4P.2.apn.pred.spg <- CatDynPred(jflcrusoe0809.4P.2.apn.fit,"spg") ###13 93
plot(x=jflcrusoe0809.4P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.2.apn.pred.CG <- CatDynPred(jflcrusoe0809.4P.2.apn.fit,"CG")   ###14 82
plot(x=jflcrusoe0809.4P.2.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.2.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.4P.2.apln.pred.spg <- CatDynPred(jflcrusoe0809.4P.2.apln.fit,"spg")
# plot(x=jflcrusoe0809.4P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.2.apln.pred.CG <- CatDynPred(jflcrusoe0809.4P.2.apln.fit,"CG")
# plot(x=jflcrusoe0809.4P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.4P.2.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0809.4P.2.n.pred.spg <- CatDynPred(jflcrusoe0809.4P.2.n.fit,"spg")     ###15 92
plot(x=jflcrusoe0809.4P.2.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.2.n.pred.CG <- CatDynPred(jflcrusoe0809.4P.2.n.fit,"CG")       ###16 87
plot(x=jflcrusoe0809.4P.2.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.4P.2.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.4P.2.ln.pred.spg <- CatDynPred(jflcrusoe0809.4P.2.ln.fit,"spg")   
# plot(x=jflcrusoe0809.4P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.2.ln.pred.CG <- CatDynPred(jflcrusoe0809.4P.2.ln.fit,"CG")     
# plot(x=jflcrusoe0809.4P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*48.26034
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe0809$Data$nasas$time.step,1),                    # now the dates vector also has
                 38, 
                 44,                                                            # the week of one input of abundance
                 51,  
                 54, 
                 tail(jflcrusoe0809$Data$nasas$time.step,1))
#
jflcrusoe0809.4P.apn.ini <- catdynexp(x=jflcrusoe0809,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0809.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0809.4P.3.apn.fit  <- CatDynFit(x=jflcrusoe0809,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0809.4P.3.apn.pred.spg <- CatDynPred(jflcrusoe0809.4P.3.apn.fit,"spg") 
# plot(x=jflcrusoe0809.4P.3.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.3.apn.pred.CG <- CatDynPred(jflcrusoe0809.4P.3.apn.fit,"CG")   
# plot(x=jflcrusoe0809.4P.3.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.4P.3.apln.fit  <- CatDynFit(x=jflcrusoe0809,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe0809.4P.3.apln.pred.spg <- CatDynPred(jflcrusoe0809.4P.3.apln.fit,"spg")
# plot(x=jflcrusoe0809.4P.3.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.3.apln.pred.CG <- CatDynPred(jflcrusoe0809.4P.3.apln.fit,"CG")
# plot(x=jflcrusoe0809.4P.3.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.4P.3.n.fit  <- CatDynFit(x=jflcrusoe0809,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0809.4P.3.n.pred.spg <- CatDynPred(jflcrusoe0809.4P.3.n.fit,"spg")   
# plot(x=jflcrusoe0809.4P.3.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe0809.4P.3.n.pred.CG <- CatDynPred(jflcrusoe0809.4P.3.n.fit,"CG")     
# plot(x=jflcrusoe0809.4P.3.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0809.4P.3.ln.fit  <- CatDynFit(x=jflcrusoe0809,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0809.4P.3.ln.pred.spg <- CatDynPred(jflcrusoe0809.4P.3.ln.fit,"spg")   
# plot(x=jflcrusoe0809.4P.3.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0809.4P.3.ln.pred.CG <- CatDynPred(jflcrusoe0809.4P.3.ln.fit,"CG")     
# plot(x=jflcrusoe0809.4P.3.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe0809.2P.1.apn.fit,     ###01
           jflcrusoe0809.2P.1.apn.fit,     ###02
           jflcrusoe0809.2P.1.n.fit,       ###03
           jflcrusoe0809.2P.1.n.fit,       ###04
           jflcrusoe0809.3P.1.apn.fit,     ###05
           jflcrusoe0809.3P.1.apn.fit,     ###06
           jflcrusoe0809.3P.1.n.fit,       ###07
           jflcrusoe0809.3P.1.n.fit,       ###08
           jflcrusoe0809.4P.1.apn.fit,     ###09
           jflcrusoe0809.4P.1.apn.fit,     ###10
           jflcrusoe0809.4P.1.n.fit,       ###11
           jflcrusoe0809.4P.1.n.fit,       ###12
           jflcrusoe0809.4P.2.apn.fit,     ###13
           jflcrusoe0809.4P.2.apn.fit,     ###14
           jflcrusoe0809.4P.2.n.fit,       ###15
           jflcrusoe0809.4P.2.n.fit)       ###16
m1 <- rep(c("spg","CG"),8)
#
jflcrusoe0809.sum.0  <- CatDynSum(x=x1,season="2008-2009",method=m1)
# All gradients ok
jflcrusoe0809.sum.0[jflcrusoe0809.sum.0$Distribution=="apnormal",]
jflcrusoe0809.sum.0[jflcrusoe0809.sum.0$Distribution=="normal",]
# AIC inconclusive from 2P tp 4P though 4P.2 strongly disfavored yet only one with realistic M and esc biomass
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0809.sum.0))],                     
          ttl=paste(jflcrusoe0809.sum.0$Model,
                    substring(jflcrusoe0809.sum.0$Distribution, 1,8),
                    jflcrusoe0809.sum.0$Method,
                    as.numeric(row.names(jflcrusoe0809.sum.0))),
          method=m1[as.numeric(row.names(jflcrusoe0809.sum.0))],
          arr=c(4,4))
# Best correlations in variant ###05 ###10 ###15 
#
(jflcrusoe0809.3P.1.apn.spg.partable  <- CatDynPar(x=jflcrusoe0809.3P.1.apn.fit,method="spg"))   ###05
(jflcrusoe0809.4P.1.apn.CG.partable   <- CatDynPar(x=jflcrusoe0809.4P.1.apn.fit,method="CG"))    ###10
(jflcrusoe0809.4P.2.n.spg.partable    <- CatDynPar(x=jflcrusoe0809.4P.2.n.fit,method="spg"))     ###15
# Going withvariant ###15 for having the single realistic M estimate 
#
plot(x=jflcrusoe0809.4P.2.n.pred.spg,                                           ###15 92
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0809.sum.0$Sel.Model[15] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.8.- Depletion models season: 2009-2010                                   #
################################################################################
#
# Data object
#
jflcrusoe0910  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==8,][4:38,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2009-09-21","2010-05-15"))
#
plot(x=jflcrusoe0910,mark=TRUE,offset=c(9,10,4),hem="S")                        # 44 53 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe0910$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 45.90018
M.ini       <- 3*0.001937482
N0.ini      <- 3*45.90018
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe0910$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe0910$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe0910.0P.apn.ini <- catdynexp(x=jflcrusoe0910,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0910.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe0910.0P.apn.fit  <- CatDynFit(x=jflcrusoe0910,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe0910.0P.apn.pred.spg <- CatDynPred(jflcrusoe0910.0P.apn.fit,"spg")     # 44 56
plot(x=jflcrusoe0910.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.0P.apn.pred.CG <- CatDynPred(jflcrusoe0910.0P.apn.fit,"CG")       # 44 56
plot(x=jflcrusoe0910.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.0P.apln.fit  <- CatDynFit(x=jflcrusoe0910,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0910.0P.apln.pred.spg <- CatDynPred(jflcrusoe0910.0P.apln.fit,"spg")   # 44 56
plot(x=jflcrusoe0910.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.0P.apln.pred.CG <- CatDynPred(jflcrusoe0910.0P.apln.fit,"CG")     # 44 56
plot(x=jflcrusoe0910.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
P1.ini      <- 25
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe0910$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,                                                            # the week of one input of abundance
                 tail(jflcrusoe0910$Data$nasas$time.step,1))
#
jflcrusoe0910.1P.apn.ini <- catdynexp(x=jflcrusoe0910,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0910.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0910.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe0910,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0910.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe0910.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe0910.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe0910.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe0910.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe0910,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0910.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe0910.1P.1.apln.fit,"spg") ###01 52
plot(x=jflcrusoe0910.1P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe0910.1P.1.apln.fit,"CG") ###02 52
plot(x=jflcrusoe0910.1P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe0910$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe0910$Data$nasas$obscat.thou))^2)
#
jflcrusoe0910.1P.1.n.fit  <- CatDynFit(x=jflcrusoe0910,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0910.1P.1.n.pred.spg <- CatDynPred(jflcrusoe0910.1P.1.n.fit,"spg")
# plot(x=jflcrusoe0910.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.1P.1.n.pred.CG <- CatDynPred(jflcrusoe0910.1P.1.n.fit,"CG")
# plot(x=jflcrusoe0910.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe0910,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0910.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe0910.1P.1.ln.fit,"spg")   ###03 52
plot(x=jflcrusoe0910.1P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe0910.1P.1.ln.fit,"CG")     ###04 54
plot(x=jflcrusoe0910.1P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe0910$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 56,                                                            # the week of one input of abundance
                 tail(jflcrusoe0910$Data$nasas$time.step,1))
#
jflcrusoe0910.2P.apn.ini <- catdynexp(x=jflcrusoe0910,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0910.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0910.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe0910,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe0910.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe0910.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe0910.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe0910.2P.1.apn.fit,"CG")   #
# plot(x=jflcrusoe0910.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe0910,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0910.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe0910.2P.1.apln.fit,"spg") ###05 67
plot(x=jflcrusoe0910.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe0910.2P.1.apln.fit,"CG") ###06 47
plot(x=jflcrusoe0910.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe0910.2P.1.n.fit  <- CatDynFit(x=jflcrusoe0910,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0910.2P.1.n.pred.spg <- CatDynPred(jflcrusoe0910.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe0910.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.2P.1.n.pred.CG <- CatDynPred(jflcrusoe0910.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe0910.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe0910,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe0910.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe0910.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe0910.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe0910.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0910.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*48.26034
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 10
k.ini       <- 1.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe0910$Data$nasas$time.step,1),                    # now the dates vector also has
                 38,
                 43,                                                            # the week of one input of abundance
                 56,
                 tail(jflcrusoe0910$Data$nasas$time.step,1))
#
jflcrusoe0910.3P.apn.ini <- catdynexp(x=jflcrusoe0910,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe0910.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe0910.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe0910,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe0910.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe0910.3P.1.apn.fit,"spg") 
# plot(x=jflcrusoe0910.3P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe0910.3P.1.apn.fit,"CG")   
# plot(x=jflcrusoe0910.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe0910,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method="spg",#c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe0910.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe0910.3P.1.apln.fit,"spg") ###07 65
plot(x=jflcrusoe0910.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe0910.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe0910.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe0910.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.3P.1.n.fit  <- CatDynFit(x=jflcrusoe0910,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe0910.3P.1.n.pred.spg <- CatDynPred(jflcrusoe0910.3P.1.n.fit,"spg")     
# plot(x=jflcrusoe0910.3P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe0910.3P.1.n.pred.CG <- CatDynPred(jflcrusoe0910.3P.1.n.fit,"CG")       
# plot(x=jflcrusoe0910.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe0910.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe0910,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method="spg",#c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe0910.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe0910.3P.1.ln.fit,"spg")   ###08 50
plot(x=jflcrusoe0910.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe0910.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe0910.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe0910.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflcrusoe0910.1P.1.apln.fit,     ###01
           jflcrusoe0910.1P.1.apln.fit,     ###02
           jflcrusoe0910.1P.1.ln.fit,       ###03
           jflcrusoe0910.1P.1.ln.fit,       ###04
           jflcrusoe0910.2P.1.apln.fit,     ###05
           jflcrusoe0910.2P.1.apln.fit,     ###06{}
           jflcrusoe0910.3P.1.apln.fit,     ###07
           jflcrusoe0910.3P.1.ln.fit)       ###08
m1 <- c(rep(c("spg","CG"),3),"spg","spg")
#
jflcrusoe0910.sum.0  <- CatDynSum(x=x1,season="2009-2010",method=m1)
# All gradients ok
jflcrusoe0910.sum.0[jflcrusoe0910.sum.0$Distribution=="aplnormal",]
jflcrusoe0910.sum.0[jflcrusoe0910.sum.0$Distribution=="lognormal",]
jflcrusoe0910.sum.1  <- jflcrusoe0910.sum.0[jflcrusoe0910.sum.0$Model=="1P",]
# AIC favour 1P
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe0910.sum.1))],                     
          ttl=paste(jflcrusoe0910.sum.1$Model,
                    substring(jflcrusoe0910.sum.1$Distribution, 1,8),
                    jflcrusoe0910.sum.1$Method,
                    as.numeric(row.names(jflcrusoe0910.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe0910.sum.1))],
          arr=c(2,2))
# Best correlations in variant ###01 and ###02
#
(jflcrusoe0910.1P.1.apln.spg.partable  <- CatDynPar(x=jflcrusoe0910.1P.1.apln.fit,method="spg"))   ###01
(jflcrusoe0910.1P.1.apln.CG.partable   <- CatDynPar(x=jflcrusoe0910.1P.1.apln.fit,method="CG"))    ###02
# Both variants have poor M estimate and CVs and ###01 slightly more realistic M
#
plot(x=jflcrusoe0910.1P.1.apln.pred.spg,                                        ###01 52
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflcrusoe0910.1P.1.apln.pred.CG,                                         ###02 52
    leg.pos="topright",
    Biom.tstep=1,
    Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
    Biom.xpos=0.8,
    Biom.ypos=0.9,
    Cat.xpos=0.8,
    Cat.ypos=0.85)
#
jflcrusoe0910.sum.0$Sel.Model[1] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.9.- Depletion models season: 2010-2011                                   #
################################################################################
#
# Data object
#
jflcrusoe1011  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==9,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2009-08-30","2010-05-23"))
#
plot(x=jflcrusoe1011,mark=TRUE,offset=c(9,10,4),hem="S")                        # 37 46 52 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1011$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 82.3301
M.ini       <- 3*0.001937482
N0.ini      <- 3*82.3301
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1011$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1011$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1011.0P.apn.ini <- catdynexp(x=jflcrusoe1011,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1011.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1011.0P.apn.fit  <- CatDynFit(x=jflcrusoe1011,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1011.0P.apn.pred.spg <- CatDynPred(jflcrusoe1011.0P.apn.fit,"spg")     # 37 46
plot(x=jflcrusoe1011.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.0P.apn.pred.CG <- CatDynPred(jflcrusoe1011.0P.apn.fit,"CG")       # 37 46
plot(x=jflcrusoe1011.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.0P.apln.fit  <- CatDynFit(x=jflcrusoe1011,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1011.0P.apln.pred.spg <- CatDynPred(jflcrusoe1011.0P.apln.fit,"spg")   # 37 46 52
plot(x=jflcrusoe1011.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.0P.apln.pred.CG <- CatDynPred(jflcrusoe1011.0P.apln.fit,"CG")     # 37 46 52
plot(x=jflcrusoe1011.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*82.3301
P1.ini      <- 25
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 37,                                                            # the week of one input of abundance
                 tail(jflcrusoe1011$Data$nasas$time.step,1))
#
jflcrusoe1011.1P.apn.ini <- catdynexp(x=jflcrusoe1011,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1011.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1011.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1011,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1011.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1011.1P.1.apn.fit,"spg") ###01 132
plot(x=jflcrusoe1011.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1011.1P.1.apn.fit,"CG")   ###02 94
plot(x=jflcrusoe1011.1P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1011,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1011.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1011.1P.1.apln.fit,"spg") 
# plot(x=jflcrusoe1011.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1011.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1011.1P.1.apln.fit,"CG") 
# plot(x=jflcrusoe1011.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1011$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1011$Data$nasas$obscat.thou))^2)
#
jflcrusoe1011.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1011,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1011.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1011.1P.1.n.fit,"spg")     ###03 128
plot(x=jflcrusoe1011.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1011.1P.1.n.fit,"CG")       ###04 94
plot(x=jflcrusoe1011.1P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1011,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1011.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1011.1P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1011.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1011.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1011.1P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1011.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*82.3301
P1.ini      <- 20
P2.ini      <- 10
k.ini       <- 3.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 37,
                 46,                                                            # the week of one input of abundance
                 tail(jflcrusoe1011$Data$nasas$time.step,1))
#
jflcrusoe1011.2P.apn.ini <- catdynexp(x=jflcrusoe1011,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1011.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1011.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1011,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1011.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1011.2P.1.apn.fit,"spg") ###05 91
plot(x=jflcrusoe1011.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1011.2P.1.apn.fit,"CG")   ###06 69
plot(x=jflcrusoe1011.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1011,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1011.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1011.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1011.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1011.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1011.2P.1.apln.fit,"CG") 
# plot(x=jflcrusoe1011.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1011.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1011,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1011.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1011.2P.1.n.fit,"spg")     ###07 92
plot(x=jflcrusoe1011.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1011.2P.1.n.fit,"CG")       ###08 64
plot(x=jflcrusoe1011.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1011,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1011.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1011.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1011.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1011.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1011.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1011.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*82.3301
P1.ini      <- 20
P2.ini      <- 10
P3.ini      <- 10
k.ini       <- 3.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 37,
                 46,                                                            # the week of one input of abundance
                 62,
                 tail(jflcrusoe1011$Data$nasas$time.step,1))
#
jflcrusoe1011.3P.apn.ini <- catdynexp(x=jflcrusoe1011,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1011.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1011.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1011,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1011.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1011.3P.1.apn.fit,"spg") ###09 74
plot(x=jflcrusoe1011.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1011.3P.1.apn.fit,"CG")   ###10 58
plot(x=jflcrusoe1011.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1011,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1011.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1011.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe1011.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1011.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1011.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe1011.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1011.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1011,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1011.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1011.3P.1.n.fit,"spg")     ###11 74
plot(x=jflcrusoe1011.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1011.3P.1.n.fit,"CG")       ###12 57
plot(x=jflcrusoe1011.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1011,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1011.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1011.3P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1011.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1011.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1011.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1011.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflcrusoe1011.1P.1.apn.fit,     ###01                               
           jflcrusoe1011.1P.1.apn.fit,     ###02
           jflcrusoe1011.1P.1.n.fit,       ###03
           jflcrusoe1011.1P.1.n.fit,       ###04
           jflcrusoe1011.2P.1.apn.fit,     ###05
           jflcrusoe1011.2P.1.apn.fit,     ###06
           jflcrusoe1011.2P.1.n.fit,       ###07
           jflcrusoe1011.2P.1.n.fit,       ###08
           jflcrusoe1011.3P.1.apn.fit,     ###09
           jflcrusoe1011.3P.1.apn.fit,     ###10
           jflcrusoe1011.3P.1.n.fit,       ###11
           jflcrusoe1011.3P.1.n.fit)       ###12
m1 <- rep(c("spg","CG"),6)
#
jflcrusoe1011.sum.0  <- CatDynSum(x=x1,season="2009-2010",method=m1)
# All gradients ok
jflcrusoe1011.sum.0[jflcrusoe1011.sum.0$Distribution=="apnormal",]
jflcrusoe1011.sum.0[jflcrusoe1011.sum.0$Distribution=="normal",]
jflcrusoe1011.sum.1  <- jflcrusoe1011.sum.0[jflcrusoe1011.sum.0$Model=="2P",]
# AIC favour 2P
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1011.sum.1))],                     
          ttl=paste(jflcrusoe1011.sum.1$Model,
                    substring(jflcrusoe1011.sum.1$Distribution, 1,8),
                    jflcrusoe1011.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1011.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1011.sum.1))],
          arr=c(2,2))
# Best correlations in variant ###05 and ###06
#
(jflcrusoe1011.2P.1.apn.spg.partable  <- CatDynPar(x=jflcrusoe1011.2P.1.apn.fit,method="spg"))   ###05
(jflcrusoe1011.2P.1.apn.CG.partable   <- CatDynPar(x=jflcrusoe1011.2P.1.apn.fit,method="CG"))    ###06
# Both variants have poor M estimate and CVs and ###05 is better otherwise
#
plot(x=jflcrusoe1011.2P.1.apn.pred.spg,                                         ###05 91
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1011.sum.0$Sel.Model[5] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.10.- Depletion models season: 2011-2012                                  #
################################################################################
#
# Data object
#
jflcrusoe1112  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==10,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2011-09-26","2012-05-14"))
#
plot(x=jflcrusoe1112,mark=TRUE,offset=c(9,10,4),hem="S")                        # 43 44 52 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1112$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 98.61327
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*98.61327
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1112$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1112.0P.apn.ini <- catdynexp(x=jflcrusoe1112,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1112.0P.apn.fit  <- CatDynFit(x=jflcrusoe1112,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1112.0P.apn.pred.spg <- CatDynPred(jflcrusoe1112.0P.apn.fit,"spg")     # 43 44 52
plot(x=jflcrusoe1112.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.0P.apn.pred.CG <- CatDynPred(jflcrusoe1112.0P.apn.fit,"CG")       # 43 44 52
plot(x=jflcrusoe1112.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.0P.apln.fit  <- CatDynFit(x=jflcrusoe1112,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.0P.apln.pred.spg <- CatDynPred(jflcrusoe1112.0P.apln.fit,"spg")   
# plot(x=jflcrusoe1112.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.0P.apln.pred.CG <- CatDynPred(jflcrusoe1112.0P.apln.fit,"CG")     
# plot(x=jflcrusoe1112.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*98.61327
P1.ini      <- 45
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflcrusoe1112$Data$nasas$time.step,1))
#
jflcrusoe1112.1P.apn.ini <- catdynexp(x=jflcrusoe1112,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1112.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1112,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1112.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1112.1P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1112.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1112.1P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1112.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1112,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1112.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1112.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1112.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1112.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1112.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1112.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1112.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1112$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1112$Data$nasas$obscat.thou))^2)
#
jflcrusoe1112.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1112,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1112.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1112.1P.1.n.fit,"spg")     
# plot(x=jflcrusoe1112.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1112.1P.1.n.fit,"CG")       
# plot(x=jflcrusoe1112.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1112,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1112.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1112.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1112.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1112.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*98.61327
P1.ini      <- 45
P2.ini      <- 20
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 44,                                                            # the week of one input of abundance
                 tail(jflcrusoe1112$Data$nasas$time.step,1))
#
jflcrusoe1112.2P.apn.ini <- catdynexp(x=jflcrusoe1112,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1112.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1112,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1112.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1112.2P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1112.2P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1112.2P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1112.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1112.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1112.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1112,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1112.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1112.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1112.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1112.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1112.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1112.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1112.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1112,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1112.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1112.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe1112.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1112.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe1112.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1112,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1112.2P.1.ln.fit,"spg")
# plot(x=jflcrusoe1112.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1112.2P.1.ln.fit,"CG")
# plot(x=jflcrusoe1112.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 0.5*98.61327
P1.ini      <- 25
P2.ini      <- 90
k.ini       <- 3.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,
                 52,                                                            # the week of one input of abundance
                 tail(jflcrusoe1112$Data$nasas$time.step,1))
#
jflcrusoe1112.2P.apn.ini <- catdynexp(x=jflcrusoe1112,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1112.2P.2.apn.fit  <- CatDynFit(x=jflcrusoe1112,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1112.2P.2.apn.pred.NM <- CatDynPred(jflcrusoe1112.2P.2.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1112.2P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.2.apn.pred.spg <- CatDynPred(jflcrusoe1112.2P.2.apn.fit,"spg")
# plot(x=jflcrusoe1112.2P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.2.apn.pred.CG <- CatDynPred(jflcrusoe1112.2P.2.apn.fit,"CG")   
# plot(x=jflcrusoe1112.2P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.2.apln.fit  <- CatDynFit(x=jflcrusoe1112,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1112.2P.2.apln.pred.spg <- CatDynPred(jflcrusoe1112.2P.2.apln.fit,"spg")
# plot(x=jflcrusoe1112.2P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.2.apln.pred.CG <- CatDynPred(jflcrusoe1112.2P.2.apln.fit,"CG")
# plot(x=jflcrusoe1112.2P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.2.n.fit  <- CatDynFit(x=jflcrusoe1112,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method="spg",#c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1112.2P.2.n.pred.spg <- CatDynPred(jflcrusoe1112.2P.2.n.fit,"spg")
# plot(x=jflcrusoe1112.2P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.2.n.pred.CG <- CatDynPred(jflcrusoe1112.2P.2.n.fit,"CG")       
# plot(x=jflcrusoe1112.2P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.2P.2.ln.fit  <- CatDynFit(x=jflcrusoe1112,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.2P.2.ln.pred.spg <- CatDynPred(jflcrusoe1112.2P.2.ln.fit,"spg")
# plot(x=jflcrusoe1112.2P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.2P.2.ln.pred.CG <- CatDynPred(jflcrusoe1112.2P.2.ln.fit,"CG")
# plot(x=jflcrusoe1112.2P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*98.61327
P1.ini      <- 45
P2.ini      <- 20
P3.ini      <- 25
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 44,                                                            # the week of one input of abundance
                 52,
                 tail(jflcrusoe1112$Data$nasas$time.step,1))
#
jflcrusoe1112.3P.apn.ini <- catdynexp(x=jflcrusoe1112,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1112.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1112,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe1112.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1112.3P.1.apn.fit,"spg") ###01 121
plot(x=jflcrusoe1112.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1112.3P.1.apn.fit,"CG")   ###02 151
plot(x=jflcrusoe1112.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1112.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1112.3P.1.apn.fit,"Nelder-Mead")  
# plot(x=jflcrusoe1112.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1112,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1112.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1112.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1112.3P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1112.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe1112.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1112.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe1112.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1112,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1112.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1112.3P.1.n.fit,"spg")     ###03 120
plot(x=jflcrusoe1112.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1112.3P.1.n.fit,"CG")       ###04 156
plot(x=jflcrusoe1112.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1112,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1112.3P.1.ln.fit,"spg")
# plot(x=jflcrusoe1112.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1112.3P.1.ln.fit,"CG")
# plot(x=jflcrusoe1112.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 0.15*98.61327
P1.ini      <- 55
P2.ini      <- 45
P3.ini      <- 41
k.ini       <- 8e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 0.85                                                             # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,
                 44,                                                            # the week of one input of abundance
                 52,
                 tail(jflcrusoe1112$Data$nasas$time.step,1))
#
jflcrusoe1112.3P.apn.ini <- catdynexp(x=jflcrusoe1112,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1112.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1112.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe1112,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method="Nelder-Mead",c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1112.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe1112.3P.2.apn.fit,"spg") 
# plot(x=jflcrusoe1112.3P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.2.apn.pred.CG <- CatDynPred(jflcrusoe1112.3P.2.apn.fit,"CG")
# plot(x=jflcrusoe1112.3P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.3P.2.apn.pred.NM <- CatDynPred(jflcrusoe1112.3P.2.apn.fit,"Nelder-Mead") ###05 36
plot(x=jflcrusoe1112.3P.2.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe1112,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1112.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe1112.3P.2.apln.fit,"spg")
# plot(x=jflcrusoe1112.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.2.apln.pred.CG <- CatDynPred(jflcrusoe1112.3P.2.apln.fit,"CG")
# plot(x=jflcrusoe1112.3P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.3P.2.n.fit  <- CatDynFit(x=jflcrusoe1112,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1112.3P.2.n.pred.spg <- CatDynPred(jflcrusoe1112.3P.2.n.fit,"spg")     
# plot(x=jflcrusoe1112.3P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.2.n.pred.CG <- CatDynPred(jflcrusoe1112.3P.2.n.fit,"CG")       
# plot(x=jflcrusoe1112.3P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1112.3P.2.n.pred.NM <- CatDynPred(jflcrusoe1112.3P.2.n.fit,"Nelder-Mead") ###06 38       
plot(x=jflcrusoe1112.3P.2.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe1112,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1112.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe1112.3P.2.ln.fit,"spg")
# plot(x=jflcrusoe1112.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1112.3P.2.ln.pred.CG <- CatDynPred(jflcrusoe1112.3P.2.ln.fit,"CG")
# plot(x=jflcrusoe1112.3P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1112.3P.1.apn.fit,     ###01                               
           jflcrusoe1112.3P.1.apn.fit,     ###02
           jflcrusoe1112.3P.1.n.fit,       ###03
           jflcrusoe1112.3P.1.n.fit,       ###04
           jflcrusoe1112.3P.2.apn.fit,     ###05
           jflcrusoe1112.3P.2.n.fit)       ###06
           
m1 <- c("spg","CG","spg","CG","Nelder-Mead","Nelder-Mead")
#
jflcrusoe1112.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
jflcrusoe1112.sum.1  <- jflcrusoe1112.sum.0[jflcrusoe1112.sum.0$Max.Abs.Grads. < 1,]
# All gradients ok
jflcrusoe1112.sum.1[jflcrusoe1112.sum.1$Distribution=="apnormal",]
jflcrusoe1112.sum.1[jflcrusoe1112.sum.1$Distribution=="normal",]
jflcrusoe1112.sum.1  <- jflcrusoe1112.sum.0[jflcrusoe1112.sum.0$Model=="2P",]
# AIC favour ###05
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1112.sum.1))],                     
          ttl=paste(jflcrusoe1112.sum.1$Model,
                    substring(jflcrusoe1112.sum.1$Distribution, 1,8),
                    jflcrusoe1112.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1112.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1112.sum.1))],
          arr=c(3,2))
# Best correlations in variant ###03 and ###04 and ###05
#
(jflcrusoe1112.3P.1.n.spg.partable    <- CatDynPar(x=jflcrusoe1112.3P.1.n.fit,method="spg"))           ###03
(jflcrusoe1112.3P.1.n.CG.partable     <- CatDynPar(x=jflcrusoe1112.3P.1.n.fit,method="CG"))            ###04
(jflcrusoe1112.3P.2.apn.NM.partable   <- CatDynPar(x=jflcrusoe1112.3P.2.apn.fit,method="Nelder-Mead")) ###05
# Variants ###05 has the best CVs bt far and best AIC
#
plot(x=jflcrusoe1112.3P.2.apn.pred.NM,                                          ###05 36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1112.sum.0$Sel.Model[5] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.11.- Depletion models season: 2012-2013                                  #
################################################################################
#
# Data object
#
jflcrusoe1213  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==11,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2012-09-25","2013-05-06"))
#
plot(x=jflcrusoe1213,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 52 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1213$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 56.55867
M.ini       <- 3*0.001937482
N0.ini      <- 2*56.55867
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1213$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1213$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1213.0P.apn.ini <- catdynexp(x=jflcrusoe1213,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1213.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1213.0P.apn.fit  <- CatDynFit(x=jflcrusoe1213,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1213.0P.apn.pred.spg <- CatDynPred(jflcrusoe1213.0P.apn.fit,"spg")     # 42 51
plot(x=jflcrusoe1213.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.0P.apn.pred.CG <- CatDynPred(jflcrusoe1213.0P.apn.fit,"CG")       # 42 51
plot(x=jflcrusoe1213.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.0P.apln.fit  <- CatDynFit(x=jflcrusoe1213,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1213.0P.apln.pred.spg <- CatDynPred(jflcrusoe1213.0P.apln.fit,"spg")   
# plot(x=jflcrusoe1213.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.0P.apln.pred.CG <- CatDynPred(jflcrusoe1213.0P.apln.fit,"CG")     
# plot(x=jflcrusoe1213.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 0.5*98.61327
P1.ini      <- 55
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1213$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jflcrusoe1213$Data$nasas$time.step,1))
#
jflcrusoe1213.1P.apn.ini <- catdynexp(x=jflcrusoe1213,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1213.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1213.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1213,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1213.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1213.1P.1.apn.fit,"spg") ###01 138
plot(x=jflcrusoe1213.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1213.1P.1.apn.fit,"CG")   ###02 208
plot(x=jflcrusoe1213.1P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1213,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1213.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1213.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1213.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1213.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1213.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1213.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1213.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1213$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1213$Data$nasas$obscat.thou))^2)
#
jflcrusoe1213.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1213,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1213.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1213.1P.1.n.fit,"spg")     ###03 141
plot(x=jflcrusoe1213.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1213.1P.1.n.fit,"CG")       ###04 191
plot(x=jflcrusoe1213.1P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1213,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1213.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1213.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1213.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1213.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1213.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 0.5*98.61327
P1.ini      <- 35
P2.ini      <- 30
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1213$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 51,                                                            # the week of one input of abundance
                 tail(jflcrusoe1213$Data$nasas$time.step,1))
#
jflcrusoe1213.2P.apn.ini <- catdynexp(x=jflcrusoe1213,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1213.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1213.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1213,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("CG","Nelder-Mead"),#c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1213.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1213.2P.1.apn.fit,"Nelder-Mead") ###05 50
plot(x=jflcrusoe1213.2P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1213.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1213.2P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1213.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1213.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1213.2P.1.apn.fit,"CG")   ###06 71
plot(x=jflcrusoe1213.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1213,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1213.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1213.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1213.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1213.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1213.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1213.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1213.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1213.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1213,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method="CG",#c("CG","Nelder-Mead"),#c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1213.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1213.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe1213.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1213.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1213.2P.1.n.fit,"CG")       ###07 71
plot(x=jflcrusoe1213.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1213,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1213.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1213.2P.1.ln.fit,"spg")
# plot(x=jflcrusoe1213.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1213.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1213.2P.1.ln.fit,"CG")
# plot(x=jflcrusoe1213.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1213.1P.1.apn.fit,     ###01                               
           jflcrusoe1213.1P.1.apn.fit,     ###02
           jflcrusoe1213.1P.1.n.fit,       ###03
           jflcrusoe1213.1P.1.n.fit,       ###04
           jflcrusoe1213.2P.1.apn.fit,     ###05
           jflcrusoe1213.2P.1.apn.fit,     ###06
           jflcrusoe1213.2P.1.n.fit)       ###07
m1 <- c("spg","CG","spg","CG","CG","Nelder-Mead","CG")
#
jflcrusoe1213.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
# All gradients ok
jflcrusoe1213.sum.0[jflcrusoe1213.sum.0$Distribution=="apnormal",]
jflcrusoe1213.sum.0[jflcrusoe1213.sum.0$Distribution=="normal",]
# AIC tie
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1213.sum.0))],                     
          ttl=paste(jflcrusoe1213.sum.0$Model,
                    substring(jflcrusoe1213.sum.0$Distribution, 1,8),
                    jflcrusoe1213.sum.0$Method,
                    as.numeric(row.names(jflcrusoe1213.sum.0))),
          method=m1[as.numeric(row.names(jflcrusoe1213.sum.0))],
          arr=c(4,2))
# Worst correlations in variants ###01 and ###02
#
# (jflcrusoe1213.3P.1.n.spg.partable    <- CatDynPar(x=jflcrusoe1213.1P.1.apn.fit,method="spg"))           ###01
# (jflcrusoe1213.3P.1.n.CG.partable     <- CatDynPar(x=jflcrusoe1213.1P.1.apn.fit,method="CG"))            ###02
(jflcrusoe1213.1P.1.n.spg.partable  <- CatDynPar(x=jflcrusoe1213.1P.1.n.fit,method="spg"))           ###03
(jflcrusoe1213.1P.1.n.CG.partable   <- CatDynPar(x=jflcrusoe1213.1P.1.n.fit,method="CG"))            ###04
(jflcrusoe1213.2P.1.apn.CG.partable <- CatDynPar(x=jflcrusoe1213.2P.1.apn.fit,method="CG"))          ###05
(jflcrusoe1213.2P.1.apn.NM.partable <- CatDynPar(x=jflcrusoe1213.2P.1.apn.fit,method="Nelder-Mead")) ###06
(jflcrusoe1213.2P.1.n.CG.partable   <- CatDynPar(x=jflcrusoe1213.2P.1.n.fit,method="CG"))            ###07
# Most realistic M estimate in variants ###04 and ###05 and ###07 but latter too many NaNs
# Best dotation of CVs in variant ###05 though poor for M
#
plot(x=jflcrusoe1213.2P.1.apn.pred.CG,                                          ###05 71
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1213.sum.0$Sel.Model[5] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.12.- Depletion models season: 2013-2014                                  #
################################################################################
#
# Data object
#
jflcrusoe1314  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==12,][2:35,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2013-09-25","2014-05-06"))
#
plot(x=jflcrusoe1314,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 45 51 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1314$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 43.81181
M.ini       <- 3*0.001937482
N0.ini      <- 2.5*43.81181
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1314$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1314$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1314.0P.apn.ini <- catdynexp(x=jflcrusoe1314,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1314.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1314.0P.apn.fit  <- CatDynFit(x=jflcrusoe1314,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1314.0P.apn.pred.spg <- CatDynPred(jflcrusoe1314.0P.apn.fit,"spg")     # 42 45 56
plot(x=jflcrusoe1314.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.0P.apn.pred.CG <- CatDynPred(jflcrusoe1314.0P.apn.fit,"CG")       # 42 45 56
plot(x=jflcrusoe1314.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.0P.apln.fit  <- CatDynFit(x=jflcrusoe1314,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1314.0P.apln.pred.spg <- CatDynPred(jflcrusoe1314.0P.apln.fit,"spg")   # 42 45 56
plot(x=jflcrusoe1314.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.0P.apln.pred.CG <- CatDynPred(jflcrusoe1314.0P.apln.fit,"CG")     # 42 45 56
plot(x=jflcrusoe1314.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 55
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1314$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jflcrusoe1314$Data$nasas$time.step,1))
#
jflcrusoe1314.1P.apn.ini <- catdynexp(x=jflcrusoe1314,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1314.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1314.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1314,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1314.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1314.1P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1314.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1314.1P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1314.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1314,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1314.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1314.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1314.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1314.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1314.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1314$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1314$Data$nasas$obscat.thou))^2)
#
jflcrusoe1314.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1314,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1314.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1314.1P.1.n.fit,"spg")     
# plot(x=jflcrusoe1314.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1314.1P.1.n.fit,"CG")       
# plot(x=jflcrusoe1314.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1314,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1314.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1314.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1314.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1314.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1314.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 20
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1314$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 45,                                                            # the week of one input of abundance
                 tail(jflcrusoe1314$Data$nasas$time.step,1))
#
jflcrusoe1314.2P.apn.ini <- catdynexp(x=jflcrusoe1314,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1314.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1314.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1314,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1314.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1314.2P.1.apn.fit,"spg") ###01 135
plot(x=jflcrusoe1314.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1314.2P.1.apn.fit,"CG")   ###02 107
plot(x=jflcrusoe1314.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1314,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1314.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1314.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1314.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1314.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1314.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1314,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1314.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1314.2P.1.n.fit,"spg")     ###03 138
plot(x=jflcrusoe1314.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1314.2P.1.n.fit,"CG")       ###04 107
plot(x=jflcrusoe1314.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1314,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1314.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1314.2P.1.ln.fit,"spg")
# plot(x=jflcrusoe1314.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1314.2P.1.ln.fit,"CG")
# plot(x=jflcrusoe1314.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 20
P3.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1314$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 45,                                                            # the week of one input of abundance
                 51, # 56
                 tail(jflcrusoe1314$Data$nasas$time.step,1))
#
jflcrusoe1314.3P.apn.ini <- catdynexp(x=jflcrusoe1314,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1314.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1314.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1314,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1314.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1314.3P.1.apn.fit,"spg") ###05 42
plot(x=jflcrusoe1314.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1314.3P.1.apn.fit,"Nelder-Mead")   ###06 163
plot(x=jflcrusoe1314.3P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1314,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe1314.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1314.3P.1.apln.fit,"spg") ###07 21
plot(x=jflcrusoe1314.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1314.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1314.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1314.3P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1314,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1314.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1314.3P.1.n.fit,"spg")     ###08 43
plot(x=jflcrusoe1314.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1314.3P.1.n.fit,"Nelder-Mead") ###09 54
plot(x=jflcrusoe1314.3P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1314,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1314.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1314.3P.1.ln.fit,"spg")   ###10 29
plot(x=jflcrusoe1314.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1314.3P.1.ln.fit,"Nelder-Mead") ###11 170
plot(x=jflcrusoe1314.3P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 20
P3.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1314$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 45,                                                            # the week of one input of abundance
                 56,
                 tail(jflcrusoe1314$Data$nasas$time.step,1))
#
jflcrusoe1314.3P.apn.ini <- catdynexp(x=jflcrusoe1314,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1314.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1314.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe1314,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                         itnmax=50000)
#
jflcrusoe1314.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe1314.3P.2.apn.fit,"spg") ###12 236
plot(x=jflcrusoe1314.3P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.2.apn.pred.NM <- CatDynPred(jflcrusoe1314.3P.2.apn.fit,"Nelder-Mead")   ###13 27
plot(x=jflcrusoe1314.3P.2.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe1314,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1314.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe1314.3P.2.apln.fit,"spg")
# plot(x=jflcrusoe1314.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.3P.2.apln.pred.NM <- CatDynPred(jflcrusoe1314.3P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1314.3P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.3P.2.n.fit  <- CatDynFit(x=jflcrusoe1314,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1314.3P.2.n.pred.spg <- CatDynPred(jflcrusoe1314.3P.2.n.fit,"spg")     
# plot(x=jflcrusoe1314.3P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.3P.2.n.pred.NM <- CatDynPred(jflcrusoe1314.3P.2.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1314.3P.2.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1314.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe1314,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1314.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe1314.3P.2.ln.fit,"spg")   
# plot(x=jflcrusoe1314.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1314.3P.2.ln.pred.NM <- CatDynPred(jflcrusoe1314.3P.2.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1314.3P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1314.2P.1.apn.fit,     ###01                               
           jflcrusoe1314.2P.1.apn.fit,     ###02
           jflcrusoe1314.2P.1.n.fit,       ###03
           jflcrusoe1314.2P.1.n.fit,       ###04
           jflcrusoe1314.3P.1.apn.fit,     ###05
           jflcrusoe1314.3P.1.apn.fit,     ###06
           jflcrusoe1314.3P.1.apln.fit,    ###07
           jflcrusoe1314.3P.1.n.fit,       ###08
           jflcrusoe1314.3P.1.n.fit,       ###09
           jflcrusoe1314.3P.1.ln.fit,      ###10
           jflcrusoe1314.3P.1.ln.fit,      ###11
           jflcrusoe1314.3P.2.apn.fit,     ###12
           jflcrusoe1314.3P.2.apn.fit)     ###13
m1 <- c("spg","CG","spg","CG","spg","Nelder-Mead","spg","spg","Nelder-Mead","spg","Nelder-Mead","spg","Nelder-Mead")
#
jflcrusoe1314.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
jflcrusoe1314.sum.1  <- jflcrusoe1314.sum.0[jflcrusoe1314.sum.0$Max.Abs.Grads. < 1,]
#
jflcrusoe1314.sum.0[jflcrusoe1314.sum.0$Distribution=="apnormal",]
jflcrusoe1314.sum.0[jflcrusoe1314.sum.0$Distribution=="normal",]
jflcrusoe1314.sum.0[jflcrusoe1314.sum.0$Distribution=="aplnormal",]
jflcrusoe1314.sum.0[jflcrusoe1314.sum.0$Distribution=="lognormal",]
jflcrusoe1314.sum.2  <- jflcrusoe1314.sum.1[jflcrusoe1314.sum.1$Model=="3P",]
# AIC favour 3P
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1314.sum.2))],                     
          ttl=paste(jflcrusoe1314.sum.2$Model,
                    substring(jflcrusoe1314.sum.2$Distribution, 1,8),
                    jflcrusoe1314.sum.2$Method,
                    as.numeric(row.names(jflcrusoe1314.sum.2))),
          method=m1[as.numeric(row.names(jflcrusoe1314.sum.2))],
          arr=c(4,2))
# Worst correlations in variants ###07 and ###11
#
(jflcrusoe1314.3P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe1314.3P.1.apn.fit,method="spg"))         ###05 42
(jflcrusoe1314.3P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe1314.3P.1.apn.fit,method="Nelder-Mead")) ###06 163
(jflcrusoe1314.3P.1.n.spg.partable   <- CatDynPar(x=jflcrusoe1314.3P.1.n.fit,method="spg"))           ###08 43
(jflcrusoe1314.3P.1.ln.spg.partable  <- CatDynPar(x=jflcrusoe1314.3P.1.ln.fit,method="spg"))          ###10 29
(jflcrusoe1314.3P.2.apn.NM.partable  <- CatDynPar(x=jflcrusoe1314.3P.2.apn.fit,method="Nelder-Mead")) ###13 27
# Most realistic M estimate in variant ###05 and less NaNs too
#
plot(x=jflcrusoe1314.3P.1.apn.pred.spg,                                         ###05 42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1314.sum.0$Sel.Model[5] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.13.- Depletion models season: 2014-2015                                  #
################################################################################
#
jflcrusoe1415       <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==13,],
                                     step="week",
                                     fleet.name="nasas",
                                     coleff=4,
                                     colcat=5,
                                     colmbw=6,
                                     unitseff="ndays",
                                     unitscat="kg",
                                     unitsmbw="g",
                                     nmult="thou",
                                     season.dates=c("2014-09-30","2015-05-06"))
#
plot(x=jflcrusoe1415,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 49 57 60 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1415$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 70.24545
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*70.24545
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1415$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1415.0P.apn.ini <- catdynexp(x=jflcrusoe1415,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1415.0P.apn.fit  <- CatDynFit(x=jflcrusoe1415,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1415.0P.apn.pred.spg <- CatDynPred(jflcrusoe1415.0P.apn.fit,"spg")     # 49 57 60
plot(x=jflcrusoe1415.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.0P.apn.pred.CG <- CatDynPred(jflcrusoe1415.0P.apn.fit,"CG")       # 49 57 60
plot(x=jflcrusoe1415.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.0P.apln.fit  <- CatDynFit(x=jflcrusoe1415,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1415.0P.apln.pred.spg <- CatDynPred(jflcrusoe1415.0P.apln.fit,"spg")   
# plot(x=jflcrusoe1415.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.0P.apln.pred.CG <- CatDynPred(jflcrusoe1415.0P.apln.fit,"CG")     
# plot(x=jflcrusoe1415.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.25*70
P1.ini      <- 55
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 49,                                                            # the week of one input of abundance
                 tail(jflcrusoe1415$Data$nasas$time.step,1))                    # 49 57 60
#
jflcrusoe1415.1P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1415.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1415.1P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1415.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1415.1P.1.apn.fit,"CG") 
# plot(x=jflcrusoe1415.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe1415.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.1P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1415.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1415.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1415.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1415.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1415.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1415.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1415.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.1P.1.apln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1415$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1415$Data$nasas$obscat.thou+0.01))^2)
#
jflcrusoe1415.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1415.1P.1.n.fit,"spg")
# plot(x=jflcrusoe1415.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1415.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1415.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.n.pred.NM <- CatDynPred(jflcrusoe1415.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1415.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1415.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1415.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1415.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1415.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe1415.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 25
P2.ini      <- 30
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 49,
                 56,                                                            # the week of one input of abundance
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.2P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1415.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1415.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe1415.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1415.2P.1.apn.fit,"CG")
# plot(x=jflcrusoe1415.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1415.2P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.2P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1415.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1415.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1415.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1415.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1415.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1415.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1415.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1415.2P.1.n.fit,"spg")
# plot(x=jflcrusoe1415.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1415.2P.1.n.fit,"CG")
# plot(x=jflcrusoe1415.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.2P.1.n.pred.NM <- CatDynPred(jflcrusoe1415.2P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.2P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe1415.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1415.2P.1.ln.fit,"spg")
plot(x=jflcrusoe1415.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1415.2P.1.ln.fit,"CG")
plot(x=jflcrusoe1415.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe1415.2P.1.ln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.2P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*50
P1.ini      <- 35
P2.ini      <- 20
P3.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,
                 49,                                                            # the week of one input of abundance
                 56, 
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.3P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1415.3P.1.apn.fit,"spg")
# plot(x=jflcrusoe1415.3P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1415.3P.1.apn.fit,"CG")
# plot(x=jflcrusoe1415.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1415.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1415.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1415.3P.1.apln.fit,"spg")
plot(x=jflcrusoe1415.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1415.3P.1.apln.fit,"CG")
plot(x=jflcrusoe1415.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1415.3P.1.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1415.3P.1.n.fit,"spg")
# plot(x=jflcrusoe1415.3P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1415.3P.1.n.fit,"CG")
# plot(x=jflcrusoe1415.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1415.3P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.3P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1415.3P.1.ln.fit,"spg")
# plot(x=jflcrusoe1415.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1415.3P.1.ln.fit,"CG")
# plot(x=jflcrusoe1415.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1415.3P.1.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.3P.1.ln.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*50
P1.ini      <- 35
P2.ini      <- 20
P3.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 49,                                                            # the week of one input of abundance
                 57, 
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.3P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe1415.3P.2.apn.fit,"spg")
# plot(x=jflcrusoe1415.3P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.apn.pred.CG <- CatDynPred(jflcrusoe1415.3P.2.apn.fit,"CG")
# plot(x=jflcrusoe1415.3P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.apn.pred.NM <- CatDynPred(jflcrusoe1415.3P.2.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.3P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1415.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe1415.3P.2.apln.fit,"spg")
# plot(x=jflcrusoe1415.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.apln.pred.CG <- CatDynPred(jflcrusoe1415.3P.2.apln.fit,"CG")
# plot(x=jflcrusoe1415.3P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1415.3P.2.apln.pred.NM <- CatDynPred(jflcrusoe1415.3P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.3P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.3P.2.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.3P.2.n.pred.spg <- CatDynPred(jflcrusoe1415.3P.2.n.fit,"spg")
# plot(x=jflcrusoe1415.3P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.n.pred.CG <- CatDynPred(jflcrusoe1415.3P.2.n.fit,"CG")
# plot(x=jflcrusoe1415.3P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.n.pred.NM <- CatDynPred(jflcrusoe1415.3P.2.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.3P.2.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe1415.3P.2.ln.fit,"spg")
# plot(x=jflcrusoe1415.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.3P.2.ln.pred.CG <- CatDynPred(jflcrusoe1415.3P.2.ln.fit,"CG")
# plot(x=jflcrusoe1415.3P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.3P.2.ln.pred.NM <- CatDynPred(jflcrusoe1415.3P.2.ln.fit,"Nelder-Mead") 
plot(x=jflcrusoe1415.3P.2.ln.pred.NM,                                           ###01 21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 4 input depletion variant                                  # 42 49 57 60                           
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 20
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 45, #42
                 47, #44
                 49, #46                                                        # the week of one input of abundance
                 56, #52
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.4P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe1415.4P.1.apn.fit,"spg")
# plot(x=jflcrusoe1415.4P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe1415.4P.1.apn.fit,"CG")
# plot(x=jflcrusoe1415.4P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.1.apn.pred.NM <- CatDynPred(jflcrusoe1415.4P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe1415.4P.1.apln.fit,"spg")
# plot(x=jflcrusoe1415.4P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe1415.4P.1.apln.fit,"CG")
# plot(x=jflcrusoe1415.4P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.1.apln.pred.NM <- CatDynPred(jflcrusoe1415.4P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.1.apln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.1.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.4P.1.n.pred.spg <- CatDynPred(jflcrusoe1415.4P.1.n.fit,"spg")
# plot(x=jflcrusoe1415.4P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.1.n.pred.CG <- CatDynPred(jflcrusoe1415.4P.1.n.fit,"CG")
# plot(x=jflcrusoe1415.4P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.1.n.pred.NM <- CatDynPred(jflcrusoe1415.4P.1.n.fit,"Nelder-Mead") 
plot(x=jflcrusoe1415.4P.1.n.pred.NM,                                            ###02 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe1415.4P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1415.4P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
jflcrusoe1415.4P.1.ln.pred.NM <- CatDynPred(jflcrusoe1415.4P.1.ln.fit,"Nelder-Mead") 
plot(x=jflcrusoe1415.4P.1.ln.pred.NM,                                           ###03 36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 4 input depletion variant                                  # 42 49 57 60                                  
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 20
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 42, #42
                 47, #45
                 49, #46                                                        # the week of one input of abundance
                 57, #52
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.4P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.4P.2.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.4P.2.apn.pred.spg <- CatDynPred(jflcrusoe1415.4P.2.apn.fit,"spg")
# plot(x=jflcrusoe1415.4P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.apn.pred.CG <- CatDynPred(jflcrusoe1415.4P.2.apn.fit,"CG")
# plot(x=jflcrusoe1415.4P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.apn.pred.NM <- CatDynPred(jflcrusoe1415.4P.2.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.2.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.4P.2.apln.pred.spg <- CatDynPred(jflcrusoe1415.4P.2.apln.fit,"spg")
# plot(x=jflcrusoe1415.4P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.apln.pred.CG <- CatDynPred(jflcrusoe1415.4P.2.apln.fit,"CG")
# plot(x=jflcrusoe1415.4P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.apln.pred.NM <- CatDynPred(jflcrusoe1415.4P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.2.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.4P.2.n.pred.spg <- CatDynPred(jflcrusoe1415.4P.2.n.fit,"spg")
# plot(x=jflcrusoe1415.4P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.n.pred.CG <- CatDynPred(jflcrusoe1415.4P.2.n.fit,"CG")
# plot(x=jflcrusoe1415.4P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.n.pred.NM <- CatDynPred(jflcrusoe1415.4P.2.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.4P.2.n.pred.NM,                                            
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.2.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.4P.2.ln.pred.spg <- CatDynPred(jflcrusoe1415.4P.2.ln.fit,"spg")   
# plot(x=jflcrusoe1415.4P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.2.ln.pred.NM <- CatDynPred(jflcrusoe1415.4P.2.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.4P.2.ln.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 4 input depletion variant                                  # 42 49 57 60                                 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 20
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 42, #42
                 45, #45
                 49, #46                                                        # the week of one input of abundance
                 57, #52
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.4P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.4P.3.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.4P.3.apn.pred.spg <- CatDynPred(jflcrusoe1415.4P.3.apn.fit,"spg")
# plot(x=jflcrusoe1415.4P.3.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.apn.pred.CG <- CatDynPred(jflcrusoe1415.4P.3.apn.fit,"CG")
# plot(x=jflcrusoe1415.4P.3.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.apn.pred.NM <- CatDynPred(jflcrusoe1415.4P.3.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.3.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.3.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.4P.3.apln.pred.spg <- CatDynPred(jflcrusoe1415.4P.3.apln.fit,"spg")
# plot(x=jflcrusoe1415.4P.3.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.apln.pred.CG <- CatDynPred(jflcrusoe1415.4P.3.apln.fit,"CG")
# plot(x=jflcrusoe1415.4P.3.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.apln.pred.NM <- CatDynPred(jflcrusoe1415.4P.3.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.3.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.3.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.4P.3.n.pred.spg <- CatDynPred(jflcrusoe1415.4P.3.n.fit,"spg")
# plot(x=jflcrusoe1415.4P.3.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.n.pred.CG <- CatDynPred(jflcrusoe1415.4P.3.n.fit,"CG")
# plot(x=jflcrusoe1415.4P.3.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.n.pred.NM <- CatDynPred(jflcrusoe1415.4P.3.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.3.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.3.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.4P.3.ln.pred.spg <- CatDynPred(jflcrusoe1415.4P.3.ln.fit,"spg")   
# plot(x=jflcrusoe1415.4P.3.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.ln.pred.CG <- CatDynPred(jflcrusoe1415.4P.3.ln.fit,"CG")   
# plot(x=jflcrusoe1415.4P.3.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.3.ln.pred.NM <- CatDynPred(jflcrusoe1415.4P.3.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.3.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 4 input depletion variant                                  # 42 49 57 60                                 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 20
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 10
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 42, #42
                 49, #45
                 57, #46                                                        # the week of one input of abundance
                 60, #52
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.4P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.4P.4.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.4P.4.apn.pred.spg <- CatDynPred(jflcrusoe1415.4P.4.apn.fit,"spg")
# plot(x=jflcrusoe1415.4P.4.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.apn.pred.CG <- CatDynPred(jflcrusoe1415.4P.4.apn.fit,"CG")
# plot(x=jflcrusoe1415.4P.4.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.apn.pred.NM <- CatDynPred(jflcrusoe1415.4P.4.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.4.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.4.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.4P.4.apln.pred.spg <- CatDynPred(jflcrusoe1415.4P.4.apln.fit,"spg")
# plot(x=jflcrusoe1415.4P.4.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.apln.pred.CG <- CatDynPred(jflcrusoe1415.4P.4.apln.fit,"CG")
# plot(x=jflcrusoe1415.4P.4.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.apln.pred.NM <- CatDynPred(jflcrusoe1415.4P.4.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.4.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.4.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.4P.4.n.pred.spg <- CatDynPred(jflcrusoe1415.4P.4.n.fit,"spg")
# plot(x=jflcrusoe1415.4P.4.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.n.pred.CG <- CatDynPred(jflcrusoe1415.4P.4.n.fit,"CG")
# plot(x=jflcrusoe1415.4P.4.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.n.pred.NM <- CatDynPred(jflcrusoe1415.4P.4.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.4.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.4P.4.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.4P.4.ln.pred.spg <- CatDynPred(jflcrusoe1415.4P.4.ln.fit,"spg")   
# plot(x=jflcrusoe1415.4P.4.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.ln.pred.CG <- CatDynPred(jflcrusoe1415.4P.4.ln.fit,"CG")   
# plot(x=jflcrusoe1415.4P.4.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.4P.4.ln.pred.NM <- CatDynPred(jflcrusoe1415.4P.4.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.4P.4.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 5 input depletion variant                                  # 42 49 57 60 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 10
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 5
P5.ini      <- 5
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    
                 42,
                 45, 
                 47, 
                 49,                                                            
                 56, 
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.5P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.5P.1.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1415.5P.1.apn.pred.spg <- CatDynPred(jflcrusoe1415.5P.1.apn.fit,"spg")
plot(x=jflcrusoe1415.5P.1.apn.pred.spg,                                         ###04 79
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.apn.pred.CG <- CatDynPred(jflcrusoe1415.5P.1.apn.fit,"CG")
plot(x=jflcrusoe1415.5P.1.apn.pred.CG,                                          ###05 164
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.apn.pred.NM <- CatDynPred(jflcrusoe1415.5P.1.apn.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.1.apn.pred.NM,                                          ###06 51
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.5P.1.apln.pred.spg <- CatDynPred(jflcrusoe1415.5P.1.apln.fit,"spg")
# plot(x=jflcrusoe1415.5P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.1.apln.pred.CG <- CatDynPred(jflcrusoe1415.5P.1.apln.fit,"CG")
# plot(x=jflcrusoe1415.5P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.apln.pred.NM <- CatDynPred(jflcrusoe1415.5P.1.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.1.apln.pred.NM,                                         ###07 25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1415.5P.1.n.pred.spg <- CatDynPred(jflcrusoe1415.5P.1.n.fit,"spg")
plot(x=jflcrusoe1415.5P.1.n.pred.spg,                                           ###08 80
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.n.pred.CG <- CatDynPred(jflcrusoe1415.5P.1.n.fit,"CG")
plot(x=jflcrusoe1415.5P.1.n.pred.CG,                                            ###09 161
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.n.pred.NM <- CatDynPred(jflcrusoe1415.5P.1.n.fit,"Nelder-Mead") 
plot(x=jflcrusoe1415.5P.1.n.pred.NM,                                            ###10 50
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.1.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.5P.1.ln.pred.spg <- CatDynPred(jflcrusoe1415.5P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1415.5P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.1.ln.pred.CG <- CatDynPred(jflcrusoe1415.5P.1.ln.fit,"CG")   
# plot(x=jflcrusoe1415.5P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1415.5P.1.ln.pred.NM <- CatDynPred(jflcrusoe1415.5P.1.ln.fit,"Nelder-Mead") 
plot(x=jflcrusoe1415.5P.1.ln.pred.NM,                                           ###11 39
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 5 input depletion variant                                  # 42 49 57 60
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 10
P2.ini      <- 10
P3.ini      <- 15
P4.ini      <- 5
P5.ini      <- 5
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    # 42 45 47 49 56
                 42,
                 45, 
                 47, 
                 49,                                                            
                 60, 
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.5P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.5P.2.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.5P.2.apn.pred.spg <- CatDynPred(jflcrusoe1415.5P.2.apn.fit,"spg")
# plot(x=jflcrusoe1415.5P.2.apn.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.2.apn.pred.CG <- CatDynPred(jflcrusoe1415.5P.2.apn.fit,"CG")
# plot(x=jflcrusoe1415.5P.2.apn.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.2.apn.pred.NM <- CatDynPred(jflcrusoe1415.5P.2.apn.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.2.apn.pred.NM,                                          ###12 64
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.2.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.5P.2.apln.pred.spg <- CatDynPred(jflcrusoe1415.5P.2.apln.fit,"spg")
# plot(x=jflcrusoe1415.5P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.2.apln.pred.CG <- CatDynPred(jflcrusoe1415.5P.2.apln.fit,"CG")
# plot(x=jflcrusoe1415.5P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.2.apln.pred.NM <- CatDynPred(jflcrusoe1415.5P.2.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.2.apln.pred.NM,                                         ###13 29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.2.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.5P.2.n.pred.spg <- CatDynPred(jflcrusoe1415.5P.2.n.fit,"spg")
# plot(x=jflcrusoe1415.5P.2.n.pred.spg,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.2.n.pred.CG <- CatDynPred(jflcrusoe1415.5P.2.n.fit,"CG")
# plot(x=jflcrusoe1415.5P.2.n.pred.CG,                                            
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.2.n.pred.NM <- CatDynPred(jflcrusoe1415.5P.2.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.5P.2.n.pred.NM,                                            
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.2.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1415.5P.2.ln.pred.spg <- CatDynPred(jflcrusoe1415.5P.2.ln.fit,"spg")   
# plot(x=jflcrusoe1415.5P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.2.ln.pred.CG <- CatDynPred(jflcrusoe1415.5P.2.ln.fit,"CG")   
# plot(x=jflcrusoe1415.5P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# # 
# jflcrusoe1415.5P.2.ln.pred.NM <- CatDynPred(jflcrusoe1415.5P.2.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.5P.2.ln.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                  
#
# Initial values for 5 input depletion variant                                  # 42 49 57 60 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 10
P2.ini      <- 10
P3.ini      <- 35
P4.ini      <- 5
P5.ini      <- 2
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    
                 42,
                 49, 
                 57, 
                 60,                                                            
                 64, 
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.5P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.5P.3.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.5P.3.apn.pred.spg <- CatDynPred(jflcrusoe1415.5P.3.apn.fit,"spg")
# plot(x=jflcrusoe1415.5P.3.apn.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.3.apn.pred.CG <- CatDynPred(jflcrusoe1415.5P.3.apn.fit,"CG")
# plot(x=jflcrusoe1415.5P.3.apn.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.3.apn.pred.NM <- CatDynPred(jflcrusoe1415.5P.3.apn.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.3.apn.pred.NM,                                          ###13 141
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.3.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1415.5P.3.apln.pred.spg <- CatDynPred(jflcrusoe1415.5P.3.apln.fit,"spg")
plot(x=jflcrusoe1415.5P.3.apln.pred.spg,                                        ###14 55
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1415.5P.3.apln.pred.CG <- CatDynPred(jflcrusoe1415.5P.3.apln.fit,"CG")
# plot(x=jflcrusoe1415.5P.3.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.3.apln.pred.NM <- CatDynPred(jflcrusoe1415.5P.3.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.3.apln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.3.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.5P.3.n.pred.spg <- CatDynPred(jflcrusoe1415.5P.3.n.fit,"spg")
# plot(x=jflcrusoe1415.5P.3.n.pred.spg,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.3.n.pred.CG <- CatDynPred(jflcrusoe1415.5P.3.n.fit,"CG")
# plot(x=jflcrusoe1415.5P.3.n.pred.CG,                                            
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.3.n.pred.NM <- CatDynPred(jflcrusoe1415.5P.3.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.5P.3.n.pred.NM,                                            
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.3.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead")
                                        itnmax=50000)
#
jflcrusoe1415.5P.3.ln.pred.spg <- CatDynPred(jflcrusoe1415.5P.3.ln.fit,"spg")   ###15 47
plot(x=jflcrusoe1415.5P.3.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1415.5P.3.ln.pred.CG <- CatDynPred(jflcrusoe1415.5P.3.ln.fit,"CG")   
# plot(x=jflcrusoe1415.5P.3.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# # 
# jflcrusoe1415.5P.3.ln.pred.NM <- CatDynPred(jflcrusoe1415.5P.3.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1415.5P.3.ln.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                                             
#
# Initial values for 5 input depletion variant                                  # 42 49 57 60 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 10
P2.ini      <- 10
P3.ini      <- 35
P4.ini      <- 5
P5.ini      <- 2
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    
                 42, # 42
                 45, # 45 
                 49, # 47
                 57, # 49                                                            
                 60, # 57
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.5P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.5P.4.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1415.5P.4.apn.pred.spg <- CatDynPred(jflcrusoe1415.5P.4.apn.fit,"spg")
# plot(x=jflcrusoe1415.5P.4.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.4.apn.pred.CG <- CatDynPred(jflcrusoe1415.5P.4.apn.fit,"CG")
# plot(x=jflcrusoe1415.5P.4.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.4.apn.pred.NM <- CatDynPred(jflcrusoe1415.5P.4.apn.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.4.apn.pred.NM,                                          ###16 51
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.4.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.5P.4.apln.pred.spg <- CatDynPred(jflcrusoe1415.5P.4.apln.fit,"spg")
# plot(x=jflcrusoe1415.5P.4.apln.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1415.5P.4.apln.pred.CG <- CatDynPred(jflcrusoe1415.5P.4.apln.fit,"CG")
# plot(x=jflcrusoe1415.5P.4.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
jflcrusoe1415.5P.4.apln.pred.NM <- CatDynPred(jflcrusoe1415.5P.4.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.4.apln.pred.NM,                                         ###17 101
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.4.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1415.5P.4.n.pred.spg <- CatDynPred(jflcrusoe1415.5P.4.n.fit,"spg")
# plot(x=jflcrusoe1415.5P.4.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.4.n.pred.CG <- CatDynPred(jflcrusoe1415.5P.4.n.fit,"CG")
# plot(x=jflcrusoe1415.5P.4.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.4.n.pred.NM <- CatDynPred(jflcrusoe1415.5P.4.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.4.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.4.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead")
                                        itnmax=50000)
#
# jflcrusoe1415.5P.4.ln.pred.spg <- CatDynPred(jflcrusoe1415.5P.4.ln.fit,"spg")   
# plot(x=jflcrusoe1415.5P.4.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.4.ln.pred.CG <- CatDynPred(jflcrusoe1415.5P.4.ln.fit,"CG")   
# plot(x=jflcrusoe1415.5P.4.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.4.ln.pred.NM <- CatDynPred(jflcrusoe1415.5P.4.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.4.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                                             
#
# Initial values for 5 input depletion variant                                  # 42 49 57 60 
M.ini       <- 1*0.001937482
N0.ini      <- 1.5*70
P1.ini      <- 10
P2.ini      <- 10
P3.ini      <- 35
P4.ini      <- 5
P5.ini      <- 2
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1415$Data$nasas$time.step,1),                    
                 42, # 42
                 45, # 45 
                 47, # 47
                 49, # 49                                                            
                 57, # 57
                 tail(jflcrusoe1415$Data$nasas$time.step,1))
#
jflcrusoe1415.5P.apn.ini <- catdynexp(x=jflcrusoe1415,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1415.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1415.5P.5.apn.fit  <- CatDynFit(x=jflcrusoe1415,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1415.5P.5.apn.pred.spg <- CatDynPred(jflcrusoe1415.5P.5.apn.fit,"spg")
plot(x=jflcrusoe1415.5P.5.apn.pred.spg,                                         ###18 49
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.5.apn.pred.CG <- CatDynPred(jflcrusoe1415.5P.5.apn.fit,"CG")
plot(x=jflcrusoe1415.5P.5.apn.pred.CG,                                          ###19 30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1415.5P.5.apn.pred.NM <- CatDynPred(jflcrusoe1415.5P.5.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.5.apn.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.5.apln.fit  <- CatDynFit(x=jflcrusoe1415,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1415.5P.5.apln.pred.spg <- CatDynPred(jflcrusoe1415.5P.5.apln.fit,"spg")
# plot(x=jflcrusoe1415.5P.5.apln.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1415.5P.5.apln.pred.CG <- CatDynPred(jflcrusoe1415.5P.5.apln.fit,"CG")
# plot(x=jflcrusoe1415.5P.5.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1415.5P.5.apln.pred.NM <- CatDynPred(jflcrusoe1415.5P.5.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe1415.5P.5.apln.pred.NM,                                         ###20 14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.5P.5.n.fit  <- CatDynFit(x=jflcrusoe1415,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1415.5P.5.n.pred.spg <- CatDynPred(jflcrusoe1415.5P.5.n.fit,"spg")
plot(x=jflcrusoe1415.5P.5.n.pred.spg,                                           ###21 39
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1415.5P.5.n.pred.CG <- CatDynPred(jflcrusoe1415.5P.5.n.fit,"CG")
# plot(x=jflcrusoe1415.5P.5.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.5.n.pred.NM <- CatDynPred(jflcrusoe1415.5P.5.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.5.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1415.5P.5.ln.fit  <- CatDynFit(x=jflcrusoe1415,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1415.5P.5.ln.pred.spg <- CatDynPred(jflcrusoe1415.5P.5.ln.fit,"spg")   
# plot(x=jflcrusoe1415.5P.5.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.5.ln.pred.CG <- CatDynPred(jflcrusoe1415.5P.5.ln.fit,"CG")   
# plot(x=jflcrusoe1415.5P.5.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1415.5P.5.ln.pred.NM <- CatDynPred(jflcrusoe1415.5P.5.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1415.5P.5.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")                                                            
#
# Model variant selection
x1 <- list(jflcrusoe1415.3P.2.ln.fit,    ###01                               
           jflcrusoe1415.4P.1.n.fit,     ###02
           jflcrusoe1415.4P.1.ln.fit,    ###03
           jflcrusoe1415.5P.1.apn.fit,   ###04
           jflcrusoe1415.5P.1.apn.fit,   ###05
           jflcrusoe1415.5P.1.apn.fit,   ###06
           jflcrusoe1415.5P.1.apln.fit,  ###07
           jflcrusoe1415.5P.1.n.fit,     ###08
           jflcrusoe1415.5P.1.n.fit,     ###09
           jflcrusoe1415.5P.1.n.fit,     ###10
           jflcrusoe1415.5P.1.ln.fit,    ###11
           jflcrusoe1415.5P.2.apn.fit,   ###12
           jflcrusoe1415.5P.2.apln.fit,  ###13
           jflcrusoe1415.5P.3.apn.fit,   ###14
           jflcrusoe1415.5P.3.ln.fit,    ###15
           jflcrusoe1415.5P.4.apn.fit,   ###16
           jflcrusoe1415.5P.4.apln.fit,  ###17
           jflcrusoe1415.5P.5.apn.fit,   ###18
           jflcrusoe1415.5P.5.apn.fit,   ###19
           jflcrusoe1415.5P.5.apln.fit,  ###20
           jflcrusoe1415.5P.5.n.fit)     ###21
m1 <- c("Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "spg",
        "CG",
        "Nelder-Mead",
        "Nelder-Mead",
        "spg",
        "CG",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "spg",
        "Nelder-Mead",
        "Nelder-Mead",
        "spg",
        "CG",
        "Nelder-Mead",
        "spg")
#
jflcrusoe1415.sum.0  <- CatDynSum(x=x1,season="2014-2015",method=m1)
# All gradients are poor though > 1 gradients are in k, alpha and beta
jflcrusoe1415.sum.1  <- jflcrusoe1415.sum.0[jflcrusoe1415.sum.0$Max.Abs.Grads. < 1,]
# AIC not taken into account due to all same likelihood variants are 5P
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1415.sum.1))],                     
          ttl=paste(jflcrusoe1415.sum.1$Model,
                    substring(jflcrusoe1415.sum.1$Distribution, 1,8),
                    jflcrusoe1415.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1415.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1415.sum.1))],
          arr=c(4,2))
# Variant ###19 best, variants ###05 and ###15 worst 
#
(jflcrusoe1415.5P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe1415.5P.1.apn.fit,method="spg")) ###04
(jflcrusoe1415.5P.1.n.spg.partable   <- CatDynPar(x=jflcrusoe1415.5P.1.n.fit,method="spg"))   ###08
(jflcrusoe1415.5P.1.n.CG.partable    <- CatDynPar(x=jflcrusoe1415.5P.1.n.fit,method="CG"))    ###09
(jflcrusoe1415.5P.5.apn.spg.partable <- CatDynPar(x=jflcrusoe1415.5P.5.apn.fit,method="spg")) ###18
(jflcrusoe1415.5P.5.apn.CG.partable  <- CatDynPar(x=jflcrusoe1415.5P.5.apn.fit,method="CG"))  ###19
(jflcrusoe1415.5P.5.n.spg.partable   <- CatDynPar(x=jflcrusoe1415.5P.5.n.fit,method="spg"))   ###21
# Variants ###04, ###18, ###19 have best CVs, ###19 also has realistic estimate of M (but fail for SE)
#
plot(x=jflcrusoe1415.5P.1.apn.pred.spg,                                         ###04 79
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflcrusoe1415.5P.5.apn.pred.spg,                                         ###18 49
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflcrusoe1415.5P.5.apn.pred.CG,                                          ###19 30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1415.sum.0$Sel.Model[19] <- 1 ###18 or ###19
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.14.- Depletion models season: 2015-2016                                  #
################################################################################
#
# Data object
jflcrusoe1516  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==14,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2015-09-25","2016-05-06"))
#
plot(x=jflcrusoe1516,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 46 51 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1516$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 56.72284
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*56.72284
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1516$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1516.0P.apn.ini <- catdynexp(x=jflcrusoe1516,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1516.0P.apn.fit  <- CatDynFit(x=jflcrusoe1516,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1516.0P.apn.pred.spg <- CatDynPred(jflcrusoe1516.0P.apn.fit,"spg")     # 42 54 58
plot(x=jflcrusoe1516.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.0P.apn.pred.CG <- CatDynPred(jflcrusoe1516.0P.apn.fit,"CG")       # 42 54 58
plot(x=jflcrusoe1516.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.0P.apln.fit  <- CatDynFit(x=jflcrusoe1516,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1516.0P.apln.pred.spg <- CatDynPred(jflcrusoe1516.0P.apln.fit,"spg")   # 42 51 58
plot(x=jflcrusoe1516.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.0P.apln.pred.CG <- CatDynPred(jflcrusoe1516.0P.apln.fit,"CG")     # 42 51 58
plot(x=jflcrusoe1516.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.1P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1516.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1516.1P.1.apn.fit,"spg") # 54 58
# plot(x=jflcrusoe1516.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1516.1P.1.apn.fit,"CG")   # 54 58
# plot(x=jflcrusoe1516.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflcrusoe1516.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1516.1P.1.apln.fit,"spg") # 51 58
plot(x=jflcrusoe1516.1P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1516.1P.1.apln.fit,"CG")  # 51 58
plot(x=jflcrusoe1516.1P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1516$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1516$Data$nasas$obscat.thou))^2)
#
jflcrusoe1516.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1516.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1516.1P.1.n.fit,"spg")
# plot(x=jflcrusoe1516.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1516.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1516.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1516.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1516.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1516.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1516.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1516.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.2P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1516.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1516.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe1516.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1516.2P.1.apn.fit,"CG")
# plot(x=jflcrusoe1516.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1516.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1516.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1516.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1516.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1516.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1516.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1516.2P.1.n.fit,"spg")
# plot(x=jflcrusoe1516.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1516.2P.1.n.fit,"CG")
# plot(x=jflcrusoe1516.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1516.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1516.2P.1.ln.fit,"spg")
# plot(x=jflcrusoe1516.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1516.2P.1.ln.fit,"CG")
# plot(x=jflcrusoe1516.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*43.81181
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 54, 
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.3P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1516.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1516.3P.1.apn.fit,"spg")
# plot(x=jflcrusoe1516.3P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1516.3P.1.apn.fit,"CG")
# plot(x=jflcrusoe1516.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1516.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1516.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1516.3P.1.apln.fit,"spg") 
# plot(x=jflcrusoe1516.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1516.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe1516.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1516.3P.1.apln.fit,"Nelder-Mead") ###01 39
plot(x=jflcrusoe1516.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1516.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1516.3P.1.n.fit,"spg")
# plot(x=jflcrusoe1516.3P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1516.3P.1.n.fit,"CG")
# plot(x=jflcrusoe1516.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1516.3P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1516.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1516.3P.1.ln.fit,"spg")
# plot(x=jflcrusoe1516.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1516.3P.1.ln.fit,"CG")
# plot(x=jflcrusoe1516.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1516.3P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*43.81181
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 51,
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.3P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead","CG"),
                                         itnmax=50000)
#
# jflcrusoe1516.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe1516.3P.2.apn.fit,"spg")
# plot(x=jflcrusoe1516.3P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.apn.pred.CG <- CatDynPred(jflcrusoe1516.3P.2.apn.fit,"CG")
# plot(x=jflcrusoe1516.3P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.apn.pred.NM <- CatDynPred(jflcrusoe1516.3P.2.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1516.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe1516.3P.2.apln.fit,"spg")
# plot(x=jflcrusoe1516.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.2.apln.pred.CG <- CatDynPred(jflcrusoe1516.3P.2.apln.fit,"CG")
# plot(x=jflcrusoe1516.3P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.2.apln.pred.NM <- CatDynPred(jflcrusoe1516.3P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.2.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1516.3P.2.n.pred.spg <- CatDynPred(jflcrusoe1516.3P.2.n.fit,"spg")
# plot(x=jflcrusoe1516.3P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.n.pred.CG <- CatDynPred(jflcrusoe1516.3P.2.n.fit,"CG")
# plot(x=jflcrusoe1516.3P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.n.pred.NM <- CatDynPred(jflcrusoe1516.3P.2.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1516.3P.2.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1516.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe1516.3P.2.ln.fit,"spg")
# plot(x=jflcrusoe1516.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.ln.pred.CG <- CatDynPred(jflcrusoe1516.3P.2.ln.fit,"CG")
# plot(x=jflcrusoe1516.3P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.3P.2.ln.pred.NM <- CatDynPred(jflcrusoe1516.3P.2.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.3P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# # Initial values for 3 input depletion variant                                  
# M.ini       <- 3*0.001937482
# N0.ini      <- 1.5*43.81181
# P1.ini      <- 30
# P2.ini      <- 15
# P3.ini      <- 35
# k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
# alpha.ini   <- 1                                                                # always close to 1
# beta.ini    <- 1                                                                # always close to 1
# pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
# #
# dates.3P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
#                  42,
#                  45,                                                            # the week of one input of abundance
#                  57,
#                  tail(jflcrusoe1516$Data$nasas$time.step,1))
# #
# jflcrusoe1516.3P.apn.ini <- catdynexp(x=jflcrusoe1516,
#                                       p=3,
#                                       par=pars.ini.3P,
#                                       dates=dates.3P,
#                                       distr="apnormal")
# #
# plot(x=jflcrusoe1516.3P.apn.ini,
#      leg.pos="topleft",
#      Biom.tstep=1,
#      Biom.xpos=0.8,
#      Biom.ypos=0.8,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Cat.xpos=0.8,
#      Cat.ypos=0.7)
# #
# # Statistical fit of 1-input depletion variant
# jflcrusoe1516.3P.3.apn.fit  <- CatDynFit(x=jflcrusoe1516,
#                                          p=3,
#                                          par=pars.ini.3P,
#                                          dates=dates.3P,
#                                          distr="apnormal",
#                                          method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
#                                          itnmax=50000)
# #
# # jflcrusoe1516.3P.3.apn.pred.spg <- CatDynPred(jflcrusoe1516.3P.3.apn.fit,"spg")
# # plot(x=jflcrusoe1516.3P.3.apn.pred.spg,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# # #
# # jflcrusoe1516.3P.3.apn.pred.CG <- CatDynPred(jflcrusoe1516.3P.3.apn.fit,"CG")
# # plot(x=jflcrusoe1516.3P.3.apn.pred.CG,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.3.apn.pred.NM <- CatDynPred(jflcrusoe1516.3P.3.apn.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1516.3P.3.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.3.apln.fit  <- CatDynFit(x=jflcrusoe1516,
#                                           p=3,
#                                           par=pars.ini.3P,
#                                           dates=dates.3P,
#                                           distr="aplnormal",
#                                           method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG"),#
#                                           itnmax=50000)
# #
# # jflcrusoe1516.3P.3.apln.pred.spg <- CatDynPred(jflcrusoe1516.3P.3.apln.fit,"spg")
# # plot(x=jflcrusoe1516.3P.3.apln.pred.spg,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# # #
# # jflcrusoe1516.3P.3.apln.pred.NM <- CatDynPred(jflcrusoe1516.3P.3.apln.fit,"Nelder-Mead")
# # plot(x=jflcrusoe1516.3P.3.apln.pred.NM,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.3.n.fit  <- CatDynFit(x=jflcrusoe1516,
#                                        p=3,
#                                        par=c(pars.ini.3P,psi.n.ini),
#                                        dates=dates.3P,
#                                        distr="normal",
#                                        method="Nelder-Mead",#c("spg","CG"),
#                                        itnmax=50000)
# #
# # jflcrusoe1516.3P.3.n.pred.spg <- CatDynPred(jflcrusoe1516.3P.3.n.fit,"spg")
# # plot(x=jflcrusoe1516.3P.3.n.pred.spg,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# # #
# # jflcrusoe1516.3P.3.n.pred.CG <- CatDynPred(jflcrusoe1516.3P.3.n.fit,"CG")
# # plot(x=jflcrusoe1516.3P.3.n.pred.CG,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.3.n.pred.NM <- CatDynPred(jflcrusoe1516.3P.3.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1516.3P.3.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.3P.3.ln.fit  <- CatDynFit(x=jflcrusoe1516,
#                                         p=3,
#                                         par=c(pars.ini.3P,psi.ln.ini),
#                                         dates=dates.3P,
#                                         distr="lognormal",
#                                         method="Nelder-Mead",#c("spg","CG"),#c("spg","Nelder-Mead"),#
#                                         itnmax=50000)
# #
# # jflcrusoe1516.3P.3.ln.pred.spg <- CatDynPred(jflcrusoe1516.3P.3.ln.fit,"spg")   
# # plot(x=jflcrusoe1516.3P.3.ln.pred.spg,
# #      leg.pos="topright",
# #      Biom.tstep=1,
# #      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
# #      Biom.xpos=0.8,
# #      Biom.ypos=0.9,
# #      Cat.xpos=0.8,
# #      Cat.ypos=0.85)
# # #
# jflcrusoe1516.3P.3.ln.pred.NM <- CatDynPred(jflcrusoe1516.3P.3.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1516.3P.3.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25
P4.ini      <- 15
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 54, 
                 58,
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.4P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1516.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe1516.4P.1.apn.fit,"spg")
# plot(x=jflcrusoe1516.4P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe1516.4P.1.apn.fit,"CG")
# plot(x=jflcrusoe1516.4P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1516.4P.1.apn.pred.NM <- CatDynPred(jflcrusoe1516.4P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=500000)
#
# jflcrusoe1516.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe1516.4P.1.apln.fit,"spg")
# plot(x=jflcrusoe1516.4P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe1516.4P.1.apln.fit,"CG")
# plot(x=jflcrusoe1516.4P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.1.apln.pred.NM <- CatDynPred(jflcrusoe1516.4P.1.apln.fit,"Nelder-Mead") ###02 43
plot(x=jflcrusoe1516.4P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.4P.1.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1516.4P.1.n.pred.spg <- CatDynPred(jflcrusoe1516.4P.1.n.fit,"spg")
# plot(x=jflcrusoe1516.4P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.1.n.pred.CG <- CatDynPred(jflcrusoe1516.4P.1.n.fit,"CG")
# plot(x=jflcrusoe1516.4P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.1.n.pred.NM <- CatDynPred(jflcrusoe1516.4P.1.n.fit,"Nelder-Mead") 
# plot(x=jflcrusoe1516.4P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1516.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe1516.4P.1.ln.fit,"spg")
# plot(x=jflcrusoe1516.4P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.1.ln.pred.CG <- CatDynPred(jflcrusoe1516.4P.1.ln.fit,"CG")
# plot(x=jflcrusoe1516.4P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.1.ln.pred.NM <- CatDynPred(jflcrusoe1516.4P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25
P4.ini      <- 15
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 51, 
                 54,
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.4P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.4P.2.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1516.4P.2.apn.pred.spg <- CatDynPred(jflcrusoe1516.4P.2.apn.fit,"spg")
# plot(x=jflcrusoe1516.4P.2.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.2.apn.pred.CG <- CatDynPred(jflcrusoe1516.4P.2.apn.fit,"CG")
# plot(x=jflcrusoe1516.4P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.2.apn.pred.NM <- CatDynPred(jflcrusoe1516.4P.2.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.2.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=500000)
#
# jflcrusoe1516.4P.2.apln.pred.spg <- CatDynPred(jflcrusoe1516.4P.2.apln.fit,"spg")
# plot(x=jflcrusoe1516.4P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.2.apln.pred.CG <- CatDynPred(jflcrusoe1516.4P.2.apln.fit,"CG")
# plot(x=jflcrusoe1516.4P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.2.apln.pred.NM <- CatDynPred(jflcrusoe1516.4P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.2.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1516.4P.2.n.pred.spg <- CatDynPred(jflcrusoe1516.4P.2.n.fit,"spg")
# plot(x=jflcrusoe1516.4P.2.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.4P.2.n.pred.CG <- CatDynPred(jflcrusoe1516.4P.2.n.fit,"CG")
# plot(x=jflcrusoe1516.4P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1516.4P.2.n.pred.NM <- CatDynPred(jflcrusoe1516.4P.2.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.2.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.4P.2.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1516.4P.2.ln.pred.spg <- CatDynPred(jflcrusoe1516.4P.2.ln.fit,"spg")
# plot(x=jflcrusoe1516.4P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1516.4P.2.ln.pred.CG <- CatDynPred(jflcrusoe1516.4P.2.ln.fit,"CG")
# plot(x=jflcrusoe1516.4P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1516.4P.2.ln.pred.NM <- CatDynPred(jflcrusoe1516.4P.2.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1516.4P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.81181
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflcrusoe1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 46,                                                            # the week of one input of abundance
                 54, 
                 58,
                 61,
                 tail(jflcrusoe1516$Data$nasas$time.step,1))
#
jflcrusoe1516.5P.apn.ini <- catdynexp(x=jflcrusoe1516,
                                      p=5,
                                      par=pars.ini.5P,
                                      dates=dates.5P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1516.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1516.5P.1.apn.fit  <- CatDynFit(x=jflcrusoe1516,
                                         p=5,
                                         par=pars.ini.5P,
                                         dates=dates.5P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1516.5P.1.apn.pred.spg <- CatDynPred(jflcrusoe1516.5P.1.apn.fit,"spg")
# plot(x=jflcrusoe1516.5P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.5P.1.apn.pred.CG <- CatDynPred(jflcrusoe1516.5P.1.apn.fit,"CG")
# plot(x=jflcrusoe1516.5P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.apn.pred.NM <- CatDynPred(jflcrusoe1516.5P.1.apn.fit,"Nelder-Mead") ###03 161
plot(x=jflcrusoe1516.5P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.apln.fit  <- CatDynFit(x=jflcrusoe1516,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=500000)
#
# jflcrusoe1516.5P.1.apln.pred.spg <- CatDynPred(jflcrusoe1516.5P.1.apln.fit,"spg")
# plot(x=jflcrusoe1516.5P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.5P.1.apln.pred.CG <- CatDynPred(jflcrusoe1516.5P.1.apln.fit,"CG")
# plot(x=jflcrusoe1516.5P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.apln.pred.NM <- CatDynPred(jflcrusoe1516.5P.1.apln.fit,"Nelder-Mead") ###04 65
plot(x=jflcrusoe1516.5P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.n.fit  <- CatDynFit(x=jflcrusoe1516,
                                       p=5,
                                       par=c(pars.ini.5P,psi.n.ini),
                                       dates=dates.5P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1516.5P.1.n.pred.spg <- CatDynPred(jflcrusoe1516.5P.1.n.fit,"spg")
# plot(x=jflcrusoe1516.5P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.5P.1.n.pred.CG <- CatDynPred(jflcrusoe1516.5P.1.n.fit,"CG")
# plot(x=jflcrusoe1516.5P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.n.pred.NM <- CatDynPred(jflcrusoe1516.5P.1.n.fit,"Nelder-Mead") ###05 157
plot(x=jflcrusoe1516.5P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.ln.fit  <- CatDynFit(x=jflcrusoe1516,
                                        p=5,
                                        par=c(pars.ini.5P,psi.ln.ini),
                                        dates=dates.5P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1516.5P.1.ln.pred.spg <- CatDynPred(jflcrusoe1516.5P.1.ln.fit,"spg")
# plot(x=jflcrusoe1516.5P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1516.5P.1.ln.pred.CG <- CatDynPred(jflcrusoe1516.5P.1.ln.fit,"CG")
# plot(x=jflcrusoe1516.5P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1516.5P.1.ln.pred.NM <- CatDynPred(jflcrusoe1516.5P.1.ln.fit,"Nelder-Mead") ###06 52
plot(x=jflcrusoe1516.5P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1516.3P.1.apln.fit,    ###01                               
           jflcrusoe1516.4P.1.apln.fit,    ###02
           jflcrusoe1516.5P.1.apn.fit,     ###03
           jflcrusoe1516.5P.1.apln.fit,    ###04
           jflcrusoe1516.5P.1.n.fit,       ###05
           jflcrusoe1516.5P.1.ln.fit)      ###06
m1 <- rep("Nelder-Mead",6)
#
jflcrusoe1516.sum.0  <- CatDynSum(x=x1,season="2014-2015",method=m1)
jflcrusoe1516.sum.1  <- jflcrusoe1516.sum.0[jflcrusoe1516.sum.0$Max.Abs.Grads. < 6,] # poor gradients in alpha and beta
#
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1516.sum.1))],                     
          ttl=paste(jflcrusoe1516.sum.1$Model,
                    substring(jflcrusoe1516.sum.1$Distribution, 1,8),
                    jflcrusoe1516.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1516.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1516.sum.1))],
          arr=c(2,2))
# Variants ###04 has the worse
#
# (jflcrusoe1516.3P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe1516.3P.1.apln.fit,method="Nelder-Mead")) ###01 39
(jflcrusoe1516.4P.1.apln.NM.partable <- CatDynPar(x=jflcrusoe1516.4P.1.apln.fit,method="Nelder-Mead"))   ###02 43
(jflcrusoe1516.5P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe1516.5P.1.apn.fit,method="Nelder-Mead"))    ###03 161
# (jflcrusoe1516.5P.1.apln.NM.partable <- CatDynPar(x=jflcrusoe1516.5P.1.apln.fit,method="Nelder-Mead")) ###04 65
# (jflcrusoe1516.5P.1.n.NM.partable    <- CatDynPar(x=jflcrusoe1516.5P.1.n.fit,method="Nelder-Mead"))    ###05 157
(jflcrusoe1516.5P.1.ln.NM.partable   <- CatDynPar(x=jflcrusoe1516.5P.1.ln.fit,method="Nelder-Mead"))     ###06 52
# Variant ###03 has more complete CVs though M is unrealistically low, last input negligible small, and large escapement biomass
# Variant ###02 has more stable CVs and M estimate is the lowest, with high precision
# Going with ###02 
plot(x=jflcrusoe1516.4P.1.apln.pred.NM,                                         ###02 43
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1516.sum.0$Sel.Model[2] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.15.- Depletion models season: 2016-2017                                  #
################################################################################
#
# Data object
jflcrusoe1617  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==15,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2016-09-25","2017-05-08"))
#
plot(x=jflcrusoe1617,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 45 51 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1617$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 56.72284
M.ini       <- 3*0.001937482
N0.ini      <- 2*41.89448
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1617$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1617$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1617.0P.apn.ini <- catdynexp(x=jflcrusoe1617,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1617.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1617.0P.apn.fit  <- CatDynFit(x=jflcrusoe1617,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1617.0P.apn.pred.spg <- CatDynPred(jflcrusoe1617.0P.apn.fit,"spg")     # 51 53
plot(x=jflcrusoe1617.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.0P.apn.pred.CG <- CatDynPred(jflcrusoe1617.0P.apn.fit,"CG")       # 51 53
plot(x=jflcrusoe1617.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.0P.apln.fit  <- CatDynFit(x=jflcrusoe1617,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1617.0P.apln.pred.spg <- CatDynPred(jflcrusoe1617.0P.apln.fit,"spg")   # 45 51 52
plot(x=jflcrusoe1617.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.0P.apln.pred.CG <- CatDynPred(jflcrusoe1617.0P.apln.fit,"CG")     # 45 51 52
plot(x=jflcrusoe1617.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*41.89448
P1.ini      <- 35
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jflcrusoe1617$Data$nasas$time.step,1))
#
jflcrusoe1617.1P.apn.ini <- catdynexp(x=jflcrusoe1617,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1617.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1617.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1617,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1617.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1617.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe1617.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1617.1P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1617.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1617,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflcrusoe1617.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1617.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1617.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1617.1P.1.apln.fit,"CG") 
# plot(x=jflcrusoe1617.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1617$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1617$Data$nasas$obscat.thou))^2)
#
jflcrusoe1617.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1617,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
# jflcrusoe1617.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1617.1P.1.n.fit,"spg")
# plot(x=jflcrusoe1617.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1617.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1617.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1617,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflcrusoe1617.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1617.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1617.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1617.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1617.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*41.89448
P1.ini      <- 25
P2.ini      <- 15
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 51,                                                            # the week of one input of abundance
                 tail(jflcrusoe1617$Data$nasas$time.step,1))
#
jflcrusoe1617.2P.apn.ini <- catdynexp(x=jflcrusoe1617,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1617.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1617.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1617,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflcrusoe1617.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1617.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe1617.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1617.2P.1.apn.fit,"CG")
# plot(x=jflcrusoe1617.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1617.2P.1.apn.fit,"Nelder-Mead") ###01 50
plot(x=jflcrusoe1617.2P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1617,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflcrusoe1617.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1617.2P.1.apln.fit,"spg") ###02 20
plot(x=jflcrusoe1617.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1617.2P.1.apln.fit,"CG") ###03 20
plot(x=jflcrusoe1617.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1617.2P.1.apln.fit,"Nelder-Mead") ###04 20
plot(x=jflcrusoe1617.2P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1617,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1617.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1617.2P.1.n.fit,"spg")
# plot(x=jflcrusoe1617.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1617.2P.1.n.fit,"CG")
# plot(x=jflcrusoe1617.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1617,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe1617.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1617.2P.1.ln.fit,"spg")   ###05 20
plot(x=jflcrusoe1617.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1617.2P.1.ln.fit,"CG")     ###06 20
plot(x=jflcrusoe1617.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe1617.2P.1.ln.fit,"Nelder-Mead") ###07 48
plot(x=jflcrusoe1617.2P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*41.89448
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25    
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 45,                                                            # the week of one input of abundance
                 51, 
                 tail(jflcrusoe1617$Data$nasas$time.step,1))
#
jflcrusoe1617.3P.apn.ini <- catdynexp(x=jflcrusoe1617,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1617.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1617.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1617,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1617.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1617.3P.1.apn.fit,"spg")
# plot(x=jflcrusoe1617.3P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1617.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1617.3P.1.apn.fit,"CG")
# plot(x=jflcrusoe1617.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1617.3P.1.apn.fit,"Nelder-Mead") ###08 55
plot(x=jflcrusoe1617.3P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1617,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1617.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1617.3P.1.apln.fit,"spg") ###09 12
plot(x=jflcrusoe1617.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1617.3P.1.apln.fit,"CG") ###10 12
plot(x=jflcrusoe1617.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1617.3P.1.apln.fit,"Nelder-Mead") ###11 45
plot(x=jflcrusoe1617.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1617,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe1617.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1617.3P.1.n.fit,"spg")
# plot(x=jflcrusoe1617.3P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1617.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1617.3P.1.n.fit,"CG")
# plot(x=jflcrusoe1617.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1617.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1617.3P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1617.3P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1617,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe1617.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1617.3P.1.ln.fit,"spg")   ###12 12
plot(x=jflcrusoe1617.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1617.3P.1.ln.fit,"CG")     ###13 12
plot(x=jflcrusoe1617.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1617.3P.1.ln.fit,"Nelder-Mead") ###14 60
plot(x=jflcrusoe1617.3P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1617.2P.1.apn.fit,    ###01                               
           jflcrusoe1617.2P.1.apln.fit,   ###02
           jflcrusoe1617.2P.1.apln.fit,   ###03
           jflcrusoe1617.2P.1.apln.fit,   ###04
           jflcrusoe1617.2P.1.ln.fit,     ###05
           jflcrusoe1617.2P.1.ln.fit,     ###06
           jflcrusoe1617.2P.1.ln.fit,     ###07
           jflcrusoe1617.3P.1.apn.fit,    ###08
           jflcrusoe1617.3P.1.apln.fit,   ###09
           jflcrusoe1617.3P.1.apln.fit,   ###10
           jflcrusoe1617.3P.1.apln.fit,   ###11
           jflcrusoe1617.3P.1.ln.fit,     ###12
           jflcrusoe1617.3P.1.ln.fit,     ###13
           jflcrusoe1617.3P.1.ln.fit)     ###14
m1 <- c("Nelder-Mead", ###01
        "spg",         ###02
        "CG",          ###03
        "Nelder-Mead", ###04
        "spg",         ###05
        "CG",          ###06
        "Nelder-Mead", ###07
        "Nelder-Mead", ###08
        "spg",         ###09
        "CG",          ###10
        "Nelder-Mead", ###11
        "spg",         ###12
        "CG",          ###13
        "Nelder-Mead") ###14
#
jflcrusoe1617.sum.0  <- CatDynSum(x=x1,season="2016-2017",method=m1)
jflcrusoe1617.sum.1  <- jflcrusoe1617.sum.0[jflcrusoe1617.sum.0$Max.Abs.Grads. < 1,]
#
jflcrusoe1617.sum.1[jflcrusoe1617.sum.1$Distribution=="apnormal",]
jflcrusoe1617.sum.1[jflcrusoe1617.sum.1$Distribution=="aplnormal",]
jflcrusoe1617.sum.1[jflcrusoe1617.sum.1$Distribution=="lognormal",]
# AIC inconclusive
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1617.sum.1))],                     
          ttl=paste(jflcrusoe1617.sum.1$Model,
                    substring(jflcrusoe1617.sum.1$Distribution, 1,8),
                    jflcrusoe1617.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1617.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1617.sum.1))],
          arr=c(3,4))
# Variants ###05 and ###06 and ###12 and ###13 have the worst correlations
#
(jflcrusoe1617.2P.1.apn.NM.partable   <- CatDynPar(x=jflcrusoe1617.2P.1.apn.fit,method="Nelder-Mead")) ###01 50
(jflcrusoe1617.2P.1.apln.spg.partable <- CatDynPar(x=jflcrusoe1617.2P.1.apln.fit,method="spg"))        ###02 20
(jflcrusoe1617.2P.1.apln.CG.partable  <- CatDynPar(x=jflcrusoe1617.2P.1.apln.fit,method="CG"))         ###03 20
(jflcrusoe1617.2P.1.ln.NM.partable    <- CatDynPar(x=jflcrusoe1617.2P.1.ln.fit,method="Nelder-Mead"))  ###07 48
(jflcrusoe1617.3P.1.apn.NM.partable   <- CatDynPar(x=jflcrusoe1617.3P.1.apn.fit,method="Nelder-Mead")) ###08 55
(jflcrusoe1617.3P.1.apln.spg.partable <- CatDynPar(x=jflcrusoe1617.3P.1.apln.fit,method="spg"))        ###09 12
(jflcrusoe1617.3P.1.apln.CG.partable  <- CatDynPar(x=jflcrusoe1617.3P.1.apln.fit,method="CG"))         ###10 12
# Variant ###09 has complete and good CVs though M is poorly estimated
plot(x=jflcrusoe1617.3P.1.apln.pred.spg,                                        ###09 12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1617.sum.0$Sel.Model[9] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.16.- Depletion models season: 2017-2018                                  #
################################################################################
#
# Data object
jflcrusoe1718  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==16,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2017-09-25","2018-05-01"))
#
plot(x=jflcrusoe1718,mark=TRUE,offset=c(9,10,4),hem="S")                        # 41 45 48 51 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1718$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 34.31042
M.ini       <- 3*0.001937482
N0.ini      <- 2*34.31042
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1718$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1718$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1718.0P.apn.ini <- catdynexp(x=jflcrusoe1718,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1718.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1718.0P.apn.fit  <- CatDynFit(x=jflcrusoe1718,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1718.0P.apn.pred.spg <- CatDynPred(jflcrusoe1718.0P.apn.fit,"spg")     # 41 45 51
plot(x=jflcrusoe1718.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.0P.apn.pred.CG <- CatDynPred(jflcrusoe1718.0P.apn.fit,"CG")       # 41 45 51
plot(x=jflcrusoe1718.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.0P.apln.fit  <- CatDynFit(x=jflcrusoe1718,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1718.0P.apln.pred.spg <- CatDynPred(jflcrusoe1718.0P.apln.fit,"spg")   # 41 45 51
plot(x=jflcrusoe1718.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.0P.apln.pred.CG <- CatDynPred(jflcrusoe1718.0P.apln.fit,"CG")     # 41 45 51
plot(x=jflcrusoe1718.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*34.31042
P1.ini      <- 35
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1718$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,                                                            # the week of one input of abundance
                 tail(jflcrusoe1718$Data$nasas$time.step,1))
#
jflcrusoe1718.1P.apn.ini <- catdynexp(x=jflcrusoe1718,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1718.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1718.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1718,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe1718.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1718.1P.1.apn.fit,"spg") ###01 49
plot(x=jflcrusoe1718.1P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1718.1P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1718.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe1718.1P.1.apn.fit,"Nelder-Mead") ###02 87
plot(x=jflcrusoe1718.1P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1718,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1718.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1718.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1718.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1718.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1718.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1718.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1718$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1718$Data$nasas$obscat.thou))^2)
#
jflcrusoe1718.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1718,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1718.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1718.1P.1.n.fit,"spg")     ###03 63
plot(x=jflcrusoe1718.1P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1718.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1718.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.n.pred.NM <- CatDynPred(jflcrusoe1718.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1718.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1718,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1718.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1718.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1718.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1718.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1718.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1718.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe1718.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*34.31042
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1718$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,
                 45,                                                            # the week of one input of abundance
                 tail(jflcrusoe1718$Data$nasas$time.step,1))
#
jflcrusoe1718.2P.apn.ini <- catdynexp(x=jflcrusoe1718,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1718.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1718.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1718,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe1718.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1718.2P.1.apn.fit,"spg") ###04 31
plot(x=jflcrusoe1718.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1718.2P.1.apn.fit,"CG")
# plot(x=jflcrusoe1718.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1718.2P.1.apn.fit,"Nelder-Mead") ###05 75
plot(x=jflcrusoe1718.2P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1718,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1718.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1718.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1718.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1718.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1718.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1718.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1718.2P.1.apln.fit,"Nelder-Mead") ###06 58
plot(x=jflcrusoe1718.2P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1718,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1718.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1718.2P.1.n.fit,"spg")     ###07 42
plot(x=jflcrusoe1718.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1718.2P.1.n.fit,"CG")
# plot(x=jflcrusoe1718.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.n.pred.NM <- CatDynPred(jflcrusoe1718.2P.1.n.fit,"Nelder-Mead") ###08 46
plot(x=jflcrusoe1718.2P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1718,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1718.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1718.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1718.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1718.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1718.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1718.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe1718.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.2P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*34.31042
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 25    
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1718$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,
                 45,                                                            # the week of one input of abundance
                 51, 
                 tail(jflcrusoe1718$Data$nasas$time.step,1))
#
jflcrusoe1718.3P.apn.ini <- catdynexp(x=jflcrusoe1718,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1718.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1718.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1718,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe1718.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1718.3P.1.apn.fit,"spg") ###09 49
plot(x=jflcrusoe1718.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1718.3P.1.apn.fit,"CG")
# plot(x=jflcrusoe1718.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1718.3P.1.apn.fit,"Nelder-Mead") ###10 98
plot(x=jflcrusoe1718.3P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1718,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1718.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1718.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe1718.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1718.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1718.3P.1.apln.fit,"CG") 
# plot(x=jflcrusoe1718.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1718.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.3P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1718,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe1718.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1718.3P.1.n.fit,"spg")     ###11 47
plot(x=jflcrusoe1718.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1718.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1718.3P.1.n.fit,"CG")
# plot(x=jflcrusoe1718.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1718.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1718.3P.1.n.fit,"Nelder-Mead") ###12 109
plot(x=jflcrusoe1718.3P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1718.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1718,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1718.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1718.3P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1718.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1718.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1718.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1718.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1718.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1718.3P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1718.3P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1718.1P.1.apn.fit,  ###01                               
           jflcrusoe1718.1P.1.apn.fit,  ###02
           jflcrusoe1718.1P.1.n.fit,    ###03
           jflcrusoe1718.2P.1.apn.fit,  ###04
           jflcrusoe1718.2P.1.apn.fit,  ###05
           jflcrusoe1718.2P.1.apln.fit, ###06
           jflcrusoe1718.2P.1.n.fit,    ###07
           jflcrusoe1718.2P.1.n.fit,    ###08
           jflcrusoe1718.3P.1.apn.fit,  ###09
           jflcrusoe1718.3P.1.apn.fit,  ###10
           jflcrusoe1718.3P.1.n.fit,    ###11
           jflcrusoe1718.3P.1.n.fit)    ###12
m1 <- c("spg",         ###01
        "Nelder-Mead", ###02
        "spg",         ###03
        "spg",         ###04
        "Nelder-Mead", ###05
        "Nelder-Mead", ###06
        "spg",         ###07
        "Nelder-Mead", ###08
        "spg",         ###09
        "Nelder-Mead", ###10
        "spg",         ###11
        "Nelder-Mead") ###12
#
jflcrusoe1718.sum.0  <- CatDynSum(x=x1,season="2017-2017",method=m1)
# Borderline gradients in ###06 ###08 and ###10 but only in fishing operational pars
jflcrusoe1718.sum.0[jflcrusoe1718.sum.0$Distribution=="apnormal",]
jflcrusoe1718.sum.0[jflcrusoe1718.sum.0$Distribution=="normal",]
# AIC inconclusive
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1718.sum.0))],                     
          ttl=paste(jflcrusoe1718.sum.0$Model,
                    substring(jflcrusoe1718.sum.0$Distribution, 1,8),
                    jflcrusoe1718.sum.0$Method,
                    as.numeric(row.names(jflcrusoe1718.sum.0))),
          method=m1[as.numeric(row.names(jflcrusoe1718.sum.0))],
          arr=c(3,4))
# Variants ###03 and ###05 and ###07 have the worst correlations
#
(jflcrusoe1718.1P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe1718.1P.1.apn.fit,method="spg"))          ###01 49
(jflcrusoe1718.1P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe1718.1P.1.apn.fit,method="Nelder-Mead"))  ###02 87
(jflcrusoe1718.2P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe1718.2P.1.apn.fit,method="spg"))          ###04 31
(jflcrusoe1718.2P.1.apln.NM.partable <- CatDynPar(x=jflcrusoe1718.2P.1.apln.fit,method="Nelder-Mead")) ###06 58
(jflcrusoe1718.2P.1.n.NM.partable    <- CatDynPar(x=jflcrusoe1718.2P.1.n.fit,method="Nelder-Mead"))    ###08 46
(jflcrusoe1718.3P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe1718.3P.1.apn.fit,method="spg"))          ###09 49
(jflcrusoe1718.3P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe1718.3P.1.apn.fit,method="Nelder-Mead"))  ###10 98
(jflcrusoe1718.3P.1.n.spg.partable   <- CatDynPar(x=jflcrusoe1718.3P.1.n.fit,method="spg"))            ###11 47
(jflcrusoe1718.3P.1.n.NM.partable    <- CatDynPar(x=jflcrusoe1718.3P.1.n.fit,method="Nelder-Mead"))    ###12 109
# Variant ###04 has complete and good CVs though M is poorly estimated
# Variant ###10 has the most realistic and precise estimate of M 
plot(x=jflcrusoe1718.2P.1.apn.pred.spg,                                        ###04 31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflcrusoe1718.3P.1.apn.pred.NM,                                          ###10 98
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# Giving more value to a better estimate of M
jflcrusoe1718.sum.0$Sel.Model[10] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#


################################################################################
# 2.1.17.- Depletion models season: 2018-2019                                  #
################################################################################
#
# Data object
jflcrusoe1819  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==17,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2018-09-25","2019-05-07"))
#
plot(x=jflcrusoe1819,mark=TRUE,offset=c(9,10,4),hem="S")                        # 47 56 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1819$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 43.80215
M.ini       <- 3*0.001937482
N0.ini      <- 2*43.80215
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1819$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1819$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1819.0P.apn.ini <- catdynexp(x=jflcrusoe1819,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1819.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1819.0P.apn.fit  <- CatDynFit(x=jflcrusoe1819,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1819.0P.apn.pred.spg <- CatDynPred(jflcrusoe1819.0P.apn.fit,"spg")     # 54 56
plot(x=jflcrusoe1819.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.0P.apn.pred.CG <- CatDynPred(jflcrusoe1819.0P.apn.fit,"CG")       # 54 56
plot(x=jflcrusoe1819.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.0P.apln.fit  <- CatDynFit(x=jflcrusoe1819,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1819.0P.apln.pred.spg <- CatDynPred(jflcrusoe1819.0P.apln.fit,"spg")   # 56
plot(x=jflcrusoe1819.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.0P.apln.pred.CG <- CatDynPred(jflcrusoe1819.0P.apln.fit,"CG")     # 56
plot(x=jflcrusoe1819.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*43.80215
P1.ini      <- 55
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jflcrusoe1819$Data$nasas$time.step,1))
#
jflcrusoe1819.1P.apn.ini <- catdynexp(x=jflcrusoe1819,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1819.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1819.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1819,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1819.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1819.1P.1.apn.fit,"spg") 
# plot(x=jflcrusoe1819.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1819.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1819.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe1819.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1819.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe1819.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.1P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1819.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1819,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1819.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1819.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1819.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1819.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1819.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1819.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1819$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1819$Data$nasas$obscat.thou))^2)
#
jflcrusoe1819.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1819,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
# jflcrusoe1819.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1819.1P.1.n.fit,"spg")   
# plot(x=jflcrusoe1819.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1819.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1819.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.n.pred.NM <- CatDynPred(jflcrusoe1819.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1819.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1819,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1819.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1819.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1819.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1819.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1819.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe1819.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.80215
P1.ini      <- 25
P2.ini      <- 35
k.ini       <- 2e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,
                 56,                                                            # the week of one input of abundance
                 tail(jflcrusoe1819$Data$nasas$time.step,1))
#
jflcrusoe1819.2P.apn.ini <- catdynexp(x=jflcrusoe1819,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1819.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1819.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1819,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1819.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1819.2P.1.apn.fit,"spg") ###01 106
plot(x=jflcrusoe1819.2P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1819.2P.1.apn.fit,"CG")   ###02 101
plot(x=jflcrusoe1819.2P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1819.2P.1.apn.fit,"Nelder-Mead") ###03 87
plot(x=jflcrusoe1819.2P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1819,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe1819.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1819.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe1819.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1819.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1819.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe1819.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1819.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1819,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1819.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1819.2P.1.n.fit,"spg")     ###04 105
plot(x=jflcrusoe1819.2P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1819.2P.1.n.fit,"CG")       ###05 100
plot(x=jflcrusoe1819.2P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.n.pred.NM <- CatDynPred(jflcrusoe1819.2P.1.n.fit,"Nelder-Mead") ###06 81
plot(x=jflcrusoe1819.2P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1819,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe1819.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1819.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe1819.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe1819.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1819.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe1819.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1819.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe1819.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.2P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*43.80215
P1.ini      <- 25
P2.ini      <- 35
P3.ini      <- 55    
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,
                 56,                                                            # the week of one input of abundance
                 70, 
                 tail(jflcrusoe1819$Data$nasas$time.step,1))
#
jflcrusoe1819.3P.apn.ini <- catdynexp(x=jflcrusoe1819,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1819.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1819,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1819.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1819.3P.1.apn.fit,"spg") ###07 72
plot(x=jflcrusoe1819.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1819.3P.1.apn.fit,"CG")   ###08 73
plot(x=jflcrusoe1819.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1819.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1819.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflcrusoe1819.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1819.3P.1.apln.fit,"spg") ###09 101
plot(x=jflcrusoe1819.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1819.3P.1.apln.fit,"CG") ###10 115
plot(x=jflcrusoe1819.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1819.3P.1.apln.fit,"Nelder-Mead") ###11 76
plot(x=jflcrusoe1819.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1819,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1819.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1819.3P.1.n.fit,"spg")     ###12 72
plot(x=jflcrusoe1819.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1819.3P.1.n.fit,"CG")       ###13 73
plot(x=jflcrusoe1819.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1819.3P.1.n.fit,"Nelder-Mead") ###14 65
plot(x=jflcrusoe1819.3P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe1819.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1819.3P.1.ln.fit,"spg")   ###15 100
plot(x=jflcrusoe1819.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1819.3P.1.ln.fit,"CG")     ###16 117
plot(x=jflcrusoe1819.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1819.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1819.3P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1819.3P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1819.2P.1.apn.fit,  ###01                               
           jflcrusoe1819.2P.1.apn.fit,  ###02
           jflcrusoe1819.2P.1.apn.fit,  ###03
           jflcrusoe1819.2P.1.n.fit,    ###04
           jflcrusoe1819.2P.1.n.fit,    ###05
           jflcrusoe1819.2P.1.n.fit,    ###06
           jflcrusoe1819.3P.1.apn.fit,  ###07
           jflcrusoe1819.3P.1.apn.fit,  ###08
           jflcrusoe1819.3P.1.apln.fit, ###09
           jflcrusoe1819.3P.1.apln.fit, ###10
           jflcrusoe1819.3P.1.apln.fit, ###11
           jflcrusoe1819.3P.1.n.fit,    ###12
           jflcrusoe1819.3P.1.n.fit,    ###13
           jflcrusoe1819.3P.1.n.fit,    ###14
           jflcrusoe1819.3P.1.ln.fit,   ###15
           jflcrusoe1819.3P.1.ln.fit)   ###16
m1 <- c("spg",         ###01
        "CG",          ###02
        "Nelder-Mead", ###03
        "spg",         ###04
        "CG",          ###05
        "Nelder-Mead", ###06
        "spg",         ###07
        "CG",          ###08
        "spg",         ###09
        "CG",          ###10
        "Nelder-Mead", ###11
        "spg",         ###12
        "CG",          ###13
        "Nelder-Mead", ###14
        "spg",         ###15
        "CG")          ###16
#
jflcrusoe1819.sum.0  <- CatDynSum(x=x1,season="2018-2019",method=m1)
# All gradients are good
jflcrusoe1819.sum.0[jflcrusoe1819.sum.0$Distribution=="apnormal",]
jflcrusoe1819.sum.0[jflcrusoe1819.sum.0$Distribution=="normal",]
jflcrusoe1819.sum.0[jflcrusoe1819.sum.0$Distribution=="aplnormal",]
jflcrusoe1819.sum.0[jflcrusoe1819.sum.0$Distribution=="lognormal",]
# AIC favours 3P
jflcrusoe1819.sum.1 <- jflcrusoe1819.sum.0[jflcrusoe1819.sum.0$Model=="3P",]
#
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1819.sum.1))],                     
          ttl=paste(jflcrusoe1819.sum.1$Model,
                    substring(jflcrusoe1819.sum.1$Distribution, 1,8),
                    jflcrusoe1819.sum.1$Method,
                    as.numeric(row.names(jflcrusoe1819.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe1819.sum.1))],
          arr=c(5,2))
# Variants ###07 and ###11 and ###14 and ###15 and ###16 have the worst correlations
#
(jflcrusoe1819.3P.1.apn.CG.partable   <- CatDynPar(x=jflcrusoe1819.3P.1.apn.fit,method="CG"))   ###08 73
(jflcrusoe1819.3P.1.apln.spg.partable <- CatDynPar(x=jflcrusoe1819.3P.1.apln.fit,method="spg")) ###09 101
(jflcrusoe1819.3P.1.apln.CG.partable  <- CatDynPar(x=jflcrusoe1819.3P.1.apln.fit,method="CG"))  ###10 115
(jflcrusoe1819.3P.1.n.spg.partable    <- CatDynPar(x=jflcrusoe1819.3P.1.n.fit,method="spg"))    ###12 72
(jflcrusoe1819.3P.1.n.CG.partable     <- CatDynPar(x=jflcrusoe1819.3P.1.n.fit,method="CG"))     ###13 73
# Variant ###08 has the most realistic and precise estimate of M - other CVs are good 
#
plot(x=jflcrusoe1819.3P.1.apn.pred.CG,                                         ###08 73
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1819.sum.0$Sel.Model[8] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.18.- Depletion models season: 2019-2020                                  #
################################################################################
#
# Data object
jflcrusoe1920  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==18,][1:34,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2019-09-25","2020-05-07"))
#
plot(x=jflcrusoe1920,mark=TRUE,offset=c(9,10,4),hem="S")                        # 42 47 54 60 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe1920$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 28.50449
M.ini       <- 3*0.001937482
N0.ini      <- 2*43.80215
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe1920$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe1920.0P.apn.ini <- catdynexp(x=jflcrusoe1920,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe1920.0P.apn.fit  <- CatDynFit(x=jflcrusoe1920,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe1920.0P.apn.pred.spg <- CatDynPred(jflcrusoe1920.0P.apn.fit,"spg")     # 38 53 57 60
plot(x=jflcrusoe1920.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.0P.apn.pred.CG <- CatDynPred(jflcrusoe1920.0P.apn.fit,"CG")       # 38 53 57 60
plot(x=jflcrusoe1920.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.0P.apln.fit  <- CatDynFit(x=jflcrusoe1920,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe1920.0P.apln.pred.spg <- CatDynPred(jflcrusoe1920.0P.apln.fit,"spg")   # 38 53 57 60
plot(x=jflcrusoe1920.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.0P.apln.pred.CG <- CatDynPred(jflcrusoe1920.0P.apln.fit,"CG")     # 38 53 57 60
plot(x=jflcrusoe1920.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*28.50449
P1.ini      <- 75
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 38,                                                            # the week of one input of abundance
                 tail(jflcrusoe1920$Data$nasas$time.step,1))
#
jflcrusoe1920.1P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe1920.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe1920.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe1920.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1920.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe1920.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe1920.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe1920.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.1P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe1920.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe1920.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe1920.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe1920.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe1920.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe1920.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe1920$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe1920$Data$nasas$obscat.thou))^2)
#
jflcrusoe1920.1P.1.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
# jflcrusoe1920.1P.1.n.pred.spg <- CatDynPred(jflcrusoe1920.1P.1.n.fit,"spg")
# plot(x=jflcrusoe1920.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1920.1P.1.n.pred.CG <- CatDynPred(jflcrusoe1920.1P.1.n.fit,"CG")
# plot(x=jflcrusoe1920.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1920.1P.1.n.pred.NM <- CatDynPred(jflcrusoe1920.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe1920.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe1920.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe1920.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe1920.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1920.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe1920.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe1920.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe1920.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe1920.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1*28.50449
P1.ini      <- 25
P2.ini      <- 85
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 38,
                 53,                                                            # the week of one input of abundance
                 tail(jflcrusoe1920$Data$nasas$time.step,1))
#
jflcrusoe1920.2P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe1920.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe1920.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe1920.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe1920.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe1920.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe1920.2P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.2P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1920.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe1920.2P.1.apln.fit,"spg") ###01 115
plot(x=jflcrusoe1920.2P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe1920.2P.1.apln.fit,"CG") ###02 115
plot(x=jflcrusoe1920.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# 
# jflcrusoe1920.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe1920.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.2P.1.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
# jflcrusoe1920.2P.1.n.pred.spg <- CatDynPred(jflcrusoe1920.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe1920.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.2P.1.n.pred.CG <- CatDynPred(jflcrusoe1920.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe1920.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe1920.2P.1.n.pred.NM <- CatDynPred(jflcrusoe1920.2P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.2P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
jflcrusoe1920.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe1920.2P.1.ln.fit,"spg")   ###03 116
plot(x=jflcrusoe1920.2P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe1920.2P.1.ln.fit,"CG")     ###04 115
plot(x=jflcrusoe1920.2P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1920.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe1920.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.2P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*28.50449
P1.ini      <- 25
P2.ini      <- 85
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 53,
                 60,                                                            # the week of one input of abundance
                 tail(jflcrusoe1920$Data$nasas$time.step,1))
#
jflcrusoe1920.2P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.2P.2.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1920.2P.2.apn.pred.spg <- CatDynPred(jflcrusoe1920.2P.2.apn.fit,"spg") ###05 40
plot(x=jflcrusoe1920.2P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.apn.pred.CG <- CatDynPred(jflcrusoe1920.2P.2.apn.fit,"CG")   ###06 30
plot(x=jflcrusoe1920.2P.2.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.apn.pred.NM <- CatDynPred(jflcrusoe1920.2P.2.apn.fit,"Nelder-Mead") ###07 56
plot(x=jflcrusoe1920.2P.2.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1920.2P.2.apln.pred.spg <- CatDynPred(jflcrusoe1920.2P.2.apln.fit,"spg") ###08 64
plot(x=jflcrusoe1920.2P.2.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.apln.pred.CG <- CatDynPred(jflcrusoe1920.2P.2.apln.fit,"CG") ###09 64
plot(x=jflcrusoe1920.2P.2.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# 
# jflcrusoe1920.2P.2.apln.pred.NM <- CatDynPred(jflcrusoe1920.2P.2.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.2P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1920.2P.2.n.pred.spg <- CatDynPred(jflcrusoe1920.2P.2.n.fit,"spg")     ###10 39
plot(x=jflcrusoe1920.2P.2.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.n.pred.CG <- CatDynPred(jflcrusoe1920.2P.2.n.fit,"CG")       ###11 30
plot(x=jflcrusoe1920.2P.2.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.n.pred.NM <- CatDynPred(jflcrusoe1920.2P.2.n.fit,"Nelder-Mead") ###12 30
plot(x=jflcrusoe1920.2P.2.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
jflcrusoe1920.2P.2.ln.pred.spg <- CatDynPred(jflcrusoe1920.2P.2.ln.fit,"spg")   ###13 64
plot(x=jflcrusoe1920.2P.2.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.ln.pred.CG <- CatDynPred(jflcrusoe1920.2P.2.ln.fit,"CG")     ###14 64
plot(x=jflcrusoe1920.2P.2.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.2P.2.ln.pred.NM <- CatDynPred(jflcrusoe1920.2P.2.ln.fit,"Nelder-Mead") ###15 111
plot(x=jflcrusoe1920.2P.2.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*28.50449
P1.ini      <- 25
P2.ini      <- 65
P3.ini      <- 25    
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 38,
                 53,                                                            # the week of one input of abundance
                 60, 
                 tail(jflcrusoe1920$Data$nasas$time.step,1))
#
jflcrusoe1920.3P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1920.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe1920.3P.1.apn.fit,"spg") ###05 44
plot(x=jflcrusoe1920.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe1920.3P.1.apn.fit,"CG")   ###06 30
plot(x=jflcrusoe1920.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1920.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe1920.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflcrusoe1920.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe1920.3P.1.apln.fit,"spg") ###07 64
plot(x=jflcrusoe1920.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe1920.3P.1.apln.fit,"CG") ###08 64
plot(x=jflcrusoe1920.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe1920.3P.1.apln.fit,"Nelder-Mead") ###09 107
plot(x=jflcrusoe1920.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1920.3P.1.n.pred.spg <- CatDynPred(jflcrusoe1920.3P.1.n.fit,"spg")     ###10 44
plot(x=jflcrusoe1920.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.n.pred.CG <- CatDynPred(jflcrusoe1920.3P.1.n.fit,"CG")       ###11 33
plot(x=jflcrusoe1920.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe1920.3P.1.n.pred.NM <- CatDynPred(jflcrusoe1920.3P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe1920.3P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe1920.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe1920.3P.1.ln.fit,"spg")   ###12 65
plot(x=jflcrusoe1920.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe1920.3P.1.ln.fit,"CG")     ###13 64
plot(x=jflcrusoe1920.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe1920.3P.1.ln.fit,"Nelder-Mead") ###14 73
plot(x=jflcrusoe1920.3P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*28.50449
P1.ini      <- 25
P2.ini      <- 65
P3.ini      <- 25    
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 53,                                                            # the week of one input of abundance
                 60, 
                 tail(jflcrusoe1920$Data$nasas$time.step,1))                    # 42 47 54 60
#
jflcrusoe1920.3P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.3P.2.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1920.3P.2.apn.pred.spg <- CatDynPred(jflcrusoe1920.3P.2.apn.fit,"spg") ###15 39
plot(x=jflcrusoe1920.3P.2.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.apn.pred.CG <- CatDynPred(jflcrusoe1920.3P.2.apn.fit,"CG")   ###16 26
plot(x=jflcrusoe1920.3P.2.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.apn.pred.NM <- CatDynPred(jflcrusoe1920.3P.2.apn.fit,"Nelder-Mead") ###17 99
plot(x=jflcrusoe1920.3P.2.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1920.3P.2.apln.pred.spg <- CatDynPred(jflcrusoe1920.3P.2.apln.fit,"spg") ###18 65
plot(x=jflcrusoe1920.3P.2.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.apln.pred.CG <- CatDynPred(jflcrusoe1920.3P.2.apln.fit,"CG") ###19 64
plot(x=jflcrusoe1920.3P.2.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.apln.pred.NM <- CatDynPred(jflcrusoe1920.3P.2.apln.fit,"Nelder-Mead") ###20 64
plot(x=jflcrusoe1920.3P.2.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1920.3P.2.n.pred.spg <- CatDynPred(jflcrusoe1920.3P.2.n.fit,"spg")     ###21 43
plot(x=jflcrusoe1920.3P.2.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.n.pred.CG <- CatDynPred(jflcrusoe1920.3P.2.n.fit,"CG")       ###22 26
plot(x=jflcrusoe1920.3P.2.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.n.pred.NM <- CatDynPred(jflcrusoe1920.3P.2.n.fit,"Nelder-Mead") ###23 159
plot(x=jflcrusoe1920.3P.2.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
jflcrusoe1920.3P.2.ln.pred.spg <- CatDynPred(jflcrusoe1920.3P.2.ln.fit,"spg")   ###24 64
plot(x=jflcrusoe1920.3P.2.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.ln.pred.CG <- CatDynPred(jflcrusoe1920.3P.2.ln.fit,"CG")     ###25 64
plot(x=jflcrusoe1920.3P.2.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.2.ln.pred.NM <- CatDynPred(jflcrusoe1920.3P.2.ln.fit,"Nelder-Mead") ###26 75
plot(x=jflcrusoe1920.3P.2.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*28.50449
P1.ini      <- 25
P2.ini      <- 65
P3.ini      <- 25    
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,
                 53,                                                            # the week of one input of abundance
                 60, 
                 tail(jflcrusoe1920$Data$nasas$time.step,1))                    # 42 47 54 60
#
jflcrusoe1920.3P.apn.ini <- catdynexp(x=jflcrusoe1920,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe1920.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe1920.3P.3.apn.fit  <- CatDynFit(x=jflcrusoe1920,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe1920.3P.3.apn.pred.spg <- CatDynPred(jflcrusoe1920.3P.3.apn.fit,"spg") ###27 42
plot(x=jflcrusoe1920.3P.3.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.apn.pred.CG <- CatDynPred(jflcrusoe1920.3P.3.apn.fit,"CG")   ###28 30
plot(x=jflcrusoe1920.3P.3.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.apn.pred.NM <- CatDynPred(jflcrusoe1920.3P.3.apn.fit,"Nelder-Mead") ###29 26
plot(x=jflcrusoe1920.3P.3.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.apln.fit  <- CatDynFit(x=jflcrusoe1920,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
jflcrusoe1920.3P.3.apln.pred.spg <- CatDynPred(jflcrusoe1920.3P.3.apln.fit,"spg") ###30 64
plot(x=jflcrusoe1920.3P.3.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.apln.pred.CG <- CatDynPred(jflcrusoe1920.3P.3.apln.fit,"CG") ###31 64
plot(x=jflcrusoe1920.3P.3.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.apln.pred.NM <- CatDynPred(jflcrusoe1920.3P.3.apln.fit,"Nelder-Mead") ###32 44
plot(x=jflcrusoe1920.3P.3.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.n.fit  <- CatDynFit(x=jflcrusoe1920,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe1920.3P.3.n.pred.spg <- CatDynPred(jflcrusoe1920.3P.3.n.fit,"spg")     ###33 42
plot(x=jflcrusoe1920.3P.3.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.n.pred.CG <- CatDynPred(jflcrusoe1920.3P.3.n.fit,"CG")       ###34 30
plot(x=jflcrusoe1920.3P.3.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.n.pred.NM <- CatDynPred(jflcrusoe1920.3P.3.n.fit,"Nelder-Mead") ###35 123
plot(x=jflcrusoe1920.3P.3.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.ln.fit  <- CatDynFit(x=jflcrusoe1920,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
jflcrusoe1920.3P.3.ln.pred.spg <- CatDynPred(jflcrusoe1920.3P.3.ln.fit,"spg")   ###36 64
plot(x=jflcrusoe1920.3P.3.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.ln.pred.CG <- CatDynPred(jflcrusoe1920.3P.3.ln.fit,"CG")     ###37 64
plot(x=jflcrusoe1920.3P.3.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.3P.3.ln.pred.NM <- CatDynPred(jflcrusoe1920.3P.3.ln.fit,"Nelder-Mead") ###38 43
plot(x=jflcrusoe1920.3P.3.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe1920.2P.1.apln.fit,  ###01                               
           jflcrusoe1920.2P.1.apln.fit,  ###02
           jflcrusoe1920.2P.1.ln.fit,    ###03
           jflcrusoe1920.2P.1.ln.fit,    ###04
           jflcrusoe1920.2P.2.apn.fit,   ###05
           jflcrusoe1920.2P.2.apn.fit,   ###06
           jflcrusoe1920.2P.2.apn.fit,   ###07
           jflcrusoe1920.2P.2.apln.fit,  ###08
           jflcrusoe1920.2P.2.apln.fit,  ###09
           jflcrusoe1920.2P.2.n.fit,     ###10
           jflcrusoe1920.2P.2.n.fit,     ###11
           jflcrusoe1920.2P.2.n.fit,     ###12
           jflcrusoe1920.2P.2.ln.fit,    ###13
           jflcrusoe1920.2P.2.ln.fit,    ###14
           jflcrusoe1920.2P.2.ln.fit)    ###15
           # jflcrusoe1920.3P.1.apn.fit,   ###05
           # jflcrusoe1920.3P.1.apn.fit,   ###06
           # jflcrusoe1920.3P.1.apln.fit,  ###07
           # jflcrusoe1920.3P.1.apln.fit,  ###08
           # jflcrusoe1920.3P.1.apln.fit,  ###09
           # jflcrusoe1920.3P.1.n.fit,     ###10
           # jflcrusoe1920.3P.1.n.fit,     ###11
           # jflcrusoe1920.3P.1.ln.fit,    ###12
           # jflcrusoe1920.3P.1.ln.fit,    ###13
           # jflcrusoe1920.3P.1.ln.fit,    ###14
           # jflcrusoe1920.3P.2.apn.fit,   ###15
           # jflcrusoe1920.3P.2.apn.fit,   ###16
           # jflcrusoe1920.3P.2.apn.fit,   ###17
           # jflcrusoe1920.3P.2.apln.fit,  ###18
           # jflcrusoe1920.3P.2.apln.fit,  ###19
           # jflcrusoe1920.3P.2.apln.fit,  ###20
           # jflcrusoe1920.3P.2.n.fit,     ###21
           # jflcrusoe1920.3P.2.n.fit,     ###22
           # jflcrusoe1920.3P.2.n.fit,     ###23
           # jflcrusoe1920.3P.2.ln.fit,    ###24
           # jflcrusoe1920.3P.2.ln.fit,    ###25
           # jflcrusoe1920.3P.2.ln.fit,    ###26
           # jflcrusoe1920.3P.3.apn.fit,   ###27
           # jflcrusoe1920.3P.3.apn.fit,   ###28
           # jflcrusoe1920.3P.3.apn.fit,   ###29
           # jflcrusoe1920.3P.3.apln.fit,  ###30
           # jflcrusoe1920.3P.3.apln.fit,  ###31
           # jflcrusoe1920.3P.3.apln.fit,  ###32
           # jflcrusoe1920.3P.3.n.fit,     ###33
           # jflcrusoe1920.3P.3.n.fit,     ###34
           # jflcrusoe1920.3P.3.n.fit,     ###35
           # jflcrusoe1920.3P.3.ln.fit,    ###36
           # jflcrusoe1920.3P.3.ln.fit,    ###37
           # jflcrusoe1920.3P.3.ln.fit)    ###38
m1 <- c("spg",         ###01
        "CG",          ###02
        "spg",         ###03
        "CG",          ###04
        "spg",         ###05
        "CG",          ###06
        "Nelder-Mead", ###07
        "spg",         ###08
        "CG",          ###09
        "spg",         ###10
        "CG",          ###11
        "Nelder-Mead", ###12
        "spg",         ###13
        "CG",          ###14
        "Nelder-Mead") ###15
        # "CG",          ###16
        # "Nelder-Mead", ###17
        # "spg",         ###18
        # "CG",          ###19
        # "Nelder-Mead", ###20
        # "spg",         ###21
        # "CG",          ###22
        # "Nelder-Mead", ###23
        # "spg",         ###24
        # "CG",          ###25
        # "Nelder-Mead", ###26
        # "spg",         ###27
        # "CG",          ###28
        # "Nelder-Mead", ###29
        # "spg",         ###30
        # "CG",          ###31
        # "Nelder-Mead", ###32
        # "spg",         ###33
        # "CG",          ###34
        # "Nelder-Mead", ###35
        # "spg",         ###36
        # "CG",          ###37
        # "Nelder-Mead") ###38
#
jflcrusoe1920.sum.0 <- CatDynSum(x=x1,season="2019-2020",method=m1)
# All gradients are good
jflcrusoe1920.sum.0[jflcrusoe1920.sum.0$Distribution=="apnormal",]
jflcrusoe1920.sum.0[jflcrusoe1920.sum.0$Distribution=="normal",]
jflcrusoe1920.sum.0[jflcrusoe1920.sum.0$Distribution=="aplnormal",]
jflcrusoe1920.sum.0[jflcrusoe1920.sum.0$Distribution=="lognormal",]
# AIC inconclusive
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe1920.sum.0))],                     
          ttl=paste(jflcrusoe1920.sum.0$Model,
                    substring(jflcrusoe1920.sum.0$Distribution, 1,8),
                    jflcrusoe1920.sum.0$Method,
                    as.numeric(row.names(jflcrusoe1920.sum.0))),
          method=m1[as.numeric(row.names(jflcrusoe1920.sum.0))],
          arr=c(5,3))
# Variants ###05 ###06 ###07 ###11 ###12 ###14 ###15 have better correlations
(jflcrusoe1920.2P.2.apn.spg.partable <- CatDynPar(x=jflcrusoe1920.2P.2.apn.fit,method="spg"))         ###05 44 *
(jflcrusoe1920.2P.2.apn.CG.partable  <- CatDynPar(x=jflcrusoe1920.2P.2.apn.fit,method="CG"))          ###06 30
(jflcrusoe1920.2P.2.apn.NM.partable  <- CatDynPar(x=jflcrusoe1920.2P.2.apn.fit,method="Nelder-Mead")) ###07 44 *
(jflcrusoe1920.2P.2.n.CG.partable    <- CatDynPar(x=jflcrusoe1920.2P.2.n.fit,method="CG"))            ###11 30
(jflcrusoe1920.2P.2.n.NM.partable    <- CatDynPar(x=jflcrusoe1920.2P.2.n.fit,method="Nelder-Mead"))   ###12 44 *
(jflcrusoe1920.2P.2.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.2P.2.ln.fit,method="CG"))           ###14 30
(jflcrusoe1920.2P.2.ln.NM.partable   <- CatDynPar(x=jflcrusoe1920.2P.2.ln.fit,method="Nelder-Mead"))  ###15 44 *
# Variant ###07 has the most realistic and precise estimate of M - other CVs are OK 
#
# (jflcrusoe1920.3P.1.n.CG.partable    <- CatDynPar(x=jflcrusoe1920.3P.1.n.fit,method="CG"))             ###11 33
# (jflcrusoe1920.3P.1.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.3P.1.ln.fit,method="CG"))            ###13 64
# (jflcrusoe1920.3P.2.apn.CG.partable  <- CatDynPar(x=jflcrusoe1920.3P.2.apn.fit,method="spg"))          ###15 39 *
# (jflcrusoe1920.3P.2.apn.CG.partable  <- CatDynPar(x=jflcrusoe1920.3P.2.apn.fit,method="CG"))           ###16 26
# (jflcrusoe1920.3P.2.apln.CG.partable <- CatDynPar(x=jflcrusoe1920.3P.2.apln.fit,method="spg"))         ###18 65
# (jflcrusoe1920.3P.2.apln.CG.partable <- CatDynPar(x=jflcrusoe1920.3P.2.apln.fit,method="CG"))          ###19 64
# (jflcrusoe1920.3P.2.apln.CG.partable <- CatDynPar(x=jflcrusoe1920.3P.2.apln.fit,method="Nelder-Mead")) ###20 64
# (jflcrusoe1920.3P.2.n.CG.partable    <- CatDynPar(x=jflcrusoe1920.3P.2.n.fit,method="CG"))             ###22 26
# (jflcrusoe1920.3P.2.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.3P.2.ln.fit,method="spg"))           ###24 64
# (jflcrusoe1920.3P.2.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.3P.2.ln.fit,method="CG"))            ###25 64
# (jflcrusoe1920.3P.2.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.3P.2.ln.fit,method="Nelder-Mead"))   ###26 75
# (jflcrusoe1920.3P.3.apn.spg.partable <- CatDynPar(x=jflcrusoe1920.3P.3.apn.fit,method="spg"))          ###27 42 *
# (jflcrusoe1920.3P.3.apn.CG.partable  <- CatDynPar(x=jflcrusoe1920.3P.3.apn.fit,method="CG"))           ###28 30
# (jflcrusoe1920.3P.3.apn.NM.partable  <- CatDynPar(x=jflcrusoe1920.3P.3.apn.fit,method="Nelder-Mead"))  ###29 26
# (jflcrusoe1920.3P.3.n.CG.partable    <- CatDynPar(x=jflcrusoe1920.3P.3.n.fit,method="CG"))             ###34 30
# (jflcrusoe1920.3P.3.ln.CG.partable   <- CatDynPar(x=jflcrusoe1920.3P.3.ln.fit,method="CG"))            ###37 64
# Variant ###08 has the most realistic and precise estimate of M - other CVs are good 
#
plot(x=jflcrusoe1920.2P.2.apn.pred.NM,                                          ###07 56
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe1920.sum.0$Sel.Model[7] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.19.- Depletion models season: 2020-2021                                  #
################################################################################
#
# Data object
jflcrusoe2021  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==19,][1:34,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2020-09-25","2021-05-07"))
#
plot(x=jflcrusoe2021,mark=TRUE,offset=c(9,10,4),hem="S")                        # 45 52 58 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe2021$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 55.86662
M.ini       <- 3*0.001937482
N0.ini      <- 4*43.80215
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe2021$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe2021$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe2021.0P.apn.ini <- catdynexp(x=jflcrusoe2021,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2021.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe2021.0P.apn.fit  <- CatDynFit(x=jflcrusoe2021,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe2021.0P.apn.pred.spg <- CatDynPred(jflcrusoe2021.0P.apn.fit,"spg")     # 44 54 58
plot(x=jflcrusoe2021.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.0P.apn.pred.CG <- CatDynPred(jflcrusoe2021.0P.apn.fit,"CG")       # 44 54 58
plot(x=jflcrusoe2021.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.0P.apln.fit  <- CatDynFit(x=jflcrusoe2021,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe2021.0P.apln.pred.spg <- CatDynPred(jflcrusoe2021.0P.apln.fit,"spg")   # 44 52
plot(x=jflcrusoe2021.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.0P.apln.pred.CG <- CatDynPred(jflcrusoe2021.0P.apln.fit,"CG")     # 44 52
plot(x=jflcrusoe2021.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*28.50449
P1.ini      <- 55
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe2021$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,                                                            # the week of one input of abundance
                 tail(jflcrusoe2021$Data$nasas$time.step,1))
#
jflcrusoe2021.1P.apn.ini <- catdynexp(x=jflcrusoe2021,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2021.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2021.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe2021,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe2021.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe2021.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe2021.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2021.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe2021.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe2021.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe2021.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.1P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2021.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe2021,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe2021.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe2021.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe2021.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe2021.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe2021.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe2021.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe2021$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe2021$Data$nasas$obscat.thou))^2)
#
jflcrusoe2021.1P.1.n.fit  <- CatDynFit(x=jflcrusoe2021,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
# jflcrusoe2021.1P.1.n.pred.spg <- CatDynPred(jflcrusoe2021.1P.1.n.fit,"spg")
# plot(x=jflcrusoe2021.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2021.1P.1.n.pred.CG <- CatDynPred(jflcrusoe2021.1P.1.n.fit,"CG")
# plot(x=jflcrusoe2021.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2021.1P.1.n.pred.NM <- CatDynPred(jflcrusoe2021.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe2021.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe2021,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe2021.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe2021.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe2021.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2021.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe2021.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe2021.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2021.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe2021.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*55.86662
P1.ini      <- 75
P2.ini      <- 25
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe2021$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 52,                                                            # the week of one input of abundance
                 tail(jflcrusoe2021$Data$nasas$time.step,1))
#
jflcrusoe2021.2P.apn.ini <- catdynexp(x=jflcrusoe2021,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2021.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2021.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe2021,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
# jflcrusoe2021.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe2021.2P.1.apn.fit,"spg")
# plot(x=jflcrusoe2021.2P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe2021.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe2021.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe2021.2P.1.apn.fit,"Nelder-Mead") ###01 21
plot(x=jflcrusoe2021.2P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe2021,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe2021.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe2021.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe2021.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe2021.2P.1.apln.fit,"CG") 
plot(x=jflcrusoe2021.2P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# 
# jflcrusoe2021.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe2021.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.2P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.n.fit  <- CatDynFit(x=jflcrusoe2021,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
# jflcrusoe2021.2P.1.n.pred.spg <- CatDynPred(jflcrusoe2021.2P.1.n.fit,"spg")     
# plot(x=jflcrusoe2021.2P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.2P.1.n.pred.CG <- CatDynPred(jflcrusoe2021.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe2021.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.n.pred.NM <- CatDynPred(jflcrusoe2021.2P.1.n.fit,"Nelder-Mead") ###02 180
plot(x=jflcrusoe2021.2P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe2021,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe2021.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe2021.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe2021.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe2021.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe2021.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2021.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe2021.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2021.2P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 2*55.86662
P1.ini      <- 75
P2.ini      <- 15
P3.ini      <- 15    
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe2021$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 52,                                                            # the week of one input of abundance
                 58, 
                 tail(jflcrusoe2021$Data$nasas$time.step,1))
#
jflcrusoe2021.3P.apn.ini <- catdynexp(x=jflcrusoe2021,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2021.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2021.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe2021,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe2021.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe2021.3P.1.apn.fit,"spg") ###03 19
plot(x=jflcrusoe2021.3P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe2021.3P.1.apn.fit,"CG")   ###04 19
plot(x=jflcrusoe2021.3P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe2021.3P.1.apn.fit,"Nelder-Mead") ###05 40
plot(x=jflcrusoe2021.3P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe2021,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflcrusoe2021.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe2021.3P.1.apln.fit,"spg") ###06 109
plot(x=jflcrusoe2021.3P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe2021.3P.1.apln.fit,"CG") ###07 142
plot(x=jflcrusoe2021.3P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe2021.3P.1.apln.fit,"Nelder-Mead") ###08 179
plot(x=jflcrusoe2021.3P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.n.fit  <- CatDynFit(x=jflcrusoe2021,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2021.3P.1.n.pred.spg <- CatDynPred(jflcrusoe2021.3P.1.n.fit,"spg")     ###09 19
plot(x=jflcrusoe2021.3P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.n.pred.CG <- CatDynPred(jflcrusoe2021.3P.1.n.fit,"CG")       ###10 19
plot(x=jflcrusoe2021.3P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.n.pred.NM <- CatDynPred(jflcrusoe2021.3P.1.n.fit,"Nelder-Mead") ###11 83
plot(x=jflcrusoe2021.3P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe2021,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe2021.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe2021.3P.1.ln.fit,"spg")   ###12 122
plot(x=jflcrusoe2021.3P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe2021.3P.1.ln.fit,"CG")     ###13 143
plot(x=jflcrusoe2021.3P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe2021.3P.1.ln.fit,"Nelder-Mead") ###14 158
plot(x=jflcrusoe2021.3P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*55.86662
P1.ini      <- 45
P2.ini      <- 15
P3.ini      <- 15 
P4.ini      <- 15
k.ini       <- 3e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe2021$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 52,                                                            # the week of one input of abundance
                 58, 
                 69,
                 tail(jflcrusoe2021$Data$nasas$time.step,1))
#
jflcrusoe2021.4P.apn.ini <- catdynexp(x=jflcrusoe2021,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2021.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2021.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe2021,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe2021.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe2021.4P.1.apn.fit,"spg") ###15 21
plot(x=jflcrusoe2021.4P.1.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe2021.4P.1.apn.fit,"CG")   ###16 22
plot(x=jflcrusoe2021.4P.1.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.apn.pred.NM <- CatDynPred(jflcrusoe2021.4P.1.apn.fit,"Nelder-Mead") ###17 49
plot(x=jflcrusoe2021.4P.1.apn.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe2021,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflcrusoe2021.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe2021.4P.1.apln.fit,"spg") ###18 80
plot(x=jflcrusoe2021.4P.1.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe2021.4P.1.apln.fit,"CG") ###19 99
plot(x=jflcrusoe2021.4P.1.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.apln.pred.NM <- CatDynPred(jflcrusoe2021.4P.1.apln.fit,"Nelder-Mead") ###20 46
plot(x=jflcrusoe2021.4P.1.apln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.n.fit  <- CatDynFit(x=jflcrusoe2021,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#c("spg","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2021.4P.1.n.pred.spg <- CatDynPred(jflcrusoe2021.4P.1.n.fit,"spg")     ###21 21
plot(x=jflcrusoe2021.4P.1.n.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.n.pred.CG <- CatDynPred(jflcrusoe2021.4P.1.n.fit,"CG")       ###22 23
plot(x=jflcrusoe2021.4P.1.n.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.n.pred.NM <- CatDynPred(jflcrusoe2021.4P.1.n.fit,"Nelder-Mead") ###23 39
plot(x=jflcrusoe2021.4P.1.n.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe2021,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflcrusoe2021.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe2021.4P.1.ln.fit,"spg")   ###24 83
plot(x=jflcrusoe2021.4P.1.ln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.ln.pred.CG <- CatDynPred(jflcrusoe2021.4P.1.ln.fit,"CG")     ###25 103
plot(x=jflcrusoe2021.4P.1.ln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.4P.1.ln.pred.NM <- CatDynPred(jflcrusoe2021.4P.1.ln.fit,"Nelder-Mead") ###26 61
plot(x=jflcrusoe2021.4P.1.ln.pred.NM,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe2021.2P.1.apn.fit,  ###01                               
           jflcrusoe2021.2P.1.n.fit,    ###02
           jflcrusoe2021.3P.1.apn.fit,  ###03
           jflcrusoe2021.3P.1.apn.fit,  ###04
           jflcrusoe2021.3P.1.apn.fit,  ###05
           jflcrusoe2021.3P.1.apln.fit, ###06
           jflcrusoe2021.3P.1.apln.fit, ###07
           jflcrusoe2021.3P.1.apln.fit, ###08
           jflcrusoe2021.3P.1.n.fit,    ###09
           jflcrusoe2021.3P.1.n.fit,    ###10
           jflcrusoe2021.3P.1.n.fit,    ###11
           jflcrusoe2021.3P.1.ln.fit,   ###12
           jflcrusoe2021.3P.1.ln.fit,   ###13
           jflcrusoe2021.3P.1.ln.fit,   ###14
           jflcrusoe2021.4P.1.apn.fit,  ###15
           jflcrusoe2021.4P.1.apn.fit,  ###16
           jflcrusoe2021.4P.1.apn.fit,  ###17
           jflcrusoe2021.4P.1.apln.fit, ###18
           jflcrusoe2021.4P.1.apln.fit, ###19
           jflcrusoe2021.4P.1.apln.fit, ###20
           jflcrusoe2021.4P.1.n.fit,    ###21
           jflcrusoe2021.4P.1.n.fit,    ###22
           jflcrusoe2021.4P.1.n.fit,    ###23
           jflcrusoe2021.4P.1.ln.fit,   ###24
           jflcrusoe2021.4P.1.ln.fit,   ###25
           jflcrusoe2021.4P.1.ln.fit)   ###26
m1 <- c("Nelder-Mead", ###01
        "Nelder-Mead", ###02
        "spg",         ###03
        "CG",          ###04
        "Nelder-Mead", ###05
        "spg",         ###06
        "CG",          ###07
        "Nelder-Mead", ###08
        "spg",         ###09
        "CG",          ###10
        "Nelder-Mead", ###11
        "spg",         ###12
        "CG",          ###13
        "Nelder-Mead", ###14
        "spg",         ###15
        "CG",          ###16
        "Nelder-Mead", ###17
        "spg",         ###18
        "CG",          ###19
        "Nelder-Mead", ###20
        "spg",         ###21
        "CG",          ###22
        "Nelder-Mead", ###23
        "spg",         ###24
        "CG",          ###25
        "Nelder-Mead") ###26
        #
jflcrusoe2021.sum.0 <- CatDynSum(x=x1,season="2020-2021",method=m1)
jflcrusoe2021.sum.1 <- jflcrusoe2021.sum.0[jflcrusoe2021.sum.0$Max.Abs.Grads. < 1,]
# All gradients are good
jflcrusoe2021.sum.0[jflcrusoe2021.sum.0$Distribution=="apnormal",]
jflcrusoe2021.sum.0[jflcrusoe2021.sum.0$Distribution=="normal",]
jflcrusoe2021.sum.0[jflcrusoe2021.sum.0$Distribution=="aplnormal",]
jflcrusoe2021.sum.0[jflcrusoe2021.sum.0$Distribution=="lognormal",]
# AIC favours 3P and 4P
jflcrusoe2021.sum.2 <- jflcrusoe2021.sum.1[jflcrusoe2021.sum.1$Model == "3P" | jflcrusoe2021.sum.1$Model == "4P",]
#
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe2021.sum.2))],                     
          ttl=paste(jflcrusoe2021.sum.2$Model,
                    substring(jflcrusoe2021.sum.2$Distribution, 1,8),
                    jflcrusoe2021.sum.2$Method,
                    as.numeric(row.names(jflcrusoe2021.sum.2))),
          method=m1[as.numeric(row.names(jflcrusoe2021.sum.2))],
          arr=c(6,3))
# Variants ###03 ###04 ###15 ###16 ###19 have very good correlations
(jflcrusoe2021.3P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe2021.3P.1.apn.fit,method="spg")) ###03 19 
(jflcrusoe2021.3P.1.apn.CG.partable  <- CatDynPar(x=jflcrusoe2021.3P.1.apn.fit,method="CG"))  ###04 19
(jflcrusoe2021.4P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe2021.4P.1.apn.fit,method="spg")) ###15 21 
(jflcrusoe2021.4P.1.apn.CG.partable  <- CatDynPar(x=jflcrusoe2021.4P.1.apn.fit,method="CG"))  ###16 22
(jflcrusoe2021.4P.1.apln.CG.partable <- CatDynPar(x=jflcrusoe2021.4P.1.apln.fit,method="CG")) ###19 99 
# Variant ###16 has the most realistic and precise (though very imprecise) estimate of M
#
plot(x=jflcrusoe2021.4P.1.apn.pred.CG,                                          ###16 22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2021.sum.0$Sel.Model[16] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.20.- Depletion models season: 2021-2022                                  #
################################################################################
#
# Data object
jflcrusoe2122  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==20,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2021-09-25","2022-05-07"))
#
plot(x=jflcrusoe2122,mark=TRUE,offset=c(9,10,4),hem="S")                        # 45 53 59 64 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe2122$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 38.21488
M.ini       <- 3*0.001937482
N0.ini      <- 4*38.21488
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe2122$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe2122$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe2122.0P.apn.ini <- catdynexp(x=jflcrusoe2122,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2122.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe2122.0P.apn.fit  <- CatDynFit(x=jflcrusoe2122,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe2122.0P.apn.pred.spg <- CatDynPred(jflcrusoe2122.0P.apn.fit,"spg")     # 45 53 59 64
plot(x=jflcrusoe2122.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.0P.apn.pred.CG <- CatDynPred(jflcrusoe2122.0P.apn.fit,"CG")       # 45 53 59 64
plot(x=jflcrusoe2122.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.0P.apln.fit  <- CatDynFit(x=jflcrusoe2122,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe2122.0P.apln.pred.spg <- CatDynPred(jflcrusoe2122.0P.apln.fit,"spg")   # 45 53 64
plot(x=jflcrusoe2122.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.0P.apln.pred.CG <- CatDynPred(jflcrusoe2122.0P.apln.fit,"CG")     # 45 53 64
plot(x=jflcrusoe2122.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*38.21488
P1.ini      <- 45
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,                                                            # the week of one input of abundance
                 tail(jflcrusoe2122$Data$nasas$time.step,1))
#
jflcrusoe2122.1P.apn.ini <- catdynexp(x=jflcrusoe2122,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2122.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2122.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe2122,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflcrusoe2122.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe2122.1P.1.apn.fit,"spg")
# plot(x=jflcrusoe2122.1P.1.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2122.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe2122.1P.1.apn.fit,"CG")
# plot(x=jflcrusoe2122.1P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2122.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe2122.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.1P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe2122,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe2122.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe2122.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe2122.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe2122.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe2122.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe2122.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe2122$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe2122$Data$nasas$obscat.thou))^2)
#
jflcrusoe2122.1P.1.n.fit  <- CatDynFit(x=jflcrusoe2122,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
# jflcrusoe2122.1P.1.n.pred.spg <- CatDynPred(jflcrusoe2122.1P.1.n.fit,"spg")
# plot(x=jflcrusoe2122.1P.1.n.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2122.1P.1.n.pred.CG <- CatDynPred(jflcrusoe2122.1P.1.n.fit,"CG")
# plot(x=jflcrusoe2122.1P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2122.1P.1.n.pred.NM <- CatDynPred(jflcrusoe2122.1P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.1P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe2122.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe2122,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe2122.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe2122.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe2122.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2122.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe2122.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe2122.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflcrusoe2122.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe2122.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*38.21488
P1.ini      <- 75
P2.ini      <- 25
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 53,                                                            # the week of one input of abundance
                 tail(jflcrusoe2122$Data$nasas$time.step,1))
#
jflcrusoe2122.2P.apn.ini <- catdynexp(x=jflcrusoe2122,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2122.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2122.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe2122,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe2122.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe2122.2P.1.apn.fit,"spg") 
plot(x=jflcrusoe2122.2P.1.apn.pred.spg,                                         ###01 18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe2122.2P.1.apn.fit,"CG")   
# plot(x=jflcrusoe2122.2P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe2122.2P.1.apn.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.2P.1.apn.pred.NM,                                          ###02 81
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe2122,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe2122.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe2122.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe2122.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe2122.2P.1.apln.fit,"CG") 
# plot(x=jflcrusoe2122.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
jflcrusoe2122.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe2122.2P.1.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe2122.2P.1.apln.pred.NM,                                         ###03 141
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.n.fit  <- CatDynFit(x=jflcrusoe2122,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2122.2P.1.n.pred.spg <- CatDynPred(jflcrusoe2122.2P.1.n.fit,"spg")
plot(x=jflcrusoe2122.2P.1.n.pred.spg,                                           ###04 12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.2P.1.n.pred.CG <- CatDynPred(jflcrusoe2122.2P.1.n.fit,"CG")       
# plot(x=jflcrusoe2122.2P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.n.pred.NM <- CatDynPred(jflcrusoe2122.2P.1.n.fit,"Nelder-Mead")
plot(x=jflcrusoe2122.2P.1.n.pred.NM,                                            ###05 501
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe2122,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe2122.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe2122.2P.1.ln.fit,"spg")   
# plot(x=jflcrusoe2122.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe2122.2P.1.ln.fit,"CG")     
# plot(x=jflcrusoe2122.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe2122.2P.1.ln.fit,"Nelder-Mead")
plot(x=jflcrusoe2122.2P.1.ln.pred.NM,                                           ###06 45
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 3*38
P1.ini      <- 75
P2.ini      <- 15
P3.ini      <- 15    
k.ini       <- 2e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 53,                                                            # the week of one input of abundance
                 64, 
                 tail(jflcrusoe2122$Data$nasas$time.step,1))
#
jflcrusoe2122.3P.apn.ini <- catdynexp(x=jflcrusoe2122,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2122.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2122.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe2122,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method="spg",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe2122.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe2122.3P.1.apn.fit,"spg") 
plot(x=jflcrusoe2122.3P.1.apn.pred.spg,                                         ###07 53
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe2122.3P.1.apn.fit,"CG")   
# plot(x=jflcrusoe2122.3P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe2122.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe2122,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe2122.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe2122.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe2122.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe2122.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe2122.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe2122.3P.1.apln.fit,"Nelder-Mead")
plot(x=jflcrusoe2122.3P.1.apln.pred.NM,                                         ###08 62
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.3P.1.n.fit  <- CatDynFit(x=jflcrusoe2122,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2122.3P.1.n.pred.spg <- CatDynPred(jflcrusoe2122.3P.1.n.fit,"spg")     
plot(x=jflcrusoe2122.3P.1.n.pred.spg,                                           ###09 59
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.n.pred.CG <- CatDynPred(jflcrusoe2122.3P.1.n.fit,"CG")       
# plot(x=jflcrusoe2122.3P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.n.pred.NM <- CatDynPred(jflcrusoe2122.3P.1.n.fit,"Nelder-Mead")
# plot(x=jflcrusoe2122.3P.1.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe2122,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe2122.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe2122.3P.1.ln.fit,"spg")   
# plot(x=jflcrusoe2122.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe2122.3P.1.ln.fit,"CG")     
# plot(x=jflcrusoe2122.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe2122.3P.1.ln.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.3P.1.ln.pred.NM,                                           ###10 151
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 4 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 3*38
P1.ini      <- 25
P2.ini      <- 5
P3.ini      <- 5 
P4.ini      <- 5
k.ini       <- 3e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflcrusoe2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 53,                                                            # the week of one input of abundance
                 59, 
                 64,
                 tail(jflcrusoe2122$Data$nasas$time.step,1))
#
jflcrusoe2122.4P.apn.ini <- catdynexp(x=jflcrusoe2122,
                                      p=4,
                                      par=pars.ini.4P,
                                      dates=dates.4P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2122.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2122.4P.1.apn.fit  <- CatDynFit(x=jflcrusoe2122,
                                         p=4,
                                         par=pars.ini.4P,
                                         dates=dates.4P,
                                         distr="apnormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe2122.4P.1.apn.pred.spg <- CatDynPred(jflcrusoe2122.4P.1.apn.fit,"spg") 
plot(x=jflcrusoe2122.4P.1.apn.pred.spg,                                         ###11 17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.4P.1.apn.pred.CG <- CatDynPred(jflcrusoe2122.4P.1.apn.fit,"CG")   
# plot(x=jflcrusoe2122.4P.1.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.apn.pred.NM <- CatDynPred(jflcrusoe2122.4P.1.apn.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.4P.1.apn.pred.NM,                                          ###12 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.apln.fit  <- CatDynFit(x=jflcrusoe2122,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="aplnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe2122.4P.1.apln.pred.spg <- CatDynPred(jflcrusoe2122.4P.1.apln.fit,"spg")
# plot(x=jflcrusoe2122.4P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.4P.1.apln.pred.CG <- CatDynPred(jflcrusoe2122.4P.1.apln.fit,"CG") 
# plot(x=jflcrusoe2122.4P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.apln.pred.NM <- CatDynPred(jflcrusoe2122.4P.1.apln.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.4P.1.apln.pred.NM,                                         ###13 80
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.n.fit  <- CatDynFit(x=jflcrusoe2122,
                                       p=4,
                                       par=c(pars.ini.4P,psi.n.ini),
                                       dates=dates.4P,
                                       distr="normal",
                                       method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2122.4P.1.n.pred.spg <- CatDynPred(jflcrusoe2122.4P.1.n.fit,"spg")     
plot(x=jflcrusoe2122.4P.1.n.pred.spg,                                           ###14 18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2122.4P.1.n.pred.CG <- CatDynPred(jflcrusoe2122.4P.1.n.fit,"CG") 
# plot(x=jflcrusoe2122.4P.1.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.n.pred.NM <- CatDynPred(jflcrusoe2122.4P.1.n.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.4P.1.n.pred.NM,                                            ###15 207
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.ln.fit  <- CatDynFit(x=jflcrusoe2122,
                                        p=4,
                                        par=c(pars.ini.4P,psi.ln.ini),
                                        dates=dates.4P,
                                        distr="lognormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe2122.4P.1.ln.pred.spg <- CatDynPred(jflcrusoe2122.4P.1.ln.fit,"spg")   
# plot(x=jflcrusoe2122.4P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2122.4P.1.ln.pred.CG <- CatDynPred(jflcrusoe2122.4P.1.ln.fit,"CG")     
# plot(x=jflcrusoe2122.4P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2122.4P.1.ln.pred.NM <- CatDynPred(jflcrusoe2122.4P.1.ln.fit,"Nelder-Mead") 
plot(x=jflcrusoe2122.4P.1.ln.pred.NM,                                           ###16 157
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe2122.2P.1.apn.fit,  ###01                               
           jflcrusoe2122.2P.1.apn.fit,  ###02
           jflcrusoe2122.2P.1.apln.fit, ###03
           jflcrusoe2122.2P.1.n.fit,    ###04
           jflcrusoe2122.2P.1.n.fit,    ###05
           jflcrusoe2122.2P.1.ln.fit,   ###06
           jflcrusoe2122.3P.1.apn.fit,  ###07
           jflcrusoe2122.3P.1.apln.fit, ###08
           jflcrusoe2122.3P.1.n.fit,    ###09
           jflcrusoe2122.3P.1.ln.fit,   ###10
           jflcrusoe2122.4P.1.apn.fit,  ###11
           jflcrusoe2122.4P.1.apn.fit,  ###12
           jflcrusoe2122.4P.1.apln.fit, ###13
           jflcrusoe2122.4P.1.n.fit,    ###14
           jflcrusoe2122.4P.1.n.fit,    ###15
           jflcrusoe2122.4P.1.ln.fit)   ###16
m1 <- c("spg",         ###01
        "Nelder-Mead", ###02
        "Nelder-Mead", ###03
        "spg",         ###04
        "Nelder-Mead", ###05
        "Nelder-Mead", ###06
        "spg",         ###07
        "Nelder-Mead", ###08
        "spg",         ###09
        "Nelder-Mead", ###10
        "spg",         ###11
        "Nelder-Mead", ###12
        "Nelder-Mead", ###13
        "spg",         ###14
        "Nelder-Mead", ###15
        "Nelder-Mead") ###16
#
jflcrusoe2122.sum.0 <- CatDynSum(x=x1,season="2021-2122",method=m1)
jflcrusoe2122.sum.1 <- jflcrusoe2122.sum.0[jflcrusoe2122.sum.0$Max.Abs.Grads. < 1,]
# Two variants taken out
jflcrusoe2122.sum.1[jflcrusoe2122.sum.1$Distribution=="apnormal",]
jflcrusoe2122.sum.1[jflcrusoe2122.sum.1$Distribution=="normal",]
jflcrusoe2122.sum.1[jflcrusoe2122.sum.1$Distribution=="aplnormal",]
jflcrusoe2122.sum.1[jflcrusoe2122.sum.1$Distribution=="lognormal",]
# AIC inconclusive
#jflcrusoe2122.sum.2 <- jflcrusoe2122.sum.1[jflcrusoe2122.sum.1$Model == "3P" | jflcrusoe2122.sum.1$Model == "4P",]
#
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe2122.sum.1))],                     
          ttl=paste(jflcrusoe2122.sum.1$Model,
                    substring(jflcrusoe2122.sum.1$Distribution, 1,8),
                    jflcrusoe2122.sum.1$Method,
                    as.numeric(row.names(jflcrusoe2122.sum.1))),
          method=m1[as.numeric(row.names(jflcrusoe2122.sum.1))],
          arr=c(7,2))
# All correlations are poor but ###05, ###06, ###08, ###11, ###12, ###13, ###16 a bit better
(jflcrusoe2122.2P.1.n.NM.partable    <- CatDynPar(x=jflcrusoe2122.2P.1.n.fit,method="Nelder-Mead"))    ###05 501
(jflcrusoe2122.2P.1.ln.NM.partable   <- CatDynPar(x=jflcrusoe2122.2P.1.ln.fit,method="Nelder-Mead"))   ###06 45
(jflcrusoe2122.3P.1.apln.NM.partable <- CatDynPar(x=jflcrusoe2122.3P.1.apln.fit,method="Nelder-Mead")) ###08 62 
(jflcrusoe2122.4P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe2122.4P.1.apn.fit,method="spg"))          ###11 17
(jflcrusoe2122.4P.1.apn.NM.partable  <- CatDynPar(x=jflcrusoe2122.4P.1.apn.fit,method="Nelder-Mead"))  ###12 35
(jflcrusoe2122.4P.1.apln.NM.partable <- CatDynPar(x=jflcrusoe2122.4P.1.apln.fit,method="Nelder-Mead")) ###13 80
(jflcrusoe2122.4P.1.ln.NM.partable   <- CatDynPar(x=jflcrusoe2122.4P.1.ln.fit,method="Nelder-Mead"))   ###16 157
# Variant ###11 has the best CVs
#
plot(x=jflcrusoe2122.4P.1.apn.pred.spg,                                         ###11 17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2122.sum.0$Sel.Model[11] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.21.- Depletion models season: 2022-2023                                  #
################################################################################
#
# Data object
jflcrusoe2223  <- as.CatDynData(x=cateff1.Crusoe[cateff1.Crusoe$Season==21,],
                                step="week",
                                fleet.name="nasas",
                                coleff=4,
                                colcat=5,
                                colmbw=6,
                                unitseff="ndays",
                                unitscat="kg",
                                unitsmbw="g",
                                nmult="thou",
                                season.dates=c("2022-09-25","2023-04-23"))
#
plot(x=jflcrusoe2223,mark=TRUE,offset=c(9,10,4),hem="S")                        # 46 52 58 60 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflcrusoe2223$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 27.25512
M.ini       <- 3*0.001937482
N0.ini      <- 6*27.25512
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflcrusoe2223$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflcrusoe2223$Data$nasas$time.step,1))                    # just start and end week
#
jflcrusoe2223.0P.apn.ini <- catdynexp(x=jflcrusoe2223,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2223.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflcrusoe2223.0P.apn.fit  <- CatDynFit(x=jflcrusoe2223,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflcrusoe2223.0P.apn.pred.spg <- CatDynPred(jflcrusoe2223.0P.apn.fit,"spg")     # 46 52 58 60
plot(x=jflcrusoe2223.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.0P.apn.pred.CG <- CatDynPred(jflcrusoe2223.0P.apn.fit,"CG")       # 46 52 58 60
plot(x=jflcrusoe2223.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.0P.apln.fit  <- CatDynFit(x=jflcrusoe2223,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflcrusoe2223.0P.apln.pred.spg <- CatDynPred(jflcrusoe2223.0P.apln.fit,"spg")   # 46 52 58 60
plot(x=jflcrusoe2223.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.0P.apln.pred.CG <- CatDynPred(jflcrusoe2223.0P.apln.fit,"CG")     # 46 52 58 60
plot(x=jflcrusoe2223.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*27.25512
P1.ini      <- 85
k.ini       <- 2.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflcrusoe2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,                                                            # the week of one input of abundance
                 tail(jflcrusoe2223$Data$nasas$time.step,1))
#
jflcrusoe2223.1P.apn.ini <- catdynexp(x=jflcrusoe2223,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2223.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2223.1P.1.apn.fit  <- CatDynFit(x=jflcrusoe2223,
                                         p=1,
                                         par=pars.ini.1P,
                                         dates=dates.1P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe2223.1P.1.apn.pred.spg <- CatDynPred(jflcrusoe2223.1P.1.apn.fit,"spg")
plot(x=jflcrusoe2223.1P.1.apn.pred.spg,                                         ###01 158
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.1P.1.apn.pred.CG <- CatDynPred(jflcrusoe2223.1P.1.apn.fit,"CG")
plot(x=jflcrusoe2223.1P.1.apn.pred.CG,                                          ###02 187
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.1P.1.apn.pred.NM <- CatDynPred(jflcrusoe2223.1P.1.apn.fit,"Nelder-Mead")
plot(x=jflcrusoe2223.1P.1.apn.pred.NM,                                          ###03 139
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.1P.1.apln.fit  <- CatDynFit(x=jflcrusoe2223,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe2223.1P.1.apln.pred.spg <- CatDynPred(jflcrusoe2223.1P.1.apln.fit,"spg")
# plot(x=jflcrusoe2223.1P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.1P.1.apln.pred.CG <- CatDynPred(jflcrusoe2223.1P.1.apln.fit,"CG")
# plot(x=jflcrusoe2223.1P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.1P.1.apln.pred.NM <- CatDynPred(jflcrusoe2223.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflcrusoe2223$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflcrusoe2223$Data$nasas$obscat.thou))^2)
#
jflcrusoe2223.1P.1.n.fit  <- CatDynFit(x=jflcrusoe2223,
                                       p=1,
                                       par=c(pars.ini.1P,psi.n.ini),
                                       dates=dates.1P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),
                                       itnmax=50000)
#
jflcrusoe2223.1P.1.n.pred.spg <- CatDynPred(jflcrusoe2223.1P.1.n.fit,"spg")
plot(x=jflcrusoe2223.1P.1.n.pred.spg,                                           ###04 158
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.1P.1.n.pred.CG <- CatDynPred(jflcrusoe2223.1P.1.n.fit,"CG")
plot(x=jflcrusoe2223.1P.1.n.pred.CG,                                            ###05 189
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.1P.1.n.pred.NM <- CatDynPred(jflcrusoe2223.1P.1.n.fit,"Nelder-Mead")
plot(x=jflcrusoe2223.1P.1.n.pred.NM,                                            ###06 92
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# 
jflcrusoe2223.1P.1.ln.fit  <- CatDynFit(x=jflcrusoe2223,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe2223.1P.1.ln.pred.spg <- CatDynPred(jflcrusoe2223.1P.1.ln.fit,"spg")
# plot(x=jflcrusoe2223.1P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.1P.1.ln.pred.CG <- CatDynPred(jflcrusoe2223.1P.1.ln.fit,"CG")
# plot(x=jflcrusoe2223.1P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.1P.1.ln.pred.NM <- CatDynPred(jflcrusoe2223.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.1P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*27
P1.ini      <- 75
P2.ini      <- 65
k.ini       <- 3e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflcrusoe2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 tail(jflcrusoe2223$Data$nasas$time.step,1))
#
jflcrusoe2223.2P.apn.ini <- catdynexp(x=jflcrusoe2223,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2223.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2223.2P.1.apn.fit  <- CatDynFit(x=jflcrusoe2223,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),#
                                         itnmax=50000)
#
jflcrusoe2223.2P.1.apn.pred.spg <- CatDynPred(jflcrusoe2223.2P.1.apn.fit,"spg") 
plot(x=jflcrusoe2223.2P.1.apn.pred.spg,                                         ###07 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.apn.pred.CG <- CatDynPred(jflcrusoe2223.2P.1.apn.fit,"CG")
plot(x=jflcrusoe2223.2P.1.apn.pred.CG,                                          ###08 37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2223.2P.1.apn.pred.NM <- CatDynPred(jflcrusoe2223.2P.1.apn.fit,"Nelder-Mead") 
# plot(x=jflcrusoe2223.2P.1.apn.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.apln.fit  <- CatDynFit(x=jflcrusoe2223,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),#
                                          itnmax=50000)
#
# jflcrusoe2223.2P.1.apln.pred.spg <- CatDynPred(jflcrusoe2223.2P.1.apln.fit,"spg")
# plot(x=jflcrusoe2223.2P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.2P.1.apln.pred.CG <- CatDynPred(jflcrusoe2223.2P.1.apln.fit,"CG")
# plot(x=jflcrusoe2223.2P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# # 
# jflcrusoe2223.2P.1.apln.pred.NM <- CatDynPred(jflcrusoe2223.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.2P.1.apln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.n.fit  <- CatDynFit(x=jflcrusoe2223,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2223.2P.1.n.pred.spg <- CatDynPred(jflcrusoe2223.2P.1.n.fit,"spg")
plot(x=jflcrusoe2223.2P.1.n.pred.spg,                                           ###09 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.n.pred.CG <- CatDynPred(jflcrusoe2223.2P.1.n.fit,"CG")
plot(x=jflcrusoe2223.2P.1.n.pred.CG,                                            ###10 36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.n.pred.NM <- CatDynPred(jflcrusoe2223.2P.1.n.fit,"Nelder-Mead")
plot(x=jflcrusoe2223.2P.1.n.pred.NM,                                            ###11 152
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.2P.1.ln.fit  <- CatDynFit(x=jflcrusoe2223,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),#
                                        itnmax=50000)
#
# jflcrusoe2223.2P.1.ln.pred.spg <- CatDynPred(jflcrusoe2223.2P.1.ln.fit,"spg")
# plot(x=jflcrusoe2223.2P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.2P.1.ln.pred.CG <- CatDynPred(jflcrusoe2223.2P.1.ln.fit,"CG")
# plot(x=jflcrusoe2223.2P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflcrusoe2223.2P.1.ln.pred.NM <- CatDynPred(jflcrusoe2223.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.2P.1.ln.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 3*27
P1.ini      <- 75
P2.ini      <- 45
P3.ini      <- 15    
k.ini       <- 3e-4                                                             # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflcrusoe2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 60, 
                 tail(jflcrusoe2223$Data$nasas$time.step,1))
#
jflcrusoe2223.3P.apn.ini <- catdynexp(x=jflcrusoe2223,
                                      p=3,
                                      par=pars.ini.3P,
                                      dates=dates.3P,
                                      distr="apnormal")
#
plot(x=jflcrusoe2223.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflcrusoe2223.3P.1.apn.fit  <- CatDynFit(x=jflcrusoe2223,
                                         p=3,
                                         par=pars.ini.3P,
                                         dates=dates.3P,
                                         distr="apnormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflcrusoe2223.3P.1.apn.pred.spg <- CatDynPred(jflcrusoe2223.3P.1.apn.fit,"spg") 
plot(x=jflcrusoe2223.3P.1.apn.pred.spg,                                         ###12 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.apn.pred.CG <- CatDynPred(jflcrusoe2223.3P.1.apn.fit,"CG")
plot(x=jflcrusoe2223.3P.1.apn.pred.CG,                                          ###13 36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflcrusoe2223.3P.1.apn.pred.NM <- CatDynPred(jflcrusoe2223.3P.1.apn.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.3P.1.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.apln.fit  <- CatDynFit(x=jflcrusoe2223,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="aplnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflcrusoe2223.3P.1.apln.pred.spg <- CatDynPred(jflcrusoe2223.3P.1.apln.fit,"spg")
# plot(x=jflcrusoe2223.3P.1.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2223.3P.1.apln.pred.CG <- CatDynPred(jflcrusoe2223.3P.1.apln.fit,"CG")
# plot(x=jflcrusoe2223.3P.1.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2223.3P.1.apln.pred.NM <- CatDynPred(jflcrusoe2223.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jflcrusoe2223.3P.1.apln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.n.fit  <- CatDynFit(x=jflcrusoe2223,
                                       p=3,
                                       par=c(pars.ini.3P,psi.n.ini),
                                       dates=dates.3P,
                                       distr="normal",
                                       method=c("spg","CG","Nelder-Mead"),#
                                       itnmax=50000)
#
jflcrusoe2223.3P.1.n.pred.spg <- CatDynPred(jflcrusoe2223.3P.1.n.fit,"spg")     
plot(x=jflcrusoe2223.3P.1.n.pred.spg,                                           ###14 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.n.pred.CG <- CatDynPred(jflcrusoe2223.3P.1.n.fit,"CG")
plot(x=jflcrusoe2223.3P.1.n.pred.CG,                                            ###15 36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.n.pred.NM <- CatDynPred(jflcrusoe2223.3P.1.n.fit,"Nelder-Mead")
plot(x=jflcrusoe2223.3P.1.n.pred.NM,                                            ###16 107
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflcrusoe2223.3P.1.ln.fit  <- CatDynFit(x=jflcrusoe2223,
                                        p=3,
                                        par=c(pars.ini.3P,psi.ln.ini),
                                        dates=dates.3P,
                                        distr="lognormal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflcrusoe2223.3P.1.ln.pred.spg <- CatDynPred(jflcrusoe2223.3P.1.ln.fit,"spg")
# plot(x=jflcrusoe2223.3P.1.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2223.3P.1.ln.pred.CG <- CatDynPred(jflcrusoe2223.3P.1.ln.fit,"CG")
# plot(x=jflcrusoe2223.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflcrusoe2223.3P.1.ln.pred.NM <- CatDynPred(jflcrusoe2223.3P.1.ln.fit,"Nelder-Mead") 
# plot(x=jflcrusoe2223.3P.1.ln.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflcrusoe2223.1P.1.apn.fit,  ###01                               
           jflcrusoe2223.1P.1.apn.fit,  ###02
           jflcrusoe2223.1P.1.apn.fit,  ###03
           jflcrusoe2223.1P.1.n.fit,    ###04
           jflcrusoe2223.1P.1.n.fit,    ###05
           jflcrusoe2223.1P.1.n.fit,    ###06
           jflcrusoe2223.2P.1.apn.fit,  ###07
           jflcrusoe2223.2P.1.apn.fit,  ###08
           jflcrusoe2223.2P.1.n.fit,    ###09
           jflcrusoe2223.2P.1.n.fit,    ###10
           jflcrusoe2223.2P.1.n.fit,    ###11
           jflcrusoe2223.3P.1.apn.fit,  ###12
           jflcrusoe2223.3P.1.apn.fit,  ###13
           jflcrusoe2223.3P.1.n.fit,    ###14
           jflcrusoe2223.3P.1.n.fit,    ###15
           jflcrusoe2223.3P.1.n.fit)    ###16
m1 <- c("spg",         ###01
        "CG",          ###02
        "Nelder-Mead", ###03
        "spg",         ###04
        "CG",          ###05
        "Nelder-Mead", ###06
        "spg",         ###07
        "CG",          ###08
        "spg",         ###09
        "CG",          ###10
        "Nelder-Mead", ###11
        "spg",         ###12
        "CG",          ###13
        "spg",         ###14
        "CG",          ###15
        "Nelder-Mead") ###16
#
jflcrusoe2223.sum.0 <- CatDynSum(x=x1,season="2021-2223",method=m1)
jflcrusoe2223.sum.1 <- jflcrusoe2223.sum.0[jflcrusoe2223.sum.0$Max.Abs.Grads. < 1,]
# Two variants taken out
jflcrusoe2223.sum.1[jflcrusoe2223.sum.1$Distribution=="apnormal",]
jflcrusoe2223.sum.1[jflcrusoe2223.sum.1$Distribution=="normal",]
# AIC favors 2P and 3P
jflcrusoe2223.sum.2 <- jflcrusoe2223.sum.1[jflcrusoe2223.sum.1$Model == "2P" | jflcrusoe2223.sum.1$Model == "3P",]
#
CatDynCor(x=x1[as.numeric(row.names(jflcrusoe2223.sum.2))],                     
          ttl=paste(jflcrusoe2223.sum.2$Model,
                    substring(jflcrusoe2223.sum.2$Distribution, 1,8),
                    jflcrusoe2223.sum.2$Method,
                    as.numeric(row.names(jflcrusoe2223.sum.2))),
          method=m1[as.numeric(row.names(jflcrusoe2223.sum.2))],
          arr=c(3,3))
# All correlations rather similar
(jflcrusoe2223.2P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe2223.2P.1.apn.fit,method="spg"))       ###07 
(jflcrusoe2223.2P.1.apn.CG.partable  <- CatDynPar(x=jflcrusoe2223.2P.1.apn.fit,method="CG"))        ###08 
(jflcrusoe2223.2P.1.n.spg.partable   <- CatDynPar(x=jflcrusoe2223.2P.1.n.fit,method="spg"))         ###09
(jflcrusoe2223.2P.1.n.CG.partable    <- CatDynPar(x=jflcrusoe2223.2P.1.n.fit,method="CG"))          ###10 
(jflcrusoe2223.2P.1.n.NM.partable    <- CatDynPar(x=jflcrusoe2223.2P.1.n.fit,method="Nelder-Mead")) ###11
(jflcrusoe2223.3P.1.apn.spg.partable <- CatDynPar(x=jflcrusoe2223.3P.1.apn.fit,method="spg"))       ###12 
(jflcrusoe2223.3P.1.apn.CG.partable  <- CatDynPar(x=jflcrusoe2223.3P.1.apn.fit,method="CG"))        ###13 
(jflcrusoe2223.3P.1.n.spg.partable   <- CatDynPar(x=jflcrusoe2223.3P.1.n.fit,method="spg"))         ###14 
(jflcrusoe2223.3P.1.n.CG.partable    <- CatDynPar(x=jflcrusoe2223.3P.1.n.fit,method="CG"))          ###15 
# Variant ###09 and ###14 has the best CVs
#
plot(x=jflcrusoe2223.2P.1.n.pred.spg,                                           ###09 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflcrusoe2223.3P.1.n.pred.spg,                                           ###14 35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
# Similar biomass prediction but ###14 has third rec input too small
#
jflcrusoe2223.sum.0$Sel.Model[09] <- 1
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.22.- All selected models                                                 #
################################################################################
#
# Overview of all fitted and selected variants
JFLCrusoe.SelMods <- data.frame(YearStart=2002:2022,
                                YearEnd=2003:2023,
                                NumberFits=c(2*length(ls()[grep("fit",ls())][grep("0203",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("0304",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("0405",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("0506",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("0607",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("0708",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("0809",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("0910",ls()[grep("fit",ls())])]),
                                             2*length(ls()[grep("fit",ls())][grep("1011",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1112",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1213",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1314",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1415",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1516",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1617",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1718",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1819",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("1920",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("2021",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("2122",ls()[grep("fit",ls())])]),
                                             3*length(ls()[grep("fit",ls())][grep("2223",ls()[grep("fit",ls())])])),
                                RetainedFits=c(dim(jflcrusoe0203.sum.0)[1],
                                               dim(jflcrusoe0304.sum.0)[1],
                                               dim(jflcrusoe0405.sum.0)[1],
                                               dim(jflcrusoe0506.sum.0)[1],
                                               dim(jflcrusoe0607.sum.0)[1],
                                               dim(jflcrusoe0708.sum.0)[1],
                                               dim(jflcrusoe0809.sum.0)[1],
                                               dim(jflcrusoe0910.sum.0)[1],
                                               dim(jflcrusoe1011.sum.0)[1],
                                               dim(jflcrusoe1112.sum.0)[1],
                                               dim(jflcrusoe1213.sum.0)[1],
                                               dim(jflcrusoe1314.sum.0)[1],
                                               dim(jflcrusoe1415.sum.0)[1],
                                               dim(jflcrusoe1516.sum.0)[1],
                                               dim(jflcrusoe1617.sum.0)[1],
                                               dim(jflcrusoe1718.sum.0)[1],
                                               dim(jflcrusoe1819.sum.0)[1],
                                               dim(jflcrusoe1920.sum.0)[1],
                                               dim(jflcrusoe2021.sum.0)[1],
                                               dim(jflcrusoe2122.sum.0)[1],
                                               dim(jflcrusoe2223.sum.0)[1]),
                                SelMod.name=c("jflcrusoe0203.1P.1.n.fit",
                                              "jflcrusoe0304.2P.1.apn.fit",
                                              "jflcrusoe0405.2P.1.apn.fit",
                                              "jflcrusoe0506.1P.2.apn.fit",
                                              "jflcrusoe0607.2P.1.apn.fit",
                                              "jflcrusoe0708.3P.1.apn.fit",
                                              "jflcrusoe0809.4P.2.n.fit",
                                              "jflcrusoe0910.1P.1.apln.fit",
                                              "jflcrusoe1011.2P.1.apn.fit",
                                              "jflcrusoe1112.3P.2.apn.fit",
                                              "jflcrusoe1213.2P.1.apn.fit",
                                              "jflcrusoe1314.3P.1.apn.fit",
                                              "jflcrusoe1415.5P.5.apn.fit",
                                              "jflcrusoe1516.4P.1.apln.fit",
                                              "jflcrusoe1617.3P.1.apln.fit",
                                              "jflcrusoe1718.3P.1.apn.fit",
                                              "jflcrusoe1819.3P.1.apn.fit",
                                              "jflcrusoe1920.2P.2.apn.fit",
                                              "jflcrusoe2021.4P.1.apn.fit",
                                              "jflcrusoe2122.4P.1.apn.fit",
                                              "jflcrusoe2223.2P.1.n.fit"),
                                SelMod.lik=c("n",
                                             rep("apn",5),
                                             "n",
                                             "apln",
                                             rep("apn",5),
                                             rep("apln",2),
                                             rep("apn",5),
                                             "n"),
                                SelMod.meth=c("CG",
                                              "spg",
                                              "spg",
                                              "spg",
                                              "CG",
                                              "spg",
                                              "spg",
                                              "spg",
                                              "spg",
                                              "Nelder-Mead",
                                              "CG",
                                              "spg",
                                              "CG", #spg
                                              "Nelder-Mead",
                                              "spg",
                                              "Nelder-Mead",
                                              "CG",
                                              "Nelder-Mead",
                                              "CG",
                                              "spg",
                                              "spg"),
                                FirstWeek=c(38,35,39,34,38,39,37,38,34,39,39,38,39,38,38,39,39,38,38,38,38),
                                P1.timing=c(43,46,47,42,43,43,38,44,37,41,42,42,42,42,42,41,47,53,45,45,46),
                                P2.timing=c("",47,53,"",56,46,43,"",46,44,51,45,45,46,45,45,56,60,52,53,52),
                                P3.timing=c("","","","","",57,51,"","",52,"",51,47,54,51,51,70,"",58,59,""),
                                P4.timing=c("","","","","","",58,"","","","","",49,58,"","","","",69,64,""),
                                P5.timing=c("","","","","","","","","","","","",57,"","","","","","","",""),
                                LastWeek =c(73,71,71,71,72,73,72,72,73,73,72,71,71,71,72,71,72,71,71,71,69))
#                                           02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22
#
# List with fits that contain the selected variant
JFLCrusoe.Iagdfits <- list(jflcrusoe0203.1P.1.n.fit,
                           jflcrusoe0304.2P.1.apn.fit,
                           jflcrusoe0405.2P.1.apn.fit,
                           jflcrusoe0506.1P.2.apn.fit,
                           jflcrusoe0607.2P.1.apn.fit,
                           jflcrusoe0708.3P.1.apn.fit,
                           jflcrusoe0809.4P.2.n.fit,
                           jflcrusoe0910.1P.1.apln.fit,
                           jflcrusoe1011.2P.1.apn.fit,
                           jflcrusoe1112.3P.2.apn.fit,
                           jflcrusoe1213.2P.1.apn.fit,
                           jflcrusoe1314.3P.1.apn.fit,
                           jflcrusoe1415.5P.5.apn.fit,
                           jflcrusoe1516.4P.1.apln.fit,
                           jflcrusoe1617.3P.1.apln.fit,
                           jflcrusoe1718.3P.1.apn.fit,
                           jflcrusoe1819.3P.1.apn.fit,
                           jflcrusoe1920.2P.2.apn.fit,
                           jflcrusoe2021.4P.1.apn.fit,
                           jflcrusoe2122.4P.1.apn.fit,
                           jflcrusoe2223.2P.1.n.fit)
names(JFLCrusoe.Iagdfits) <- paste(2002:2022,2003:2023,sep="-")
#
# List of predictions of the selected variant
JFLCrusoe.Iagdpreds <- list(jflcrusoe0203.1P.1.n.pred.CG,
                            jflcrusoe0304.2P.1.apn.pred.spg,
                            jflcrusoe0405.2P.1.apn.pred.spg,
                            jflcrusoe0506.1P.2.apn.pred.spg,
                            jflcrusoe0607.2P.1.apn.pred.CG,
                            jflcrusoe0708.3P.1.apn.pred.spg,
                            jflcrusoe0809.4P.2.n.pred.spg,
                            jflcrusoe0910.1P.1.apln.pred.spg,
                            jflcrusoe1011.2P.1.apn.pred.spg,
                            jflcrusoe1112.3P.2.apn.pred.NM,
                            jflcrusoe1213.2P.1.apn.pred.CG,
                            jflcrusoe1314.3P.1.apn.pred.spg,
                            jflcrusoe1415.5P.5.apn.pred.CG, #spg
                            jflcrusoe1516.4P.1.apln.pred.NM,
                            jflcrusoe1617.3P.1.apln.pred.spg,
                            jflcrusoe1718.3P.1.apn.pred.NM,
                            jflcrusoe1819.3P.1.apn.pred.CG,
                            jflcrusoe1920.2P.2.apn.pred.NM,
                            jflcrusoe2021.4P.1.apn.pred.CG,
                            jflcrusoe2122.4P.1.apn.pred.spg,
                            jflcrusoe2223.2P.1.n.pred.spg)
x <- paste(2002:2022,2003:2023,sep="-")
for(i in 1:21)
  {
   names(JFLCrusoe.Iagdpreds)[i] <- x[i]
  }
#
# All seasons summary table
JFLCrusoe.sum.0203.2223           <- CatDynSum(x=JFLCrusoe.Iagdfits,season="0203-2023",method=JFLCrusoe.SelMods$SelMod.meth)
JFLCrusoe.sum.0203.2223$N0        <- as.numeric(JFLCrusoe.sum.0203.2223$N0)
JFLCrusoe.sum.0203.2223$Season    <- paste(2002:2022,2003:2023,sep="-")
JFLCrusoe.sum.0203.2223$Sel.Model <- 1
JFLCrusoe.sum.0203.2223$Besc.ton  <- sapply(1:length(JFLCrusoe.Iagdpreds), function(u) tail(JFLCrusoe.Iagdpreds[[u]]$Model$Results$Predicted.Biomass.tonnes,1))
#
# Fixing missing standard errors with multivariate imputation technique
cbind(1:dim(JFLCrusoe.sum.0203.2223)[2],names(JFLCrusoe.sum.0203.2223))
# library(mice)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,9:10], method="pmm",m=1,maxit=1000)      #M and SE.M
JFLCrusoe.sum.0203.2223[,9:10]  <- complete(imp1)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,11:12], method="pmm",m=1,maxit=1000)     #N0 and SE.N0
JFLCrusoe.sum.0203.2223[,11:12] <- complete(imp1)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,13:14], method="pmm",m=1,maxit=1000)     #P1 and SE.P1
JFLCrusoe.sum.0203.2223[,13:14] <- complete(imp1)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,28:29], method="pmm",m=1,maxit=1000)     #k and SE.k
JFLCrusoe.sum.0203.2223[,28:29] <- complete(imp1)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,30:31], method="pmm",m=1,maxit=1000)     #alpha and SE.alpha
JFLCrusoe.sum.0203.2223[,30:31] <- complete(imp1)
imp1                            <- mice(JFLCrusoe.sum.0203.2223[,32:33], method="pmm",m=1,maxit=1000)     #beta and SE.beta
JFLCrusoe.sum.0203.2223[,32:33] <- complete(imp1)
rm(imp1)
#
# Calculating standard error of starting biomass prediction
mbw.sd <- data.frame(Season=paste(2002:2022,2003:2023,sep="-"),
                     Start.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==38],
                     Start.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==38],
                     End.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==(71-53)],
                     End.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==(71-53)])
#
mbw.sd$Start.Mean.weekly.weight.kg     <- 1e-3*lw.a*mbw.sd$Start.Mean.weekly.length.mm^lw.b
mbw.sd$Start.SD.mean.weekly.weight.kg  <- 1e-3*lw.a*mbw.sd$Start.SD.Mean.weekly.length.mm^lw.b
mbw.sd$End.Mean.weekly.weight.kg       <- 1e-3*lw.a*mbw.sd$End.Mean.weekly.length.mm^lw.b
mbw.sd$End.SD.mean.weekly.weight.kg    <- 1e-3*lw.a*mbw.sd$End.SD.Mean.weekly.length.mm^lw.b
JFLCrusoe.StartBiom                    <- CatDynBSD(x=JFLCrusoe.Iagdfits,
                                                    method=JFLCrusoe.SelMods$SelMod.meth,
                                                    multi=FALSE,
                                                    mbw.sd=mbw.sd[,c(1,6,7)])
JFLCrusoe.StartBiom$B0Tot.ton.CV       <- 100*JFLCrusoe.StartBiom$B0Tot.ton.SE/JFLCrusoe.StartBiom$B0Tot.ton
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.1.23.- Fit plots                                                           #
################################################################################
#
tiff("Fig03CatDynCrusoeFit0203.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2002-2003']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0203$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig04CatDynCrusoeFit0304.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2003-2004']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0304$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig05CatDynCrusoeFit0405.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2004-2005']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0405$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig06CatDynCrusoeFit0506.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2005-2006']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0506$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig07CatDynCrusoeFit0607.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2006-2007']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0607$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig08CatDynCrusoeFit0708.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2007-2008']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0708$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig09CatDynCrusoeFit0809.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2008-2009']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0809$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig10CatDynCrusoeFit0910.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2009-2010']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig11CatDynCrusoeFit1011.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2010-2011']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig12CatDynCrusoeFit1112.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2011-2012']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig13CatDynCrusoeFit1213.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2012-2013']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig14CatDynCrusoeFit1314.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2013-2014']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig15CatDynCrusoeFit1415.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2014-2015']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig16CatDynCrusoeFit1516.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2015-2016']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig17CatDynCrusoeFit1617.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2016-2017']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig18CatDynCrusoeFit1718.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2017-2018']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig19CatDynCrusoeFit1819.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2018-2019']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig20CatDynCrusoeFit1920.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2019-2020']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig21CatDynCrusoeFit2021.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2020-2021']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig22CatDynCrusoeFit2122.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2021-2022']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.55,
     Biom.ypos=0.8,
     Cat.xpos=0.55,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig23CatDynCrusoeFit2223.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLCrusoe.Iagdpreds[['2022-2023']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.55,
     Biom.ypos=0.8,
     Cat.xpos=0.55,
     Cat.ypos=0.75)
dev.off()
#
################################################################################
# 2.1.24.- Parameters plot                                                     #
################################################################################
#
# library(Hmisc)
tiff("Fig24CatDynCrusoePars.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(3,2),mar=c(2,2,1,1),oma=c(3,3,1,1))
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=53*JFLCrusoe.sum.0203.2223$M,
       yplus=53*(JFLCrusoe.sum.0203.2223$M+2*JFLCrusoe.sum.0203.2223$SE.M),
       yminus=53*(JFLCrusoe.sum.0203.2223$M-2*JFLCrusoe.sum.0203.2223$SE.M),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,2))
legend("top",legend=expression(paste("Annualized ",italic(M),sep="")),bty="n")
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=JFLCrusoe.sum.0203.2223$N0,
       yplus=(JFLCrusoe.sum.0203.2223$N0+2*JFLCrusoe.sum.0203.2223$SE.N0),
       yminus=(JFLCrusoe.sum.0203.2223$N0-2*JFLCrusoe.sum.0203.2223$SE.N0),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,300))
legend("top",legend=expression(paste(N[0]," (thousands)",sep="")),bty="n")
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=JFLCrusoe.sum.0203.2223$P1.nasas,
       yplus=(JFLCrusoe.sum.0203.2223$P1.nasas+2*JFLCrusoe.sum.0203.2223$SE.P1.nasas),
       yminus=(JFLCrusoe.sum.0203.2223$P1.nasas-2*JFLCrusoe.sum.0203.2223$SE.P1.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,100))
legend("top",legend=expression(paste(R[1]," (thousands)",sep="")),bty="n")
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=1e4*JFLCrusoe.sum.0203.2223$k.nasas,
       yplus=1e4*(JFLCrusoe.sum.0203.2223$k.nasas+2*JFLCrusoe.sum.0203.2223$SE.k.nasas),
       yminus=1e4*(JFLCrusoe.sum.0203.2223$k.nasas-2*JFLCrusoe.sum.0203.2223$SE.k.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,40))
legend("top",legend=expression(paste(10^4*italic(k)," (1/days)",sep="")),bty="n")
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=JFLCrusoe.sum.0203.2223$alpha.nasas,
       yplus=(JFLCrusoe.sum.0203.2223$alpha.nasas+2*JFLCrusoe.sum.0203.2223$SE.alpha.nasas),
       yminus=(JFLCrusoe.sum.0203.2223$alpha.nasas-2*JFLCrusoe.sum.0203.2223$SE.alpha.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,2))
abline(v=1)
legend("top",legend=expression(alpha),bty="n")
errbar(x=JFLCrusoe.sum.0203.2223$Season,
       y=JFLCrusoe.sum.0203.2223$beta.nasas,
       yplus=(JFLCrusoe.sum.0203.2223$beta.nasas+2*JFLCrusoe.sum.0203.2223$SE.beta.nasas),
       yminus=(JFLCrusoe.sum.0203.2223$beta.nasas-2*JFLCrusoe.sum.0203.2223$SE.beta.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,2))
abline(v=1)
legend("top",legend=expression(beta),bty="n")
dev.off()
#
################################################################################
# 2.1.25.- Exploitation rate plot                                              #
################################################################################
#
cbind(JFLCrusoe.SelMods$Year,JFLCrusoe.SelMods$SelMod.meth)
tiff("Fig25CatDynCrusoeFM.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(7,3),oma=c(1,1,1,1),mar=c(1,1,1,1))
#2002-2003
plot(JFLCrusoe.Iagdpreds[["2002-2003"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2002-2003"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[1]+0.03)) 
abline(h=JFLCrusoe.Iagdfits[["2002-2003"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2002-2003")
#2003-2004
plot(JFLCrusoe.Iagdpreds[["2003-2004"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2003-2004"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[2]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2003-2004"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2003-2004")
#2004-2005
plot(JFLCrusoe.Iagdpreds[["2004-2005"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2004-2005"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[3]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2004-2005"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2004-2005")
#2005-2006
plot(JFLCrusoe.Iagdpreds[["2005-2006"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2005-2006"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[4]+0.01))
abline(h=JFLCrusoe.Iagdfits[["2005-2006"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2005-2006")
#2006-2007
plot(JFLCrusoe.Iagdpreds[["2006-2007"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2006-2007"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[5]+0.05))
abline(h=JFLCrusoe.Iagdfits[["2006-2007"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2006-2007")
#2007-2008
plot(JFLCrusoe.Iagdpreds[["2007-2008"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2007-2008"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[6]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2007-2008"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2007-2008")
#2008-2009
plot(JFLCrusoe.Iagdpreds[["2008-2009"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2008-2009"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[7]+0.035))
abline(h=JFLCrusoe.Iagdfits[["2008-2009"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2008-2009")
#2009-2010
plot(JFLCrusoe.Iagdpreds[["2009-2010"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2009-2010"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[8]+0.05))
abline(h=JFLCrusoe.Iagdfits[["2009-2010"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2009-2010")
#2010-2011
plot(JFLCrusoe.Iagdpreds[["2010-2011"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2010-2011"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[9]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2010-2011"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2010-2011")
#2011-2012
plot(JFLCrusoe.Iagdpreds[["2011-2012"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2011-2012"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[10]+0.1))
abline(h=JFLCrusoe.Iagdfits[["2011-2012"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2011-2012")
#2012-2013
plot(JFLCrusoe.Iagdpreds[["2012-2013"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2012-2013"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[11]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2012-2013"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2012-2013")
#2013-2014
plot(JFLCrusoe.Iagdpreds[["2013-2014"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2013-2014"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[12]+0.05))
abline(h=JFLCrusoe.Iagdfits[["2013-2014"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2013-2014")
#2014-2015
plot(JFLCrusoe.Iagdpreds[["2014-2015"]]$Model$Results$Period.week-53,
     JFLCrusoe.Iagdpreds[["2014-2015"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[13]+0.08))
abline(h=JFLCrusoe.Iagdfits[["2014-2015"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2014-2015")
#2015-2016
plot(JFLCrusoe.Iagdpreds[["2015-2016"]]$Model$Results$Period.week,                              
     JFLCrusoe.Iagdpreds[["2015-2016"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[14]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2015-2016"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2015-2016")
#2016-2017
plot(JFLCrusoe.Iagdpreds[["2016-2017"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2016-2017"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[15]+0.1))
abline(h=JFLCrusoe.Iagdfits[["2016-2017"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2016-2017")
#2017-2018
plot(JFLCrusoe.Iagdpreds[["2017-2018"]]$Model$Results$Period.week,                   
     JFLCrusoe.Iagdpreds[["2017-2018"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[16]+0.01))
abline(h=JFLCrusoe.Iagdfits[["2017-2018"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2017-2018")
#2018-2019
plot(JFLCrusoe.Iagdpreds[["2018-2019"]]$Model$Results$Period.week,                           
     JFLCrusoe.Iagdpreds[["2018-2019"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[17]+0.04))
abline(h=JFLCrusoe.Iagdfits[["2018-2019"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2018-2019")
#2019-2020
plot(JFLCrusoe.Iagdpreds[["2019-2020"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2019-2020"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[18]+0.03))
abline(h=JFLCrusoe.Iagdfits[["2019-2020"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2019-2020")
#2020-2021
plot(JFLCrusoe.Iagdpreds[["2020-2021"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2020-2021"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[19]+0.35))
abline(h=JFLCrusoe.Iagdfits[["2020-2021"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2020-2021")
#2021-2022
plot(JFLCrusoe.Iagdpreds[["2021-2022"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2021-2022"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[19]+0.35))
abline(h=JFLCrusoe.Iagdfits[["2021-2022"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2021-2022")
#2022-2023
plot(JFLCrusoe.Iagdpreds[["2022-2023"]]$Model$Results$Period.week,
     JFLCrusoe.Iagdpreds[["2022-2023"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLCrusoe.sum.0203.2223$M[19]+0.35))
abline(h=JFLCrusoe.Iagdfits[["2022-2023"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2022-2023")
#
dev.off()
#
################################################################################
# 2.1.26.- Starting biomass plot                                               #
################################################################################
#
#tiff("Fig24CatDynCrusoeStartBiom.tiff",width=15,height=15,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(4,4,1,1))
plot(JFLCrusoe.StartBiom$Year,
     JFLCrusoe.StartBiom$B0Tot.ton,
     ylim=c(0,250),
     cex=10*1/JFLCrusoe.StartBiom$B0Tot.ton.CV,
     pch=19,
     col="green4",
     type="b",
     xlab="Year",
     ylab="Star of season biomass (tonnes)",
     main=expression(italic(Jasus~frontalis)))
points(JFLCrusoe.StartBiom$Year,
       1e-3*c(sum(jflcrusoe0203$Data$nasas$obscat.kg),
              sum(jflcrusoe0304$Data$nasas$obscat.kg),
              sum(jflcrusoe0405$Data$nasas$obscat.kg),
              sum(jflcrusoe0506$Data$nasas$obscat.kg),
              sum(jflcrusoe0607$Data$nasas$obscat.kg),
              sum(jflcrusoe0708$Data$nasas$obscat.kg),
              sum(jflcrusoe0809$Data$nasas$obscat.kg),
              sum(jflcrusoe0910$Data$nasas$obscat.kg),
              sum(jflcrusoe1011$Data$nasas$obscat.kg),
              sum(jflcrusoe1112$Data$nasas$obscat.kg),
              sum(jflcrusoe1213$Data$nasas$obscat.kg),
              sum(jflcrusoe1314$Data$nasas$obscat.kg),
              sum(jflcrusoe1415$Data$nasas$obscat.kg),
              sum(jflcrusoe1516$Data$nasas$obscat.kg),
              sum(jflcrusoe1617$Data$nasas$obscat.kg),
              sum(jflcrusoe1718$Data$nasas$obscat.kg),
              sum(jflcrusoe1819$Data$nasas$obscat.kg),
              sum(jflcrusoe1920$Data$nasas$obscat.kg),
              sum(jflcrusoe2021$Data$nasas$obscat.kg),
              sum(jflcrusoe2122$Data$nasas$obscat.kg),
              sum(jflcrusoe2223$Data$nasas$obscat.kg)),
       type="h",
       lwd=15,
       col="blue")
#dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.1.27.- Initial values for ADMB from toy Surplus production model           #
################################################################################
#
FYrInd                 <- 2002 # Use starting year of each season
LYrInd                 <- 2022
FYrLan                 <- 2002
LYrLan                 <- 2022
nyears                 <- LYrLan-FYrLan+1
JFLCrusoe.InniBiom.ton <- data.frame(Year=FYrLan:LYrLan,
                                Landings.ton=1e-3*c(sum(jflcrusoe0203$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0304$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0405$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0506$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0607$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0708$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0809$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe0910$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1011$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1112$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1213$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1314$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1415$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1516$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1617$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1718$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1819$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe1920$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe2021$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe2122$Data$nasas$obscat.kg),
                                                    sum(jflcrusoe2223$Data$nasas$obscat.kg)))
JFLCrusoe.InniBiom.ton$B0.CatDyn    <- JFLCrusoe.StartBiom$B0Tot.ton
JFLCrusoe.InniBiom.ton$SE.B0.CatDyn <- JFLCrusoe.StartBiom$B0Tot.ton.SE
#
# Initial values of parameters for PT model under constant parameters
#
B0.ini              <- 0.4*150
K.ini               <- 250
p.ini               <- 1.5
r.ini               <- 1.25
Stock.pt    <- rep(0,LYrLan-FYrLan+1)
Stock.pt[1] <- B0.ini
for(i in 2:(LYrLan-FYrLan+1))
{
  Stock.pt[i] <- Stock.pt[i-1]+r.ini*Stock.pt[i-1]*(1-(Stock.pt[i-1]/K.ini)^(p.ini-1))-JFLCrusoe.InniBiom.ton$Landings.ton[i-1];
}
#
par(mfrow=c(1,1))
plot(JFLCrusoe.InniBiom.ton$Year,JFLCrusoe.InniBiom.ton$B0.CatDyn,ylim=c(0,250),pch=19)
lines(JFLCrusoe.InniBiom.ton$Year,Stock.pt,col="blue",lwd=2)
lines(JFLCrusoe.InniBiom.ton$Year,JFLCrusoe.InniBiom.ton$Landings.ton,col="red",lwd=2)
#
(log.B0.ini  <- log(B0.ini))
#[1] 4.094345
(log.K.ini   <- log(K.ini))
#[1] 5.521461
(log.p.ini   <- log(p.ini))
#[1] 0.4054651
(log.r.ini   <- log(r.ini))
#[1] 0.2231436
#
t(JFLCrusoe.InniBiom.ton$Landings.ton)
JFLCrusoe.InniBiom.ton[,c(1,3,4)]
#
save.image("JFLobsters.0203.2021.RData")
#
################################################################################
# 2.1.28.- Bringing output from ADMB and model selection                       #
################################################################################
#
# Variant 2
npar.jfjfrc.1reg4p            <- 4
maxgrad.admb.pt.jfjfrc.1reg4p <- read.table("marlikptjfjfrc1reg4p.par",comment.char="",nrows=1)$V16
# [1] 0.4713098
lik.admb.pt.jfjfrc.1reg4p     <- read.table("marlikptjfjfrc1reg4p.par",comment.char="",nrows=1)$V11
AIC.admb.pt.jfjfrc.1reg4p     <- 2*npar.jfjfrc.1reg4p - 2*lik.admb.pt.jfjfrc.1reg4p
# [1] -234.0593
#
# Correlations
library(Matrix)
# Variant 2
cor.admb.pt.jfjfrc.1reg4p <- read.table("marlikptjfjfrc1reg4p.cor",
                                      header=TRUE,
                                      skip=1,
                                      fill=TRUE)
cor.admb.pt.jfjfrc.1reg4p                                 <- cor.admb.pt.jfjfrc.1reg4p[(npar.jfjfrc.1reg4p+1):(dim(cor.admb.pt.jfjfrc.1reg4p)[1]),(4+npar.jfjfrc.1reg4p+1):dim(cor.admb.pt.jfjfrc.1reg4p)[2]]
cor.admb.pt.jfjfrc.1reg4p[is.na(cor.admb.pt.jfjfrc.1reg4p)] <- 0
cor.admb.pt.jfjfrc.1reg4p                                 <- as.matrix(cor.admb.pt.jfjfrc.1reg4p)
cor.admb.pt.jfjfrc.1reg4p                                 <- cor.admb.pt.jfjfrc.1reg4p + t(cor.admb.pt.jfjfrc.1reg4p) - diag(diag(cor.admb.pt.jfjfrc.1reg4p))
cor.admb.pt.jfjfrc.1reg4p                                 <- forceSymmetric(cor.admb.pt.jfjfrc.1reg4p)
cor.admb.pt.jfjfrc.1reg4p                                 <- as.matrix(cor.admb.pt.jfjfrc.1reg4p)
row.names(cor.admb.pt.jfjfrc.1reg4p)                      <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
colnames(cor.admb.pt.jfjfrc.1reg4p)                       <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
#
# Summary table
pt.pars.admb.jfjfrc <- data.frame(Variant=rep(2,npar.jfjfrc.1reg4p),
                                  Max.Abs.Grad=c(rep(round(maxgrad.admb.pt.jfjfrc.1reg4p,7),npar.jfjfrc.1reg4p)),
                                   AIC=c(rep(round(AIC.admb.pt.jfjfrc.1reg4p),npar.jfjfrc.1reg4p)),
                                   N.pars=c(rep(npar.jfjfrc.1reg4p,npar.jfjfrc.1reg4p)),
                                   Description=c(rep("B0!=K",npar.jfjfrc.1reg4p)),
                                   Par=c("B0","K","p","r"),
                                   MLE=c(read.table("marlikptjfjfrc1reg4p.std",skip=(npar.jfjfrc.1reg4p+1),header=FALSE)[1:npar.jfjfrc.1reg4p,3]),
                                   SE=c(read.table("marlikptjfjfrc1reg4p.std",skip=(npar.jfjfrc.1reg4p+1),header=FALSE)[1:npar.jfjfrc.1reg4p,4]))
pt.pars.admb.jfjfrc$CV.pc   <- c(round(100*pt.pars.admb.jfjfrc$SE/pt.pars.admb.jfjfrc$MLE,1))
pt.pars.admb.jfjfrc$SelMod  <- c(rep(1,npar.jfjfrc.1reg4p))
#
# PT parameters and biomass time series
pars.admb.pt.jfjfrc.1reg4p           <- read.table("marlikptjfjfrc1reg4p.std",skip=(npar.jfjfrc.1reg4p+1),header=FALSE)[1:npar.jfjfrc.1reg4p,3:4]
names(pars.admb.pt.jfjfrc.1reg4p)    <- c("MLE","SD")
rownames(pars.admb.pt.jfjfrc.1reg4p) <- c("B0","K","p","r")
K.jfjfrc.1reg4p                      <- round(pars.admb.pt.jfjfrc.1reg4p["K","MLE"])
p.jfjfrc.1reg4p                      <- pars.admb.pt.jfjfrc.1reg4p["p","MLE"]
r.jfjfrc.1reg4p                      <- pars.admb.pt.jfjfrc.1reg4p["r","MLE"]   
Stock.admb.pt.jfjfrc.1reg4p          <- cbind(FYrLan:(LYrLan+1),read.table("marlikptjfjfrc1reg4p.std",skip=1+2*npar.jfjfrc.1reg4p,header=FALSE)[,3:4])
names(Stock.admb.pt.jfjfrc.1reg4p)   <- c("Year","Biomass.ton","SD.Biomass.ton")
Stock.admb.pt.jfjfrc.1reg4p$CV.pc    <- 100*Stock.admb.pt.jfjfrc.1reg4p$SD.Biomass.ton/Stock.admb.pt.jfjfrc.1reg4p$Biomass.ton
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.29.- Correlations plot                                                   #
################################################################################
#
tiff("Fig26PellaTomlinsonCrusoeCorrelations.tiff",width=12,height=12,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(2,1,1,1),oma=c(4,4,1,1))
# Variant 2
hist(cor.admb.pt.jfjfrc.1reg4p[,-1][(lower.tri(as.matrix(cor.admb.pt.jfjfrc.1reg4p[,-1])))],
     main="",#expression(paste("Variant 2: ",italic(B)[0]!=italic(K))),
     xlab="",
     ylab="",
     ylim=,
     xlim=c(-1,1),
     cex.axis = 1.5)
legend("topleft",bty="n",legend=c(list(bquote("Max(|gradient|)" ==.(round(maxgrad.admb.pt.jfjfrc.1reg4p,7)))),
                                  list(bquote("AIC" ==.(round(AIC.admb.pt.jfjfrc.1reg4p,3))))))
#
dev.off()
#
################################################################################
# 2.1.30.- Derived parameters of interest to management                        #
################################################################################
#
jfjfrc.popdyn <- data.frame(Year=seq(FYrLan,LYrLan+1,1),
                            #Regime=Stock.admb.pt.jfjfrc.1reg3p$EnvCycle,
                            Catch.ton=c(JFLCrusoe.InniBiom.ton$Landings.ton,NA),
                            CatDyn.Biom.ton=c(JFLCrusoe.InniBiom.ton$B0.CatDyn,NA),
                            CatDyn.Biom.SE.ton=c(JFLCrusoe.InniBiom.ton$SE.B0.CatDyn,NA),
                            CatDyn.Biom.CV.pc=c(100*JFLCrusoe.InniBiom.ton$SE.B0.CatDyn/JFLCrusoe.InniBiom.ton$B0.CatDyn,NA),
                            PT.Biom.ton=Stock.admb.pt.jfjfrc.1reg4p$Biomass.ton,
                            PT.Biom.SE.ton=Stock.admb.pt.jfjfrc.1reg4p$SD.Biomass.ton,
                            PT.Biom.CV.pc=Stock.admb.pt.jfjfrc.1reg4p$CV.pc)
#
# Covariance matrix of estimates to use deltamethod on derived parameters
pt.cor.jfjfrc             <- cor.admb.pt.jfjfrc.1reg4p[c("K","p","r"),c("K","p","r")]
row.names(pt.cor.jfjfrc)  <- c("K","p","r")
colnames(pt.cor.jfjfrc)   <- c("K","p","r")
pt.sd.jfjfrc              <- read.table("marlikptjfjfrc1reg4p.std",skip=(1+npar.jfjfrc.1reg4p),header=FALSE)[1:npar.jfjfrc.1reg4p,4][2:4]
names(pt.sd.jfjfrc)       <- c("K","p","r")
pt.cov.jfjfrc             <- cor2cov(cor.mat=as.matrix(pt.cor.jfjfrc),sd=as.vector(pt.sd.jfjfrc))
#
# MSY
MSY.jfjfrc    <- round(r.jfjfrc.1reg4p*K.jfjfrc.1reg4p*(p.jfjfrc.1reg4p-1)/(p.jfjfrc.1reg4p^(p.jfjfrc.1reg4p/(p.jfjfrc.1reg4p-1))))
#[1] 121
MSY.SE.jfjfrc <- round(deltamethod(g=list(~x3*x1*(x2-1)/(x2^(x2/(x2-1)))),
                                 mean=c(K.jfjfrc.1reg4p,p.jfjfrc.1reg4p,r.jfjfrc.1reg4p),
                                 cov=pt.cov.jfjfrc,
                                 ses=TRUE))
#[1] 89
#
# B.MSY
B.MSY.jfjfrc    <- round(K.jfjfrc.1reg4p*(p.jfjfrc.1reg4p^(1/(1-p.jfjfrc.1reg4p))))
#[1] 903
B.MSY.SE.jfjfrc <- round(deltamethod(g=list(~x1*x2^(1/(1-x2))),
                                   mean=c(K.jfjfrc.1reg4p,p.jfjfrc.1reg4p),
                                   cov=pt.cov.jfjfrc[1:2,1:2],
                                   ses=TRUE))
#[1] 912
#
# Latent productivity
B.jfjfrc.all                  <- Stock.admb.pt.jfjfrc.1reg4p$Biomass.ton
B.jfjfrc.all.sd               <- Stock.admb.pt.jfjfrc.1reg4p$SD.Biomass.ton
Lat.Prod.B.jfjfrc.all         <- r.jfjfrc.1reg4p*B.jfjfrc.all*(1-(B.jfjfrc.all/K.jfjfrc.1reg4p)^(p.jfjfrc.1reg4p-1))
Lat.Prod.B.jfjfrc.all.Total   <- Lat.Prod.B.jfjfrc.all + jfjfrc.popdyn$Catch.ton
mean(Lat.Prod.B.jfjfrc.all.Total,na.rm=TRUE)
# [1] 74.82812
KBcor.jfjfrc  <- cor.admb.pt.jfjfrc.1reg4p[(npar.jfjfrc.1reg4p+1):(npar.jfjfrc.1reg4p+(LYrLan-FYrLan+2)),1]
pBcor.jfjfrc  <- cor.admb.pt.jfjfrc.1reg4p[(npar.jfjfrc.1reg4p+1):(npar.jfjfrc.1reg4p+(LYrLan-FYrLan+2)),2]
rBcor.jfjfrc  <- cor.admb.pt.jfjfrc.1reg4p[(npar.jfjfrc.1reg4p+1):(npar.jfjfrc.1reg4p+(LYrLan-FYrLan+2)),4]
Lat.Prod.B.jfjfrc.all.SE    <- vector("numeric",length(B.jfjfrc.all))
for(i in 1:length(B.jfjfrc.all))
{
  Lat.Prod.B.jfjfrc.all.SE[i] <- round(deltamethod(g=list(~(x1*x2*(1-(x2/x3)^(x4-1)))),
                                                 mean=c(r.jfjfrc.1reg4p,B.jfjfrc.all[i],K.jfjfrc.1reg4p,p.jfjfrc.1reg4p),
                                                 cov=matrix(c(pt.cov.jfjfrc["r","r"],rBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["r","r"])*B.jfjfrc.all[i],pt.cov.jfjfrc["r","K"],pt.cov.jfjfrc["r","p"],
                                                              rBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["r","r"])*B.jfjfrc.all[i],B.jfjfrc.all[i]^2,KBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["K","K"])*B.jfjfrc.all[i],pBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["p","p"])*B.jfjfrc.all[i],
                                                              pt.cov.jfjfrc["r","K"],KBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["K","K"])*B.jfjfrc.all[i],pt.cov.jfjfrc["K","K"],pt.cov.jfjfrc["K","p"],
                                                              pt.cov.jfjfrc["r","p"],pBcor.jfjfrc[i]*sqrt(pt.cov.jfjfrc["p","p"])*B.jfjfrc.all[i],pt.cov.jfjfrc["K","p"],pt.cov.jfjfrc["p","p"]),
                                                              4,4),
                                                 ses=TRUE))
}
Lat.Prod.jfjfrc.Total       <- data.frame(Year=FYrLan:LYrLan,
                                        #Regime=Stock.admb.pt.omyuc.2regp4p$EnvCycle[1:22],
                                        Biomass.t=Stock.admb.pt.jfjfrc.1reg4p$Biomass.ton[1:(LYrLan-FYrLan+1)],
                                        Biomass.SD.t=Stock.admb.pt.jfjfrc.1reg4p$SD.Biomass.ton[1:(LYrLan-FYrLan+1)],
                                        Latprodtot.t=Lat.Prod.B.jfjfrc.all.Total[1:(LYrLan-FYrLan+1)],
                                        Latprodtot.SE.t=Lat.Prod.B.jfjfrc.all.SE[1:(LYrLan-FYrLan+1)])
Lat.Prod.jfjfrc.Total$CV.pc <- 100*Lat.Prod.jfjfrc.Total$Latprodtot.SE.t/abs(Lat.Prod.jfjfrc.Total$Latprodtot.t)
#
# Sustainable harvest rates
harvest.rate.jfjfrc <- data.frame(MSY=MSY.jfjfrc,
                                  MSY.SE=MSY.SE.jfjfrc,
                                  TLP=round(mean(Lat.Prod.jfjfrc.Total$Latprodtot.t)),
                                  TLP.SE=round(mean(Lat.Prod.jfjfrc.Total$Latprodtot.SE.t)))
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.31.- Population dynamics plot                                            #
################################################################################
#
options(scipen=3)
tiff("Fig27PellaTomlinsonCrusoeBiomassDynamics.tiff",width=20,height=20,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(1,1,1,1),bty="o",oma=c(3,3,1,1))
# CatDyn biomass
plot(x=seq(FYrLan,LYrLan+1,1),
     y=jfjfrc.popdyn$CatDyn.Biom.ton,
     pch=19,
     ylim=c(0,250),
     cex=3e-2/jfjfrc.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfrc.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE),
     cex.axis=1.25,
     cex.lab=1.25,
     col="green4",
     type="b",
     lwd=2,
     ylab="",
     xlab="",
     main=expression(paste(italic(Jasus~frontalis)," in Robinson Crusoe")))
# MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(MSY.jfjfrc-1*MSY.SE.jfjfrc,LYrLan-FYrLan+2),
#             rev(rep(MSY.jfjfrc+1*MSY.SE.jfjfrc,LYrLan-FYrLan+2))),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(MSY.jfjfrc,LYrLan-FYrLan+2),
#       col="blue",
#       lwd=2)
# # Legend MSY
# polygon(x=c(2008,2010,2010,2008),
#         y=c(180,180,190,190),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=c(2008,2010),y=c(185,185),col="blue",lwd=2)
# text(x=2017.5,y=185,lab=expression(MSY%+-%"2"~standard~deviations),adj=1)
# B_MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(B.MSY.jfjfrc-1*B.MSY.SE.jfjfrc,LYrLan-FYrLan+2),
#             rev(rep(B.MSY.jfjfrc+1*B.MSY.SE.jfjfrc,LYrLan-FYrLan+2))),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(B.MSY.jfjfrc,LYrLan-FYrLan+2),
#       col="salmon",
#       lwd=2)
# # Legend B_MSY
# polygon(x=c(2008,2010,2010,2008),
#         y=c(160,160,170,170),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=c(2008,2010),y=c(165,165),col="salmon",lwd=2)
# text(x=2017.5,y=165,lab=expression(B[MSY]%+-%"2"~standard~deviations),adj=1)
# CatDyn Biomass
points(x=seq(FYrLan,LYrLan+1,1),
       y=jfjfrc.popdyn$CatDyn.Biom.ton,
       pch=19,
       lty=1,
       col="green4",
       cex=3e-2/jfjfrc.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfrc.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE))
lines(x=seq(FYrLan,LYrLan+1,1),
      y=jfjfrc.popdyn$CatDyn.Biom.ton,
      lty=1,
      lwd=2,
      col="green4")
# Legend CatDyn biomass
points(x=2009,y=250,pch=19,cex=2,col="green4")
lines(x=c(2008,2010),y=c(250,250),col="green4",lwd=2)
text(x=2019,y=250,lab=expression(CatDyn~biomass~(size%prop%presicion)),cex=1,adj=1)
# PT Biomass
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfrc.popdyn$PT.Biom.ton-2*jfjfrc.popdyn$PT.Biom.SE.ton,
            rev(jfjfrc.popdyn$PT.Biom.ton+2*jfjfrc.popdyn$PT.Biom.SE.ton)),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfrc.popdyn$PT.Biom.ton-4*jfjfrc.popdyn$PT.Biom.SE.ton,
            rev(jfjfrc.popdyn$PT.Biom.ton+4*jfjfrc.popdyn$PT.Biom.SE.ton)),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfrc.popdyn$PT.Biom.ton-6*jfjfrc.popdyn$PT.Biom.SE.ton,
            rev(jfjfrc.popdyn$PT.Biom.ton+6*jfjfrc.popdyn$PT.Biom.SE.ton)),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
lines(seq(FYrLan,LYrLan+1,1),jfjfrc.popdyn$PT.Biom.ton,lwd=2)
# Legend PT Biomass
polygon(x=c(2008,2010,2010,2008),
        y=c(230,230,225,225),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2008,2010,2010,2008),
        y=c(235,235,220,220),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2008,2010,2010,2008),
        y=c(240,240,215,215),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
lines(x=c(2008,2010,2010,2008),y=rep(227.5,4),lwd=2)
text(x=2023.5,y=227.5,lab=expression(Pella~Tomlinson~biomass%+-%"2,4,6"~standard~deviations),adj=1,cex=1)
# Landings
lines(x=seq(FYrLan,LYrLan+1,1),jfjfrc.popdyn$Catch.ton,type="h",lwd=15,col="red")
# Legend landings
segments(x0=2009,x1=2009,y0=200,y1=210,lwd=20,col="red")
text(x=2013.5,y=200,lab="Annual catch",adj=1,cex=1)
#
mtext(side=2,outer=TRUE,text="Biomass at start of season (tonnes)",line=1,cex=1.5)
mtext(side=1,outer=TRUE,text="Year",line=1,cex=1.5)
dev.off()
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.1.32.- Kobe plot                                                           #
################################################################################
#
# B over B_MSY and F over F_MSY
jfjfrc.popdyn$B.BMSY  <- (jfjfrc.popdyn$PT.Biom.ton)/(B.MSY.jfjfrc)
jfjfrc.popdyn$F.FMSY  <- (jfjfrc.popdyn$Catch.ton/jfjfrc.popdyn$PT.Biom.ton)/(MSY.jfjfrc/B.MSY.jfjfrc)
# Standard errors
jfjfrc.popdyn$B.BMSY.SE  <- NA
jfjfrc.popdyn$F.FMSY.SE  <- NA
for(i in 1:nyears)
{
  jfjfrc.popdyn$B.BMSY.SE[i] <- deltamethod(g=list(~x1/x2),
                                          mean=c(jfjfrc.popdyn$PT.Biom.ton[i],B.MSY.jfjfrc),
                                          cov=matrix(c(jfjfrc.popdyn$PT.Biom.SE.ton[i]^2,0,0,B.MSY.SE.jfjfrc^2),2,2),
                                          ses=TRUE)
}
for(i in 1:nyears)
{
  yield <- jfjfrc.popdyn$Catch.ton[i]
  jfjfrc.popdyn$F.FMSY.SE[i] <- deltamethod(g=list(~(yield/x1)/(x2/x3)),
                                          mean=c(jfjfrc.popdyn$PT.Biom.ton[i],MSY.jfjfrc,B.MSY.jfjfrc),
                                          cov=matrix(c(jfjfrc.popdyn$PT.Biom.SE.ton[i]^2,0,0,0,MSY.SE.jfjfrc^2,0,0,0,B.MSY.SE.jfjfrc^2),3,3),
                                          ses=TRUE)
  
}
# Stock status for pie chart
jfjfrc.popdyn$Status <- ifelse(jfjfrc.popdyn$B.BMSY > 1 & jfjfrc.popdyn$F.FMSY < 1,1,
                                   ifelse(jfjfrc.popdyn$B.BMSY < 1 & jfjfrc.popdyn$F.FMSY < 1,2,
                                          ifelse(jfjfrc.popdyn$B.BMSY < 1 & jfjfrc.popdyn$F.FMSY > 1,3,4)))
#
tiff("Fig28PellaTomlinsonCrusoeKobe.tiff",width=22,height=20,units="cm",res=350,type="cairo")
par(mfrow=c(1,1),mar=c(4,5,2,1))
plot(jfjfrc.popdyn$B.BMSY,
     jfjfrc.popdyn$F.FMSY,
     type="b",
     xlim=c(0,2.5),
     ylim=c(0,7.5),
     xlab=expression(B/B[MSY]),
     ylab=expression(F/F[MSY]),
     main=expression(paste(italic(Jasus~frontalis)," in Robinson Crusoe")),
     cex.axis=2,
     cex.lab=2,
     cex.main=2)
abline(h=1)
abline(v=1)
rect(xleft=-1,xright=1,ybottom=-1,ytop=1,col="yellow")
rect(xleft=-1,xright=1,ybottom=1,ytop=10,col="red")
rect(xleft=1,xright=3,ybottom=1,ytop=10,col="orange1")
rect(xleft=1,xright=3,ybottom=-1,ytop=1,col="green")
text(x=0.2,y=5.5,lab="Overfished",cex=2)
text(x=2.0,y=5.5,lab="Overfishing",cex=2)
text(x=2.2,y=0,lab="Sustainable",cex=2)
text(x=0.2,y=0,lab="Rebuilding",cex=2)
points(jfjfrc.popdyn$B.BMSY,
       jfjfrc.popdyn$F.FMSY,
       pch=19,
       cex=3,
       col="blue")
lines(jfjfrc.popdyn$B.BMSY,
      jfjfrc.popdyn$F.FMSY,
      col="blue",
      lwd=2)
segments(x0=jfjfrc.popdyn$B.BMSY[nyears]-2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         x1=jfjfrc.popdyn$B.BMSY[nyears]+2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         y0=jfjfrc.popdyn$F.FMSY[nyears],
         y1=jfjfrc.popdyn$F.FMSY[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfrc.popdyn$B.BMSY[nyears]+2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         x1=jfjfrc.popdyn$B.BMSY[nyears]+2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         y0=jfjfrc.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfrc.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfrc.popdyn$B.BMSY[nyears]-2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         x1=jfjfrc.popdyn$B.BMSY[nyears]-2*jfjfrc.popdyn$B.BMSY.SE[nyears],
         y0=jfjfrc.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfrc.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfrc.popdyn$B.BMSY[nyears],
         x1=jfjfrc.popdyn$B.BMSY[nyears],
         y0=jfjfrc.popdyn$F.FMSY[nyears]-2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         y1=jfjfrc.popdyn$F.FMSY[nyears]+2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfrc.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfrc.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfrc.popdyn$F.FMSY[nyears]-2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         y1=jfjfrc.popdyn$F.FMSY[nyears]-2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfrc.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfrc.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfrc.popdyn$F.FMSY[nyears]+2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         y1=jfjfrc.popdyn$F.FMSY[nyears]+2*jfjfrc.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
text(jfjfrc.popdyn$B.BMSY,
     jfjfrc.popdyn$F.FMSY,
     lab=substring(jfjfrc.popdyn$Year,3,4),
     col="yellow")
par(new=TRUE,mai=c(4.5,4.5,1,1))
barplot(c(0,0,21,0),
        width=c(1,1),
        col=c("green","yellow","red","orange1"),
        names.arg=c("0.0%","0.0%","100.0%","0.0%"),
        cex.names=1)
dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.- Alejandro Selkirk                                                      #
################################################################################
#
################################################################################
# 2.2.1.- Depletion models season: 2009-2010                                   #
################################################################################
#
# Data object
#
jflselkirk0910  <- as.CatDynData(x=cateff1.Selkirk.0910,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2009-09-28","2010-02-12"))
#
plot(x=jflselkirk0910,mark=TRUE,offset=c(9,10,4),hem="S")                       # 40 52 54 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk0910$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 9.210188
M.ini       <- 3*0.001937482
N0.ini      <- 5*9.210188
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk0910$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk0910$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk0910.0P.apn.ini <- catdynexp(x=jflselkirk0910,                          # creating a toy model with
                                      p=0,                                      # catdynexp
                                      par=pars.ini.0P,
                                      dates=dates.0P,
                                      distr="apnormal")
#
plot(x=jflselkirk0910.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk0910.0P.apn.fit  <- CatDynFit(x=jflselkirk0910,                         # once happy with initial par values
                                       p=0,                                     # proceed to statistical fit with CatDynFit
                                       par=pars.ini.0P,                         # starting with apnormal likelihood
                                       dates=dates.0P,
                                       distr="apnormal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflselkirk0910.0P.apn.pred.spg <- CatDynPred(jflselkirk0910.0P.apn.fit,"spg")   # 40 41 54
plot(x=jflselkirk0910.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.0P.apn.pred.CG <- CatDynPred(jflselkirk0910.0P.apn.fit,"CG")     # 40 41 54
plot(x=jflselkirk0910.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.0P.apln.fit  <- CatDynFit(x=jflselkirk0910,                        # next with aplnormal likelihood
                                        p=0,
                                        par=pars.ini.0P,
                                        dates=dates.0P,
                                        distr="aplnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk0910.0P.apln.pred.spg <- CatDynPred(jflselkirk0910.0P.apln.fit,"spg") # 40
plot(x=jflselkirk0910.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.0P.apln.pred.CG <- CatDynPred(jflselkirk0910.0P.apln.fit,"CG")   # 40
plot(x=jflselkirk0910.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*9.210188
P1.ini      <- 25
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk0910$Data$nasas$time.step,1),                    # now the dates vector also has
                 40,                                                            # the week of one input of abundance
                 tail(jflselkirk0910$Data$nasas$time.step,1))
#
jflselkirk0910.1P.apn.ini <- catdynexp(x=jflselkirk0910,
                                      p=1,
                                      par=pars.ini.1P,
                                      dates=dates.1P,
                                      distr="apnormal")
#
plot(x=jflselkirk0910.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk0910.1P.1.apn.fit  <- CatDynFit(x=jflselkirk0910,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk0910.1P.1.apn.pred.spg <- CatDynPred(jflselkirk0910.1P.1.apn.fit,"spg")
plot(x=jflselkirk0910.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.apn.pred.CG <- CatDynPred(jflselkirk0910.1P.1.apn.fit,"CG")
plot(x=jflselkirk0910.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.apln.fit  <- CatDynFit(x=jflselkirk0910,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk0910.1P.1.apln.pred.spg <- CatDynPred(jflselkirk0910.1P.1.apln.fit,"spg") 
plot(x=jflselkirk0910.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.apln.pred.CG <- CatDynPred(jflselkirk0910.1P.1.apln.fit,"CG") 
plot(x=jflselkirk0910.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk0910$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk0910$Data$nasas$obscat.thou))^2)
#
jflselkirk0910.1P.1.n.fit  <- CatDynFit(x=jflselkirk0910,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk0910.1P.1.n.pred.spg <- CatDynPred(jflselkirk0910.1P.1.n.fit,"spg")
plot(x=jflselkirk0910.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.n.pred.CG <- CatDynPred(jflselkirk0910.1P.1.n.fit,"CG")
plot(x=jflselkirk0910.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.ln.fit  <- CatDynFit(x=jflselkirk0910,
                                        p=1,
                                        par=c(pars.ini.1P,psi.ln.ini),
                                        dates=dates.1P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk0910.1P.1.ln.pred.spg <- CatDynPred(jflselkirk0910.1P.1.ln.fit,"spg")   
plot(x=jflselkirk0910.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.1P.1.ln.pred.CG <- CatDynPred(jflselkirk0910.1P.1.ln.fit,"CG")     
plot(x=jflselkirk0910.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*9.210188
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk0910$Data$nasas$time.step,1),                   # now the dates vector also has
                 40,
                 54,                                                            # the week of one input of abundance
                 tail(jflselkirk0910$Data$nasas$time.step,1))
#
jflselkirk0910.2P.apn.ini <- catdynexp(x=jflselkirk0910,
                                      p=2,
                                      par=pars.ini.2P,
                                      dates=dates.2P,
                                      distr="apnormal")
#
plot(x=jflselkirk0910.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk0910.2P.1.apn.fit  <- CatDynFit(x=jflselkirk0910,
                                         p=2,
                                         par=pars.ini.2P,
                                         dates=dates.2P,
                                         distr="apnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk0910.2P.1.apn.pred.spg <- CatDynPred(jflselkirk0910.2P.1.apn.fit,"spg")
plot(x=jflselkirk0910.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.apn.pred.CG <- CatDynPred(jflselkirk0910.2P.1.apn.fit,"CG")   
plot(x=jflselkirk0910.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.apln.fit  <- CatDynFit(x=jflselkirk0910,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="aplnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk0910.2P.1.apln.pred.spg <- CatDynPred(jflselkirk0910.2P.1.apln.fit,"spg") 
plot(x=jflselkirk0910.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.apln.pred.CG <- CatDynPred(jflselkirk0910.2P.1.apln.fit,"CG")
plot(x=jflselkirk0910.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.n.fit  <- CatDynFit(x=jflselkirk0910,
                                       p=2,
                                       par=c(pars.ini.2P,psi.n.ini),
                                       dates=dates.2P,
                                       distr="normal",
                                       method=c("spg","CG"),
                                       itnmax=50000)
#
jflselkirk0910.2P.1.n.pred.spg <- CatDynPred(jflselkirk0910.2P.1.n.fit,"spg")
plot(x=jflselkirk0910.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.n.pred.CG <- CatDynPred(jflselkirk0910.2P.1.n.fit,"CG")
plot(x=jflselkirk0910.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.ln.fit  <- CatDynFit(x=jflselkirk0910,
                                        p=2,
                                        par=c(pars.ini.2P,psi.ln.ini),
                                        dates=dates.2P,
                                        distr="lognormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk0910.2P.1.ln.pred.spg <- CatDynPred(jflselkirk0910.2P.1.ln.fit,"spg")
plot(x=jflselkirk0910.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.2P.1.ln.pred.CG <- CatDynPred(jflselkirk0910.2P.1.ln.fit,"CG")
plot(x=jflselkirk0910.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*9.210188
P1.ini      <- 25
P2.ini      <- 10
P3.ini      <- 15
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk0910$Data$nasas$time.step,1),                   # now the dates vector also has
                 40,
                 52,
                 54,                                                            # the week of one input of abundance
                 tail(jflselkirk0910$Data$nasas$time.step,1))
#
jflselkirk0910.3P.apn.ini <- catdynexp(x=jflselkirk0910,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk0910.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk0910.3P.1.apn.fit  <- CatDynFit(x=jflselkirk0910,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk0910.3P.1.apn.pred.spg <- CatDynPred(jflselkirk0910.3P.1.apn.fit,"spg")
plot(x=jflselkirk0910.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.apn.pred.CG <- CatDynPred(jflselkirk0910.3P.1.apn.fit,"CG")   
plot(x=jflselkirk0910.3P.1.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.apn.pred.NM <- CatDynPred(jflselkirk0910.3P.1.apn.fit,"Nelder-Mead")   
plot(x=jflselkirk0910.3P.1.apn.pred.NM,                                         ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.apln.fit  <- CatDynFit(x=jflselkirk0910,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jflselkirk0910.3P.1.apln.pred.spg <- CatDynPred(jflselkirk0910.3P.1.apln.fit,"spg") 
plot(x=jflselkirk0910.3P.1.apln.pred.spg,                                       ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.apln.pred.CG <- CatDynPred(jflselkirk0910.3P.1.apln.fit,"CG")
plot(x=jflselkirk0910.3P.1.apln.pred.CG,                                        ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.apln.pred.NM <- CatDynPred(jflselkirk0910.3P.1.apln.fit,"Nelder-Mead")
plot(x=jflselkirk0910.3P.1.apln.pred.NM,                                        ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.n.fit  <- CatDynFit(x=jflselkirk0910,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflselkirk0910.3P.1.n.pred.spg <- CatDynPred(jflselkirk0910.3P.1.n.fit,"spg")
plot(x=jflselkirk0910.3P.1.n.pred.spg,                                          ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.n.pred.CG <- CatDynPred(jflselkirk0910.3P.1.n.fit,"CG")
plot(x=jflselkirk0910.3P.1.n.pred.CG,                                           ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.n.pred.NM <- CatDynPred(jflselkirk0910.3P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk0910.3P.1.n.pred.NM,                                           ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.ln.fit  <- CatDynFit(x=jflselkirk0910,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflselkirk0910.3P.1.ln.pred.spg <- CatDynPred(jflselkirk0910.3P.1.ln.fit,"spg")
plot(x=jflselkirk0910.3P.1.ln.pred.spg,                                         ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.ln.pred.CG <- CatDynPred(jflselkirk0910.3P.1.ln.fit,"CG")
plot(x=jflselkirk0910.3P.1.ln.pred.CG,                                          ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.3P.1.ln.pred.NM <- CatDynPred(jflselkirk0910.3P.1.ln.fit,"Nelder-Mead")
plot(x=jflselkirk0910.3P.1.ln.pred.NM,                                          ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflselkirk0910.1P.1.apn.fit, ###01
           jflselkirk0910.1P.1.apn.fit, ###02
           jflselkirk0910.1P.1.apln.fit,###03
           jflselkirk0910.1P.1.apln.fit,###04
           jflselkirk0910.1P.1.n.fit,   ###05
           jflselkirk0910.1P.1.n.fit,   ###06
           jflselkirk0910.1P.1.ln.fit,  ###07
           jflselkirk0910.1P.1.ln.fit,  ###08
           jflselkirk0910.2P.1.apn.fit, ###09
           jflselkirk0910.2P.1.apn.fit, ###10
           jflselkirk0910.2P.1.apln.fit,###11
           jflselkirk0910.2P.1.apln.fit,###12
           jflselkirk0910.2P.1.n.fit,   ###13
           jflselkirk0910.2P.1.n.fit,   ###14
           jflselkirk0910.2P.1.ln.fit,  ###15
           jflselkirk0910.2P.1.ln.fit,  ###16
           jflselkirk0910.3P.1.apn.fit, ###17
           jflselkirk0910.3P.1.apn.fit, ###18
           jflselkirk0910.3P.1.apn.fit, ###19
           jflselkirk0910.3P.1.apln.fit,###20
           jflselkirk0910.3P.1.apln.fit,###21
           jflselkirk0910.3P.1.apln.fit,###22
           jflselkirk0910.3P.1.n.fit,   ###23
           jflselkirk0910.3P.1.n.fit,   ###24
           jflselkirk0910.3P.1.n.fit,   ###25
           jflselkirk0910.3P.1.ln.fit,  ###26
           jflselkirk0910.3P.1.ln.fit,  ###27
           jflselkirk0910.3P.1.ln.fit)  ###28
m1 <- c(rep(c("spg","CG"),8),
        rep(c("spg","CG","Nelder-Mead"),4))
# Take out variants with gradients > 1
jflselkirk0910.sum.0  <- CatDynSum(x=x1,season="2009-2010",method=m1)
# All gradients ok
# AIC within variants weith same likelihood
jflselkirk0910.sum.0[jflselkirk0910.sum.0$Distribution=="apnormal",]
jflselkirk0910.sum.0[jflselkirk0910.sum.0$Distribution=="aplnormal",]
jflselkirk0910.sum.0[jflselkirk0910.sum.0$Distribution=="normal",]
jflselkirk0910.sum.0[jflselkirk0910.sum.0$Distribution=="lognormal",]
# 3P better in all likelihoods, specially apnormal and normal
jflselkirk0910.sum.1  <- jflselkirk0910.sum.0[jflselkirk0910.sum.0$Model=="3P",]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk0910.sum.1))],                     
          ttl=paste(jflselkirk0910.sum.1$Model,
                    substring(jflselkirk0910.sum.1$Distribution, 1,8),
                    jflselkirk0910.sum.1$Method,
                    as.numeric(row.names(jflselkirk0910.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk0910.sum.1))],
          arr=c(4,3))
# Worst correlations in variant ###26, ###27, ###28
jflselkirk0910.sum.2 <- jflselkirk0910.sum.1[which(!row.names(jflselkirk0910.sum.1) %in% 
                                                     c("26","27","28")),]
#
(jflselkirk0910.3P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk0910.3P.1.apn.fit,method="spg"))         ###17
(jflselkirk0910.3P.1.apn.CG.partable   <- CatDynPar(x=jflselkirk0910.3P.1.apn.fit,method="CG"))          ###18
(jflselkirk0910.3P.1.apn.NM.partable   <- CatDynPar(x=jflselkirk0910.3P.1.apn.fit,method="Nelder-Mead")) ###19
(jflselkirk0910.3P.1.apln.spg.partable <- CatDynPar(x=jflselkirk0910.3P.1.apln.fit,method="spg"))        ###20 *
(jflselkirk0910.3P.1.apln.CG.partable  <- CatDynPar(x=jflselkirk0910.3P.1.apln.fit,method="CG"))         ###21 *
(jflselkirk0910.3P.1.apln.NM.partable  <- CatDynPar(x=jflselkirk0910.3P.1.apln.fit,method="Nelder-Mead"))###22 *
(jflselkirk0910.3P.1.n.spg.partable    <- CatDynPar(x=jflselkirk0910.3P.1.n.fit,method="spg"))           ###23
(jflselkirk0910.3P.1.n.CG.partable     <- CatDynPar(x=jflselkirk0910.3P.1.n.fit,method="CG"))            ###24
(jflselkirk0910.3P.1.n.NM.partable     <- CatDynPar(x=jflselkirk0910.3P.1.n.fit,method="Nelder-Mead"))   ###25
#
plot(x=jflselkirk0910.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.apn.pred.NM,                                         ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.apln.pred.spg,                                       ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.apln.pred.CG,                                        ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.apln.pred.NM,                                        ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.n.pred.spg,                                          ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.n.pred.CG,                                           ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.n.pred.NM,                                           ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.ln.pred.spg,                                         ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.ln.pred.CG,                                          ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
plot(x=jflselkirk0910.3P.1.ln.pred.NM,                                          ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk0910$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk0910.sum.0$Sel.Model[21] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.2.- Depletion models season: 2010-2011                                   #
################################################################################
#
# Data object
#
jflselkirk1011  <- as.CatDynData(x=cateff1.Selkirk.1011,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2009-09-13","2010-04-15"))
#
plot(x=jflselkirk1011,mark=TRUE,offset=c(9,10,4),hem="S")                       # 37 46/47 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1011$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 49.61399
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1011$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1011$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk1011.0P.apn.ini <- catdynexp(x=jflselkirk1011,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1011.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1011.0P.apn.fit  <- CatDynFit(x=jflselkirk1011,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1011.0P.apn.pred.spg <- CatDynPred(jflselkirk1011.0P.apn.fit,"spg")   # 37 47 53
plot(x=jflselkirk1011.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.0P.apn.pred.CG <- CatDynPred(jflselkirk1011.0P.apn.fit,"CG")     # 37 47 53
plot(x=jflselkirk1011.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.0P.apln.fit  <- CatDynFit(x=jflselkirk1011,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1011.0P.apln.pred.spg <- CatDynPred(jflselkirk1011.0P.apln.fit,"spg") # 40
# plot(x=jflselkirk1011.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1011.0P.apln.pred.CG <- CatDynPred(jflselkirk1011.0P.apln.fit,"CG")   # 40
# plot(x=jflselkirk1011.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 25
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 37,                                                            # the week of one input of abundance
                 tail(jflselkirk1011$Data$nasas$time.step,1))
#
jflselkirk1011.1P.apn.ini <- catdynexp(x=jflselkirk1011,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1011.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1011.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1011,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1011.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1011.1P.1.apn.fit,"spg")
plot(x=jflselkirk1011.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1011.1P.1.apn.fit,"CG")
plot(x=jflselkirk1011.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1011,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1011.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1011.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1011.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1011.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1011.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1011$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1011$Data$nasas$obscat.thou))^2)
#
jflselkirk1011.1P.1.n.fit  <- CatDynFit(x=jflselkirk1011,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1011.1P.1.n.pred.spg <- CatDynPred(jflselkirk1011.1P.1.n.fit,"spg")
plot(x=jflselkirk1011.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.1P.1.n.pred.CG <- CatDynPred(jflselkirk1011.1P.1.n.fit,"CG")
plot(x=jflselkirk1011.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1011,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1011.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1011.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1011.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1011.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1011.1P.1.ln.fit,"CG")     
# plot(x=jflselkirk1011.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 25
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1011$Data$nasas$time.step,1),                   # now the dates vector also has
                 37,
                 47,                                                            # the week of one input of abundance
                 tail(jflselkirk1011$Data$nasas$time.step,1))
#
jflselkirk1011.2P.apn.ini <- catdynexp(x=jflselkirk1011,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1011.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1011.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1011,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1011.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1011.2P.1.apn.fit,"spg")
plot(x=jflselkirk1011.2P.1.apn.pred.spg,                                        ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1011.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1011.2P.1.apn.pred.CG,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1011,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1011.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1011.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1011.2P.1.apln.pred.spg,                                       ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1011.2P.1.apln.fit,"CG")
plot(x=jflselkirk1011.2P.1.apln.pred.CG,                                        ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.n.fit  <- CatDynFit(x=jflselkirk1011,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1011.2P.1.n.pred.spg <- CatDynPred(jflselkirk1011.2P.1.n.fit,"spg")
plot(x=jflselkirk1011.2P.1.n.pred.spg,                                          ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.n.pred.CG <- CatDynPred(jflselkirk1011.2P.1.n.fit,"CG")
plot(x=jflselkirk1011.2P.1.n.pred.CG,                                           ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1011,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1011.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1011.2P.1.ln.fit,"spg")
plot(x=jflselkirk1011.2P.1.ln.pred.spg,                                         ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1011.2P.1.ln.fit,"CG")
plot(x=jflselkirk1011.2P.1.ln.pred.CG,                                          ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 10
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 37,
                 47,                                                            # the week of one input of abundance
                 53,
                 tail(jflselkirk1011$Data$nasas$time.step,1))
#
jflselkirk1011.3P.apn.ini <- catdynexp(x=jflselkirk1011,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1011.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1011.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1011,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1011.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1011.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1011.3P.1.apn.pred.spg,                                        ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1011.3P.1.apn.fit,"CG")
plot(x=jflselkirk1011.3P.1.apn.pred.CG,                                         ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1011,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1011.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1011.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1011.3P.1.apln.pred.spg,                                       ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1011.3P.1.apln.fit,"CG")
plot(x=jflselkirk1011.3P.1.apln.pred.CG,                                        ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.n.fit  <- CatDynFit(x=jflselkirk1011,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1011.3P.1.n.pred.spg <- CatDynPred(jflselkirk1011.3P.1.n.fit,"spg")
plot(x=jflselkirk1011.3P.1.n.pred.spg,                                          ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.n.pred.CG <- CatDynPred(jflselkirk1011.3P.1.n.fit,"CG")
plot(x=jflselkirk1011.3P.1.n.pred.CG,                                           ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1011,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1011.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1011.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1011.3P.1.ln.pred.spg,                                         ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1011.3P.1.ln.fit,"CG")
plot(x=jflselkirk1011.3P.1.ln.pred.CG,                                          ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1011.1P.1.apn.fit, ###01
           jflselkirk1011.1P.1.apn.fit, ###02
           jflselkirk1011.1P.1.apln.fit,###03
           jflselkirk1011.1P.1.apln.fit,###04
           jflselkirk1011.1P.1.n.fit,   ###05
           jflselkirk1011.1P.1.n.fit,   ###06
           jflselkirk1011.1P.1.ln.fit,  ###07
           jflselkirk1011.2P.1.apn.fit, ###09
           jflselkirk1011.2P.1.apn.fit, ###10
           jflselkirk1011.2P.1.apln.fit,###11
           jflselkirk1011.2P.1.apln.fit,###12
           jflselkirk1011.2P.1.n.fit,   ###13
           jflselkirk1011.2P.1.n.fit,   ###14
           jflselkirk1011.2P.1.ln.fit,  ###15
           jflselkirk1011.2P.1.ln.fit,  ###16
           jflselkirk1011.3P.1.apn.fit, ###09
           jflselkirk1011.3P.1.apn.fit, ###10
           jflselkirk1011.3P.1.apln.fit,###11
           jflselkirk1011.3P.1.apln.fit,###12
           jflselkirk1011.3P.1.n.fit,   ###13
           jflselkirk1011.3P.1.n.fit,   ###14
           jflselkirk1011.3P.1.ln.fit,  ###15
           jflselkirk1011.3P.1.ln.fit)  ###16
m1 <- c(rep(c("spg","CG"),3),"spg",rep(c("spg","CG"),8))
# Take out variants with gradients > 1
jflselkirk1011.sum.0  <- CatDynSum(x=x1,season="2009-2010",method=m1)
jflselkirk1011.sum.1  <- jflselkirk1011.sum.0[jflselkirk1011.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jflselkirk1011.sum.1[jflselkirk1011.sum.1$Distribution=="apnormal",]
jflselkirk1011.sum.1[jflselkirk1011.sum.1$Distribution=="aplnormal",]
jflselkirk1011.sum.1[jflselkirk1011.sum.1$Distribution=="normal",]
jflselkirk1011.sum.1[jflselkirk1011.sum.1$Distribution=="lognormal",]
# 2P and 3P better in all likelihoods
jflselkirk1011.sum.2 <- jflselkirk1011.sum.1[jflselkirk1011.sum.1$Model %in% c("2P","3P"),]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1011.sum.2))],                     
          ttl=paste(jflselkirk1011.sum.2$Model,
                    substring(jflselkirk1011.sum.2$Distribution, 1,8),
                    jflselkirk1011.sum.2$Method,
                    as.numeric(row.names(jflselkirk1011.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk1011.sum.2))],
          arr=c(5,3))
# Best correlations in variants ###09, ###10, ###11, ###16, ###17, ###18, ###19
jflselkirk1011.sum.3 <- jflselkirk1011.sum.2[which(row.names(jflselkirk1011.sum.2) %in% 
                                               c("9","10","11","16","17","18","19")),]
#
(jflselkirk1011.2P.1.apn.CG.partable   <- CatDynPar(x=jflselkirk1011.2P.1.apn.fit,method="CG"))   ###09 ***
(jflselkirk1011.2P.1.apln.spg.partable <- CatDynPar(x=jflselkirk1011.2P.1.apln.fit,method="spg")) ###10
(jflselkirk1011.2P.1.apln.CG.partable  <- CatDynPar(x=jflselkirk1011.2P.1.apln.fit,method="CG"))  ###11
(jflselkirk1011.3P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk1011.3P.1.apn.fit,method="spg"))  ###16
(jflselkirk1011.3P.1.apn.CG.partable   <- CatDynPar(x=jflselkirk1011.3P.1.apn.fit,method="CG"))   ###17 ***
(jflselkirk1011.3P.1.apln.spg.partable <- CatDynPar(x=jflselkirk1011.3P.1.apln.fit,method="spg")) ###18
(jflselkirk1011.3P.1.apln.CG.partable  <- CatDynPar(x=jflselkirk1011.3P.1.apln.fit,method="CG"))  ###19
#
plot(x=jflselkirk1011.2P.1.apn.pred.CG,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1011.3P.1.apn.pred.CG,                                         ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1011.sum.0$Sel.Model[17] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.3.- Depletion models season: 2011-2012                                   #
################################################################################
#
# Data object
#
jflselkirk1112  <- as.CatDynData(x=cateff1.Selkirk.1112,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2009-09-26","2010-05-07"))
#
plot(x=jflselkirk1112,mark=TRUE,offset=c(9,10,4),hem="S")                       # 47 56 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1112$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 69.19399
M.ini       <- 3*0.001937482
N0.ini      <- 2*69
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1112$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1112$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1112.0P.apn.ini <- catdynexp(x=jflselkirk1112,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1112.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1112.0P.apn.fit  <- CatDynFit(x=jflselkirk1112,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1112.0P.apn.pred.spg <- CatDynPred(jflselkirk1112.0P.apn.fit,"spg")   # 
# plot(x=jflselkirk1112.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1112.0P.apn.pred.CG <- CatDynPred(jflselkirk1112.0P.apn.fit,"CG")     # 
# plot(x=jflselkirk1112.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1112.0P.apln.fit  <- CatDynFit(x=jflselkirk1112,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method="CG",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1112.0P.apln.pred.spg <- CatDynPred(jflselkirk1112.0P.apln.fit,"spg")
# plot(x=jflselkirk1112.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1112.0P.apln.pred.CG <- CatDynPred(jflselkirk1112.0P.apln.fit,"CG") 
# plot(x=jflselkirk1112.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*69
P1.ini      <- 45
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1112$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jflselkirk1112$Data$nasas$time.step,1))
#
jflselkirk1112.1P.apn.ini <- catdynexp(x=jflselkirk1112,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1112.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1112.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1112,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1112.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1112.1P.1.apn.fit,"spg")
plot(x=jflselkirk1112.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1112.1P.1.apn.fit,"CG")
plot(x=jflselkirk1112.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1112,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1112.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1112.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1112.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1112.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1112.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1112$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1112$Data$nasas$obscat.thou))^2)
#
jflselkirk1112.1P.1.n.fit  <- CatDynFit(x=jflselkirk1112,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1112.1P.1.n.pred.spg <- CatDynPred(jflselkirk1112.1P.1.n.fit,"spg")
plot(x=jflselkirk1112.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.n.pred.CG <- CatDynPred(jflselkirk1112.1P.1.n.fit,"CG")
plot(x=jflselkirk1112.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1112,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1112.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1112.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1112.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1112.1P.1.ln.fit,"CG")
plot(x=jflselkirk1112.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*69
P1.ini      <- 45
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1112$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,
                 56,                                                            # the week of one input of abundance
                 tail(jflselkirk1112$Data$nasas$time.step,1))
#
jflselkirk1112.2P.apn.ini <- catdynexp(x=jflselkirk1112,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1112.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1112.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1112,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1112.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1112.2P.1.apn.fit,"spg")
# plot(x=jflselkirk1112.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1112.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1112.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk1112.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1112.2P.1.apn.pred.NM <- CatDynPred(jflselkirk1112.2P.1.apn.fit,"Nelder-Mead")   
plot(x=jflselkirk1112.2P.1.apn.pred.NM,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1112,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1112.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1112.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1112.2P.1.apln.pred.spg,                                       ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1112.2P.1.apln.fit,"CG")
plot(x=jflselkirk1112.2P.1.apln.pred.CG,                                        ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.1.n.fit  <- CatDynFit(x=jflselkirk1112,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1112.2P.1.n.pred.spg <- CatDynPred(jflselkirk1112.2P.1.n.fit,"spg")
# plot(x=jflselkirk1112.2P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1112.2P.1.n.pred.CG <- CatDynPred(jflselkirk1112.2P.1.n.fit,"CG")
# plot(x=jflselkirk1112.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1112.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1112,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1112.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1112.2P.1.ln.fit,"spg")
plot(x=jflselkirk1112.2P.1.ln.pred.spg,                                         ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1112.2P.1.ln.fit,"CG")
plot(x=jflselkirk1112.2P.1.ln.pred.CG,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*69
P1.ini      <- 45
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1112$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,
                 51,                                                            # the week of one input of abundance
                 tail(jflselkirk1112$Data$nasas$time.step,1))
#
jflselkirk1112.2P.apn.ini <- catdynexp(x=jflselkirk1112,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1112.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1112.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1112,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1112.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1112.2P.2.apn.fit,"spg")
plot(x=jflselkirk1112.2P.2.apn.pred.spg,                                        ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1112.2P.2.apn.fit,"CG")
plot(x=jflselkirk1112.2P.2.apn.pred.CG,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1112,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1112.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1112.2P.2.apln.fit,"spg") 
plot(x=jflselkirk1112.2P.2.apln.pred.spg,                                       ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1112.2P.2.apln.fit,"CG")
plot(x=jflselkirk1112.2P.2.apln.pred.CG,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.n.fit  <- CatDynFit(x=jflselkirk1112,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1112.2P.2.n.pred.spg <- CatDynPred(jflselkirk1112.2P.2.n.fit,"spg")
plot(x=jflselkirk1112.2P.2.n.pred.spg,                                          ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.n.pred.CG <- CatDynPred(jflselkirk1112.2P.2.n.fit,"CG")
plot(x=jflselkirk1112.2P.2.n.pred.CG,                                           ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1112,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1112.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1112.2P.2.ln.fit,"spg")
plot(x=jflselkirk1112.2P.2.ln.pred.spg,                                         ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1112.2P.2.ln.fit,"CG")
plot(x=jflselkirk1112.2P.2.ln.pred.CG,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jflselkirk1112.1P.1.apn.fit, ###01
           jflselkirk1112.1P.1.apn.fit, ###02
           jflselkirk1112.1P.1.apln.fit,###03
           jflselkirk1112.1P.1.apln.fit,###04
           jflselkirk1112.1P.1.n.fit,   ###05
           jflselkirk1112.1P.1.n.fit,   ###06
           jflselkirk1112.1P.1.ln.fit,  ###07
           jflselkirk1112.1P.1.ln.fit,  ###08
           jflselkirk1112.2P.1.apn.fit, ###09
           jflselkirk1112.2P.1.apln.fit,###10
           jflselkirk1112.2P.1.apln.fit,###11
           jflselkirk1112.2P.1.ln.fit,  ###12
           jflselkirk1112.2P.1.ln.fit,  ###13
           jflselkirk1112.2P.2.apn.fit, ###14
           jflselkirk1112.2P.2.apn.fit, ###15
           jflselkirk1112.2P.2.apln.fit,###16
           jflselkirk1112.2P.2.apln.fit,###17
           jflselkirk1112.2P.2.n.fit,   ###18
           jflselkirk1112.2P.2.n.fit,   ###19
           jflselkirk1112.2P.2.ln.fit,  ###20
           jflselkirk1112.2P.2.ln.fit)  ###21
m1 <- c(rep(c("spg","CG"),4),"Nelder-Mead",rep(c("spg","CG"),6))
# Take out variants with gradients > 1
jflselkirk1112.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
# All gradients are good
# AIC within variants with same likelihood
jflselkirk1112.sum.0[jflselkirk1112.sum.0$Distribution=="apnormal",]
jflselkirk1112.sum.0[jflselkirk1112.sum.0$Distribution=="aplnormal",]
jflselkirk1112.sum.0[jflselkirk1112.sum.0$Distribution=="normal",]
jflselkirk1112.sum.0[jflselkirk1112.sum.0$Distribution=="lognormal",]
# Tied
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1112.sum.0))],                     
          ttl=paste(jflselkirk1112.sum.0$Model,
                    substring(jflselkirk1112.sum.0$Distribution, 1,8),
                    jflselkirk1112.sum.0$Method,
                    as.numeric(row.names(jflselkirk1112.sum.0))),
          method=m1[as.numeric(row.names(jflselkirk1112.sum.0))],
          arr=c(7,3))
# Best correlations in variants ###09, ###11, ###14, ###15
jflselkirk1112.sum.1 <- jflselkirk1112.sum.0[which(row.names(jflselkirk1112.sum.0) %in% 
                                                     c("9","11","14","15")),]
#
(jflselkirk1112.2P.1.apn.NM.partable  <- CatDynPar(x=jflselkirk1112.2P.1.apn.fit,method="Nelder-Mead")) ###09
(jflselkirk1112.2P.1.apln.CG.partable <- CatDynPar(x=jflselkirk1112.2P.1.apln.fit,method="CG"))         ###11
(jflselkirk1112.2P.2.apn.spg.partable <- CatDynPar(x=jflselkirk1112.2P.2.apn.fit,method="spg"))         ###14
(jflselkirk1112.2P.2.apn.CG.partable  <- CatDynPar(x=jflselkirk1112.2P.2.apn.fit,method="CG"))          ###15
#
plot(x=jflselkirk1112.2P.2.apn.pred.CG,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1112.sum.0$Sel.Model[15] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.4.- Depletion models season: 2012-2013                                   #
################################################################################
#
# Data object
#
jflselkirk1213  <- as.CatDynData(x=cateff1.Selkirk.1213,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2012-10-01","2013-05-15"))
#
plot(x=jflselkirk1213,mark=TRUE,offset=c(9,10,4),hem="S")                       # 47 49 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1213$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 52.44417
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1213$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1213$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk1213.0P.apn.ini <- catdynexp(x=jflselkirk1213,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1213.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1213.0P.apn.fit  <- CatDynFit(x=jflselkirk1213,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1213.0P.apn.pred.spg <- CatDynPred(jflselkirk1213.0P.apn.fit,"spg")   # 47 49
plot(x=jflselkirk1213.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.0P.apn.pred.CG <- CatDynPred(jflselkirk1213.0P.apn.fit,"CG")     # 47 49
plot(x=jflselkirk1213.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.0P.apln.fit  <- CatDynFit(x=jflselkirk1213,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1213.0P.apln.pred.spg <- CatDynPred(jflselkirk1213.0P.apln.fit,"spg") # 53
plot(x=jflselkirk1213.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.0P.apln.pred.CG <- CatDynPred(jflselkirk1213.0P.apln.fit,"CG")   # 53
plot(x=jflselkirk1213.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 25
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1213$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jflselkirk1213$Data$nasas$time.step,1))
#
jflselkirk1213.1P.apn.ini <- catdynexp(x=jflselkirk1213,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1213.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1213.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1213,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1213.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1213.1P.1.apn.fit,"spg")
plot(x=jflselkirk1213.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1213.1P.1.apn.fit,"CG")
plot(x=jflselkirk1213.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1213,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1213.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1213.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1213.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1213.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1213.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1213$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1213$Data$nasas$obscat.thou))^2)
#
jflselkirk1213.1P.1.n.fit  <- CatDynFit(x=jflselkirk1213,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1213.1P.1.n.pred.spg <- CatDynPred(jflselkirk1213.1P.1.n.fit,"spg")
plot(x=jflselkirk1213.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.n.pred.CG <- CatDynPred(jflselkirk1213.1P.1.n.fit,"CG")
plot(x=jflselkirk1213.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1213,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1213.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1213.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1213.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1213.1P.1.ln.fit,"CG")
plot(x=jflselkirk1213.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 25
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1213$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,
                 49,                                                            # the week of one input of abundance
                 tail(jflselkirk1213$Data$nasas$time.step,1))
#
jflselkirk1213.2P.apn.ini <- catdynexp(x=jflselkirk1213,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1213.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1213.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1213,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1213.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1213.2P.1.apn.fit,"spg")
plot(x=jflselkirk1213.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1213.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1213.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1213,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1213.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1213.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1213.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1213.2P.1.apln.fit,"CG")
plot(x=jflselkirk1213.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.n.fit  <- CatDynFit(x=jflselkirk1213,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1213.2P.1.n.pred.spg <- CatDynPred(jflselkirk1213.2P.1.n.fit,"spg")
plot(x=jflselkirk1213.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.n.pred.CG <- CatDynPred(jflselkirk1213.2P.1.n.fit,"CG")
plot(x=jflselkirk1213.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1213,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1213.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1213.2P.1.ln.fit,"spg")
plot(x=jflselkirk1213.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1213.2P.1.ln.fit,"CG")
plot(x=jflselkirk1213.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 45
P2.ini      <- 40
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1213$Data$nasas$time.step,1),                   # now the dates vector also has
                 47,
                 68,                                                            # the week of one input of abundance
                 tail(jflselkirk1213$Data$nasas$time.step,1))
#
jflselkirk1213.2P.apn.ini <- catdynexp(x=jflselkirk1213,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1213.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1213.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1213,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1213.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1213.2P.2.apn.fit,"spg")
plot(x=jflselkirk1213.2P.2.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1213.2P.2.apn.fit,"CG")   
plot(x=jflselkirk1213.2P.2.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1213,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1213.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1213.2P.2.apln.fit,"spg") 
plot(x=jflselkirk1213.2P.2.apln.pred.spg,                                       ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1213.2P.2.apln.fit,"CG")
plot(x=jflselkirk1213.2P.2.apln.pred.CG,                                        ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.n.fit  <- CatDynFit(x=jflselkirk1213,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1213.2P.2.n.pred.spg <- CatDynPred(jflselkirk1213.2P.2.n.fit,"spg")
plot(x=jflselkirk1213.2P.2.n.pred.spg,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.n.pred.CG <- CatDynPred(jflselkirk1213.2P.2.n.fit,"CG")
plot(x=jflselkirk1213.2P.2.n.pred.CG,                                           ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1213,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1213.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1213.2P.2.ln.fit,"spg")
plot(x=jflselkirk1213.2P.2.ln.pred.spg,                                         ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1213.2P.2.ln.fit,"CG")
plot(x=jflselkirk1213.2P.2.ln.pred.CG,                                          ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 20
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1213$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,
                 49,                                                            # the week of one input of abundance
                 68,
                 tail(jflselkirk1213$Data$nasas$time.step,1))
#
jflselkirk1213.3P.apn.ini <- catdynexp(x=jflselkirk1213,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1213.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1213.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1213,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1213.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1213.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1213.3P.1.apn.pred.spg,                                        ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1213.3P.1.apn.fit,"CG")
plot(x=jflselkirk1213.3P.1.apn.pred.CG,                                         ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1213,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1213.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1213.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1213.3P.1.apln.pred.spg,                                       ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1213.3P.1.apln.fit,"CG")
plot(x=jflselkirk1213.3P.1.apln.pred.CG,                                        ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.n.fit  <- CatDynFit(x=jflselkirk1213,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1213.3P.1.n.pred.spg <- CatDynPred(jflselkirk1213.3P.1.n.fit,"spg")
plot(x=jflselkirk1213.3P.1.n.pred.spg,                                          ###29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.n.pred.CG <- CatDynPred(jflselkirk1213.3P.1.n.fit,"CG")
plot(x=jflselkirk1213.3P.1.n.pred.CG,                                           ###30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1213,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1213.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1213.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1213.3P.1.ln.pred.spg,                                         ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1213.3P.1.ln.fit,"CG")
plot(x=jflselkirk1213.3P.1.ln.pred.CG,                                          ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1213.1P.1.apn.fit, ###01
           jflselkirk1213.1P.1.apn.fit, ###02
           jflselkirk1213.1P.1.apln.fit,###03
           jflselkirk1213.1P.1.apln.fit,###04
           jflselkirk1213.1P.1.n.fit,   ###05
           jflselkirk1213.1P.1.n.fit,   ###06
           jflselkirk1213.1P.1.ln.fit,  ###07
           jflselkirk1213.1P.1.ln.fit,  ###08
           jflselkirk1213.2P.1.apn.fit, ###09
           jflselkirk1213.2P.1.apn.fit, ###10
           jflselkirk1213.2P.1.apln.fit,###11
           jflselkirk1213.2P.1.apln.fit,###12
           jflselkirk1213.2P.1.n.fit,   ###13
           jflselkirk1213.2P.1.n.fit,   ###14
           jflselkirk1213.2P.1.ln.fit,  ###15
           jflselkirk1213.2P.1.ln.fit,  ###16
           jflselkirk1213.2P.2.apn.fit, ###17
           jflselkirk1213.2P.2.apn.fit, ###18
           jflselkirk1213.2P.2.apln.fit,###19
           jflselkirk1213.2P.2.apln.fit,###20
           jflselkirk1213.2P.2.n.fit,   ###21
           jflselkirk1213.2P.2.n.fit,   ###22
           jflselkirk1213.2P.2.ln.fit,  ###23
           jflselkirk1213.2P.2.ln.fit,  ###24
           jflselkirk1213.3P.1.apn.fit, ###25
           jflselkirk1213.3P.1.apn.fit, ###26
           jflselkirk1213.3P.1.apln.fit,###27
           jflselkirk1213.3P.1.apln.fit,###28
           jflselkirk1213.3P.1.n.fit,   ###29
           jflselkirk1213.3P.1.n.fit,   ###30
           jflselkirk1213.3P.1.ln.fit,  ###31
           jflselkirk1213.3P.1.ln.fit)  ###32
m1 <- rep(c("spg","CG"),16)
# Take out variants with gradients > 1
jflselkirk1213.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
#jflselkirk1213.sum.1  <- jflselkirk1213.sum.0[jflselkirk1213.sum.0$Max.Abs.Grads.<1,]
# All gradients good
# AIC within variants weith same likelihood
jflselkirk1213.sum.0[jflselkirk1213.sum.0$Distribution=="apnormal",]
jflselkirk1213.sum.0[jflselkirk1213.sum.0$Distribution=="aplnormal",]
jflselkirk1213.sum.0[jflselkirk1213.sum.0$Distribution=="normal",]
jflselkirk1213.sum.0[jflselkirk1213.sum.0$Distribution=="lognormal",]
# 2P.2 better in all likelihoods
#jflselkirk1213.sum.1 <- jflselkirk1213.sum.0[jflselkirk1213.sum.0$Model %in% c("3P"),]
jflselkirk1213.sum.1 <- jflselkirk1213.sum.0[17:24,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1213.sum.1))],                     
          ttl=paste(jflselkirk1213.sum.1$Model,
                    substring(jflselkirk1213.sum.1$Distribution, 1,8),
                    jflselkirk1213.sum.1$Method,
                    as.numeric(row.names(jflselkirk1213.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk1213.sum.1))],
          arr=c(4,2))
# Best correlations in variants ###17, ###18, ###19, ###20
jflselkirk1213.sum.2 <- jflselkirk1213.sum.1[which(row.names(jflselkirk1213.sum.1) %in% 
                                                     c("17","18","19","20")),]
#
(jflselkirk1213.2P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk1213.2P.2.apn.fit,method="spg"))   ###17 ***
(jflselkirk1213.2P.2.apn.CG.partable   <- CatDynPar(x=jflselkirk1213.2P.2.apn.fit,method="CG"))    ###18
(jflselkirk1213.2P.2.apln.spg.partable <- CatDynPar(x=jflselkirk1213.2P.2.apln.fit,method="spg"))  ###19
(jflselkirk1213.2P.2.apln.CG.partable  <- CatDynPar(x=jflselkirk1213.2P.2.apln.fit,method="CG"))   ###20
#
plot(x=jflselkirk1213.2P.2.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1213.sum.0$Sel.Model[17] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.5.- Depletion models season: 2013-2014                                   #
################################################################################
#
# Data object
#
jflselkirk1314  <- as.CatDynData(x=cateff1.Selkirk.1314[1:34,],
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2013-09-23","2014-05-05"))
#
plot(x=jflselkirk1314,mark=TRUE,offset=c(9,10,4),hem="S")                       # 46 54 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1314$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 74.33511
M.ini       <- 3*0.001937482
N0.ini      <- 2*55
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1314$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1314.0P.apn.ini <- catdynexp(x=jflselkirk1314,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1314.0P.apn.fit  <- CatDynFit(x=jflselkirk1314,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1314.0P.apn.pred.spg <- CatDynPred(jflselkirk1314.0P.apn.fit,"spg")   
# plot(x=jflselkirk1314.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.0P.apn.pred.CG <- CatDynPred(jflselkirk1314.0P.apn.fit,"CG")     
# plot(x=jflselkirk1314.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.0P.apln.fit  <- CatDynFit(x=jflselkirk1314,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.0P.apln.pred.spg <- CatDynPred(jflselkirk1314.0P.apln.fit,"spg") 
# plot(x=jflselkirk1314.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.0P.apln.pred.CG <- CatDynPred(jflselkirk1314.0P.apln.fit,"CG")   
# plot(x=jflselkirk1314.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 25
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,                                                            # the week of one input of abundance
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.1P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1314.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1314.1P.1.apn.fit,"spg")
plot(x=jflselkirk1314.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1314.1P.1.apn.fit,"CG")
plot(x=jflselkirk1314.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1314,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1314.1P.1.apln.fit,"spg") 
# plot(x=jflselkirk1314.1P.1.apln.pred.spg,                                     
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1314.1P.1.apln.fit,"CG") 
# plot(x=jflselkirk1314.1P.1.apln.pred.CG,                                    
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1314$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1314$Data$nasas$obscat.thou))^2)
#
jflselkirk1314.1P.1.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.1P.1.n.pred.spg <- CatDynPred(jflselkirk1314.1P.1.n.fit,"spg")
plot(x=jflselkirk1314.1P.1.n.pred.spg,                                          ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.1P.1.n.pred.CG <- CatDynPred(jflselkirk1314.1P.1.n.fit,"CG")
plot(x=jflselkirk1314.1P.1.n.pred.CG,                                           ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1314.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk1314.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1314.1P.1.ln.fit,"CG")
# plot(x=jflselkirk1314.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 25
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 54,                                                            # the week of one input of abundance
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.2P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1314.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="spg",#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1314.2P.1.apn.fit,"spg")
plot(x=jflselkirk1314.2P.1.apn.pred.spg,                                        ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1314.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk1314.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1314,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1314.2P.1.apln.fit,"spg") 
# plot(x=jflselkirk1314.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1314.2P.1.apln.fit,"CG")
# plot(x=jflselkirk1314.2P.1.apln.pred.CG,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.2P.1.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="spg",#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.2P.1.n.pred.spg <- CatDynPred(jflselkirk1314.2P.1.n.fit,"spg")
plot(x=jflselkirk1314.2P.1.n.pred.spg,                                          ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.2P.1.n.pred.CG <- CatDynPred(jflselkirk1314.2P.1.n.fit,"CG")
# plot(x=jflselkirk1314.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1314.2P.1.ln.fit,"spg")
# plot(x=jflselkirk1314.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1314.2P.1.ln.fit,"CG")
# plot(x=jflselkirk1314.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*75
P1.ini      <- 45
P2.ini      <- 40
k.ini       <- 4e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.2P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1314.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1314.2P.2.apn.fit,"spg")
plot(x=jflselkirk1314.2P.2.apn.pred.spg,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1314.2P.2.apn.fit,"CG")   
plot(x=jflselkirk1314.2P.2.apn.pred.CG,                                         ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1314,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1314.2P.2.apln.fit,"spg") 
# plot(x=jflselkirk1314.2P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1314.2P.2.apln.fit,"CG")
# plot(x=jflselkirk1314.2P.2.apln.pred.CG,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.2P.2.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.2P.2.n.pred.spg <- CatDynPred(jflselkirk1314.2P.2.n.fit,"spg")
plot(x=jflselkirk1314.2P.2.n.pred.spg,                                          ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.2P.2.n.pred.CG <- CatDynPred(jflselkirk1314.2P.2.n.fit,"CG")
plot(x=jflselkirk1314.2P.2.n.pred.CG,                                           ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1314.2P.2.ln.fit,"spg")
# plot(x=jflselkirk1314.2P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1314.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1314.2P.2.ln.fit,"CG")
# plot(x=jflselkirk1314.2P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*60
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 20
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.3P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1314.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1314.3P.1.apn.fit,"spg")
plot(x=jflselkirk1314.3P.1.apn.pred.spg,                                        ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1314.3P.1.apn.fit,"CG")
plot(x=jflselkirk1314.3P.1.apn.pred.CG,                                         ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1314.3P.1.apln.fit,"spg") 
# plot(x=jflselkirk1314.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1314.3P.1.apln.fit,"CG")
# plot(x=jflselkirk1314.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.3P.1.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.3P.1.n.pred.spg <- CatDynPred(jflselkirk1314.3P.1.n.fit,"spg")
plot(x=jflselkirk1314.3P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.1.n.pred.CG <- CatDynPred(jflselkirk1314.3P.1.n.fit,"CG")
plot(x=jflselkirk1314.3P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1314.3P.1.ln.fit,"spg")   
# plot(x=jflselkirk1314.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1314.3P.1.ln.fit,"CG")
# plot(x=jflselkirk1314.3P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*60
P1.ini      <- 5
P2.ini      <- 10
P3.ini      <- 10
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 54,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.3P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1314.3P.2.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.3P.2.apn.pred.spg <- CatDynPred(jflselkirk1314.3P.2.apn.fit,"spg")
plot(x=jflselkirk1314.3P.2.apn.pred.spg,                                        ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.2.apn.pred.CG <- CatDynPred(jflselkirk1314.3P.2.apn.fit,"CG")
plot(x=jflselkirk1314.3P.2.apn.pred.CG,                                         ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.2.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.3P.2.apln.pred.spg <- CatDynPred(jflselkirk1314.3P.2.apln.fit,"spg") 
# plot(x=jflselkirk1314.3P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.3P.2.apln.pred.CG <- CatDynPred(jflselkirk1314.3P.2.apln.fit,"CG")
# plot(x=jflselkirk1314.3P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.3P.2.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.3P.2.n.pred.spg <- CatDynPred(jflselkirk1314.3P.2.n.fit,"spg")
plot(x=jflselkirk1314.3P.2.n.pred.spg,                                          ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.2.n.pred.CG <- CatDynPred(jflselkirk1314.3P.2.n.fit,"CG")
plot(x=jflselkirk1314.3P.2.n.pred.CG,                                           ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.3P.2.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.3P.2.ln.pred.spg <- CatDynPred(jflselkirk1314.3P.2.ln.fit,"spg")   
# plot(x=jflselkirk1314.3P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.3P.2.ln.pred.CG <- CatDynPred(jflselkirk1314.3P.2.ln.fit,"CG")
# plot(x=jflselkirk1314.3P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*40
P1.ini      <- 5
P2.ini      <- 10
P3.ini      <- 10
P4.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 52,                                                            # the week of one input of abundance
                 54,
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.4P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.4P.1.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1314.4P.1.apn.pred.spg <- CatDynPred(jflselkirk1314.4P.1.apn.fit,"spg")
plot(x=jflselkirk1314.4P.1.apn.pred.spg,                                        ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.apn.pred.CG <- CatDynPred(jflselkirk1314.4P.1.apn.fit,"CG")
# plot(x=jflselkirk1314.4P.1.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.1.apn.pred.NM <- CatDynPred(jflselkirk1314.4P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1314.4P.1.apn.pred.NM,                                         ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.4P.1.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.4P.1.apln.pred.spg <- CatDynPred(jflselkirk1314.4P.1.apln.fit,"spg") 
# plot(x=jflselkirk1314.4P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.apln.pred.CG <- CatDynPred(jflselkirk1314.4P.1.apln.fit,"CG")
# plot(x=jflselkirk1314.4P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.apln.pred.NM <- CatDynPred(jflselkirk1314.4P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.1.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.4P.1.n.pred.spg <- CatDynPred(jflselkirk1314.4P.1.n.fit,"spg")
plot(x=jflselkirk1314.4P.1.n.pred.spg,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.n.pred.CG <- CatDynPred(jflselkirk1314.4P.1.n.fit,"CG")
# plot(x=jflselkirk1314.4P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.1.n.pred.NM <- CatDynPred(jflselkirk1314.4P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk1314.4P.1.n.pred.NM,                                           ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.4P.1.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.4P.1.ln.pred.spg <- CatDynPred(jflselkirk1314.4P.1.ln.fit,"spg")   
# plot(x=jflselkirk1314.4P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.ln.pred.CG <- CatDynPred(jflselkirk1314.4P.1.ln.fit,"CG")
# plot(x=jflselkirk1314.4P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.1.ln.pred.NM <- CatDynPred(jflselkirk1314.4P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*40
P1.ini      <- 5
P2.ini      <- 10
P3.ini      <- 10
P4.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 50,                                                            # the week of one input of abundance
                 52,
                 54,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.4P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.4P.2.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1314.4P.2.apn.pred.spg <- CatDynPred(jflselkirk1314.4P.2.apn.fit,"spg")
plot(x=jflselkirk1314.4P.2.apn.pred.spg,                                        ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.apn.pred.CG <- CatDynPred(jflselkirk1314.4P.2.apn.fit,"CG")
# plot(x=jflselkirk1314.4P.2.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.2.apn.pred.NM <- CatDynPred(jflselkirk1314.4P.2.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1314.4P.2.apn.pred.NM,                                         ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.4P.2.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.4P.2.apln.pred.spg <- CatDynPred(jflselkirk1314.4P.2.apln.fit,"spg") 
# plot(x=jflselkirk1314.4P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.apln.pred.CG <- CatDynPred(jflselkirk1314.4P.2.apln.fit,"CG")
# plot(x=jflselkirk1314.4P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.apln.pred.NM <- CatDynPred(jflselkirk1314.4P.2.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.2.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.4P.2.n.pred.spg <- CatDynPred(jflselkirk1314.4P.2.n.fit,"spg")
plot(x=jflselkirk1314.4P.2.n.pred.spg,                                          ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.n.pred.CG <- CatDynPred(jflselkirk1314.4P.2.n.fit,"CG")
# plot(x=jflselkirk1314.4P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.2.n.pred.NM <- CatDynPred(jflselkirk1314.4P.2.n.fit,"Nelder-Mead")
plot(x=jflselkirk1314.4P.2.n.pred.NM,                                           ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.4P.2.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.4P.2.ln.pred.spg <- CatDynPred(jflselkirk1314.4P.2.ln.fit,"spg")   
# plot(x=jflselkirk1314.4P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.ln.pred.CG <- CatDynPred(jflselkirk1314.4P.2.ln.fit,"CG")
# plot(x=jflselkirk1314.4P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.2.ln.pred.NM <- CatDynPred(jflselkirk1314.4P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.2.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
M.ini       <- 3*0.001937482
N0.ini      <- 2*40
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 5
P4.ini      <- 30
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 42,                                                            # the week of one input of abundance
                 46,
                 54,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.4P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.4P.3.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflselkirk1314.4P.3.apn.pred.spg <- CatDynPred(jflselkirk1314.4P.3.apn.fit,"spg")
# plot(x=jflselkirk1314.4P.3.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.apn.pred.CG <- CatDynPred(jflselkirk1314.4P.3.apn.fit,"CG")
# plot(x=jflselkirk1314.4P.3.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.3.apn.pred.NM <- CatDynPred(jflselkirk1314.4P.3.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1314.4P.3.apn.pred.NM,                                         ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.4P.3.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1314.4P.3.apln.pred.spg <- CatDynPred(jflselkirk1314.4P.3.apln.fit,"spg") 
# plot(x=jflselkirk1314.4P.3.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.apln.pred.CG <- CatDynPred(jflselkirk1314.4P.3.apln.fit,"CG")
# plot(x=jflselkirk1314.4P.3.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.apln.pred.NM <- CatDynPred(jflselkirk1314.4P.3.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.3.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.3.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1314.4P.3.n.pred.spg <- CatDynPred(jflselkirk1314.4P.3.n.fit,"spg")
# plot(x=jflselkirk1314.4P.3.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.n.pred.CG <- CatDynPred(jflselkirk1314.4P.3.n.fit,"CG")
# plot(x=jflselkirk1314.4P.3.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.n.pred.NM <- CatDynPred(jflselkirk1314.4P.3.n.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.3.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.4P.3.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.4P.3.ln.pred.spg <- CatDynPred(jflselkirk1314.4P.3.ln.fit,"spg")   
# plot(x=jflselkirk1314.4P.3.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.ln.pred.CG <- CatDynPred(jflselkirk1314.4P.3.ln.fit,"CG")
# plot(x=jflselkirk1314.4P.3.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.4P.3.ln.pred.NM <- CatDynPred(jflselkirk1314.4P.3.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.4P.3.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*40
P1.ini      <- 5
P2.ini      <- 10
P3.ini      <- 10
P4.ini      <- 5
P5.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 50,                                                            # the week of one input of abundance
                 52,
                 54,
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.5P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.5P.1.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1314.5P.1.apn.pred.spg <- CatDynPred(jflselkirk1314.5P.1.apn.fit,"spg")
plot(x=jflselkirk1314.5P.1.apn.pred.spg,                                        ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.apn.pred.CG <- CatDynPred(jflselkirk1314.5P.1.apn.fit,"CG")
# plot(x=jflselkirk1314.5P.1.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.apn.pred.NM <- CatDynPred(jflselkirk1314.5P.1.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.1.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.1.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1314.5P.1.apln.pred.spg <- CatDynPred(jflselkirk1314.5P.1.apln.fit,"spg") 
# plot(x=jflselkirk1314.5P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.apln.pred.CG <- CatDynPred(jflselkirk1314.5P.1.apln.fit,"CG")
# plot(x=jflselkirk1314.5P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.apln.pred.NM <- CatDynPred(jflselkirk1314.5P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.1.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.5P.1.n.pred.spg <- CatDynPred(jflselkirk1314.5P.1.n.fit,"spg")
plot(x=jflselkirk1314.5P.1.n.pred.spg,                                          ###29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.n.pred.CG <- CatDynPred(jflselkirk1314.5P.1.n.fit,"CG")
# plot(x=jflselkirk1314.5P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.n.pred.NM <- CatDynPred(jflselkirk1314.5P.1.n.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.1.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.5P.1.ln.pred.spg <- CatDynPred(jflselkirk1314.5P.1.ln.fit,"spg")   
# plot(x=jflselkirk1314.5P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.ln.pred.CG <- CatDynPred(jflselkirk1314.5P.1.ln.fit,"CG")
# plot(x=jflselkirk1314.5P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.1.ln.pred.NM <- CatDynPred(jflselkirk1314.5P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*40
P1.ini      <- 5
P2.ini      <- 15
P3.ini      <- 10
P4.ini      <- 10
P5.ini      <- 10
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 49,                                                            # the week of one input of abundance
                 50,
                 54,
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.5P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.5P.2.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1314.5P.2.apn.pred.spg <- CatDynPred(jflselkirk1314.5P.2.apn.fit,"spg")
plot(x=jflselkirk1314.5P.2.apn.pred.spg,                                        ###30 *
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.apn.pred.CG <- CatDynPred(jflselkirk1314.5P.2.apn.fit,"CG")
# plot(x=jflselkirk1314.5P.2.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.2.apn.pred.NM <- CatDynPred(jflselkirk1314.5P.2.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1314.5P.2.apn.pred.NM,                                         ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.5P.2.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1314.5P.2.apln.pred.spg <- CatDynPred(jflselkirk1314.5P.2.apln.fit,"spg") 
# plot(x=jflselkirk1314.5P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.apln.pred.CG <- CatDynPred(jflselkirk1314.5P.2.apln.fit,"CG")
# plot(x=jflselkirk1314.5P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.apln.pred.NM <- CatDynPred(jflselkirk1314.5P.2.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.2.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.5P.2.n.pred.spg <- CatDynPred(jflselkirk1314.5P.2.n.fit,"spg")
plot(x=jflselkirk1314.5P.2.n.pred.spg,                                          ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.n.pred.CG <- CatDynPred(jflselkirk1314.5P.2.n.fit,"CG")
# plot(x=jflselkirk1314.5P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.2.n.pred.NM <- CatDynPred(jflselkirk1314.5P.2.n.fit,"Nelder-Mead")
plot(x=jflselkirk1314.5P.2.n.pred.NM,                                           ###33
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.5P.2.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.5P.2.ln.pred.spg <- CatDynPred(jflselkirk1314.5P.2.ln.fit,"spg")   
# plot(x=jflselkirk1314.5P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.ln.pred.CG <- CatDynPred(jflselkirk1314.5P.2.ln.fit,"CG")
# plot(x=jflselkirk1314.5P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.2.ln.pred.NM <- CatDynPred(jflselkirk1314.5P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.2.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*40
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 5
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 42,                                                            # the week of one input of abundance
                 46,
                 52,
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.5P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.5P.3.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1314.5P.3.apn.pred.spg <- CatDynPred(jflselkirk1314.5P.3.apn.fit,"spg")
plot(x=jflselkirk1314.5P.3.apn.pred.spg,                                        ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.apn.pred.CG <- CatDynPred(jflselkirk1314.5P.3.apn.fit,"CG")
# plot(x=jflselkirk1314.5P.3.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.apn.pred.NM <- CatDynPred(jflselkirk1314.5P.3.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.3.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.3.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1314.5P.3.apln.pred.spg <- CatDynPred(jflselkirk1314.5P.3.apln.fit,"spg") 
# plot(x=jflselkirk1314.5P.3.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.apln.pred.CG <- CatDynPred(jflselkirk1314.5P.3.apln.fit,"CG")
# plot(x=jflselkirk1314.5P.3.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.apln.pred.NM <- CatDynPred(jflselkirk1314.5P.3.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.3.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.3.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.5P.3.n.pred.spg <- CatDynPred(jflselkirk1314.5P.3.n.fit,"spg")
plot(x=jflselkirk1314.5P.3.n.pred.spg,                                          ###35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.n.pred.CG <- CatDynPred(jflselkirk1314.5P.3.n.fit,"CG")
# plot(x=jflselkirk1314.5P.3.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.n.pred.NM <- CatDynPred(jflselkirk1314.5P.3.n.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.3.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.3.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.5P.3.ln.pred.spg <- CatDynPred(jflselkirk1314.5P.3.ln.fit,"spg")   
# plot(x=jflselkirk1314.5P.3.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.ln.pred.CG <- CatDynPred(jflselkirk1314.5P.3.ln.fit,"CG")
# plot(x=jflselkirk1314.5P.3.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.3.ln.pred.NM <- CatDynPred(jflselkirk1314.5P.3.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.3.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 1.5*40
P1.ini      <- 5
P2.ini      <- 15
P3.ini      <- 10
P4.ini      <- 10
P5.ini      <- 10
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1314$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 46,
                 49,                                                            # the week of one input of abundance
                 54,
                 65,
                 tail(jflselkirk1314$Data$nasas$time.step,1))
#
jflselkirk1314.5P.apn.ini <- catdynexp(x=jflselkirk1314,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1314.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 4-input depletion variant
jflselkirk1314.5P.4.apn.fit  <- CatDynFit(x=jflselkirk1314,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1314.5P.4.apn.pred.spg <- CatDynPred(jflselkirk1314.5P.4.apn.fit,"spg")
plot(x=jflselkirk1314.5P.4.apn.pred.spg,                                        ###36 *
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.apn.pred.CG <- CatDynPred(jflselkirk1314.5P.4.apn.fit,"CG")
# plot(x=jflselkirk1314.5P.4.apn.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.apn.pred.NM <- CatDynPred(jflselkirk1314.5P.4.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.4.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.4.apln.fit  <- CatDynFit(x=jflselkirk1314,                    
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1314.5P.4.apln.pred.spg <- CatDynPred(jflselkirk1314.5P.4.apln.fit,"spg") 
# plot(x=jflselkirk1314.5P.4.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.apln.pred.CG <- CatDynPred(jflselkirk1314.5P.4.apln.fit,"CG")
# plot(x=jflselkirk1314.5P.4.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.apln.pred.NM <- CatDynPred(jflselkirk1314.5P.4.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.4.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.4.n.fit  <- CatDynFit(x=jflselkirk1314,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1314.5P.4.n.pred.spg <- CatDynPred(jflselkirk1314.5P.4.n.fit,"spg")
plot(x=jflselkirk1314.5P.4.n.pred.spg,                                          ###37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.n.pred.CG <- CatDynPred(jflselkirk1314.5P.4.n.fit,"CG")
# plot(x=jflselkirk1314.5P.4.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1314.5P.4.n.pred.NM <- CatDynPred(jflselkirk1314.5P.4.n.fit,"Nelder-Mead")
plot(x=jflselkirk1314.5P.4.n.pred.NM,                                           ###38
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.5P.4.ln.fit  <- CatDynFit(x=jflselkirk1314,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1314.5P.4.ln.pred.spg <- CatDynPred(jflselkirk1314.5P.4.ln.fit,"spg")   
# plot(x=jflselkirk1314.5P.4.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.ln.pred.CG <- CatDynPred(jflselkirk1314.5P.4.ln.fit,"CG")
# plot(x=jflselkirk1314.5P.4.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1314.5P.4.ln.pred.NM <- CatDynPred(jflselkirk1314.5P.4.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1314.5P.4.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1314.1P.1.apn.fit, ###01
           jflselkirk1314.1P.1.apn.fit, ###02
           jflselkirk1314.1P.1.n.fit,   ###03
           jflselkirk1314.1P.1.n.fit,   ###04
           jflselkirk1314.2P.1.apn.fit, ###05
           jflselkirk1314.2P.1.n.fit,   ###06
           jflselkirk1314.2P.2.apn.fit, ###07
           jflselkirk1314.2P.2.apn.fit, ###08
           jflselkirk1314.2P.2.n.fit,   ###09
           jflselkirk1314.2P.2.n.fit,   ###10
           jflselkirk1314.3P.1.apn.fit, ###11
           jflselkirk1314.3P.1.apn.fit, ###12
           jflselkirk1314.3P.1.n.fit,   ###13
           jflselkirk1314.3P.1.n.fit,   ###14
           jflselkirk1314.3P.2.apn.fit, ###15
           jflselkirk1314.3P.2.apn.fit, ###16
           jflselkirk1314.3P.2.n.fit,   ###17
           jflselkirk1314.3P.2.n.fit,   ###18
           jflselkirk1314.4P.1.apn.fit, ###19
           jflselkirk1314.4P.1.apn.fit, ###20
           jflselkirk1314.4P.1.n.fit,   ###21
           jflselkirk1314.4P.1.n.fit,   ###22
           jflselkirk1314.4P.2.apn.fit, ###23
           jflselkirk1314.4P.2.apn.fit, ###24
           jflselkirk1314.4P.2.n.fit,   ###25
           jflselkirk1314.4P.2.n.fit,   ###26
           jflselkirk1314.4P.3.apn.fit, ###27
           jflselkirk1314.5P.1.apn.fit, ###28
           jflselkirk1314.5P.1.n.fit,   ###29
           jflselkirk1314.5P.2.apn.fit, ###30
           jflselkirk1314.5P.2.apn.fit, ###31
           jflselkirk1314.5P.2.n.fit,   ###32
           jflselkirk1314.5P.2.n.fit,   ###33
           jflselkirk1314.5P.3.apn.fit, ###34
           jflselkirk1314.5P.3.n.fit,   ###35
           jflselkirk1314.5P.4.apn.fit, ###36
           jflselkirk1314.5P.4.n.fit,   ###37
           jflselkirk1314.5P.4.n.fit)   ###38
m1 <- c(rep(c("spg","CG"),2),
        "spg","spg",rep(c("spg","CG"),2),
        rep(c("spg","CG"),2),rep(c("spg","CG"),2),
        rep(c("spg","Nelder-Mead"),4),"Nelder-Mead",
        "spg","spg",rep(c("spg","Nelder-Mead"),2),"spg","spg","spg","spg","Nelder-Mead")
# Take out variants with gradients > 1
jflselkirk1314.sum.0  <- CatDynSum(x=x1,season="2013-2014",method=m1)
jflselkirk1314.sum.1  <- jflselkirk1314.sum.0[jflselkirk1314.sum.0$Max.Abs.Grads.<1,]
# AIC within variants with same likelihood
jflselkirk1314.sum.1[jflselkirk1314.sum.1$Distribution=="apnormal",]
jflselkirk1314.sum.1[jflselkirk1314.sum.1$Distribution=="normal",]
# 2P.2, 3P.2, 4P.1, 4P.2, 5P.1, 5P.2 better in all likelihoods
#jflselkirk1314.sum.1 <- jflselkirk1314.sum.0[jflselkirk1314.sum.0$Model %in% c("3P"),]
jflselkirk1314.sum.2 <- jflselkirk1314.sum.1[which(row.names(jflselkirk1314.sum.1) %in% 
                                                     c("7","8","10","15","16","17","18","19","21","23","24","28","29","30","32","34","35","36","37")),]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1314.sum.2))],                     
          ttl=paste(jflselkirk1314.sum.2$Model,
                    substring(jflselkirk1314.sum.2$Distribution, 1,8),
                    jflselkirk1314.sum.2$Method,
                    as.numeric(row.names(jflselkirk1314.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk1314.sum.2))],
          arr=c(5,4))
# Worst correlations in variants ###10, ###17, ###18, ###21, ###24, ###28, ###31
jflselkirk1314.sum.3 <- jflselkirk1314.sum.2[which(!row.names(jflselkirk1314.sum.2) %in% 
                                                     c("10","17","18","21","24","29","32","35","37")),]
#
(jflselkirk1314.2P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.2P.2.apn.fit,method="spg")) ###07
(jflselkirk1314.2P.2.apn.CG.partable   <- CatDynPar(x=jflselkirk1314.2P.2.apn.fit,method="CG"))  ###08
(jflselkirk1314.3P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.3P.2.apn.fit,method="spg")) ###15
(jflselkirk1314.3P.2.apn.CG.partable   <- CatDynPar(x=jflselkirk1314.3P.2.apn.fit,method="CG"))  ###16
(jflselkirk1314.4P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.4P.1.apn.fit,method="spg")) ###19
(jflselkirk1314.4P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.4P.2.apn.fit,method="spg")) ###23
(jflselkirk1314.5P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.5P.1.apn.fit,method="spg")) ###28
(jflselkirk1314.5P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.5P.2.apn.fit,method="spg")) ###30
(jflselkirk1314.5P.3.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.5P.3.apn.fit,method="spg")) ###34
(jflselkirk1314.5P.3.apn.spg.partable  <- CatDynPar(x=jflselkirk1314.5P.4.apn.fit,method="spg")) ###36
#
plot(x=jflselkirk1314.2P.2.apn.pred.spg,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.2P.2.apn.pred.CG,                                         ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.3P.2.apn.pred.spg,                                        ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.3P.2.apn.pred.CG,                                         ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.4P.1.apn.pred.spg,                                        ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.4P.2.apn.pred.spg,                                        ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.5P.1.apn.pred.spg,                                        ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.5P.2.apn.pred.spg,                                        ###30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.5P.3.apn.pred.spg,                                        ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
plot(x=jflselkirk1314.5P.4.apn.pred.spg,                                        ###36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1314.sum.0$Sel.Model[36] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.6.- Depletion models season: 2014-2015                                   #
################################################################################
#
# Data object
cateff1.Selkirk.1415 <- rbind(cateff1.Selkirk.1415[1:14,],
                              c(2015,6,1,0,0,118.5905,0.1169274,118.6512,774.4533),
                              c(2015,6,2,0,0,118.5905,0.1169274,118.6512,774.4533),
                              c(2015,6,3,0,0,118.5905,0.1169274,118.6512,774.4533),
                              cateff1.Selkirk.1415[15:30,])
#
jflselkirk1415  <- as.CatDynData(x=cateff1.Selkirk.1415,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2013-09-22","2014-04-25"))
#
plot(x=jflselkirk1415,mark=TRUE,offset=c(9,10,4),hem="S")                       # 48 50 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1415$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 30.19719
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1415$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1415.0P.apn.ini <- catdynexp(x=jflselkirk1415,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1415.0P.apn.fit  <- CatDynFit(x=jflselkirk1415,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1415.0P.apn.pred.spg <- CatDynPred(jflselkirk1415.0P.apn.fit,"spg")   
# plot(x=jflselkirk1415.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.0P.apn.pred.CG <- CatDynPred(jflselkirk1415.0P.apn.fit,"CG")     
# plot(x=jflselkirk1415.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.0P.apln.fit  <- CatDynFit(x=jflselkirk1415,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1415.0P.apln.pred.spg <- CatDynPred(jflselkirk1415.0P.apln.fit,"spg") 
# plot(x=jflselkirk1415.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.0P.apln.pred.CG <- CatDynPred(jflselkirk1415.0P.apln.fit,"CG")   
# plot(x=jflselkirk1415.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 35
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                   # now the dates vector also has
                 48,                                                            # the week of one input of abundance
                 tail(jflselkirk1415$Data$nasas$time.step,1))
#
jflselkirk1415.1P.apn.ini <- catdynexp(x=jflselkirk1415,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1415.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1415,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1415.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1415.1P.1.apn.fit,"spg")
# plot(x=jflselkirk1415.1P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1415.1P.1.apn.fit,"CG")
# plot(x=jflselkirk1415.1P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.1P.1.apn.pred.NM <- CatDynPred(jflselkirk1415.1P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1415.1P.1.apn.pred.NM,                                         ###01 46 48 59
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1415,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1415.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1415.1P.1.apln.fit,"spg") 
# plot(x=jflselkirk1415.1P.1.apln.pred.spg,                                     
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1415.1P.1.apln.fit,"CG") 
# plot(x=jflselkirk1415.1P.1.apln.pred.CG,                                    
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1415$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1415$Data$nasas$obscat.thou+0.1))^2)
#
jflselkirk1415.1P.1.n.fit  <- CatDynFit(x=jflselkirk1415,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1415.1P.1.n.pred.spg <- CatDynPred(jflselkirk1415.1P.1.n.fit,"spg")
# plot(x=jflselkirk1415.1P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.1P.1.n.pred.CG <- CatDynPred(jflselkirk1415.1P.1.n.fit,"CG")
# plot(x=jflselkirk1415.1P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1415,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1415.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1415.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk1415.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1415.1P.1.ln.fit,"CG")
# plot(x=jflselkirk1415.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                   # now the dates vector also has
                 48,
                 50,                                                            # the week of one input of abundance
                 tail(jflselkirk1415$Data$nasas$time.step,1))
#
jflselkirk1415.2P.apn.ini <- catdynexp(x=jflselkirk1415,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1415.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1415,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1415.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1415.2P.1.apn.fit,"spg")
# plot(x=jflselkirk1415.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1415.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk1415.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1415,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1415.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1415.2P.1.apln.fit,"spg") 
# plot(x=jflselkirk1415.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1415.2P.1.apln.fit,"CG")
# plot(x=jflselkirk1415.2P.1.apln.pred.CG,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.1.n.fit  <- CatDynFit(x=jflselkirk1415,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1415.2P.1.n.pred.spg <- CatDynPred(jflselkirk1415.2P.1.n.fit,"spg")
# plot(x=jflselkirk1415.2P.1.n.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.1.n.pred.CG <- CatDynPred(jflselkirk1415.2P.1.n.fit,"CG")
# plot(x=jflselkirk1415.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1415,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1415.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1415.2P.1.ln.fit,"spg")
# plot(x=jflselkirk1415.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1415.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1415.2P.1.ln.fit,"CG")
# plot(x=jflselkirk1415.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 25
P2.ini      <- 10
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                   # now the dates vector also has
                 48,
                 59,                                                            # the week of one input of abundance
                 tail(jflselkirk1415$Data$nasas$time.step,1))
#
jflselkirk1415.2P.apn.ini <- catdynexp(x=jflselkirk1415,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1415.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1415,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflselkirk1415.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1415.2P.2.apn.fit,"spg")
# plot(x=jflselkirk1415.2P.2.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1415.2P.2.apn.fit,"CG")   
# plot(x=jflselkirk1415.2P.2.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.2.apn.pred.NM <- CatDynPred(jflselkirk1415.2P.2.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1415.2P.2.apn.pred.NM,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1415,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1415.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1415.2P.2.apln.fit,"spg") 
# plot(x=jflselkirk1415.2P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1415.2P.2.apln.fit,"CG")
# plot(x=jflselkirk1415.2P.2.apln.pred.CG,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.apln.pred.NM <- CatDynPred(jflselkirk1415.2P.2.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1415.2P.2.apln.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.2.n.fit  <- CatDynFit(x=jflselkirk1415,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflselkirk1415.2P.2.n.pred.spg <- CatDynPred(jflselkirk1415.2P.2.n.fit,"spg")
# plot(x=jflselkirk1415.2P.2.n.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.n.pred.CG <- CatDynPred(jflselkirk1415.2P.2.n.fit,"CG")
# plot(x=jflselkirk1415.2P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.n.pred.NM <- CatDynPred(jflselkirk1415.2P.2.n.fit,"Nelder-Mead")
# plot(x=jflselkirk1415.2P.2.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1415,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk1415.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1415.2P.2.ln.fit,"spg")
# plot(x=jflselkirk1415.2P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# 
# jflselkirk1415.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1415.2P.2.ln.fit,"CG")
# plot(x=jflselkirk1415.2P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.2P.2.ln.pred.NM <- CatDynPred(jflselkirk1415.2P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1415.2P.2.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 5
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 48,                                                            # the week of one input of abundance
                 59,
                 tail(jflselkirk1415$Data$nasas$time.step,1))
#
jflselkirk1415.3P.apn.ini <- catdynexp(x=jflselkirk1415,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1415.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1415,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflselkirk1415.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1415.3P.1.apn.fit,"spg") 
# plot(x=jflselkirk1415.3P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1415.3P.1.apn.fit,"CG")
# plot(x=jflselkirk1415.3P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.3P.1.apn.pred.NM <- CatDynPred(jflselkirk1415.3P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1415.3P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1415,                    
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1415.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1415.3P.1.apln.fit,"spg") 
# plot(x=jflselkirk1415.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1415.3P.1.apln.fit,"CG")
# plot(x=jflselkirk1415.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.3P.1.apln.pred.NM <- CatDynPred(jflselkirk1415.3P.1.apln.fit,"Nelder-Mead")
plot(x=jflselkirk1415.3P.1.apln.pred.NM,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.3P.1.n.fit  <- CatDynFit(x=jflselkirk1415,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflselkirk1415.3P.1.n.pred.spg <- CatDynPred(jflselkirk1415.3P.1.n.fit,"spg")
# plot(x=jflselkirk1415.3P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.3P.1.n.pred.CG <- CatDynPred(jflselkirk1415.3P.1.n.fit,"CG")
# plot(x=jflselkirk1415.3P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.3P.1.n.pred.NM <- CatDynPred(jflselkirk1415.3P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk1415.3P.1.n.pred.NM,                                           ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1415,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk1415.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1415.3P.1.ln.fit,"spg")   
# plot(x=jflselkirk1415.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1415.3P.1.ln.fit,"CG")
# plot(x=jflselkirk1415.3P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.3P.1.ln.pred.NM <- CatDynPred(jflselkirk1415.3P.1.ln.fit,"Nelder-Mead")
plot(x=jflselkirk1415.3P.1.ln.pred.NM,                                          ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 5
P4.ini      <- 5
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 48, 
                 57,                                                             # the week of one input of abundance
                 59,
                 tail(jflselkirk1415$Data$nasas$time.step,1))
#
jflselkirk1415.4P.apn.ini <- catdynexp(x=jflselkirk1415,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1415.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1415.4P.1.apn.fit  <- CatDynFit(x=jflselkirk1415,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflselkirk1415.4P.1.apn.pred.spg <- CatDynPred(jflselkirk1415.4P.1.apn.fit,"spg") 
# plot(x=jflselkirk1415.4P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.apn.pred.CG <- CatDynPred(jflselkirk1415.4P.1.apn.fit,"CG")
# plot(x=jflselkirk1415.4P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.apn.pred.NM <- CatDynPred(jflselkirk1415.4P.1.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1415.4P.1.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.4P.1.apln.fit  <- CatDynFit(x=jflselkirk1415,                    
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1415.4P.1.apln.pred.spg <- CatDynPred(jflselkirk1415.4P.1.apln.fit,"spg") 
# plot(x=jflselkirk1415.4P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.apln.pred.CG <- CatDynPred(jflselkirk1415.4P.1.apln.fit,"CG")
# plot(x=jflselkirk1415.4P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.4P.1.apln.pred.NM <- CatDynPred(jflselkirk1415.4P.1.apln.fit,"Nelder-Mead")
plot(x=jflselkirk1415.4P.1.apln.pred.NM,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.4P.1.n.fit  <- CatDynFit(x=jflselkirk1415,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflselkirk1415.4P.1.n.pred.spg <- CatDynPred(jflselkirk1415.4P.1.n.fit,"spg")
# plot(x=jflselkirk1415.4P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.n.pred.CG <- CatDynPred(jflselkirk1415.4P.1.n.fit,"CG")
# plot(x=jflselkirk1415.4P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1415.4P.1.n.pred.NM <- CatDynPred(jflselkirk1415.4P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk1415.4P.1.n.pred.NM,                                           ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.4P.1.ln.fit  <- CatDynFit(x=jflselkirk1415,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk1415.4P.1.ln.pred.spg <- CatDynPred(jflselkirk1415.4P.1.ln.fit,"spg")   
# plot(x=jflselkirk1415.4P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.ln.pred.CG <- CatDynPred(jflselkirk1415.4P.1.ln.fit,"CG")
# plot(x=jflselkirk1415.4P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1415.4P.1.ln.pred.NM <- CatDynPred(jflselkirk1415.4P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1415.4P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1415.1P.1.apn.fit, ###01
           jflselkirk1415.2P.2.apn.fit, ###02
           jflselkirk1415.3P.1.apn.fit, ###03
           jflselkirk1415.3P.1.apln.fit,###04
           jflselkirk1415.3P.1.n.fit,   ###05
           jflselkirk1415.3P.1.ln.fit)  ###06
m1 <- c("Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead")
# Take out variants with gradients > 1
jflselkirk1415.sum.0  <- CatDynSum(x=x1,season="2014-2015",method=m1)
jflselkirk1415.sum.1  <- jflselkirk1415.sum.0[jflselkirk1415.sum.0$Max.Abs.Grads.<1,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1415.sum.1))],                     
          ttl=paste(jflselkirk1415.sum.1$Model,
                    substring(jflselkirk1415.sum.1$Distribution, 1,8),
                    jflselkirk1415.sum.1$Method,
                    as.numeric(row.names(jflselkirk1415.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk1415.sum.1))],
          arr=c(3,1))
# All bad
#
(jflselkirk1415.3P.1.apn.NM.partable  <- CatDynPar(x=jflselkirk1415.3P.1.apn.fit,method="Nelder-Mead")) ###03
(jflselkirk1415.3P.1.apln.NM.partable <- CatDynPar(x=jflselkirk1415.3P.1.apln.fit,method="Nelder-Mead"))###04
(jflselkirk1415.3P.1.n.NM.partable    <- CatDynPar(x=jflselkirk1415.3P.1.n.fit,method="Nelder-Mead"))   ###05
#
plot(x=jflselkirk1415.3P.1.apln.pred.NM,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1415.sum.0$Sel.Model[4] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.7.- Depletion models season: 2015-2016                                   #
################################################################################
#
# Data object
#
jflselkirk1516  <- as.CatDynData(x=cateff1.Selkirk.1516,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2015-09-28","2016-05-02"))
#
plot(x=jflselkirk1516,mark=TRUE,offset=c(9,10,4),hem="S")                       # 41 43 52 58 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1516$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 83.32168
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1516$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1516$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1516.0P.apn.ini <- catdynexp(x=jflselkirk1516,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1516.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1516.0P.apn.fit  <- CatDynFit(x=jflselkirk1516,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1516.0P.apn.pred.spg <- CatDynPred(jflselkirk1516.0P.apn.fit,"spg")   # 43 57
plot(x=jflselkirk1516.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.0P.apn.pred.CG <- CatDynPred(jflselkirk1516.0P.apn.fit,"CG")     # 43 57
plot(x=jflselkirk1516.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.0P.apln.fit  <- CatDynFit(x=jflselkirk1516,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1516.0P.apln.pred.spg <- CatDynPred(jflselkirk1516.0P.apln.fit,"spg") # 41 58
plot(x=jflselkirk1516.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.0P.apln.pred.CG <- CatDynPred(jflselkirk1516.0P.apln.fit,"CG")   # 41 58
plot(x=jflselkirk1516.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 45
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1516$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflselkirk1516$Data$nasas$time.step,1))
#
jflselkirk1516.1P.apn.ini <- catdynexp(x=jflselkirk1516,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1516.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1516.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1516,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1516.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1516.1P.1.apn.fit,"spg")
plot(x=jflselkirk1516.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1516.1P.1.apn.fit,"CG")
plot(x=jflselkirk1516.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1516,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1516.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1516.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1516.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1516.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1516.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1516$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1516$Data$nasas$obscat.thou))^2)
#
jflselkirk1516.1P.1.n.fit  <- CatDynFit(x=jflselkirk1516,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1516.1P.1.n.pred.spg <- CatDynPred(jflselkirk1516.1P.1.n.fit,"spg")
plot(x=jflselkirk1516.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.n.pred.CG <- CatDynPred(jflselkirk1516.1P.1.n.fit,"CG")
plot(x=jflselkirk1516.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1516,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1516.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1516.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1516.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1516.1P.1.ln.fit,"CG")
plot(x=jflselkirk1516.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 45
P2.ini      <- 30
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1516$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 57,                                                            # the week of one input of abundance
                 tail(jflselkirk1516$Data$nasas$time.step,1))
#
jflselkirk1516.2P.apn.ini <- catdynexp(x=jflselkirk1516,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1516.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1516.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1516,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1516.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1516.2P.1.apn.fit,"spg")
plot(x=jflselkirk1516.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1516.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1516.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1516,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1516.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1516.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1516.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1516.2P.1.apln.fit,"CG")
plot(x=jflselkirk1516.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.n.fit  <- CatDynFit(x=jflselkirk1516,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1516.2P.1.n.pred.spg <- CatDynPred(jflselkirk1516.2P.1.n.fit,"spg")
plot(x=jflselkirk1516.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.n.pred.CG <- CatDynPred(jflselkirk1516.2P.1.n.fit,"CG")
plot(x=jflselkirk1516.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1516,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1516.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1516.2P.1.ln.fit,"spg")
plot(x=jflselkirk1516.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1516.2P.1.ln.fit,"CG")
plot(x=jflselkirk1516.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 25
P2.ini      <- 40
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1516$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 54,                                                            # the week of one input of abundance
                 tail(jflselkirk1516$Data$nasas$time.step,1))
#
jflselkirk1516.2P.apn.ini <- catdynexp(x=jflselkirk1516,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1516.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1516.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1516,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1516.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1516.2P.2.apn.fit,"spg")
plot(x=jflselkirk1516.2P.2.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1516.2P.2.apn.fit,"CG")   
plot(x=jflselkirk1516.2P.2.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1516,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1516.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1516.2P.2.apln.fit,"spg") 
# plot(x=jflselkirk1516.2P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1516.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1516.2P.2.apln.fit,"CG")
# plot(x=jflselkirk1516.2P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1516.2P.2.n.fit  <- CatDynFit(x=jflselkirk1516,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1516.2P.2.n.pred.spg <- CatDynPred(jflselkirk1516.2P.2.n.fit,"spg")
plot(x=jflselkirk1516.2P.2.n.pred.spg,                                          ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.2.n.pred.CG <- CatDynPred(jflselkirk1516.2P.2.n.fit,"CG")
plot(x=jflselkirk1516.2P.2.n.pred.CG,                                           ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1516,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1516.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1516.2P.2.ln.fit,"spg")
# plot(x=jflselkirk1516.2P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1516.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1516.2P.2.ln.fit,"CG")
# plot(x=jflselkirk1516.2P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 25
P2.ini      <- 40
P3.ini      <- 5
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 54,                                                            # the week of one input of abundance
                 58,
                 tail(jflselkirk1516$Data$nasas$time.step,1))
#
jflselkirk1516.3P.apn.ini <- catdynexp(x=jflselkirk1516,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1516.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1516.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1516,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1516.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1516.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1516.3P.1.apn.pred.spg,                                        ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1516.3P.1.apn.fit,"CG")
plot(x=jflselkirk1516.3P.1.apn.pred.CG,                                         ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1516,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1516.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1516.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1516.3P.1.apln.pred.spg,                                       ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1516.3P.1.apln.fit,"CG")
plot(x=jflselkirk1516.3P.1.apln.pred.CG,                                        ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.n.fit  <- CatDynFit(x=jflselkirk1516,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1516.3P.1.n.pred.spg <- CatDynPred(jflselkirk1516.3P.1.n.fit,"spg")
plot(x=jflselkirk1516.3P.1.n.pred.spg,                                          ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.n.pred.CG <- CatDynPred(jflselkirk1516.3P.1.n.fit,"CG")
plot(x=jflselkirk1516.3P.1.n.pred.CG,                                           ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1516,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1516.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1516.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1516.3P.1.ln.pred.spg,                                         ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1516.3P.1.ln.fit,"CG")
plot(x=jflselkirk1516.3P.1.ln.pred.CG,                                          ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection                                                       
x1 <- list(jflselkirk1516.1P.1.apn.fit, ###01
           jflselkirk1516.1P.1.apn.fit, ###02
           jflselkirk1516.1P.1.apln.fit,###03
           jflselkirk1516.1P.1.apln.fit,###04
           jflselkirk1516.1P.1.n.fit,   ###05
           jflselkirk1516.1P.1.n.fit,   ###06
           jflselkirk1516.1P.1.ln.fit,  ###07
           jflselkirk1516.1P.1.ln.fit,  ###08
           jflselkirk1516.2P.1.apn.fit, ###09
           jflselkirk1516.2P.1.apn.fit, ###10
           jflselkirk1516.2P.1.apln.fit,###11
           jflselkirk1516.2P.1.apln.fit,###12
           jflselkirk1516.2P.1.n.fit,   ###13
           jflselkirk1516.2P.1.n.fit,   ###14
           jflselkirk1516.2P.1.ln.fit,  ###15
           jflselkirk1516.2P.1.ln.fit,  ###16
           jflselkirk1516.2P.2.apn.fit, ###17
           jflselkirk1516.2P.2.apn.fit, ###18
           jflselkirk1516.2P.2.n.fit,   ###19
           jflselkirk1516.2P.2.n.fit,   ###20
           jflselkirk1516.3P.1.apn.fit, ###21
           jflselkirk1516.3P.1.apn.fit, ###22
           jflselkirk1516.3P.1.apln.fit,###23
           jflselkirk1516.3P.1.apln.fit,###24
           jflselkirk1516.3P.1.n.fit,   ###25
           jflselkirk1516.3P.1.n.fit,   ###26
           jflselkirk1516.3P.1.ln.fit,  ###27
           jflselkirk1516.3P.1.ln.fit)  ###28
m1 <- rep(c("spg","CG"),14)
# Take out variants with gradients > 1
jflselkirk1516.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
jflselkirk1516.sum.1  <- jflselkirk1516.sum.0[jflselkirk1516.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jflselkirk1516.sum.1[jflselkirk1516.sum.1$Distribution=="apnormal",]
jflselkirk1516.sum.1[jflselkirk1516.sum.1$Distribution=="aplnormal",]
jflselkirk1516.sum.1[jflselkirk1516.sum.1$Distribution=="normal",]
jflselkirk1516.sum.1[jflselkirk1516.sum.1$Distribution=="lognormal",]
# 3P better in all likelihoods
jflselkirk1516.sum.2 <- jflselkirk1516.sum.1[jflselkirk1516.sum.1$Model %in% c("3P"),]
#jflselkirk1516.sum.1 <- jflselkirk1516.sum.0[17:24,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1516.sum.2))],                     
          ttl=paste(jflselkirk1516.sum.2$Model,
                    substring(jflselkirk1516.sum.2$Distribution, 1,8),
                    jflselkirk1516.sum.2$Method,
                    as.numeric(row.names(jflselkirk1516.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk1516.sum.2))],
          arr=c(4,2))
# Best correlations in variant ###21
(jflselkirk1516.3P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk1516.3P.1.apn.fit,method="spg"))   ###21
#
plot(x=jflselkirk1516.3P.1.apn.pred.spg,                                        ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1516.sum.0$Sel.Model[21] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.8.- Depletion models season: 2016-2017                                   #
################################################################################
#
# Data object
#
jflselkirk1617  <- as.CatDynData(x=cateff1.Selkirk.1617,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2016-09-19","2017-05-15"))
#
plot(x=jflselkirk1617,mark=TRUE,offset=c(9,10,4),hem="S")                       # 39 51 54 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1617$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 70.0496
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1617$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1617.0P.apn.ini <- catdynexp(x=jflselkirk1617,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1617.0P.apn.fit  <- CatDynFit(x=jflselkirk1617,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.0P.apn.pred.spg <- CatDynPred(jflselkirk1617.0P.apn.fit,"spg")   # 39 54
plot(x=jflselkirk1617.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.0P.apn.pred.CG <- CatDynPred(jflselkirk1617.0P.apn.fit,"CG")     # 39 54
plot(x=jflselkirk1617.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.0P.apln.fit  <- CatDynFit(x=jflselkirk1617,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.0P.apln.pred.spg <- CatDynPred(jflselkirk1617.0P.apln.fit,"spg") # 39
plot(x=jflselkirk1617.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.0P.apln.pred.CG <- CatDynPred(jflselkirk1617.0P.apln.fit,"CG")   # 39
plot(x=jflselkirk1617.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 15
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,                                                            # the week of one input of abundance
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.1P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1617.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1617.1P.1.apn.fit,"spg")
plot(x=jflselkirk1617.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1617.1P.1.apn.fit,"CG")
plot(x=jflselkirk1617.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1617.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1617.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1617.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1617.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1617.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1617$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1617$Data$nasas$obscat.thou))^2)
#
jflselkirk1617.1P.1.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.1P.1.n.pred.spg <- CatDynPred(jflselkirk1617.1P.1.n.fit,"spg")
plot(x=jflselkirk1617.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.n.pred.CG <- CatDynPred(jflselkirk1617.1P.1.n.fit,"CG")
plot(x=jflselkirk1617.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1617.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1617.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1617.1P.1.ln.fit,"CG")
plot(x=jflselkirk1617.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*45
P1.ini      <- 15
P2.ini      <- 30
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 54,                                                            # the week of one input of abundance
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.2P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1617.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1617.2P.1.apn.fit,"spg")
plot(x=jflselkirk1617.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1617.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1617.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1617.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1617.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1617.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1617.2P.1.apln.fit,"CG")
plot(x=jflselkirk1617.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.2P.1.n.pred.spg <- CatDynPred(jflselkirk1617.2P.1.n.fit,"spg")
plot(x=jflselkirk1617.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.n.pred.CG <- CatDynPred(jflselkirk1617.2P.1.n.fit,"CG")
plot(x=jflselkirk1617.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1617.2P.1.ln.fit,"spg")
plot(x=jflselkirk1617.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1617.2P.1.ln.fit,"CG")
plot(x=jflselkirk1617.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*25
P1.ini      <- 15
P2.ini      <- 30
P3.ini      <- 35
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 39,
                 51,                                                            # the week of one input of abundance
                 54,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.3P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1617.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1617.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1617.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1617.3P.1.apn.fit,"CG")
plot(x=jflselkirk1617.3P.1.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1617.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1617.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1617.3P.1.apln.pred.spg,                                       ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1617.3P.1.apln.fit,"CG")
plot(x=jflselkirk1617.3P.1.apln.pred.CG,                                        ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.3P.1.n.pred.spg <- CatDynPred(jflselkirk1617.3P.1.n.fit,"spg")
plot(x=jflselkirk1617.3P.1.n.pred.spg,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.n.pred.CG <- CatDynPred(jflselkirk1617.3P.1.n.fit,"CG")
plot(x=jflselkirk1617.3P.1.n.pred.CG,                                           ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1617.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1617.3P.1.ln.pred.spg,                                         ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1617.3P.1.ln.fit,"CG")
plot(x=jflselkirk1617.3P.1.ln.pred.CG,                                          ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*25
P1.ini      <- 15
P2.ini      <- 10
P3.ini      <- 55
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 47,                                                            # the week of one input of abundance
                 51,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.3P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.3P.2.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="spg",#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1617.3P.2.apn.pred.spg <- CatDynPred(jflselkirk1617.3P.2.apn.fit,"spg") 
plot(x=jflselkirk1617.3P.2.apn.pred.spg,                                        ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.3P.2.apn.pred.CG <- CatDynPred(jflselkirk1617.3P.2.apn.fit,"CG")
# plot(x=jflselkirk1617.3P.2.apn.pred.CG,                                     
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.3P.2.apn.pred.NM <- CatDynPred(jflselkirk1617.3P.2.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.3P.2.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.3P.2.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1617.3P.2.apln.pred.spg <- CatDynPred(jflselkirk1617.3P.2.apln.fit,"spg") 
plot(x=jflselkirk1617.3P.2.apln.pred.spg,                                       ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.2.apln.pred.CG <- CatDynPred(jflselkirk1617.3P.2.apln.fit,"CG")
plot(x=jflselkirk1617.3P.2.apln.pred.CG,                                        ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.2.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method="spg",#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.3P.2.n.pred.spg <- CatDynPred(jflselkirk1617.3P.2.n.fit,"spg")
plot(x=jflselkirk1617.3P.2.n.pred.spg,                                          ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.3P.2.n.pred.CG <- CatDynPred(jflselkirk1617.3P.2.n.fit,"CG")
# plot(x=jflselkirk1617.3P.2.n.pred.CG,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.3P.2.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.3P.2.ln.pred.spg <- CatDynPred(jflselkirk1617.3P.2.ln.fit,"spg")   
plot(x=jflselkirk1617.3P.2.ln.pred.spg,                                         ###29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.3P.2.ln.pred.CG <- CatDynPred(jflselkirk1617.3P.2.ln.fit,"CG")
plot(x=jflselkirk1617.3P.2.ln.pred.CG,                                          ###30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*25
P1.ini      <- 5
P2.ini      <- 30
P3.ini      <- 35
P4.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 47,                                                            # the week of one input of abundance
                 51,
                 54,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.4P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant                                  
jflselkirk1617.4P.1.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1617.4P.1.apn.pred.spg <- CatDynPred(jflselkirk1617.4P.1.apn.fit,"spg") 
plot(x=jflselkirk1617.4P.1.apn.pred.spg,                                        ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.apn.pred.CG <- CatDynPred(jflselkirk1617.4P.1.apn.fit,"CG")
plot(x=jflselkirk1617.4P.1.apn.pred.CG,                                         ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1617.4P.1.apln.pred.spg <- CatDynPred(jflselkirk1617.4P.1.apln.fit,"spg") 
plot(x=jflselkirk1617.4P.1.apln.pred.spg,                                       ###33
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.apln.pred.CG <- CatDynPred(jflselkirk1617.4P.1.apln.fit,"CG")
plot(x=jflselkirk1617.4P.1.apln.pred.CG,                                        ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.4P.1.n.pred.spg <- CatDynPred(jflselkirk1617.4P.1.n.fit,"spg")
plot(x=jflselkirk1617.4P.1.n.pred.spg,                                          ###35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.n.pred.CG <- CatDynPred(jflselkirk1617.4P.1.n.fit,"CG")
plot(x=jflselkirk1617.4P.1.n.pred.CG,                                           ###36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.4P.1.ln.pred.spg <- CatDynPred(jflselkirk1617.4P.1.ln.fit,"spg")   
plot(x=jflselkirk1617.4P.1.ln.pred.spg,                                         ###37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.4P.1.ln.pred.CG <- CatDynPred(jflselkirk1617.4P.1.ln.fit,"CG")
plot(x=jflselkirk1617.4P.1.ln.pred.CG,                                          ###38
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 4 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*25
P1.ini      <- 5
P2.ini      <- 30
P3.ini      <- 35
P4.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 54,
                 63,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.4P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant                                  
# jflselkirk1617.4P.2.apn.fit  <- CatDynFit(x=jflselkirk1617,
#                                           p=4,
#                                           par=pars.ini.4P,
#                                           dates=dates.4P,
#                                           distr="apnormal",
#                                           method=c("spg","CG"),
#                                           itnmax=50000)
# #
# jflselkirk1617.4P.2.apn.pred.spg <- CatDynPred(jflselkirk1617.4P.2.apn.fit,"spg") 
# plot(x=jflselkirk1617.4P.2.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1617.4P.2.apn.pred.CG <- CatDynPred(jflselkirk1617.4P.2.apn.fit,"CG")
# plot(x=jflselkirk1617.4P.2.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
jflselkirk1617.4P.2.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1617.4P.2.apln.pred.spg <- CatDynPred(jflselkirk1617.4P.2.apln.fit,"spg") 
# plot(x=jflselkirk1617.4P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1617.4P.2.apln.pred.CG <- CatDynPred(jflselkirk1617.4P.2.apln.fit,"CG")
# plot(x=jflselkirk1617.4P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.4P.2.n.fit  <- CatDynFit(x=jflselkirk1617,
#                                         p=4,
#                                         par=c(pars.ini.4P,psi.n.ini),
#                                         dates=dates.4P,
#                                         distr="normal",
#                                         method=c("spg","CG"),
#                                         itnmax=50000)
# #
# jflselkirk1617.4P.2.n.pred.spg <- CatDynPred(jflselkirk1617.4P.2.n.fit,"spg")
# plot(x=jflselkirk1617.4P.2.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1617.4P.2.n.pred.CG <- CatDynPred(jflselkirk1617.4P.2.n.fit,"CG")
# plot(x=jflselkirk1617.4P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1617.4P.2.ln.fit  <- CatDynFit(x=jflselkirk1617,
#                                          p=4,
#                                          par=c(pars.ini.4P,psi.ln.ini),
#                                          dates=dates.4P,
#                                          distr="lognormal",
#                                          method=c("spg","CG"),
#                                          itnmax=50000)
# #
# jflselkirk1617.4P.2.ln.pred.spg <- CatDynPred(jflselkirk1617.4P.2.ln.fit,"spg")   
# plot(x=jflselkirk1617.4P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1617.4P.2.ln.pred.CG <- CatDynPred(jflselkirk1617.4P.2.ln.fit,"CG")
# plot(x=jflselkirk1617.4P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 5 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 2.5*25
P1.ini      <- 5
P2.ini      <- 10
P3.ini      <- 5
P4.ini      <- 5
P5.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 47,                                                            # the week of one input of abundance
                 51,
                 54,
                 57,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.5P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.5P.1.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1617.5P.1.apn.pred.spg <- CatDynPred(jflselkirk1617.5P.1.apn.fit,"spg") 
plot(x=jflselkirk1617.5P.1.apn.pred.spg,                                        ###39
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.1.apn.pred.CG <- CatDynPred(jflselkirk1617.5P.1.apn.fit,"CG")
plot(x=jflselkirk1617.5P.1.apn.pred.CG,                                         ###40
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.5P.1.apn.pred.NM <- CatDynPred(jflselkirk1617.5P.1.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.5P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.5P.1.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jflselkirk1617.5P.1.apln.pred.spg <- CatDynPred(jflselkirk1617.5P.1.apln.fit,"spg") 
plot(x=jflselkirk1617.5P.1.apln.pred.spg,                                       ###41 ***
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.1.apln.pred.CG <- CatDynPred(jflselkirk1617.5P.1.apln.fit,"CG")
plot(x=jflselkirk1617.5P.1.apln.pred.CG,                                        ###42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.5P.1.apln.pred.NM <- CatDynPred(jflselkirk1617.5P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.5P.1.apln.pred.NM,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.5P.1.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1617.5P.1.n.pred.spg <- CatDynPred(jflselkirk1617.5P.1.n.fit,"spg")
plot(x=jflselkirk1617.5P.1.n.pred.spg,                                          ###43
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.1.n.pred.CG <- CatDynPred(jflselkirk1617.5P.1.n.fit,"CG")
plot(x=jflselkirk1617.5P.1.n.pred.CG,                                           ###44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.1.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1617.5P.1.ln.pred.spg <- CatDynPred(jflselkirk1617.5P.1.ln.fit,"spg")   
plot(x=jflselkirk1617.5P.1.ln.pred.spg,                                         ###45 ***
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.1.ln.pred.CG <- CatDynPred(jflselkirk1617.5P.1.ln.fit,"CG")
plot(x=jflselkirk1617.5P.1.ln.pred.CG,                                          ###46
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.5P.1.ln.pred.NM <- CatDynPred(jflselkirk1617.5P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.5P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 5 input depletion variant                                  
M.ini       <- 3*0.001937482
N0.ini      <- 1*25
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 25
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 1.5e-3                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk1617$Data$nasas$time.step,1),                   # now the dates vector also has
                 39,
                 47,                                                            # the week of one input of abundance
                 49,
                 51,
                 54,
                 tail(jflselkirk1617$Data$nasas$time.step,1))
#
jflselkirk1617.5P.apn.ini <- catdynexp(x=jflselkirk1617,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk1617.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1617.5P.2.apn.fit  <- CatDynFit(x=jflselkirk1617,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk1617.5P.2.apn.pred.spg <- CatDynPred(jflselkirk1617.5P.2.apn.fit,"spg")
plot(x=jflselkirk1617.5P.2.apn.pred.spg,                                        ###47
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.apn.pred.CG <- CatDynPred(jflselkirk1617.5P.2.apn.fit,"CG")
# plot(x=jflselkirk1617.5P.2.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.5P.2.apn.pred.NM <- CatDynPred(jflselkirk1617.5P.2.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1617.5P.2.apn.pred.NM,                                         ###48 *
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.2.apln.fit  <- CatDynFit(x=jflselkirk1617,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk1617.5P.2.apln.pred.spg <- CatDynPred(jflselkirk1617.5P.2.apln.fit,"spg")
# plot(x=jflselkirk1617.5P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.apln.pred.CG <- CatDynPred(jflselkirk1617.5P.2.apln.fit,"CG")
# plot(x=jflselkirk1617.5P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.apln.pred.NM <- CatDynPred(jflselkirk1617.5P.2.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.5P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.5P.2.n.fit  <- CatDynFit(x=jflselkirk1617,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jflselkirk1617.5P.2.n.pred.spg <- CatDynPred(jflselkirk1617.5P.2.n.fit,"spg")
plot(x=jflselkirk1617.5P.2.n.pred.spg,                                          ###49
     leg.pos="topright",
     Biom.tstep=1, 
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.n.pred.CG <- CatDynPred(jflselkirk1617.5P.2.n.fit,"CG")
# plot(x=jflselkirk1617.5P.2.n.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1617.5P.2.n.pred.NM <- CatDynPred(jflselkirk1617.5P.2.n.fit,"Nelder-Mead")
plot(x=jflselkirk1617.5P.2.n.pred.NM,                                           ###50 *
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.5P.2.ln.fit  <- CatDynFit(x=jflselkirk1617,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk1617.5P.2.ln.pred.spg <- CatDynPred(jflselkirk1617.5P.2.ln.fit,"spg")
# plot(x=jflselkirk1617.5P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.ln.pred.CG <- CatDynPred(jflselkirk1617.5P.2.ln.fit,"CG")
# plot(x=jflselkirk1617.5P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1617.5P.2.ln.pred.NM <- CatDynPred(jflselkirk1617.5P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1617.5P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1617.1P.1.apn.fit, ###01
           jflselkirk1617.1P.1.apn.fit, ###02
           jflselkirk1617.1P.1.apln.fit,###03
           jflselkirk1617.1P.1.apln.fit,###04
           jflselkirk1617.1P.1.n.fit,   ###05
           jflselkirk1617.1P.1.n.fit,   ###06
           jflselkirk1617.1P.1.ln.fit,  ###07
           jflselkirk1617.1P.1.ln.fit,  ###08
           jflselkirk1617.2P.1.apn.fit, ###09
           jflselkirk1617.2P.1.apn.fit, ###10
           jflselkirk1617.2P.1.apln.fit,###11
           jflselkirk1617.2P.1.apln.fit,###12
           jflselkirk1617.2P.1.n.fit,   ###13
           jflselkirk1617.2P.1.n.fit,   ###14
           jflselkirk1617.2P.1.ln.fit,  ###15
           jflselkirk1617.2P.1.ln.fit,  ###16
           jflselkirk1617.3P.1.apn.fit, ###17
           jflselkirk1617.3P.1.apn.fit, ###18
           jflselkirk1617.3P.1.apln.fit,###19
           jflselkirk1617.3P.1.apln.fit,###20
           jflselkirk1617.3P.1.n.fit,   ###21
           jflselkirk1617.3P.1.n.fit,   ###22
           jflselkirk1617.3P.1.ln.fit,  ###23
           jflselkirk1617.3P.1.ln.fit,  ###24
           jflselkirk1617.3P.2.apn.fit, ###25
           jflselkirk1617.3P.2.apln.fit,###26
           jflselkirk1617.3P.2.apln.fit,###27
           jflselkirk1617.3P.2.n.fit,   ###28
           jflselkirk1617.3P.2.ln.fit,  ###29
           jflselkirk1617.3P.2.ln.fit,  ###30
           jflselkirk1617.4P.1.apn.fit, ###31
           jflselkirk1617.4P.1.apn.fit, ###32
           jflselkirk1617.4P.1.apln.fit,###33
           jflselkirk1617.4P.1.apln.fit,###34
           jflselkirk1617.4P.1.n.fit,   ###35
           jflselkirk1617.4P.1.n.fit,   ###36
           jflselkirk1617.4P.1.ln.fit,  ###37
           jflselkirk1617.4P.1.ln.fit,  ###38
           jflselkirk1617.5P.1.apn.fit, ###39
           jflselkirk1617.5P.1.apn.fit, ###40
           jflselkirk1617.5P.1.apln.fit,###41
           jflselkirk1617.5P.1.apln.fit,###42
           jflselkirk1617.5P.1.n.fit,   ###43
           jflselkirk1617.5P.1.n.fit,   ###44
           jflselkirk1617.5P.1.ln.fit,  ###45
           jflselkirk1617.5P.1.ln.fit,  ###46
           jflselkirk1617.5P.2.apn.fit, ###47
           jflselkirk1617.5P.2.apn.fit, ###48 *
           jflselkirk1617.5P.2.n.fit,   ###49
           jflselkirk1617.5P.2.n.fit)   ###50 *
m1 <- c(rep(c("spg","CG"),4),
        rep(c("spg","CG"),4),
        rep(c("spg","CG"),4),"spg","spg","CG","spg","spg","CG",
        rep(c("spg","CG"),4),
        rep(c("spg","CG"),4),"spg","Nelder-Mead","spg","Nelder-Mead")
# Take out variants with gradients > 1
jflselkirk1617.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
jflselkirk1617.sum.1  <- jflselkirk1617.sum.0[jflselkirk1617.sum.0$Max.Abs.Grads.<1,]
# All gradients good
# AIC within variants weith same likelihood
jflselkirk1617.sum.1[jflselkirk1617.sum.1$Distribution=="apnormal",]
jflselkirk1617.sum.1[jflselkirk1617.sum.1$Distribution=="aplnormal",]
jflselkirk1617.sum.1[jflselkirk1617.sum.1$Distribution=="normal",]
jflselkirk1617.sum.1[jflselkirk1617.sum.1$Distribution=="lognormal",]
# 4P and 5P better in apn, n, rP better im ln
jflselkirk1617.sum.2 <- jflselkirk1617.sum.1[jflselkirk1617.sum.1$Model %in% c("4P", "5P"),]
#jflselkirk1617.sum.1 <- jflselkirk1617.sum.0[17:24,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1617.sum.2))],                     
          ttl=paste(jflselkirk1617.sum.2$Model,
                    substring(jflselkirk1617.sum.2$Distribution, 1,8),
                    jflselkirk1617.sum.2$Method,
                    as.numeric(row.names(jflselkirk1617.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk1617.sum.2))],
          arr=c(4,5))
# Best correlations in variants ###36, ###46, ###48
jflselkirk1617.sum.3 <- jflselkirk1617.sum.2[which(row.names(jflselkirk1617.sum.2) %in% 
                                                     c("36","46","48")),]
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1617.sum.3))],                     
          ttl=paste(jflselkirk1617.sum.3$Model,
                    substring(jflselkirk1617.sum.3$Distribution, 1,8),
                    jflselkirk1617.sum.3$Method,
                    as.numeric(row.names(jflselkirk1617.sum.3))),
          method=m1[as.numeric(row.names(jflselkirk1617.sum.3))],
          arr=c(3,1))
#
(jflselkirk1617.4P.1.n.CG.partable     <- CatDynPar(x=jflselkirk1617.4P.1.n.fit,method="CG"))            ###36
(jflselkirk1617.5P.1.ln.CG.partable    <- CatDynPar(x=jflselkirk1617.5P.1.ln.fit,method="CG"))           ###46
(jflselkirk1617.5P.2.apn.NM.partable   <- CatDynPar(x=jflselkirk1617.5P.2.apn.fit,method="Nelder-Mead")) ###48
#
plot(x=jflselkirk1617.5P.2.apn.pred.NM,                                         ###48
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1617.sum.0$Sel.Model[47] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.9.- Depletion models season: 2017-2018                                   #
################################################################################
#
# Data object
#
jflselkirk1718  <- as.CatDynData(x=cateff1.Selkirk.1718,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2017-10-09","2018-05-07"))
#
plot(x=jflselkirk1718,mark=TRUE,offset=c(9,10,4),hem="S")                       # 42 45 48 52 67 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1718$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 57.55674
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1718$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1718$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk1718.0P.apn.ini <- catdynexp(x=jflselkirk1718,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1718.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1718.0P.apn.fit  <- CatDynFit(x=jflselkirk1718,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1718.0P.apn.pred.spg <- CatDynPred(jflselkirk1718.0P.apn.fit,"spg")   # 45 52 67
plot(x=jflselkirk1718.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.0P.apn.pred.CG <- CatDynPred(jflselkirk1718.0P.apn.fit,"CG")     # 45 52 67
plot(x=jflselkirk1718.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.0P.apln.fit  <- CatDynFit(x=jflselkirk1718,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1718.0P.apln.pred.spg <- CatDynPred(jflselkirk1718.0P.apln.fit,"spg") # 52 67
plot(x=jflselkirk1718.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.0P.apln.pred.CG <- CatDynPred(jflselkirk1718.0P.apln.fit,"CG")   # 52 67
plot(x=jflselkirk1718.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 25
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1718$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,                                                            # the week of one input of abundance
                 tail(jflselkirk1718$Data$nasas$time.step,1))
#
jflselkirk1718.1P.apn.ini <- catdynexp(x=jflselkirk1718,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1718.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1718.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1718,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1718.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1718.1P.1.apn.fit,"spg")
plot(x=jflselkirk1718.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1718.1P.1.apn.fit,"CG")
plot(x=jflselkirk1718.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1718,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1718.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1718.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1718.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1718.1P.1.apln.fit,"CG") 
plot(x=jflselkirk1718.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1718$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1718$Data$nasas$obscat.thou))^2)
#
jflselkirk1718.1P.1.n.fit  <- CatDynFit(x=jflselkirk1718,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1718.1P.1.n.pred.spg <- CatDynPred(jflselkirk1718.1P.1.n.fit,"spg")
plot(x=jflselkirk1718.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.n.pred.CG <- CatDynPred(jflselkirk1718.1P.1.n.fit,"CG")
plot(x=jflselkirk1718.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1718,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1718.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1718.1P.1.ln.fit,"spg")   
plot(x=jflselkirk1718.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1718.1P.1.ln.fit,"CG")
plot(x=jflselkirk1718.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 10
P2.ini      <- 20
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1718$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 52,                                                            # the week of one input of abundance
                 tail(jflselkirk1718$Data$nasas$time.step,1))
#
jflselkirk1718.2P.apn.ini <- catdynexp(x=jflselkirk1718,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1718.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 2-inputs depletion variant
jflselkirk1718.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1718,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1718.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1718.2P.1.apn.fit,"spg")
plot(x=jflselkirk1718.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1718.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1718.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1718,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1718.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1718.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1718.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1718.2P.1.apln.fit,"CG")
plot(x=jflselkirk1718.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.n.fit  <- CatDynFit(x=jflselkirk1718,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1718.2P.1.n.pred.spg <- CatDynPred(jflselkirk1718.2P.1.n.fit,"spg")
plot(x=jflselkirk1718.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.n.pred.CG <- CatDynPred(jflselkirk1718.2P.1.n.fit,"CG")
plot(x=jflselkirk1718.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1718,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1718.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1718.2P.1.ln.fit,"spg")
plot(x=jflselkirk1718.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1718.2P.1.ln.fit,"CG")
plot(x=jflselkirk1718.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*49
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 20
k.ini       <- 4.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1718$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 52,                                                            # the week of one input of abundance
                 67,
                 tail(jflselkirk1718$Data$nasas$time.step,1))
#
jflselkirk1718.3P.apn.ini <- catdynexp(x=jflselkirk1718,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1718.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1718.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1718,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1718.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1718.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1718.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1718.3P.1.apn.fit,"CG")
plot(x=jflselkirk1718.3P.1.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1718,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1718.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1718.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1718.3P.1.apln.pred.spg,                                       ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1718.3P.1.apln.fit,"CG")
plot(x=jflselkirk1718.3P.1.apln.pred.CG,                                        ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.n.fit  <- CatDynFit(x=jflselkirk1718,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1718.3P.1.n.pred.spg <- CatDynPred(jflselkirk1718.3P.1.n.fit,"spg")
plot(x=jflselkirk1718.3P.1.n.pred.spg,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.n.pred.CG <- CatDynPred(jflselkirk1718.3P.1.n.fit,"CG")
plot(x=jflselkirk1718.3P.1.n.pred.CG,                                           ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1718,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1718.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1718.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1718.3P.1.ln.pred.spg,                                         ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1718.3P.1.ln.fit,"CG")
plot(x=jflselkirk1718.3P.1.ln.pred.CG,                                          ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1718.1P.1.apn.fit, ###01
           jflselkirk1718.1P.1.apn.fit, ###02
           jflselkirk1718.1P.1.apln.fit,###03
           jflselkirk1718.1P.1.apln.fit,###04
           jflselkirk1718.1P.1.n.fit,   ###05
           jflselkirk1718.1P.1.n.fit,   ###06
           jflselkirk1718.1P.1.ln.fit,  ###07
           jflselkirk1718.1P.1.ln.fit,  ###08
           jflselkirk1718.2P.1.apn.fit, ###09
           jflselkirk1718.2P.1.apn.fit, ###10
           jflselkirk1718.2P.1.apln.fit,###11
           jflselkirk1718.2P.1.apln.fit,###12
           jflselkirk1718.2P.1.n.fit,   ###13
           jflselkirk1718.2P.1.n.fit,   ###14
           jflselkirk1718.2P.1.ln.fit,  ###15
           jflselkirk1718.2P.1.ln.fit,  ###16
           jflselkirk1718.3P.1.apn.fit, ###17
           jflselkirk1718.3P.1.apn.fit, ###18
           jflselkirk1718.3P.1.apln.fit,###19
           jflselkirk1718.3P.1.apln.fit,###20
           jflselkirk1718.3P.1.n.fit,   ###21
           jflselkirk1718.3P.1.n.fit,   ###22
           jflselkirk1718.3P.1.ln.fit,  ###23
           jflselkirk1718.3P.1.ln.fit)  ###24
m1 <- rep(c("spg","CG"),12)
# Take out variants with gradients > 1
jflselkirk1718.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
#jflselkirk1718.sum.1  <- jflselkirk1718.sum.0[jflselkirk1718.sum.0$Max.Abs.Grads.<1,]
# All gradients good
# AIC within variants weith same likelihood
jflselkirk1718.sum.0[jflselkirk1718.sum.0$Distribution=="apnormal",]
jflselkirk1718.sum.0[jflselkirk1718.sum.0$Distribution=="aplnormal",]
jflselkirk1718.sum.0[jflselkirk1718.sum.0$Distribution=="normal",]
jflselkirk1718.sum.0[jflselkirk1718.sum.0$Distribution=="lognormal",]
# 3P better in all likelihoods
jflselkirk1718.sum.1 <- jflselkirk1718.sum.0[jflselkirk1718.sum.0$Model %in% c("3P"),]
#jflselkirk1718.sum.1 <- jflselkirk1718.sum.0[17:24,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1718.sum.1))],                     
          ttl=paste(jflselkirk1718.sum.1$Model,
                    substring(jflselkirk1718.sum.1$Distribution, 1,8),
                    jflselkirk1718.sum.1$Method,
                    as.numeric(row.names(jflselkirk1718.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk1718.sum.1))],
          arr=c(4,2))
# Best correlations in variants ###17, ###18, ###23, ###24
jflselkirk1718.sum.2 <- jflselkirk1718.sum.1[which(row.names(jflselkirk1718.sum.1) %in% 
                                                     c("17","18","23","24")),]
#
(jflselkirk1718.3P.1.apn.spg.partable  <- CatDynPar(x=jflselkirk1718.3P.1.apn.fit,method="spg")) ###17
(jflselkirk1718.3P.1.apn.CG.partable   <- CatDynPar(x=jflselkirk1718.3P.1.apn.fit,method="CG"))  ###18
(jflselkirk1718.3P.1.ln.spg.partable   <- CatDynPar(x=jflselkirk1718.3P.1.ln.fit,method="spg"))  ###23
(jflselkirk1718.3P.1.ln.CG.partable    <- CatDynPar(x=jflselkirk1718.3P.1.ln.fit,method="CG"))   ###24
#
plot(x=jflselkirk1718.3P.1.apn.pred.spg,                                        ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1718.sum.0$Sel.Model[18] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.10.- Depletion models season: 2018-2019                                  #
################################################################################
#
# Data object
#
cateff1.Selkirk.1819 <- rbind(cateff1.Selkirk.1819[1:5,],
                              c(2018,10,45,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1819[6:15,],
                              c(2019,10,3,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1819[16,],
                              c(2019,10,5,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2019,10,6,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1819[17,],
                              c(2019,10,8,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2019,10,9,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2019,10,10,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1819[18:22,],
                              c(2019,10,16,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1819[23:25,])
#
jflselkirk1819  <- as.CatDynData(x=cateff1.Selkirk.1819,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2018-10-01","2019-05-06"))
#
plot(x=jflselkirk1819,mark=TRUE,offset=c(9,10,4),hem="S")                       # 45 55 57 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1819$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 62.40281
M.ini       <- 3*0.001937482
N0.ini      <- 3*60
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1819$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1819.0P.apn.ini <- catdynexp(x=jflselkirk1819,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1819.0P.apn.fit  <- CatDynFit(x=jflselkirk1819,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.0P.apn.pred.spg <- CatDynPred(jflselkirk1819.0P.apn.fit,"spg")   # 55 57
plot(x=jflselkirk1819.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.0P.apn.pred.CG <- CatDynPred(jflselkirk1819.0P.apn.fit,"CG")     # 55 57
plot(x=jflselkirk1819.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.0P.apln.fit  <- CatDynFit(x=jflselkirk1819,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.0P.apln.pred.spg <- CatDynPred(jflselkirk1819.0P.apln.fit,"spg") # 55 57
plot(x=jflselkirk1819.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.0P.apln.pred.CG <- CatDynPred(jflselkirk1819.0P.apln.fit,"CG")   # 55 57
plot(x=jflselkirk1819.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*60
P1.ini      <- 25
k.ini       <- 5.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,                                                            # the week of one input of abundance
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.1P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1819.1P.1.apn.fit,"spg")
plot(x=jflselkirk1819.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.1P.1.apn.pred.NM <- CatDynPred(jflselkirk1819.1P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1819.1P.1.apn.pred.NM,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1819.1P.1.apln.fit,"spg") 
plot(x=jflselkirk1819.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.1P.1.apln.pred.NM <- CatDynPred(jflselkirk1819.1P.1.apln.fit,"Nelder-Mead") 
plot(x=jflselkirk1819.1P.1.apln.pred.NM,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1819$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1819$Data$nasas$obscat.thou+1))^2)
#
jflselkirk1819.1P.1.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),
                                        itnmax=50000)
#
jflselkirk1819.1P.1.n.pred.spg <- CatDynPred(jflselkirk1819.1P.1.n.fit,"spg")
plot(x=jflselkirk1819.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.1P.1.n.pred.NM <- CatDynPred(jflselkirk1819.1P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk1819.1P.1.n.pred.NM,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1819.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1819.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk1819.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1819.1P.1.ln.pred.NM <- CatDynPred(jflselkirk1819.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk1819.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*60
P1.ini      <- 20
P2.ini      <- 40
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 55,                                                            # the week of one input of abundance
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.2P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 2-inputs depletion variant
jflselkirk1819.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1819.2P.1.apn.fit,"spg")
plot(x=jflselkirk1819.2P.1.apn.pred.spg,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1819.2P.1.apn.fit,"CG")   
plot(x=jflselkirk1819.2P.1.apn.pred.CG,                                         ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1819.2P.1.apln.fit,"spg") 
plot(x=jflselkirk1819.2P.1.apln.pred.spg,                                       ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1819.2P.1.apln.fit,"CG")
plot(x=jflselkirk1819.2P.1.apln.pred.CG,                                        ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.2P.1.n.pred.spg <- CatDynPred(jflselkirk1819.2P.1.n.fit,"spg")
plot(x=jflselkirk1819.2P.1.n.pred.spg,                                          ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.n.pred.CG <- CatDynPred(jflselkirk1819.2P.1.n.fit,"CG")
plot(x=jflselkirk1819.2P.1.n.pred.CG,                                           ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1819.2P.1.ln.fit,"spg")
plot(x=jflselkirk1819.2P.1.ln.pred.spg,                                         ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1819.2P.1.ln.fit,"CG")
plot(x=jflselkirk1819.2P.1.ln.pred.CG,                                          ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 55,                                                            # the week of one input of abundance
                 57,
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.3P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1819.3P.1.apn.fit,"spg") 
plot(x=jflselkirk1819.3P.1.apn.pred.spg,                                        ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1819.3P.1.apn.fit,"CG")
plot(x=jflselkirk1819.3P.1.apn.pred.CG,                                         ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1819.3P.1.apln.fit,"spg") 
plot(x=jflselkirk1819.3P.1.apln.pred.spg,                                       ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1819.3P.1.apln.fit,"CG")
plot(x=jflselkirk1819.3P.1.apln.pred.CG,                                        ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.3P.1.n.pred.spg <- CatDynPred(jflselkirk1819.3P.1.n.fit,"spg")
plot(x=jflselkirk1819.3P.1.n.pred.spg,                                          ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.n.pred.CG <- CatDynPred(jflselkirk1819.3P.1.n.fit,"CG")
plot(x=jflselkirk1819.3P.1.n.pred.CG,                                           ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1819.3P.1.ln.fit,"spg")   
plot(x=jflselkirk1819.3P.1.ln.pred.spg,                                         ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1819.3P.1.ln.fit,"CG")
plot(x=jflselkirk1819.3P.1.ln.pred.CG,                                          ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 15
P2.ini      <- 20
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 55,                                                            # the week of one input of abundance
                 57,
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.3P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.3P.2.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.3P.2.apn.pred.spg <- CatDynPred(jflselkirk1819.3P.2.apn.fit,"spg") 
plot(x=jflselkirk1819.3P.2.apn.pred.spg,                                        ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.apn.pred.CG <- CatDynPred(jflselkirk1819.3P.2.apn.fit,"CG")
plot(x=jflselkirk1819.3P.2.apn.pred.CG,                                         ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.3P.2.apln.pred.spg <- CatDynPred(jflselkirk1819.3P.2.apln.fit,"spg") 
plot(x=jflselkirk1819.3P.2.apln.pred.spg,                                       ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.apln.pred.CG <- CatDynPred(jflselkirk1819.3P.2.apln.fit,"CG")
plot(x=jflselkirk1819.3P.2.apln.pred.CG,                                        ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.3P.2.n.pred.spg <- CatDynPred(jflselkirk1819.3P.2.n.fit,"spg")
plot(x=jflselkirk1819.3P.2.n.pred.spg,                                          ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.n.pred.CG <- CatDynPred(jflselkirk1819.3P.2.n.fit,"CG")
plot(x=jflselkirk1819.3P.2.n.pred.CG,                                           ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.3P.2.ln.pred.spg <- CatDynPred(jflselkirk1819.3P.2.ln.fit,"spg")   
plot(x=jflselkirk1819.3P.2.ln.pred.spg,                                         ###29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.2.ln.pred.CG <- CatDynPred(jflselkirk1819.3P.2.ln.fit,"CG")
plot(x=jflselkirk1819.3P.2.ln.pred.CG,                                          ###30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 15
P2.ini      <- 60
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 55,                                                            # the week of one input of abundance
                 66,
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.3P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.3P.3.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.3P.3.apn.pred.spg <- CatDynPred(jflselkirk1819.3P.3.apn.fit,"spg") 
plot(x=jflselkirk1819.3P.3.apn.pred.spg,                                        ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apn.pred.CG <- CatDynPred(jflselkirk1819.3P.3.apn.fit,"CG")
plot(x=jflselkirk1819.3P.3.apn.pred.CG,                                         ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.3P.3.apln.pred.spg <- CatDynPred(jflselkirk1819.3P.3.apln.fit,"spg") 
plot(x=jflselkirk1819.3P.3.apln.pred.spg,                                       ###33
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apln.pred.CG <- CatDynPred(jflselkirk1819.3P.3.apln.fit,"CG")
plot(x=jflselkirk1819.3P.3.apln.pred.CG,                                        ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.3P.3.n.pred.spg <- CatDynPred(jflselkirk1819.3P.3.n.fit,"spg")
plot(x=jflselkirk1819.3P.3.n.pred.spg,                                          ###35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.n.pred.CG <- CatDynPred(jflselkirk1819.3P.3.n.fit,"CG")
plot(x=jflselkirk1819.3P.3.n.pred.CG,                                           ###36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.3P.3.ln.pred.spg <- CatDynPred(jflselkirk1819.3P.3.ln.fit,"spg")   
plot(x=jflselkirk1819.3P.3.ln.pred.spg,                                         ###37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.ln.pred.CG <- CatDynPred(jflselkirk1819.3P.3.ln.fit,"CG")
plot(x=jflselkirk1819.3P.3.ln.pred.CG,                                          ###38
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 15
P2.ini      <- 60
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 55,                                                            # the week of one input of abundance
                 66,
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.3P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.3P.3.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.3P.3.apn.pred.spg <- CatDynPred(jflselkirk1819.3P.3.apn.fit,"spg") 
plot(x=jflselkirk1819.3P.3.apn.pred.spg,                                        ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apn.pred.CG <- CatDynPred(jflselkirk1819.3P.3.apn.fit,"CG")
plot(x=jflselkirk1819.3P.3.apn.pred.CG,                                         ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.3P.3.apln.pred.spg <- CatDynPred(jflselkirk1819.3P.3.apln.fit,"spg") 
plot(x=jflselkirk1819.3P.3.apln.pred.spg,                                       ###33
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.apln.pred.CG <- CatDynPred(jflselkirk1819.3P.3.apln.fit,"CG")
plot(x=jflselkirk1819.3P.3.apln.pred.CG,                                        ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk1819.3P.3.n.pred.spg <- CatDynPred(jflselkirk1819.3P.3.n.fit,"spg")
plot(x=jflselkirk1819.3P.3.n.pred.spg,                                          ###35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.n.pred.CG <- CatDynPred(jflselkirk1819.3P.3.n.fit,"CG")
plot(x=jflselkirk1819.3P.3.n.pred.CG,                                           ###36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.3P.3.ln.pred.spg <- CatDynPred(jflselkirk1819.3P.3.ln.fit,"spg")   
plot(x=jflselkirk1819.3P.3.ln.pred.spg,                                         ###37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.3.ln.pred.CG <- CatDynPred(jflselkirk1819.3P.3.ln.fit,"CG")
plot(x=jflselkirk1819.3P.3.ln.pred.CG,                                          ###38
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*65
P1.ini      <- 15
P2.ini      <- 60
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1819$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 53,                                                            # the week of one input of abundance
                 55,
                 tail(jflselkirk1819$Data$nasas$time.step,1))
#
jflselkirk1819.3P.apn.ini <- catdynexp(x=jflselkirk1819,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1819.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1819.3P.4.apn.fit  <- CatDynFit(x=jflselkirk1819,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk1819.3P.4.apn.pred.spg <- CatDynPred(jflselkirk1819.3P.4.apn.fit,"spg") 
plot(x=jflselkirk1819.3P.4.apn.pred.spg,                                        ###39
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.apn.pred.NM <- CatDynPred(jflselkirk1819.3P.4.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1819.3P.4.apn.pred.NM,                                         ###40
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.apln.fit  <- CatDynFit(x=jflselkirk1819,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk1819.3P.4.apln.pred.spg <- CatDynPred(jflselkirk1819.3P.4.apln.fit,"spg") 
plot(x=jflselkirk1819.3P.4.apln.pred.spg,                                       ###41
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.apln.pred.CG <- CatDynPred(jflselkirk1819.3P.4.apln.fit,"CG")
plot(x=jflselkirk1819.3P.4.apln.pred.CG,                                        ###42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.n.fit  <- CatDynFit(x=jflselkirk1819,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),
                                        itnmax=50000)
#
jflselkirk1819.3P.4.n.pred.spg <- CatDynPred(jflselkirk1819.3P.4.n.fit,"spg")
plot(x=jflselkirk1819.3P.4.n.pred.spg,                                          ###43
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.n.pred.CG <- CatDynPred(jflselkirk1819.3P.4.n.fit,"Nelder-Mead")
plot(x=jflselkirk1819.3P.4.n.pred.CG,                                           ###44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.ln.fit  <- CatDynFit(x=jflselkirk1819,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk1819.3P.4.ln.pred.spg <- CatDynPred(jflselkirk1819.3P.4.ln.fit,"spg")   
plot(x=jflselkirk1819.3P.4.ln.pred.spg,                                         ###45
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.3P.4.ln.pred.CG <- CatDynPred(jflselkirk1819.3P.4.ln.fit,"CG")
plot(x=jflselkirk1819.3P.4.ln.pred.CG,                                          ###46
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk1819.1P.1.apn.fit, ###01
           jflselkirk1819.1P.1.apn.fit, ###02
           jflselkirk1819.1P.1.apln.fit,###03
           jflselkirk1819.1P.1.apln.fit,###04
           jflselkirk1819.1P.1.n.fit,   ###05
           jflselkirk1819.1P.1.n.fit,   ###06
           jflselkirk1819.2P.1.apn.fit, ###07
           jflselkirk1819.2P.1.apn.fit, ###08
           jflselkirk1819.2P.1.apln.fit,###09
           jflselkirk1819.2P.1.apln.fit,###10
           jflselkirk1819.2P.1.n.fit,   ###11
           jflselkirk1819.2P.1.n.fit,   ###12
           jflselkirk1819.2P.1.ln.fit,  ###13
           jflselkirk1819.2P.1.ln.fit,  ###14
           jflselkirk1819.3P.1.apn.fit, ###15
           jflselkirk1819.3P.1.apn.fit, ###16
           jflselkirk1819.3P.1.apln.fit,###17
           jflselkirk1819.3P.1.apln.fit,###18
           jflselkirk1819.3P.1.n.fit,   ###19
           jflselkirk1819.3P.1.n.fit,   ###20
           jflselkirk1819.3P.1.ln.fit,  ###21
           jflselkirk1819.3P.1.ln.fit,  ###22
           jflselkirk1819.3P.2.apn.fit, ###23
           jflselkirk1819.3P.2.apn.fit, ###24
           jflselkirk1819.3P.2.apln.fit,###25
           jflselkirk1819.3P.2.apln.fit,###26
           jflselkirk1819.3P.2.n.fit,   ###27
           jflselkirk1819.3P.2.n.fit,   ###28
           jflselkirk1819.3P.2.ln.fit,  ###29
           jflselkirk1819.3P.2.ln.fit,  ###30
           jflselkirk1819.3P.3.apn.fit, ###31
           jflselkirk1819.3P.3.apn.fit, ###32
           jflselkirk1819.3P.3.apln.fit,###33
           jflselkirk1819.3P.3.apln.fit,###34
           jflselkirk1819.3P.3.n.fit,   ###35
           jflselkirk1819.3P.3.n.fit,   ###36
           jflselkirk1819.3P.3.ln.fit,  ###37
           jflselkirk1819.3P.3.ln.fit,  ###38
           jflselkirk1819.3P.4.apn.fit, ###31
           jflselkirk1819.3P.4.apn.fit, ###32
           jflselkirk1819.3P.4.apln.fit,###33
           jflselkirk1819.3P.4.apln.fit,###34
           jflselkirk1819.3P.4.n.fit,   ###35
           jflselkirk1819.3P.4.n.fit,   ###36
           jflselkirk1819.3P.4.ln.fit,  ###37
           jflselkirk1819.3P.4.ln.fit)  ###38
m1 <- c(rep(c("spg","Nelder-Mead"),3),rep(c("spg","CG"),16),
        c("spg","Nelder-Mead"),c("spg","CG"),c("spg","Nelder-Mead"),c("spg","CG"))
# Take out variants with gradients > 1
jflselkirk1819.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
jflselkirk1819.sum.1  <- jflselkirk1819.sum.0[jflselkirk1819.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jflselkirk1819.sum.1[jflselkirk1819.sum.1$Distribution=="apnormal",]
jflselkirk1819.sum.1[jflselkirk1819.sum.1$Distribution=="aplnormal",]
jflselkirk1819.sum.1[jflselkirk1819.sum.1$Distribution=="normal",]
jflselkirk1819.sum.1[jflselkirk1819.sum.1$Distribution=="lognormal",]
# 3P.4 better in apln and lognormal, tied in apn and normal
# jflselkirk1819.sum.1 <- jflselkirk1819.sum.0[jflselkirk1819.sum.0$Model %in% c("3P"),]
jflselkirk1819.sum.2 <- jflselkirk1819.sum.1[which(row.names(jflselkirk1819.sum.1) %in% 
                                                     c("39","41","42","43","45","46")),]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk1819.sum.2))],                     
          ttl=paste(jflselkirk1819.sum.2$Model,
                    substring(jflselkirk1819.sum.2$Distribution, 1,8),
                    jflselkirk1819.sum.2$Method,
                    as.numeric(row.names(jflselkirk1819.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk1819.sum.2))],
          arr=c(3,2))
# Worst correlations in apnormal and normal variants
jflselkirk1819.sum.3 <- jflselkirk1819.sum.2[which(!row.names(jflselkirk1819.sum.2) %in% 
                                                     c("39","43")),]
#
(jflselkirk1819.3P.4.apln.spg.partable <- CatDynPar(x=jflselkirk1819.3P.4.apln.fit,method="spg"))###41
(jflselkirk1819.3P.4.apln.CG.partable  <- CatDynPar(x=jflselkirk1819.3P.4.apln.fit,method="CG")) ###42
(jflselkirk1819.3P.4.ln.spg.partable   <- CatDynPar(x=jflselkirk1819.3P.4.ln.fit,method="spg"))  ###45
(jflselkirk1819.3P.4.ln.CG.partable    <- CatDynPar(x=jflselkirk1819.3P.4.ln.fit,method="CG"))   ###46
#
plot(x=jflselkirk1819.3P.4.apln.pred.CG,                                        ###42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1819$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1819.sum.0$Sel.Model[42] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.11.- Depletion models season: 2019-2020                                  #
################################################################################
#
# Data object
#
cateff1.Selkirk.1920 <- rbind(cateff1.Selkirk.1920[1:11,],
                              c(2019,11,52,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2019,11,53,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1920[12:18,],
                              c(2020,11,7,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1920[19:23,],
                              c(2020,11,13,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2020,11,14,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2020,11,15,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1920[24:27,],
                              c(2020,11,20,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2020,11,21,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.1920[28,])
#
jflselkirk1920  <- as.CatDynData(x=cateff1.Selkirk.1920,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2019-10-07","2020-06-05"))
#
plot(x=jflselkirk1920,mark=TRUE,offset=c(9,10,4),hem="S")                       # 46 57 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk1920$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 70.42024
M.ini       <- 3*0.001937482
N0.ini      <- 3*70
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk1920$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk1920$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk1920.0P.apn.ini <- catdynexp(x=jflselkirk1920,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk1920.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk1920.0P.apn.fit  <- CatDynFit(x=jflselkirk1920,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1920.0P.apn.pred.spg <- CatDynPred(jflselkirk1920.0P.apn.fit,"spg")   
# plot(x=jflselkirk1920.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1920.0P.apn.pred.CG <- CatDynPred(jflselkirk1920.0P.apn.fit,"CG")     
# plot(x=jflselkirk1920.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.0P.apln.fit  <- CatDynFit(x=jflselkirk1920,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1920.0P.apln.pred.spg <- CatDynPred(jflselkirk1920.0P.apln.fit,"spg") 
# plot(x=jflselkirk1920.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
# #
# jflselkirk1920.0P.apln.pred.CG <- CatDynPred(jflselkirk1920.0P.apln.fit,"CG")   
# plot(x=jflselkirk1920.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*70
P1.ini      <- 55
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk1920$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,                                                            # the week of one input of abundance
                 tail(jflselkirk1920$Data$nasas$time.step,1))
#
jflselkirk1920.1P.apn.ini <- catdynexp(x=jflselkirk1920,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk1920.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1920.1P.1.apn.fit  <- CatDynFit(x=jflselkirk1920,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1920.1P.1.apn.pred.spg <- CatDynPred(jflselkirk1920.1P.1.apn.fit,"spg")
# plot(x=jflselkirk1920.1P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.1P.1.apn.pred.CG <- CatDynPred(jflselkirk1920.1P.1.apn.fit,"CG")
# plot(x=jflselkirk1920.1P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.1P.1.apn.pred.NM <- CatDynPred(jflselkirk1920.1P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk1920.1P.1.apn.pred.NM,                                         ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk1920.1P.1.apln.fit  <- CatDynFit(x=jflselkirk1920,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1920.1P.1.apln.pred.spg <- CatDynPred(jflselkirk1920.1P.1.apln.fit,"spg") 
# plot(x=jflselkirk1920.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.1P.1.apln.pred.CG <- CatDynPred(jflselkirk1920.1P.1.apln.fit,"CG") 
# plot(x=jflselkirk1920.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk1920$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk1920$Data$nasas$obscat.thou+1))^2)
#
jflselkirk1920.1P.1.n.fit  <- CatDynFit(x=jflselkirk1920,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1920.1P.1.n.pred.spg <- CatDynPred(jflselkirk1920.1P.1.n.fit,"spg")
# plot(x=jflselkirk1920.1P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.1P.1.n.pred.CG <- CatDynPred(jflselkirk1920.1P.1.n.fit,"CG")
# plot(x=jflselkirk1920.1P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.1P.1.ln.fit  <- CatDynFit(x=jflselkirk1920,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1920.1P.1.ln.pred.spg <- CatDynPred(jflselkirk1920.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk1920.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.1P.1.ln.pred.CG <- CatDynPred(jflselkirk1920.1P.1.ln.fit,"CG")
# plot(x=jflselkirk1920.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 45
P1.ini      <- 85
P2.ini      <- 45
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1.1                                                               # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1920$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 57,                                                            # the week of one input of abundance
                 tail(jflselkirk1920$Data$nasas$time.step,1))
#
jflselkirk1920.2P.apn.ini <- catdynexp(x=jflselkirk1920,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1920.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1920.2P.1.apn.fit  <- CatDynFit(x=jflselkirk1920,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1920.2P.1.apn.pred.spg <- CatDynPred(jflselkirk1920.2P.1.apn.fit,"spg")
# plot(x=jflselkirk1920.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.1.apn.pred.CG <- CatDynPred(jflselkirk1920.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk1920.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.1.apln.fit  <- CatDynFit(x=jflselkirk1920,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1920.2P.1.apln.pred.spg <- CatDynPred(jflselkirk1920.2P.1.apln.fit,"spg") 
# plot(x=jflselkirk1920.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.1.apln.pred.CG <- CatDynPred(jflselkirk1920.2P.1.apln.fit,"CG")
# plot(x=jflselkirk1920.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.1.n.fit  <- CatDynFit(x=jflselkirk1920,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1920.2P.1.n.pred.spg <- CatDynPred(jflselkirk1920.2P.1.n.fit,"spg")
# plot(x=jflselkirk1920.2P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.1.n.pred.CG <- CatDynPred(jflselkirk1920.2P.1.n.fit,"CG")
# plot(x=jflselkirk1920.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.1.ln.fit  <- CatDynFit(x=jflselkirk1920,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1920.2P.1.ln.pred.spg <- CatDynPred(jflselkirk1920.2P.1.ln.fit,"spg")
# plot(x=jflselkirk1920.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.1.ln.pred.CG <- CatDynPred(jflselkirk1920.2P.1.ln.fit,"CG")
# plot(x=jflselkirk1920.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*70
P1.ini      <- 85
P2.ini      <- 80
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk1920$Data$nasas$time.step,1),                   # now the dates vector also has
                 46,
                 55,                                                            # the week of one input of abundance
                 tail(jflselkirk1920$Data$nasas$time.step,1))
#
jflselkirk1920.2P.apn.ini <- catdynexp(x=jflselkirk1920,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk1920.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1920.2P.2.apn.fit  <- CatDynFit(x=jflselkirk1920,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1920.2P.2.apn.pred.spg <- CatDynPred(jflselkirk1920.2P.2.apn.fit,"spg")
# plot(x=jflselkirk1920.2P.2.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.2.apn.pred.CG <- CatDynPred(jflselkirk1920.2P.2.apn.fit,"CG")   
# plot(x=jflselkirk1920.2P.2.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.2.apln.fit  <- CatDynFit(x=jflselkirk1920,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1920.2P.2.apln.pred.spg <- CatDynPred(jflselkirk1920.2P.2.apln.fit,"spg") 
# plot(x=jflselkirk1920.2P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.2.apln.pred.CG <- CatDynPred(jflselkirk1920.2P.2.apln.fit,"CG")
# plot(x=jflselkirk1920.2P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.2.n.fit  <- CatDynFit(x=jflselkirk1920,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1920.2P.2.n.pred.spg <- CatDynPred(jflselkirk1920.2P.2.n.fit,"spg")
# plot(x=jflselkirk1920.2P.2.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.2.n.pred.CG <- CatDynPred(jflselkirk1920.2P.2.n.fit,"CG")
# plot(x=jflselkirk1920.2P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.2P.2.ln.fit  <- CatDynFit(x=jflselkirk1920,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1920.2P.2.ln.pred.spg <- CatDynPred(jflselkirk1920.2P.2.ln.fit,"spg")
# plot(x=jflselkirk1920.2P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.2P.2.ln.pred.CG <- CatDynPred(jflselkirk1920.2P.2.ln.fit,"CG")
# plot(x=jflselkirk1920.2P.2.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*60
P1.ini      <- 65
P2.ini      <- 39
P3.ini      <- 30
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk1920$Data$nasas$time.step,1),                    # now the dates vector also has
                 46,
                 50,                                                            # the week of one input of abundance
                 57,
                 tail(jflselkirk1920$Data$nasas$time.step,1))
#
jflselkirk1920.3P.apn.ini <- catdynexp(x=jflselkirk1920,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk1920.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk1920.3P.1.apn.fit  <- CatDynFit(x=jflselkirk1920,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk1920.3P.1.apn.pred.spg <- CatDynPred(jflselkirk1920.3P.1.apn.fit,"spg") 
# plot(x=jflselkirk1920.3P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.3P.1.apn.pred.CG <- CatDynPred(jflselkirk1920.3P.1.apn.fit,"CG")
# plot(x=jflselkirk1920.3P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.3P.1.apln.fit  <- CatDynFit(x=jflselkirk1920,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk1920.3P.1.apln.pred.spg <- CatDynPred(jflselkirk1920.3P.1.apln.fit,"spg") 
# plot(x=jflselkirk1920.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.3P.1.apln.pred.CG <- CatDynPred(jflselkirk1920.3P.1.apln.fit,"CG")
# plot(x=jflselkirk1920.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.3P.1.n.fit  <- CatDynFit(x=jflselkirk1920,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk1920.3P.1.n.pred.spg <- CatDynPred(jflselkirk1920.3P.1.n.fit,"spg")
# plot(x=jflselkirk1920.3P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.3P.1.n.pred.CG <- CatDynPred(jflselkirk1920.3P.1.n.fit,"CG")
# plot(x=jflselkirk1920.3P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk1920.3P.1.ln.fit  <- CatDynFit(x=jflselkirk1920,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk1920.3P.1.ln.pred.spg <- CatDynPred(jflselkirk1920.3P.1.ln.fit,"spg")   
# plot(x=jflselkirk1920.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk1920.3P.1.ln.pred.CG <- CatDynPred(jflselkirk1920.3P.1.ln.fit,"CG")
# plot(x=jflselkirk1920.3P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
# Only one variant converged
(jflselkirk1920.1P.1.apn.NM.partable  <- CatDynPar(x=jflselkirk1920.1P.1.apn.fit,method="Nelder-Mead"))   ###01
#
plot(x=jflselkirk1920.1P.1.apn.pred.NM,                                         ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk1920$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk1920.sum.0$Sel.Model[17] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.12.- Depletion models season: 2020-2021                                  #
################################################################################
#
# Data object
#
cateff1.Selkirk.2021 <- rbind(cateff1.Selkirk.2021[1:3,],
                              c(2020,12,42,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2020,12,43,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2021[4:20,],
                              c(2021,12,8,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2021[21:24,],
                              c(2021,12,13,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2021,12,14,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2021[25,],
                              c(2021,12,16,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2021,12,17,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2021[26:27,])
#
jflselkirk2021  <- as.CatDynData(x=cateff1.Selkirk.2021,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2020-10-01","2021-05-10"))
#
plot(x=jflselkirk2021,mark=TRUE,offset=c(9,10,4),hem="S")                       # 45 54 57 71 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk2021$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 48.28981
M.ini       <- 3*0.001937482
N0.ini      <- 2*70
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk2021$Data$nasas$time.step,1))                   # just start and end week
#
jflselkirk2021.0P.apn.ini <- catdynexp(x=jflselkirk2021,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk2021.0P.apn.fit  <- CatDynFit(x=jflselkirk2021,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.0P.apn.pred.spg <- CatDynPred(jflselkirk2021.0P.apn.fit,"spg")   # 49 54 57 60 71
plot(x=jflselkirk2021.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.0P.apn.pred.CG <- CatDynPred(jflselkirk2021.0P.apn.fit,"CG")     # 49 54 57 60 71
plot(x=jflselkirk2021.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.0P.apln.fit  <- CatDynFit(x=jflselkirk2021,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.0P.apln.pred.spg <- CatDynPred(jflselkirk2021.0P.apln.fit,"spg") # 53 57 71
plot(x=jflselkirk2021.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.0P.apln.pred.CG <- CatDynPred(jflselkirk2021.0P.apln.fit,"CG")   # 53 57 71
plot(x=jflselkirk2021.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
P1.ini      <- 25
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,                                                            # the week of one input of abundance
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.1P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.1P.1.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.1P.1.apn.pred.spg <- CatDynPred(jflselkirk2021.1P.1.apn.fit,"spg")
plot(x=jflselkirk2021.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.apn.pred.CG <- CatDynPred(jflselkirk2021.1P.1.apn.fit,"CG")
plot(x=jflselkirk2021.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.1P.1.apln.pred.spg <- CatDynPred(jflselkirk2021.1P.1.apln.fit,"spg") 
plot(x=jflselkirk2021.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.apln.pred.CG <- CatDynPred(jflselkirk2021.1P.1.apln.fit,"CG") 
plot(x=jflselkirk2021.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk2021$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk2021$Data$nasas$obscat.thou+1))^2)
#
jflselkirk2021.1P.1.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.1P.1.n.pred.spg <- CatDynPred(jflselkirk2021.1P.1.n.fit,"spg")
plot(x=jflselkirk2021.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.n.pred.CG <- CatDynPred(jflselkirk2021.1P.1.n.fit,"CG")
plot(x=jflselkirk2021.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.1P.1.ln.pred.spg <- CatDynPred(jflselkirk2021.1P.1.ln.fit,"spg")   
plot(x=jflselkirk2021.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.1P.1.ln.pred.CG <- CatDynPred(jflselkirk2021.1P.1.ln.fit,"CG")
plot(x=jflselkirk2021.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
P1.ini      <- 25
P2.ini      <- 30
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.2P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.2P.1.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.2P.1.apn.pred.spg <- CatDynPred(jflselkirk2021.2P.1.apn.fit,"spg")
plot(x=jflselkirk2021.2P.1.apn.pred.spg,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.apn.pred.CG <- CatDynPred(jflselkirk2021.2P.1.apn.fit,"CG")   
plot(x=jflselkirk2021.2P.1.apn.pred.CG,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.2P.1.apln.pred.spg <- CatDynPred(jflselkirk2021.2P.1.apln.fit,"spg") 
plot(x=jflselkirk2021.2P.1.apln.pred.spg,                                       ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.apln.pred.CG <- CatDynPred(jflselkirk2021.2P.1.apln.fit,"CG")
plot(x=jflselkirk2021.2P.1.apln.pred.CG,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.2P.1.n.pred.spg <- CatDynPred(jflselkirk2021.2P.1.n.fit,"spg")
plot(x=jflselkirk2021.2P.1.n.pred.spg,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.n.pred.CG <- CatDynPred(jflselkirk2021.2P.1.n.fit,"CG")
plot(x=jflselkirk2021.2P.1.n.pred.CG,                                           ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.2P.1.ln.pred.spg <- CatDynPred(jflselkirk2021.2P.1.ln.fit,"spg")
plot(x=jflselkirk2021.2P.1.ln.pred.spg,                                         ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.2P.1.ln.pred.CG <- CatDynPred(jflselkirk2021.2P.1.ln.fit,"CG")
plot(x=jflselkirk2021.2P.1.ln.pred.CG,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 65
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 57,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.3P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.3P.1.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.3P.1.apn.pred.spg <- CatDynPred(jflselkirk2021.3P.1.apn.fit,"spg") 
plot(x=jflselkirk2021.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.apn.pred.CG <- CatDynPred(jflselkirk2021.3P.1.apn.fit,"CG")
plot(x=jflselkirk2021.3P.1.apn.pred.CG,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.3P.1.apln.pred.spg <- CatDynPred(jflselkirk2021.3P.1.apln.fit,"spg") 
plot(x=jflselkirk2021.3P.1.apln.pred.spg,                                       ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.apln.pred.CG <- CatDynPred(jflselkirk2021.3P.1.apln.fit,"CG")
plot(x=jflselkirk2021.3P.1.apln.pred.CG,                                        ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.3P.1.n.pred.spg <- CatDynPred(jflselkirk2021.3P.1.n.fit,"spg")
plot(x=jflselkirk2021.3P.1.n.pred.spg,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.n.pred.CG <- CatDynPred(jflselkirk2021.3P.1.n.fit,"CG")
plot(x=jflselkirk2021.3P.1.n.pred.CG,                                           ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.3P.1.ln.pred.spg <- CatDynPred(jflselkirk2021.3P.1.ln.fit,"spg")   
plot(x=jflselkirk2021.3P.1.ln.pred.spg,                                         ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.3P.1.ln.pred.CG <- CatDynPred(jflselkirk2021.3P.1.ln.fit,"CG")
plot(x=jflselkirk2021.3P.1.ln.pred.CG,                                          ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 65
P4.ini      <- 25
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 57,
                 71,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.4P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.4P.1.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.4P.1.apn.pred.spg <- CatDynPred(jflselkirk2021.4P.1.apn.fit,"spg") 
plot(x=jflselkirk2021.4P.1.apn.pred.spg,                                        ###25
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.apn.pred.CG <- CatDynPred(jflselkirk2021.4P.1.apn.fit,"CG")
plot(x=jflselkirk2021.4P.1.apn.pred.CG,                                         ###26
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.4P.1.apln.pred.spg <- CatDynPred(jflselkirk2021.4P.1.apln.fit,"spg") 
plot(x=jflselkirk2021.4P.1.apln.pred.spg,                                       ###27
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.apln.pred.CG <- CatDynPred(jflselkirk2021.4P.1.apln.fit,"CG")
plot(x=jflselkirk2021.4P.1.apln.pred.CG,                                        ###28
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.4P.1.n.pred.spg <- CatDynPred(jflselkirk2021.4P.1.n.fit,"spg")
plot(x=jflselkirk2021.4P.1.n.pred.spg,                                          ###29
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.n.pred.CG <- CatDynPred(jflselkirk2021.4P.1.n.fit,"CG")
plot(x=jflselkirk2021.4P.1.n.pred.CG,                                           ###30
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.4P.1.ln.pred.spg <- CatDynPred(jflselkirk2021.4P.1.ln.fit,"spg")   
plot(x=jflselkirk2021.4P.1.ln.pred.spg,                                         ###31
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.1.ln.pred.CG <- CatDynPred(jflselkirk2021.4P.1.ln.fit,"CG")
plot(x=jflselkirk2021.4P.1.ln.pred.CG,                                          ###32
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*50
P1.ini      <- 25
P2.ini      <- 15
P3.ini      <- 65
P4.ini      <- 45
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 54,
                 60,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.4P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.4P.2.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.4P.2.apn.pred.spg <- CatDynPred(jflselkirk2021.4P.2.apn.fit,"spg") 
plot(x=jflselkirk2021.4P.2.apn.pred.spg,                                        ###33
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.apn.pred.CG <- CatDynPred(jflselkirk2021.4P.2.apn.fit,"CG")
plot(x=jflselkirk2021.4P.2.apn.pred.CG,                                         ###34
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.4P.2.apln.pred.spg <- CatDynPred(jflselkirk2021.4P.2.apln.fit,"spg") 
plot(x=jflselkirk2021.4P.2.apln.pred.spg,                                       ###35
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.apln.pred.CG <- CatDynPred(jflselkirk2021.4P.2.apln.fit,"CG")
plot(x=jflselkirk2021.4P.2.apln.pred.CG,                                        ###36
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.4P.2.n.pred.spg <- CatDynPred(jflselkirk2021.4P.2.n.fit,"spg")
plot(x=jflselkirk2021.4P.2.n.pred.spg,                                          ###37
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.n.pred.CG <- CatDynPred(jflselkirk2021.4P.2.n.fit,"CG")
plot(x=jflselkirk2021.4P.2.n.pred.CG,                                           ###38
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.4P.2.ln.pred.spg <- CatDynPred(jflselkirk2021.4P.2.ln.fit,"spg")   
plot(x=jflselkirk2021.4P.2.ln.pred.spg,                                         ###39
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.4P.2.ln.pred.CG <- CatDynPred(jflselkirk2021.4P.2.ln.fit,"CG")
plot(x=jflselkirk2021.4P.2.ln.pred.CG,                                          ###40
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 5 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 35
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 54,
                 60,
                 71,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.5P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.5P.1.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.5P.1.apn.pred.spg <- CatDynPred(jflselkirk2021.5P.1.apn.fit,"spg") 
plot(x=jflselkirk2021.5P.1.apn.pred.spg,                                        ###41
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.apn.pred.CG <- CatDynPred(jflselkirk2021.5P.1.apn.fit,"CG")
plot(x=jflselkirk2021.5P.1.apn.pred.CG,                                         ###42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.5P.1.apln.pred.spg <- CatDynPred(jflselkirk2021.5P.1.apln.fit,"spg") 
plot(x=jflselkirk2021.5P.1.apln.pred.spg,                                       ###43
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.apln.pred.CG <- CatDynPred(jflselkirk2021.5P.1.apln.fit,"CG")
plot(x=jflselkirk2021.5P.1.apln.pred.CG,                                        ###44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.5P.1.n.pred.spg <- CatDynPred(jflselkirk2021.5P.1.n.fit,"spg")
plot(x=jflselkirk2021.5P.1.n.pred.spg,                                          ###45
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.n.pred.CG <- CatDynPred(jflselkirk2021.5P.1.n.fit,"CG")
plot(x=jflselkirk2021.5P.1.n.pred.CG,                                           ###46
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.5P.1.ln.pred.spg <- CatDynPred(jflselkirk2021.5P.1.ln.fit,"spg")   
plot(x=jflselkirk2021.5P.1.ln.pred.spg,                                         ###47
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.1.ln.pred.CG <- CatDynPred(jflselkirk2021.5P.1.ln.fit,"CG")
plot(x=jflselkirk2021.5P.1.ln.pred.CG,                                          ###48
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 5 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 35
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 54,
                 60,
                 68,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.5P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.5P.2.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.5P.2.apn.pred.spg <- CatDynPred(jflselkirk2021.5P.2.apn.fit,"spg") 
plot(x=jflselkirk2021.5P.2.apn.pred.spg,                                        ###49
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.apn.pred.CG <- CatDynPred(jflselkirk2021.5P.2.apn.fit,"CG")
plot(x=jflselkirk2021.5P.2.apn.pred.CG,                                         ###50
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.5P.2.apln.pred.spg <- CatDynPred(jflselkirk2021.5P.2.apln.fit,"spg") 
plot(x=jflselkirk2021.5P.2.apln.pred.spg,                                       ###51
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.apln.pred.CG <- CatDynPred(jflselkirk2021.5P.2.apln.fit,"CG")
plot(x=jflselkirk2021.5P.2.apln.pred.CG,                                        ###52
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.5P.2.n.pred.spg <- CatDynPred(jflselkirk2021.5P.2.n.fit,"spg")
plot(x=jflselkirk2021.5P.2.n.pred.spg,                                          ###53
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.n.pred.CG <- CatDynPred(jflselkirk2021.5P.2.n.fit,"CG")
plot(x=jflselkirk2021.5P.2.n.pred.CG,                                           ###54
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.5P.2.ln.pred.spg <- CatDynPred(jflselkirk2021.5P.2.ln.fit,"spg")   
plot(x=jflselkirk2021.5P.2.ln.pred.spg,                                         ###55
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.2.ln.pred.CG <- CatDynPred(jflselkirk2021.5P.2.ln.fit,"CG")
plot(x=jflselkirk2021.5P.2.ln.pred.CG,                                          ###56
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 5 input depletion variant                                  45 54 57 71
M.ini       <- 3*0.001937482
N0.ini      <- 2*30
P1.ini      <- 5
P2.ini      <- 5
P3.ini      <- 35
P4.ini      <- 15
P5.ini      <- 15
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1.1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk2021$Data$nasas$time.step,1),                   # now the dates vector also has
                 45,
                 49,                                                            # the week of one input of abundance
                 54,
                 57,
                 68,
                 tail(jflselkirk2021$Data$nasas$time.step,1))
#
jflselkirk2021.5P.apn.ini <- catdynexp(x=jflselkirk2021,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk2021.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2021.5P.3.apn.fit  <- CatDynFit(x=jflselkirk2021,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2021.5P.3.apn.pred.spg <- CatDynPred(jflselkirk2021.5P.3.apn.fit,"spg") 
plot(x=jflselkirk2021.5P.3.apn.pred.spg,                                        ###57
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.apn.pred.CG <- CatDynPred(jflselkirk2021.5P.3.apn.fit,"CG")
plot(x=jflselkirk2021.5P.3.apn.pred.CG,                                         ###58
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.apln.fit  <- CatDynFit(x=jflselkirk2021,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
jflselkirk2021.5P.3.apln.pred.spg <- CatDynPred(jflselkirk2021.5P.3.apln.fit,"spg") 
plot(x=jflselkirk2021.5P.3.apln.pred.spg,                                       ###59
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.apln.pred.CG <- CatDynPred(jflselkirk2021.5P.3.apln.fit,"CG")
plot(x=jflselkirk2021.5P.3.apln.pred.CG,                                        ###60
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.n.fit  <- CatDynFit(x=jflselkirk2021,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2021.5P.3.n.pred.spg <- CatDynPred(jflselkirk2021.5P.3.n.fit,"spg")
plot(x=jflselkirk2021.5P.3.n.pred.spg,                                          ###61
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.n.pred.CG <- CatDynPred(jflselkirk2021.5P.3.n.fit,"CG")
plot(x=jflselkirk2021.5P.3.n.pred.CG,                                           ###62
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.ln.fit  <- CatDynFit(x=jflselkirk2021,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2021.5P.3.ln.pred.spg <- CatDynPred(jflselkirk2021.5P.3.ln.fit,"spg")   
plot(x=jflselkirk2021.5P.3.ln.pred.spg,                                         ###63
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.5P.3.ln.pred.CG <- CatDynPred(jflselkirk2021.5P.3.ln.fit,"CG")
plot(x=jflselkirk2021.5P.3.ln.pred.CG,                                          ###64
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk2021.1P.1.apn.fit, ###01
           jflselkirk2021.1P.1.apn.fit, ###02
           jflselkirk2021.1P.1.apln.fit,###03
           jflselkirk2021.1P.1.apln.fit,###04
           jflselkirk2021.1P.1.n.fit,   ###05
           jflselkirk2021.1P.1.n.fit,   ###06
           jflselkirk2021.1P.1.ln.fit,  ###07
           jflselkirk2021.1P.1.ln.fit,  ###08
           jflselkirk2021.2P.1.apn.fit, ###09
           jflselkirk2021.2P.1.apn.fit, ###10
           jflselkirk2021.2P.1.apln.fit,###11
           jflselkirk2021.2P.1.apln.fit,###12
           jflselkirk2021.2P.1.n.fit,   ###13
           jflselkirk2021.2P.1.n.fit,   ###14
           jflselkirk2021.2P.1.ln.fit,  ###15
           jflselkirk2021.2P.1.ln.fit,  ###16
           jflselkirk2021.3P.1.apn.fit, ###17
           jflselkirk2021.3P.1.apn.fit, ###18
           jflselkirk2021.3P.1.apln.fit,###19
           jflselkirk2021.3P.1.apln.fit,###20
           jflselkirk2021.3P.1.n.fit,   ###21
           jflselkirk2021.3P.1.n.fit,   ###22
           jflselkirk2021.3P.1.ln.fit,  ###23
           jflselkirk2021.3P.1.ln.fit,  ###24
           jflselkirk2021.4P.1.apn.fit, ###25
           jflselkirk2021.4P.1.apn.fit, ###26
           jflselkirk2021.4P.1.apln.fit,###27
           jflselkirk2021.4P.1.apln.fit,###28
           jflselkirk2021.4P.1.n.fit,   ###29
           jflselkirk2021.4P.1.n.fit,   ###30
           jflselkirk2021.4P.1.ln.fit,  ###31
           jflselkirk2021.4P.1.ln.fit,  ###32
           jflselkirk2021.4P.2.apn.fit, ###33
           jflselkirk2021.4P.2.apn.fit, ###34
           jflselkirk2021.4P.2.apln.fit,###35
           jflselkirk2021.4P.2.apln.fit,###36
           jflselkirk2021.4P.2.n.fit,   ###37
           jflselkirk2021.4P.2.n.fit,   ###38
           jflselkirk2021.4P.2.ln.fit,  ###39
           jflselkirk2021.4P.2.ln.fit,  ###40
           jflselkirk2021.5P.1.apn.fit, ###41
           jflselkirk2021.5P.1.apn.fit, ###42
           jflselkirk2021.5P.1.apln.fit,###43
           jflselkirk2021.5P.1.apln.fit,###44
           jflselkirk2021.5P.1.n.fit,   ###45
           jflselkirk2021.5P.1.n.fit,   ###46
           jflselkirk2021.5P.1.ln.fit,  ###47
           jflselkirk2021.5P.1.ln.fit,  ###48
           jflselkirk2021.5P.2.apn.fit, ###49
           jflselkirk2021.5P.2.apn.fit, ###50
           jflselkirk2021.5P.2.apln.fit,###51
           jflselkirk2021.5P.2.apln.fit,###52
           jflselkirk2021.5P.2.n.fit,   ###53
           jflselkirk2021.5P.2.n.fit,   ###54
           jflselkirk2021.5P.2.ln.fit,  ###55
           jflselkirk2021.5P.2.ln.fit,  ###56
           jflselkirk2021.5P.3.apn.fit, ###57
           jflselkirk2021.5P.3.apn.fit, ###58
           jflselkirk2021.5P.3.apln.fit,###59
           jflselkirk2021.5P.3.apln.fit,###60
           jflselkirk2021.5P.3.n.fit,   ###61
           jflselkirk2021.5P.3.n.fit,   ###62
           jflselkirk2021.5P.3.ln.fit,  ###63
           jflselkirk2021.5P.3.ln.fit)  ###64
m1 <- rep(c("spg","CG"),32)
# Take out variants with gradients > 1
jflselkirk2021.sum.0  <- CatDynSum(x=x1,season="2020-2021",method=m1)
#jflselkirk2021.sum.1  <- jflselkirk2021.sum.0[jflselkirk2021.sum.0$Max.Abs.Grads.<1,]
# All gradients good
# AIC within variants weith same likelihood
jflselkirk2021.sum.0[jflselkirk2021.sum.0$Distribution=="apnormal",]
jflselkirk2021.sum.0[jflselkirk2021.sum.0$Distribution=="aplnormal",]
jflselkirk2021.sum.0[jflselkirk2021.sum.0$Distribution=="normal",]
jflselkirk2021.sum.0[jflselkirk2021.sum.0$Distribution=="lognormal",]
# Un-informative for apnormal and normal
#jflselkirk2021.sum.1 <- jflselkirk2021.sum.0[jflselkirk2021.sum.0$Model %in% c("3P"),]
#jflselkirk2021.sum.1 <- jflselkirk2021.sum.0[17:24,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk2021.sum.0))],                     
          ttl=paste(jflselkirk2021.sum.0$Model,
                    substring(jflselkirk2021.sum.0$Distribution, 1,8),
                    jflselkirk2021.sum.0$Method,
                    as.numeric(row.names(jflselkirk2021.sum.0))),
          method=m1[as.numeric(row.names(jflselkirk2021.sum.0))],
          arr=c(8,8))
# Best correlations in variants
jflselkirk2021.sum.1 <- jflselkirk2021.sum.0[which(row.names(jflselkirk2021.sum.0) %in% 
                        c("29","30","37","38","49","50","55","56","57","58","61","63","64")),]
CatDynCor(x=x1[as.numeric(row.names(jflselkirk2021.sum.1))],                     
          ttl=paste(jflselkirk2021.sum.1$Model,
                    substring(jflselkirk2021.sum.1$Distribution, 1,8),
                    jflselkirk2021.sum.1$Method,
                    as.numeric(row.names(jflselkirk2021.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk2021.sum.1))],
          arr=c(5,3))
#
(jflselkirk2021.4P.1.n.spg.partable    <- CatDynPar(x=jflselkirk2021.4P.1.n.fit,method="spg"))   ###29
(jflselkirk2021.4P.1.n.CG.partable     <- CatDynPar(x=jflselkirk2021.4P.1.n.fit,method="CG"))    ###30
(jflselkirk2021.4P.2.n.spg.partable    <- CatDynPar(x=jflselkirk2021.4P.2.n.fit,method="spg"))   ###37
(jflselkirk2021.4P.2.n.CG.partable     <- CatDynPar(x=jflselkirk2021.4P.2.n.fit,method="CG"))    ###38
(jflselkirk2021.5P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk2021.5P.2.apn.fit,method="spg")) ###49 
(jflselkirk2021.5P.2.apn.CG.partable   <- CatDynPar(x=jflselkirk2021.5P.2.apn.fit,method="CG"))  ###50
(jflselkirk2021.5P.2.ln.spg.partable   <- CatDynPar(x=jflselkirk2021.5P.2.ln.fit,method="spg"))  ###55
(jflselkirk2021.5P.2.ln.CG.partable    <- CatDynPar(x=jflselkirk2021.5P.2.ln.fit,method="CG"))   ###56
(jflselkirk2021.5P.3.apn.spg.partable  <- CatDynPar(x=jflselkirk2021.5P.3.apn.fit,method="spg")) ###57
(jflselkirk2021.5P.3.apn.CG.partable   <- CatDynPar(x=jflselkirk2021.5P.3.apn.fit,method="CG"))  ###58
(jflselkirk2021.5P.3.n.spg.partable    <- CatDynPar(x=jflselkirk2021.5P.3.n.fit,method="spg"))   ###61
(jflselkirk2021.5P.3.ln.spg.partable   <- CatDynPar(x=jflselkirk2021.5P.3.ln.fit,method="spg"))  ###63
(jflselkirk2021.5P.3.ln.CG.partable    <- CatDynPar(x=jflselkirk2021.5P.3.ln.fit,method="CG"))   ###64
# Best CVs in ###57 and ###58, slightly better in ###57
plot(x=jflselkirk2021.5P.3.apn.pred.spg,                                        ###57
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2021$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2021.sum.0$Sel.Model[57] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.13.- Depletion models season: 2021-2022                                  #
################################################################################
#
cateff1.Selkirk.2122 <- rbind(cateff1.Selkirk.2122[1,],
                              c(2021,13,41,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2021,13,42,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2122[2:6,],
                              c(2021,13,48,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2122[7:15,],
                              c(2022,13,5,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2122[16:20,],
                              c(2022,13,11,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2122[21:25,],
                              c(2022,13,17,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2122[26:27,])
#
# Data object
#
jflselkirk2122  <- as.CatDynData(x=cateff1.Selkirk.2122,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2021-10-04","2022-05-09"))
#
plot(x=jflselkirk2122,mark=TRUE,offset=c(9,10,4),hem="S")                       # 43 46 50 57 67 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk2122$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 45.96027
M.ini       <- 3*0.001937482
N0.ini      <- 8*49
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk2122$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk2122.0P.apn.ini <- catdynexp(x=jflselkirk2122,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk2122.0P.apn.fit  <- CatDynFit(x=jflselkirk2122,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2122.0P.apn.pred.spg <- CatDynPred(jflselkirk2122.0P.apn.fit,"spg")   
# plot(x=jflselkirk2122.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.0P.apn.pred.CG <- CatDynPred(jflselkirk2122.0P.apn.fit,"CG")     
# plot(x=jflselkirk2122.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.0P.apln.fit  <- CatDynFit(x=jflselkirk2122,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2122.0P.apln.pred.spg <- CatDynPred(jflselkirk2122.0P.apln.fit,"spg") 
# plot(x=jflselkirk2122.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.0P.apln.pred.CG <- CatDynPred(jflselkirk2122.0P.apln.fit,"CG")   
# plot(x=jflselkirk2122.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant                                  # 43 50 57 67
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 55
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.1P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.1P.1.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2122.1P.1.apn.pred.spg <- CatDynPred(jflselkirk2122.1P.1.apn.fit,"spg")
# plot(x=jflselkirk2122.1P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.1P.1.apn.pred.CG <- CatDynPred(jflselkirk2122.1P.1.apn.fit,"CG")
# plot(x=jflselkirk2122.1P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.1P.1.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2122.1P.1.apln.pred.spg <- CatDynPred(jflselkirk2122.1P.1.apln.fit,"spg") 
# plot(x=jflselkirk2122.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.1P.1.apln.pred.CG <- CatDynPred(jflselkirk2122.1P.1.apln.fit,"CG") 
# plot(x=jflselkirk2122.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk2122$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk2122$Data$nasas$obscat.thou+1))^2)
#
jflselkirk2122.1P.1.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2122.1P.1.n.pred.spg <- CatDynPred(jflselkirk2122.1P.1.n.fit,"spg")
# plot(x=jflselkirk2122.1P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.1P.1.n.pred.CG <- CatDynPred(jflselkirk2122.1P.1.n.fit,"CG")
# plot(x=jflselkirk2122.1P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.1P.1.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2122.1P.1.ln.pred.spg <- CatDynPred(jflselkirk2122.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk2122.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.1P.1.ln.pred.CG <- CatDynPred(jflselkirk2122.1P.1.ln.fit,"CG")
# plot(x=jflselkirk2122.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant                                  # 43 50 57 67
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.2P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.2P.1.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2122.2P.1.apn.pred.spg <- CatDynPred(jflselkirk2122.2P.1.apn.fit,"spg")
# plot(x=jflselkirk2122.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.2P.1.apn.pred.CG <- CatDynPred(jflselkirk2122.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk2122.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.2P.1.apn.pred.NM <- CatDynPred(jflselkirk2122.2P.1.apn.fit,"Nelder-Mead")   
plot(x=jflselkirk2122.2P.1.apn.pred.NM,                                         ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.2P.1.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2122.2P.1.apln.pred.spg <- CatDynPred(jflselkirk2122.2P.1.apln.fit,"spg") 
# plot(x=jflselkirk2122.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.2P.1.apln.pred.CG <- CatDynPred(jflselkirk2122.2P.1.apln.fit,"CG")
# plot(x=jflselkirk2122.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.2P.1.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2122.2P.1.n.pred.spg <- CatDynPred(jflselkirk2122.2P.1.n.fit,"spg")
# plot(x=jflselkirk2122.2P.1.n.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.2P.1.n.pred.CG <- CatDynPred(jflselkirk2122.2P.1.n.fit,"CG")
# plot(x=jflselkirk2122.2P.1.n.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.2P.1.n.pred.NM <- CatDynPred(jflselkirk2122.2P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk2122.2P.1.n.pred.NM,                                           ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.2P.1.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2122.2P.1.ln.pred.spg <- CatDynPred(jflselkirk2122.2P.1.ln.fit,"spg")
# plot(x=jflselkirk2122.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.2P.1.ln.pred.CG <- CatDynPred(jflselkirk2122.2P.1.ln.fit,"CG")
# plot(x=jflselkirk2122.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 67,
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.3P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.3P.1.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2122.3P.1.apn.pred.spg <- CatDynPred(jflselkirk2122.3P.1.apn.fit,"spg") 
# plot(x=jflselkirk2122.3P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.1.apn.pred.CG <- CatDynPred(jflselkirk2122.3P.1.apn.fit,"CG")
# plot(x=jflselkirk2122.3P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.3P.1.apn.pred.NM <- CatDynPred(jflselkirk2122.3P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.1.apn.pred.NM,                                         
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.1.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2122.3P.1.apln.pred.spg <- CatDynPred(jflselkirk2122.3P.1.apln.fit,"spg") 
# plot(x=jflselkirk2122.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.1.apln.pred.CG <- CatDynPred(jflselkirk2122.3P.1.apln.fit,"CG")
# plot(x=jflselkirk2122.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.3P.1.apln.pred.NM <- CatDynPred(jflselkirk2122.3P.1.apln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.1.apln.pred.NM,                                        ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.1.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2122.3P.1.n.pred.spg <- CatDynPred(jflselkirk2122.3P.1.n.fit,"spg")
# plot(x=jflselkirk2122.3P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.1.n.pred.CG <- CatDynPred(jflselkirk2122.3P.1.n.fit,"CG")
# plot(x=jflselkirk2122.3P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.3P.1.n.pred.NM <- CatDynPred(jflselkirk2122.3P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.1.n.pred.NM,                                           ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.1.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2122.3P.1.ln.pred.spg <- CatDynPred(jflselkirk2122.3P.1.ln.fit,"spg")   
# plot(x=jflselkirk2122.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.1.ln.pred.CG <- CatDynPred(jflselkirk2122.3P.1.ln.fit,"CG")
# plot(x=jflselkirk2122.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.1.ln.pred.NM <- CatDynPred(jflselkirk2122.3P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk2122.3P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 57,
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.3P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.3P.2.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jflselkirk2122.3P.2.apn.pred.spg <- CatDynPred(jflselkirk2122.3P.2.apn.fit,"spg") 
# plot(x=jflselkirk2122.3P.2.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.2.apn.pred.CG <- CatDynPred(jflselkirk2122.3P.2.apn.fit,"CG")
# plot(x=jflselkirk2122.3P.2.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.3P.2.apn.pred.NM <- CatDynPred(jflselkirk2122.3P.2.apn.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.2.apn.pred.NM,                                         ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jflselkirk2122.3P.2.apln.pred.spg <- CatDynPred(jflselkirk2122.3P.2.apln.fit,"spg")
plot(x=jflselkirk2122.3P.2.apln.pred.spg,                                       ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.apln.pred.CG <- CatDynPred(jflselkirk2122.3P.2.apln.fit,"CG")
plot(x=jflselkirk2122.3P.2.apln.pred.CG,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.apln.pred.NM <- CatDynPred(jflselkirk2122.3P.2.apln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.2.apln.pred.NM,                                        ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jflselkirk2122.3P.2.n.pred.spg <- CatDynPred(jflselkirk2122.3P.2.n.fit,"spg")
# plot(x=jflselkirk2122.3P.2.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.3P.2.n.pred.CG <- CatDynPred(jflselkirk2122.3P.2.n.fit,"CG")
# plot(x=jflselkirk2122.3P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.3P.2.n.pred.NM <- CatDynPred(jflselkirk2122.3P.2.n.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.2.n.pred.NM,                                           ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflselkirk2122.3P.2.ln.pred.spg <- CatDynPred(jflselkirk2122.3P.2.ln.fit,"spg")
plot(x=jflselkirk2122.3P.2.ln.pred.spg,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.ln.pred.CG <- CatDynPred(jflselkirk2122.3P.2.ln.fit,"CG")
plot(x=jflselkirk2122.3P.2.ln.pred.CG,                                          ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.3P.2.ln.pred.NM <- CatDynPred(jflselkirk2122.3P.2.ln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.3P.2.ln.pred.NM,                                          ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
P4.ini      <- 20
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 57,
                 67,
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.4P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.4P.1.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2122.4P.1.apn.pred.spg <- CatDynPred(jflselkirk2122.4P.1.apn.fit,"spg")
plot(x=jflselkirk2122.4P.1.apn.pred.spg,                                        ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2122.4P.1.apn.pred.CG <- CatDynPred(jflselkirk2122.4P.1.apn.fit,"CG")
# plot(x=jflselkirk2122.4P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.4P.1.apn.pred.NM <- CatDynPred(jflselkirk2122.4P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.1.apn.pred.NM,                                         ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jflselkirk2122.4P.1.apln.pred.spg <- CatDynPred(jflselkirk2122.4P.1.apln.fit,"spg")
plot(x=jflselkirk2122.4P.1.apln.pred.spg,                                       ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.apln.pred.CG <- CatDynPred(jflselkirk2122.4P.1.apln.fit,"CG")
plot(x=jflselkirk2122.4P.1.apln.pred.CG,                                        ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.apln.pred.NM <- CatDynPred(jflselkirk2122.4P.1.apln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.1.apln.pred.NM,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2122.4P.1.n.pred.spg <- CatDynPred(jflselkirk2122.4P.1.n.fit,"spg")
plot(x=jflselkirk2122.4P.1.n.pred.spg,                                          ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2122.4P.1.n.pred.CG <- CatDynPred(jflselkirk2122.4P.1.n.fit,"CG")
# plot(x=jflselkirk2122.4P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.4P.1.n.pred.NM <- CatDynPred(jflselkirk2122.4P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.1.n.pred.NM,                                           ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jflselkirk2122.4P.1.ln.pred.spg <- CatDynPred(jflselkirk2122.4P.1.ln.fit,"spg")
plot(x=jflselkirk2122.4P.1.ln.pred.spg,                                         ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.ln.pred.CG <- CatDynPred(jflselkirk2122.4P.1.ln.fit,"CG")
plot(x=jflselkirk2122.4P.1.ln.pred.CG,                                          ###21
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.1.ln.pred.NM <- CatDynPred(jflselkirk2122.4P.1.ln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.1.ln.pred.NM,                                          ###22
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
P4.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk2122$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 67,
                 71,
                 tail(jflselkirk2122$Data$nasas$time.step,1))
#
jflselkirk2122.4P.apn.ini <- catdynexp(x=jflselkirk2122,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk2122.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2122.4P.2.apn.fit  <- CatDynFit(x=jflselkirk2122,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2122.4P.2.apn.pred.spg <- CatDynPred(jflselkirk2122.4P.2.apn.fit,"spg")
plot(x=jflselkirk2122.4P.2.apn.pred.spg,                                        ###23
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.apn.pred.CG <- CatDynPred(jflselkirk2122.4P.2.apn.fit,"CG")
# plot(x=jflselkirk2122.4P.2.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.apn.pred.NM <- CatDynPred(jflselkirk2122.4P.2.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk2122.4P.2.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.4P.2.apln.fit  <- CatDynFit(x=jflselkirk2122,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jflselkirk2122.4P.2.apln.pred.spg <- CatDynPred(jflselkirk2122.4P.2.apln.fit,"spg") 
# plot(x=jflselkirk2122.4P.2.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.apln.pred.CG <- CatDynPred(jflselkirk2122.4P.2.apln.fit,"CG")
# plot(x=jflselkirk2122.4P.2.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.4P.2.apln.pred.NM <- CatDynPred(jflselkirk2122.4P.2.apln.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.2.apln.pred.NM,                                        ###24
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.2.n.fit  <- CatDynFit(x=jflselkirk2122,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2122.4P.2.n.pred.spg <- CatDynPred(jflselkirk2122.4P.2.n.fit,"spg")
# plot(x=jflselkirk2122.4P.2.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.n.pred.CG <- CatDynPred(jflselkirk2122.4P.2.n.fit,"CG")
# plot(x=jflselkirk2122.4P.2.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2122.4P.2.n.pred.NM <- CatDynPred(jflselkirk2122.4P.2.n.fit,"Nelder-Mead")
plot(x=jflselkirk2122.4P.2.n.pred.NM,                                           
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.4P.2.ln.fit  <- CatDynFit(x=jflselkirk2122,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2122.4P.2.ln.pred.spg <- CatDynPred(jflselkirk2122.4P.2.ln.fit,"spg")   
# plot(x=jflselkirk2122.4P.2.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.ln.pred.CG <- CatDynPred(jflselkirk2122.4P.2.ln.fit,"CG")
# plot(x=jflselkirk2122.4P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2122.4P.2.ln.pred.NM <- CatDynPred(jflselkirk2122.4P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk2122.4P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk2122.2P.1.apn.fit, ###01
           jflselkirk2122.2P.1.n.fit,   ###02
           jflselkirk2122.3P.1.apln.fit,###03
           jflselkirk2122.3P.1.n.fit,   ###04
           jflselkirk2122.3P.2.apn.fit, ###05
           jflselkirk2122.3P.2.apln.fit,###06
           jflselkirk2122.3P.2.apln.fit,###07
           jflselkirk2122.3P.2.apln.fit,###08
           jflselkirk2122.3P.2.n.fit,   ###09
           jflselkirk2122.3P.2.ln.fit,  ###10
           jflselkirk2122.3P.2.ln.fit,  ###11
           jflselkirk2122.3P.2.ln.fit,  ###12
           jflselkirk2122.4P.1.apn.fit, ###13
           jflselkirk2122.4P.1.apn.fit, ###14
           jflselkirk2122.4P.1.apln.fit,###15
           jflselkirk2122.4P.1.apln.fit,###16
           jflselkirk2122.4P.1.apln.fit,###17
           jflselkirk2122.4P.1.n.fit,   ###18
           jflselkirk2122.4P.1.n.fit,   ###19
           jflselkirk2122.4P.1.ln.fit,  ###20
           jflselkirk2122.4P.1.ln.fit,  ###21
           jflselkirk2122.4P.1.ln.fit,  ###22
           jflselkirk2122.4P.2.apn.fit, ###23
           jflselkirk2122.4P.2.apln.fit)###24
m1 <- c(rep("Nelder-Mead",4),
        "Nelder-Mead",
        "spg","CG","Nelder-Mead",
        "Nelder-Mead",
        "spg","CG","Nelder-Mead",
        "spg","Nelder-Mead",
        "spg","CG","Nelder-Mead",
        "spg","Nelder-Mead",
        "spg","CG","Nelder-Mead",
        "spg","Nelder-Mead")
# Take out variants with gradients > 1
jflselkirk2122.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
jflselkirk2122.sum.1  <- jflselkirk2122.sum.0[jflselkirk2122.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jflselkirk2122.sum.1[jflselkirk2122.sum.1$Distribution=="apnormal",]
jflselkirk2122.sum.1[jflselkirk2122.sum.1$Distribution=="aplnormal",]
jflselkirk2122.sum.1[jflselkirk2122.sum.1$Distribution=="normal",]
jflselkirk2122.sum.1[jflselkirk2122.sum.1$Distribution=="lognormal",]
# 3P.2 better in apln, ln, 3P and 4P tied in apn, n likelihoods
jflselkirk2122.sum.2 <- jflselkirk2122.sum.1[jflselkirk2122.sum.1$Model %in% c("3P"),]
#jflselkirk2122.sum.2 <- jflselkirk2122.sum.1[4:11,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk2122.sum.2))],                     
          ttl=paste(jflselkirk2122.sum.2$Model,
                    substring(jflselkirk2122.sum.2$Distribution, 1,8),
                    jflselkirk2122.sum.2$Method,
                    as.numeric(row.names(jflselkirk2122.sum.2))),
          method=m1[as.numeric(row.names(jflselkirk2122.sum.2))],
          arr=c(4,2))
# Worst correlations in variants ###03, ###12
jflselkirk2122.sum.3 <- jflselkirk2122.sum.2[which(!row.names(jflselkirk2122.sum.2) %in% 
                                                     c("3","12")),]
#
(jflselkirk2122.4P.1.apln.spg.partable  <- CatDynPar(x=jflselkirk2122.3P.2.apln.fit,method="spg"))      ###06
(jflselkirk2122.4P.1.apln.CG.partable   <- CatDynPar(x=jflselkirk2122.3P.2.apln.fit,method="CG"))       ###07
(jflselkirk2122.4P.1.ln.spg.partable    <- CatDynPar(x=jflselkirk2122.3P.2.n.fit,method="Nelder-Mead")) ###09
(jflselkirk2122.4P.1.ln.CG.partable     <- CatDynPar(x=jflselkirk2122.3P.2.ln.fit,method="spg"))        ###10
(jflselkirk2122.4P.1.ln.CG.partable     <- CatDynPar(x=jflselkirk2122.3P.2.ln.fit,method="CG"))         ###11
#
plot(x=jflselkirk2122.3P.2.n.pred.NM,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2122$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2122.sum.0$Sel.Model[9] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.14.- Depletion models season: 2022-2023                                  #
################################################################################
#
cateff1.Selkirk.2223 <- rbind(cateff1.Selkirk.2223[1:9,],
                              c(2022,14,49,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2223[10:11,],
                              c(2022,14,52,0,0,118.1495,0.1274810,118.2313,767.0334),
                              c(2022,14,53,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2223[12:19,],
                              c(2023,14,9,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2223[20:21,],
                              c(2023,14,12,0,0,118.1495,0.1274810,118.2313,767.0334),
                              cateff1.Selkirk.2223[22:28,])
#
# Data object
#
jflselkirk2223  <- as.CatDynData(x=cateff1.Selkirk.2223,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2022-10-03","2023-05-08"))
#
plot(x=jflselkirk2223,mark=TRUE,offset=c(9,10,4),hem="S")                       # 44 47 54 63 candidate input weeks
#
# Initial values for pure depletion variant
sum(jflselkirk2223$Data$nasas$obscat.thou)                                      # for N0.ini
#[1] 34.97913
M.ini       <- 3*0.001937482
N0.ini      <- 7*49
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jflselkirk2223$Data$nasas$time.step,1))                    # just start and end week
#
jflselkirk2223.0P.apn.ini <- catdynexp(x=jflselkirk2223,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jflselkirk2223.0P.apn.fit  <- CatDynFit(x=jflselkirk2223,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2223.0P.apn.pred.spg <- CatDynPred(jflselkirk2223.0P.apn.fit,"spg")   
# plot(x=jflselkirk2223.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.0P.apn.pred.CG <- CatDynPred(jflselkirk2223.0P.apn.fit,"CG")     
# plot(x=jflselkirk2223.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.0P.apln.fit  <- CatDynFit(x=jflselkirk2223,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jflselkirk2223.0P.apln.pred.spg <- CatDynPred(jflselkirk2223.0P.apln.fit,"spg") # 55 63
plot(x=jflselkirk2223.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.0P.apln.pred.CG <- CatDynPred(jflselkirk2223.0P.apln.fit,"CG")   # 55 63
plot(x=jflselkirk2223.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant                                  # 44 47 54 63
M.ini       <- 3*0.001937482
N0.ini      <- 3*30
P1.ini      <- 55
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                   # now the dates vector also has
                 44,                                                            # the week of one input of abundance
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.1P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.1P.1.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2223.1P.1.apn.pred.spg <- CatDynPred(jflselkirk2223.1P.1.apn.fit,"spg")
# plot(x=jflselkirk2223.1P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.1P.1.apn.pred.CG <- CatDynPred(jflselkirk2223.1P.1.apn.fit,"CG")
# plot(x=jflselkirk2223.1P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.1P.1.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.1P.1.apln.pred.spg <- CatDynPred(jflselkirk2223.1P.1.apln.fit,"spg") 
# plot(x=jflselkirk2223.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.1P.1.apln.pred.CG <- CatDynPred(jflselkirk2223.1P.1.apln.fit,"CG") 
# plot(x=jflselkirk2223.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jflselkirk2223$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jflselkirk2223$Data$nasas$obscat.thou+1))^2)
#
jflselkirk2223.1P.1.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2223.1P.1.n.pred.spg <- CatDynPred(jflselkirk2223.1P.1.n.fit,"spg")
# plot(x=jflselkirk2223.1P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.1P.1.n.pred.CG <- CatDynPred(jflselkirk2223.1P.1.n.fit,"CG")
# plot(x=jflselkirk2223.1P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.1P.1.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2223.1P.1.ln.pred.spg <- CatDynPred(jflselkirk2223.1P.1.ln.fit,"spg")   
# plot(x=jflselkirk2223.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.1P.1.ln.pred.CG <- CatDynPred(jflselkirk2223.1P.1.ln.fit,"CG")
# plot(x=jflselkirk2223.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant                                  # 44 47 54 63
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                   # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.2P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.2P.1.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2223.2P.1.apn.pred.spg <- CatDynPred(jflselkirk2223.2P.1.apn.fit,"spg")
# plot(x=jflselkirk2223.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.2P.1.apn.pred.CG <- CatDynPred(jflselkirk2223.2P.1.apn.fit,"CG")   
# plot(x=jflselkirk2223.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.2P.1.apn.pred.NM <- CatDynPred(jflselkirk2223.2P.1.apn.fit,"Nelder-Mead")   
# plot(x=jflselkirk2223.2P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.2P.1.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="CG",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.2P.1.apln.pred.spg <- CatDynPred(jflselkirk2223.2P.1.apln.fit,"spg") 
# plot(x=jflselkirk2223.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.2P.1.apln.pred.CG <- CatDynPred(jflselkirk2223.2P.1.apln.fit,"CG")
# plot(x=jflselkirk2223.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.2P.1.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2223.2P.1.n.pred.spg <- CatDynPred(jflselkirk2223.2P.1.n.fit,"spg")
# plot(x=jflselkirk2223.2P.1.n.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.2P.1.n.pred.CG <- CatDynPred(jflselkirk2223.2P.1.n.fit,"CG")
# plot(x=jflselkirk2223.2P.1.n.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.2P.1.n.pred.NM <- CatDynPred(jflselkirk2223.2P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk2223.2P.1.n.pred.NM,                                           ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.2P.1.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2223.2P.1.ln.pred.spg <- CatDynPred(jflselkirk2223.2P.1.ln.fit,"spg")
# plot(x=jflselkirk2223.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.2P.1.ln.pred.CG <- CatDynPred(jflselkirk2223.2P.1.ln.fit,"CG")
# plot(x=jflselkirk2223.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 3 input depletion variant                                   44 47 54 63
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 54,
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.3P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.3P.1.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG"),
                                          itnmax=50000)
#
# jflselkirk2223.3P.1.apn.pred.spg <- CatDynPred(jflselkirk2223.3P.1.apn.fit,"spg") 
# plot(x=jflselkirk2223.3P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.1.apn.pred.CG <- CatDynPred(jflselkirk2223.3P.1.apn.fit,"CG")
# plot(x=jflselkirk2223.3P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.1.apn.pred.NM <- CatDynPred(jflselkirk2223.3P.1.apn.fit,"Nelder-Mead")
plot(x=jflselkirk2223.3P.1.apn.pred.NM,                                         ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.3P.1.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.3P.1.apln.pred.spg <- CatDynPred(jflselkirk2223.3P.1.apln.fit,"spg") 
# plot(x=jflselkirk2223.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.1.apln.pred.CG <- CatDynPred(jflselkirk2223.3P.1.apln.fit,"CG")
# plot(x=jflselkirk2223.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.1.apln.pred.NM <- CatDynPred(jflselkirk2223.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.3P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.1.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2223.3P.1.n.pred.spg <- CatDynPred(jflselkirk2223.3P.1.n.fit,"spg")
# plot(x=jflselkirk2223.3P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.1.n.pred.CG <- CatDynPred(jflselkirk2223.3P.1.n.fit,"CG")
# plot(x=jflselkirk2223.3P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.1.n.pred.NM <- CatDynPred(jflselkirk2223.3P.1.n.fit,"Nelder-Mead")
plot(x=jflselkirk2223.3P.1.n.pred.NM,                                           ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.3P.1.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2223.3P.1.ln.pred.spg <- CatDynPred(jflselkirk2223.3P.1.ln.fit,"spg")   
# plot(x=jflselkirk2223.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.1.ln.pred.CG <- CatDynPred(jflselkirk2223.3P.1.ln.fit,"CG")
# plot(x=jflselkirk2223.3P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.1.ln.pred.NM <- CatDynPred(jflselkirk2223.3P.1.ln.fit,"Nelder-Mead")
plot(x=jflselkirk2223.3P.1.ln.pred.NM,                                          ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,
                 54,                                                            # the week of one input of abundance
                 59,
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.3P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.3P.2.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2223.3P.2.apn.pred.spg <- CatDynPred(jflselkirk2223.3P.2.apn.fit,"spg")
plot(x=jflselkirk2223.3P.2.apn.pred.spg,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.3P.2.apn.pred.CG <- CatDynPred(jflselkirk2223.3P.2.apn.fit,"CG")
plot(x=jflselkirk2223.3P.2.apn.pred.CG,                                         ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.apn.pred.NM <- CatDynPred(jflselkirk2223.3P.2.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.3P.2.apn.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.2.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.3P.2.apln.pred.spg <- CatDynPred(jflselkirk2223.3P.2.apln.fit,"spg")
# plot(x=jflselkirk2223.3P.2.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.apln.pred.CG <- CatDynPred(jflselkirk2223.3P.2.apln.fit,"CG")
# plot(x=jflselkirk2223.3P.2.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.apln.pred.NM <- CatDynPred(jflselkirk2223.3P.2.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.3P.2.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.2.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jflselkirk2223.3P.2.n.pred.spg <- CatDynPred(jflselkirk2223.3P.2.n.fit,"spg")
plot(x=jflselkirk2223.3P.2.n.pred.spg,                                          ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.3P.2.n.pred.CG <- CatDynPred(jflselkirk2223.3P.2.n.fit,"CG")
plot(x=jflselkirk2223.3P.2.n.pred.CG,                                           ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.n.pred.NM <- CatDynPred(jflselkirk2223.3P.2.n.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.3P.2.n.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.3P.2.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk2223.3P.2.ln.pred.spg <- CatDynPred(jflselkirk2223.3P.2.ln.fit,"spg")
# plot(x=jflselkirk2223.3P.2.ln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.ln.pred.CG <- CatDynPred(jflselkirk2223.3P.2.ln.fit,"CG")
# plot(x=jflselkirk2223.3P.2.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.3P.2.ln.pred.NM <- CatDynPred(jflselkirk2223.3P.2.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.3P.2.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
P4.ini      <- 20
k.ini       <- 6.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.4P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,k.ini,alpha.ini,beta.ini))
#
dates.4P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 54,
                 59,
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.4P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=4,
                                       par=pars.ini.4P,
                                       dates=dates.4P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.4P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.4P.1.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=4,
                                          par=pars.ini.4P,
                                          dates=dates.4P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jflselkirk2223.4P.1.apn.pred.spg <- CatDynPred(jflselkirk2223.4P.1.apn.fit,"spg")
plot(x=jflselkirk2223.4P.1.apn.pred.spg,                                        ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.4P.1.apn.pred.CG <- CatDynPred(jflselkirk2223.4P.1.apn.fit,"CG")
plot(x=jflselkirk2223.4P.1.apn.pred.CG,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.apn.pred.NM <- CatDynPred(jflselkirk2223.4P.1.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.4P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.4P.1.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=4,
                                           par=pars.ini.4P,
                                           dates=dates.4P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.4P.1.apln.pred.spg <- CatDynPred(jflselkirk2223.4P.1.apln.fit,"spg")
# plot(x=jflselkirk2223.4P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.apln.pred.CG <- CatDynPred(jflselkirk2223.4P.1.apln.fit,"CG")
# plot(x=jflselkirk2223.4P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.apln.pred.NM <- CatDynPred(jflselkirk2223.4P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.4P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.4P.1.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=4,
                                        par=c(pars.ini.4P,psi.n.ini),
                                        dates=dates.4P,
                                        distr="normal",
                                        method=c("spg","CG"),#c("spg","Nelder-Mead"),#
                                        itnmax=50000)
#
jflselkirk2223.4P.1.n.pred.spg <- CatDynPred(jflselkirk2223.4P.1.n.fit,"spg")
plot(x=jflselkirk2223.4P.1.n.pred.spg,                                          ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.4P.1.n.pred.CG <- CatDynPred(jflselkirk2223.4P.1.n.fit,"CG")
plot(x=jflselkirk2223.4P.1.n.pred.CG,                                           ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.n.pred.NM <- CatDynPred(jflselkirk2223.4P.1.n.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.4P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.4P.1.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=4,
                                         par=c(pars.ini.4P,psi.ln.ini),
                                         dates=dates.4P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jflselkirk2223.4P.1.ln.pred.spg <- CatDynPred(jflselkirk2223.4P.1.ln.fit,"spg")
# plot(x=jflselkirk2223.4P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.ln.pred.CG <- CatDynPred(jflselkirk2223.4P.1.ln.fit,"CG")
# plot(x=jflselkirk2223.4P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.4P.1.ln.pred.NM <- CatDynPred(jflselkirk2223.4P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.4P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 3 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*49
P1.ini      <- 45
P2.ini      <- 50
P3.ini      <- 20
P4.ini      <- 20
P5.ini      <- 5
k.ini       <- 7.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.5P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,P4.ini,P5.ini,k.ini,alpha.ini,beta.ini))
#
dates.5P    <- c(head(jflselkirk2223$Data$nasas$time.step,1),                    # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 54,
                 59,
                 63,
                 tail(jflselkirk2223$Data$nasas$time.step,1))
#
jflselkirk2223.5P.apn.ini <- catdynexp(x=jflselkirk2223,
                                       p=5,
                                       par=pars.ini.5P,
                                       dates=dates.5P,
                                       distr="apnormal")
#
plot(x=jflselkirk2223.5P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jflselkirk2223.5P.1.apn.fit  <- CatDynFit(x=jflselkirk2223,
                                          p=5,
                                          par=pars.ini.5P,
                                          dates=dates.5P,
                                          distr="apnormal",
                                          method="spg",#c("spg","CG"),
                                          itnmax=50000)
#
jflselkirk2223.5P.1.apn.pred.spg <- CatDynPred(jflselkirk2223.5P.1.apn.fit,"spg")
plot(x=jflselkirk2223.5P.1.apn.pred.spg,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.apn.pred.CG <- CatDynPred(jflselkirk2223.5P.1.apn.fit,"CG")
# plot(x=jflselkirk2223.5P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.apn.pred.NM <- CatDynPred(jflselkirk2223.5P.1.apn.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.5P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.5P.1.apln.fit  <- CatDynFit(x=jflselkirk2223,
                                           p=5,
                                           par=pars.ini.5P,
                                           dates=dates.5P,
                                           distr="aplnormal",
                                           method="CG",#c("spg","CG"),
                                           itnmax=50000)
#
# jflselkirk2223.5P.1.apln.pred.spg <- CatDynPred(jflselkirk2223.5P.1.apln.fit,"spg") 
# plot(x=jflselkirk2223.5P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.apln.pred.CG <- CatDynPred(jflselkirk2223.5P.1.apln.fit,"CG")
# plot(x=jflselkirk2223.5P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.apln.pred.NM <- CatDynPred(jflselkirk2223.5P.1.apln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.5P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.5P.1.n.fit  <- CatDynFit(x=jflselkirk2223,
                                        p=5,
                                        par=c(pars.ini.5P,psi.n.ini),
                                        dates=dates.5P,
                                        distr="normal",
                                        method="CG",#c("spg","CG"),
                                        itnmax=50000)
#
# jflselkirk2223.5P.1.n.pred.spg <- CatDynPred(jflselkirk2223.5P.1.n.fit,"spg")
# plot(x=jflselkirk2223.5P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.n.pred.CG <- CatDynPred(jflselkirk2223.5P.1.n.fit,"CG")
# plot(x=jflselkirk2223.5P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.n.pred.NM <- CatDynPred(jflselkirk2223.5P.1.n.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.5P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jflselkirk2223.5P.1.ln.fit  <- CatDynFit(x=jflselkirk2223,
                                         p=5,
                                         par=c(pars.ini.5P,psi.ln.ini),
                                         dates=dates.5P,
                                         distr="lognormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jflselkirk2223.5P.1.ln.pred.spg <- CatDynPred(jflselkirk2223.5P.1.ln.fit,"spg")   
# plot(x=jflselkirk2223.5P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.ln.pred.CG <- CatDynPred(jflselkirk2223.5P.1.ln.fit,"CG")
# plot(x=jflselkirk2223.5P.1.ln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jflselkirk2223.5P.1.ln.pred.NM <- CatDynPred(jflselkirk2223.5P.1.ln.fit,"Nelder-Mead")
# plot(x=jflselkirk2223.5P.1.ln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Model variant selection
x1 <- list(jflselkirk2223.3P.1.apn.fit, ###01
           jflselkirk2223.3P.1.n.fit,   ###02
           jflselkirk2223.3P.1.ln.fit,  ###03
           jflselkirk2223.3P.2.apn.fit, ###04
           jflselkirk2223.3P.2.apn.fit, ###05
           jflselkirk2223.3P.2.n.fit,   ###06
           jflselkirk2223.3P.2.n.fit,   ###07
           jflselkirk2223.4P.1.apn.fit, ###08
           jflselkirk2223.4P.1.apn.fit, ###09
           jflselkirk2223.4P.1.n.fit,   ###10
           jflselkirk2223.4P.1.n.fit,   ###11
           jflselkirk2223.5P.1.apn.fit) ###12
m1 <- c("Nelder-Mead",
        "Nelder-Mead",
        "Nelder-Mead",
        "spg","CG",
        "spg","CG",
        "spg","CG",
        "spg","CG",
        "spg")
# Take out variants with gradients > 1
jflselkirk2223.sum.0  <- CatDynSum(x=x1,season="2012-2013",method=m1)
#jflselkirk2223.sum.1  <- jflselkirk2223.sum.0[jflselkirk2223.sum.0$Max.Abs.Grads.<1,]
# All grads good
# AIC within variants weith same likelihood
jflselkirk2223.sum.0[jflselkirk2223.sum.0$Distribution=="apnormal",]
#jflselkirk2223.sum.0[jflselkirk2223.sum.0$Distribution=="aplnormal",]
jflselkirk2223.sum.0[jflselkirk2223.sum.0$Distribution=="normal",]
#jflselkirk2223.sum.0[jflselkirk2223.sum.0$Distribution=="lognormal",]
# 3P.2 better apn, n likelihoods
#jflselkirk2223.sum.1 <- jflselkirk2223.sum.0[jflselkirk2223.sum.0$Model %in% c("4P","5P"),]
jflselkirk2223.sum.1 <- jflselkirk2223.sum.0[4:7,]
#
CatDynCor(x=x1[as.numeric(row.names(jflselkirk2223.sum.1))],                     
          ttl=paste(jflselkirk2223.sum.1$Model,
                    substring(jflselkirk2223.sum.1$Distribution, 1,8),
                    jflselkirk2223.sum.1$Method,
                    as.numeric(row.names(jflselkirk2223.sum.1))),
          method=m1[as.numeric(row.names(jflselkirk2223.sum.1))],
          arr=c(2,2))
# All similar
# jflselkirk2223.sum.2 <- jflselkirk2223.sum.1[which(!row.names(jflselkirk2223.sum.1) %in% 
#                                                      c("1","3")),]
#
(jflselkirk2223.3P.2.apn.spg.partable  <- CatDynPar(x=jflselkirk2223.3P.2.apn.fit,method="spg"))  ###04
(jflselkirk2223.3P.2.apn.CG.partable   <- CatDynPar(x=jflselkirk2223.3P.2.apn.fit,method="CG"))   ###05
(jflselkirk2223.3P.2.n.spg.partable    <- CatDynPar(x=jflselkirk2223.3P.2.n.fit,method="spg"))    ###06
(jflselkirk2223.3P.2.n.CG.partable     <- CatDynPar(x=jflselkirk2223.3P.2.n.fit,method="CG"))     ###07
#
plot(x=jflselkirk2223.3P.2.apn.pred.CG,                                         ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflselkirk2223$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jflselkirk2223.sum.0$Sel.Model[5] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.15.- All selected models                                                 #
################################################################################
#
# Overview of all fitted and selected variants
JFLSelkirk.SelMods <- data.frame(YearStart=2009:2022,
                                 YearEnd=2010:2023,
                                 NumberFits=c(2*length(ls()[grep("fit",ls())][grep("selkirk0910",ls()[grep("fit",ls())])]),
                                              2*length(ls()[grep("fit",ls())][grep("selkirk1011",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1112",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1213",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1314",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1415",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1516",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1617",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1718",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1819",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk1920",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk2021",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk2122",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("selkirk2223",ls()[grep("fit",ls())])])),
                                 RetainedFits=c(dim(jflselkirk0910.sum.0)[1],
                                                dim(jflselkirk1011.sum.0)[1],
                                                dim(jflselkirk1112.sum.0)[1],
                                                dim(jflselkirk1213.sum.0)[1],
                                                dim(jflselkirk1314.sum.0)[1],
                                                1,
                                                dim(jflselkirk1516.sum.0)[1],
                                                dim(jflselkirk1617.sum.0)[1],
                                                dim(jflselkirk1718.sum.0)[1],
                                                dim(jflselkirk1819.sum.0)[1],
                                                1,
                                                dim(jflselkirk2021.sum.0)[1],
                                                dim(jflselkirk2122.sum.0)[1],
                                                dim(jflselkirk2223.sum.0)[1]),
                                 SelMod.name=c("jflselkirk0910.3P.1.apln.fit",
                                               "jflselkirk1011.3P.1.apn.fit",
                                               "jflselkirk1112.2P.2.apn.fit",
                                               "jflselkirk1213.2P.2.apn.fit",
                                               "jflselkirk1314.5P.4.apn.fit",
                                               "jflselkirk1415.4P.1.n.fit",
                                               "jflselkirk1516.3P.1.apn.fit",
                                               "jflselkirk1617.5P.2.apn.fit",
                                               "jflselkirk1718.3P.1.apn.fit",
                                               "jflselkirk1819.3P.4.apln.fit",
                                               "jflselkirk1920.1P.1.apn.fit",
                                               "jflselkirk2021.5P.3.apn.fit",
                                               "jflselkirk2122.3P.2.n.fit",
                                               "jflselkirk2223.3P.2.apn.fit"),
                                 SelMod.lik=c("apln",
                                              "apn",
                                              "apn",
                                              "apn",
                                              "apn",
                                              "n",
                                              "apn",
                                              "apn",
                                              "apn",
                                              "apln",
                                              "apn",
                                              "apn",
                                              "n",
                                              "apn"),
                                 SelMod.meth=c("CG",
                                               "CG",
                                               "CG",
                                               "spg",
                                               "spg",
                                               "Nelder-Mead",
                                               "spg",
                                               "Nelder-Mead",
                                               "CG",
                                               "CG",
                                               "Nelder-Mead",
                                               "spg",
                                               "Nelder-Mead",
                                               "CG"),
                                 FirstWeek=c(39,36,38,40,38,37,39,38,41,40,40,39,40,40),
                                 P1.timing=c(40,37,47,47,39,46,43,39,45,46,46,45,43,44),
                                 P2.timing=c(52,47,51,68,46,48,54,42,52,53,"",49,50,54),
                                 P3.timing=c(54,53,"","",49,57,58,44,67,55,"",54,57,59),
                                 P4.timing=c("","","","",54,59,"",51,"","","",57,"",""),
                                 P5.timing=c("","","","",65,"","",54,"","","",68,"",""),
                                 LastWeek =c(59,68,71,73,71,69,71,73,72,72,75,72,72,72))
#                                           09 10 11 12 13 14 15 16 17 18 19 20 21 22
#
# List with fits that contain the selected variant
JFLSelkirk.Iagdfits <- list(jflselkirk0910.3P.1.apln.fit,
                            jflselkirk1011.3P.1.apn.fit,
                            jflselkirk1112.2P.2.apn.fit,
                            jflselkirk1213.2P.2.apn.fit,
                            jflselkirk1314.5P.4.apn.fit,
                            jflselkirk1415.4P.1.n.fit,
                            jflselkirk1516.3P.1.apn.fit,
                            jflselkirk1617.5P.2.apn.fit,
                            jflselkirk1718.3P.1.apn.fit,
                            jflselkirk1819.3P.4.apln.fit,
                            jflselkirk1920.1P.1.apn.fit,
                            jflselkirk2021.5P.3.apn.fit,
                            jflselkirk2122.3P.2.n.fit,
                            jflselkirk2223.3P.2.apn.fit)
names(JFLSelkirk.Iagdfits) <- paste(2009:2022,2010:2023,sep="-")
#
# List of predictions of the selected variant
JFLSelkirk.Iagdpreds <- list(jflselkirk0910.3P.1.apln.pred.CG,
                             jflselkirk1011.3P.1.apn.pred.CG,
                             jflselkirk1112.2P.2.apn.pred.CG,
                             jflselkirk1213.2P.2.apn.pred.spg,
                             jflselkirk1314.5P.4.apn.pred.spg,
                             jflselkirk1415.4P.1.n.pred.NM,
                             jflselkirk1516.3P.1.apn.pred.spg,
                             jflselkirk1617.5P.2.apn.pred.NM,
                             jflselkirk1718.3P.1.apn.pred.CG,
                             jflselkirk1819.3P.4.apln.pred.CG,
                             jflselkirk1920.1P.1.apn.pred.NM,
                             jflselkirk2021.5P.3.apn.pred.spg,
                             jflselkirk2122.3P.2.n.pred.NM,
                             jflselkirk2223.3P.2.apn.pred.spg)
x <- paste(2009:2022,2010:2023,sep="-")
for(i in 1:14)
{
  names(JFLSelkirk.Iagdpreds)[i] <- x[i]
}
#
# All seasons summary table
JFLSelkirk.sum.0910.2223           <- CatDynSum(x=JFLSelkirk.Iagdfits,season="0910-2023",method=JFLSelkirk.SelMods$SelMod.meth)
JFLSelkirk.sum.0910.2223$N0        <- as.numeric(JFLSelkirk.sum.0910.2223$N0)
JFLSelkirk.sum.0910.2223$Season    <- paste(2009:2022,2010:2023,sep="-")
JFLSelkirk.sum.0910.2223$Sel.Model <- 1
JFLSelkirk.sum.0910.2223$Besc.ton  <- sapply(1:length(JFLSelkirk.Iagdpreds), function(u) tail(JFLSelkirk.Iagdpreds[[u]]$Model$Results$Predicted.Biomass.tonnes,1))
#
# Fixing missing standard errors with multivariate imputation technique
cbind(1:dim(JFLSelkirk.sum.0910.2223)[2],names(JFLSelkirk.sum.0910.2223))
# library(mice)
imp1                            <- mice(JFLSelkirk.sum.0910.2223[,9:10], method="pmm",m=1,maxit=1000)      #M and SE.M
JFLSelkirk.sum.0910.2223[,9:10]  <- complete(imp1)
imp1                            <- mice(JFLSelkirk.sum.0910.2223[,11:12], method="pmm",m=1,maxit=1000)     #N0 and SE.N0
JFLSelkirk.sum.0910.2223[,11:12] <- complete(imp1)
imp1                            <- mice(JFLSelkirk.sum.0910.2223[,28:29], method="pmm",m=1,maxit=1000)     #k and SE.k
JFLSelkirk.sum.0910.2223[,28:29] <- complete(imp1)
imp1                            <- mice(JFLSelkirk.sum.0910.2223[,30:31], method="pmm",m=1,maxit=1000)     #alpha and SE.alpha
JFLSelkirk.sum.0910.2223[,30:31] <- complete(imp1)
imp1                            <- mice(JFLSelkirk.sum.0910.2223[,32:33], method="pmm",m=1,maxit=1000)     #beta and SE.beta
JFLSelkirk.sum.0910.2223[,32:33] <- complete(imp1)
rm(imp1)
#
# Calculating standard error of starting biomass prediction
# mbw.sd <- data.frame(Season=paste(2009:2022,2010:2023,sep="-"),
#                      Start.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==38],
#                      Start.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==38],
#                      End.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==(71-53)],
#                      End.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==(71-53)])
# #
# mbw.sd$Start.Mean.weekly.weight.kg     <- 1e-3*lw.a*mbw.sd$Start.Mean.weekly.length.mm^lw.b
# mbw.sd$Start.SD.mean.weekly.weight.kg  <- 1e-3*lw.a*mbw.sd$Start.SD.Mean.weekly.length.mm^lw.b
# mbw.sd$End.Mean.weekly.weight.kg       <- 1e-3*lw.a*mbw.sd$End.Mean.weekly.length.mm^lw.b
# mbw.sd$End.SD.mean.weekly.weight.kg    <- 1e-3*lw.a*mbw.sd$End.SD.Mean.weekly.length.mm^lw.b
JFLSelkirk.StartBiom                    <- CatDynBSD(x=JFLSelkirk.Iagdfits,     
                                                     method=JFLSelkirk.SelMods$SelMod.meth,
                                                     multi=FALSE,
                                                     mbw.sd=mbw.sd[c(8:21),c(1,6,7)])
JFLSelkirk.StartBiom$B0Tot.ton.CV       <- 100*JFLSelkirk.StartBiom$B0Tot.ton.SE/JFLSelkirk.StartBiom$B0Tot.ton
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.16.- Fit plots                                                           #
################################################################################
#
tiff("Fig29CatDynSelkirkFit0910.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2009-2010']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe0910$Data$nasas)[1],
     Biom.xpos=0.75,
     Biom.ypos=0.8,
     Cat.xpos=0.75,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig30CatDynSelkirkFit1011.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2010-2011']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig31CatDynSelkirkFit1112.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2011-2012']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig32CatDynSelkirkFit1213.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2012-2013']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig33CatDynSelkirkFit1314.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2013-2014']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.55,
     Biom.ypos=0.8,
     Cat.xpos=0.55,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig34CatDynSelkirkFit1415.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2014-2015']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig35CatDynSelkirkFit1516.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2015-2016']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig36CatDynSelkirkFit1617.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2016-2017']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig37CatDynSelkirkFit1718.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2017-2018']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig38CatDynSelkirkFit1819.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2018-2019']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1819$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig39CatDynSelkirkFit1920.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2019-2020']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1920$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig40CatDynSelkirkFit2021.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2020-2021']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2021$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig41CatDynSelkirkFit2122.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2021-2022']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2122$Data$nasas)[1],
     Biom.xpos=0.55,
     Biom.ypos=0.8,
     Cat.xpos=0.55,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig42CatDynSelkirkFit2223.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLSelkirk.Iagdpreds[['2022-2023']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe2223$Data$nasas)[1],
     Biom.xpos=0.55,
     Biom.ypos=0.8,
     Cat.xpos=0.55,
     Cat.ypos=0.75)
dev.off()
#
################################################################################
# 2.2.17.- Parameters plot                                                     #
################################################################################
#
tiff("Fig43CatDynSelkirkPars.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(3,2),mar=c(2,2,1,1),oma=c(3,3,1,1))
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=53*JFLSelkirk.sum.0910.2223$M,
       yplus=53*(JFLSelkirk.sum.0910.2223$M+2*JFLSelkirk.sum.0910.2223$SE.M),
       yminus=53*(JFLSelkirk.sum.0910.2223$M-2*JFLSelkirk.sum.0910.2223$SE.M),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,3.5))
legend("top",legend=expression(paste("Annualized ",italic(M),sep="")),bty="n")
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=JFLSelkirk.sum.0910.2223$N0,
       yplus=(JFLSelkirk.sum.0910.2223$N0+2*JFLSelkirk.sum.0910.2223$SE.N0),
       yminus=(JFLSelkirk.sum.0910.2223$N0-2*JFLSelkirk.sum.0910.2223$SE.N0),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,200))
legend("top",legend=expression(paste(N[0]," (thousands)",sep="")),bty="n")
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=JFLSelkirk.sum.0910.2223$P1.nasas,
       yplus=(JFLSelkirk.sum.0910.2223$P1.nasas+2*JFLSelkirk.sum.0910.2223$SE.P1.nasas),
       yminus=(JFLSelkirk.sum.0910.2223$P1.nasas-2*JFLSelkirk.sum.0910.2223$SE.P1.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,200))
legend("top",legend=expression(paste(R[1]," (thousands)",sep="")),bty="n")
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=1e4*JFLSelkirk.sum.0910.2223$k.nasas,
       yplus=1e4*(JFLSelkirk.sum.0910.2223$k.nasas+2*JFLSelkirk.sum.0910.2223$SE.k.nasas),
       yminus=1e4*(JFLSelkirk.sum.0910.2223$k.nasas-2*JFLSelkirk.sum.0910.2223$SE.k.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,50))
legend("top",legend=expression(paste(10^4*italic(k)," (1/days)",sep="")),bty="n")
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=JFLSelkirk.sum.0910.2223$alpha.nasas,
       yplus=(JFLSelkirk.sum.0910.2223$alpha.nasas+2*JFLSelkirk.sum.0910.2223$SE.alpha.nasas),
       yminus=(JFLSelkirk.sum.0910.2223$alpha.nasas-2*JFLSelkirk.sum.0910.2223$SE.alpha.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,2))
abline(v=1)
legend("top",legend=expression(alpha),bty="n")
errbar(x=JFLSelkirk.sum.0910.2223$Season,
       y=JFLSelkirk.sum.0910.2223$beta.nasas,
       yplus=(JFLSelkirk.sum.0910.2223$beta.nasas+2*JFLSelkirk.sum.0910.2223$SE.beta.nasas),
       yminus=(JFLSelkirk.sum.0910.2223$beta.nasas-2*JFLSelkirk.sum.0910.2223$SE.beta.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,4))
abline(v=1)
legend("top",legend=expression(beta),bty="n")
dev.off()
#
################################################################################
# 2.2.18.- Exploitation rate plot                                              #
################################################################################
#
cbind(JFLSelkirk.SelMods$Year,JFLSelkirk.SelMods$SelMod.meth)
tiff("Fig44CatDynSelkirkFM.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(7,2),oma=c(1,1,1,1),mar=c(1,1,1,1))
#2009-2010
plot(JFLSelkirk.Iagdpreds[["2009-2010"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2009-2010"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[1]+0.05))
abline(h=JFLSelkirk.Iagdfits[["2009-2010"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2009-2010")
#2010-2011
plot(JFLSelkirk.Iagdpreds[["2010-2011"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2010-2011"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[2]+0.03))
abline(h=JFLSelkirk.Iagdfits[["2010-2011"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2010-2011")
#2011-2012
plot(JFLSelkirk.Iagdpreds[["2011-2012"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2011-2012"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[3]+0.05))
abline(h=JFLSelkirk.Iagdfits[["2011-2012"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2011-2012")
#2012-2013
plot(JFLSelkirk.Iagdpreds[["2012-2013"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2012-2013"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[4]+0.03))
abline(h=JFLSelkirk.Iagdfits[["2012-2013"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2012-2013")
#2013-2014
plot(JFLSelkirk.Iagdpreds[["2013-2014"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2013-2014"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[5]+0.05))
abline(h=JFLSelkirk.Iagdfits[["2013-2014"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2013-2014")
#2014-2015
plot(JFLSelkirk.Iagdpreds[["2014-2015"]]$Model$Results$Period.week-53,
     JFLSelkirk.Iagdpreds[["2014-2015"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[6]+0.08))
abline(h=JFLSelkirk.Iagdfits[["2014-2015"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2014-2015")
#2015-2016
plot(JFLSelkirk.Iagdpreds[["2015-2016"]]$Model$Results$Period.week,                              
     JFLSelkirk.Iagdpreds[["2015-2016"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[7]+0.06))
abline(h=JFLSelkirk.Iagdfits[["2015-2016"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2015-2016")
#2016-2017
plot(JFLSelkirk.Iagdpreds[["2016-2017"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2016-2017"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[8]+0.15))
abline(h=JFLSelkirk.Iagdfits[["2016-2017"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2016-2017")
#2017-2018
plot(JFLSelkirk.Iagdpreds[["2017-2018"]]$Model$Results$Period.week,                   
     JFLSelkirk.Iagdpreds[["2017-2018"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[9]+0.14))
abline(h=JFLSelkirk.Iagdfits[["2017-2018"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2017-2018")
#2018-2019
plot(JFLSelkirk.Iagdpreds[["2018-2019"]]$Model$Results$Period.week,                           
     JFLSelkirk.Iagdpreds[["2018-2019"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[10]+0.1))
abline(h=JFLSelkirk.Iagdfits[["2018-2019"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2018-2019")
#2019-2020
plot(JFLSelkirk.Iagdpreds[["2019-2020"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2019-2020"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[11]+0.14))
abline(h=JFLSelkirk.Iagdfits[["2019-2020"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2019-2020")
#2020-2021
plot(JFLSelkirk.Iagdpreds[["2020-2021"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2020-2021"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[12]+0.07))
abline(h=JFLSelkirk.Iagdfits[["2020-2021"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2020-2021")
#2021-2022
plot(JFLSelkirk.Iagdpreds[["2021-2022"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2021-2022"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[13]+0.08))
abline(h=JFLSelkirk.Iagdfits[["2021-2022"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2021-2022")
#2022-2023
plot(JFLSelkirk.Iagdpreds[["2022-2023"]]$Model$Results$Period.week,
     JFLSelkirk.Iagdpreds[["2022-2023"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLSelkirk.sum.0910.2223$M[14]+0.22))
abline(h=JFLSelkirk.Iagdfits[["2022-2023"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2022-2023")
#
dev.off()
#
################################################################################
# 2.2.19.- Starting biomass plot                                               #
################################################################################
#
#tiff("FigXXCatDynSelkirkStartBiom.tiff",width=15,height=15,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(4,4,1,1))
plot(JFLSelkirk.StartBiom$Year,
     JFLSelkirk.StartBiom$B0Tot.ton,
     ylim=c(0,250),
     cex=10*1/JFLSelkirk.StartBiom$B0Tot.ton.CV,
     pch=19,
     col="green4",
     type="b",
     xlab="Year",
     ylab="Start of season biomass (tonnes)",
     main=expression(italic(Jasus~frontalis)))
points(JFLSelkirk.StartBiom$Year,
       1e-3*c(sum(jflcrusoe0910$Data$nasas$obscat.kg),
              sum(jflcrusoe1011$Data$nasas$obscat.kg),
              sum(jflcrusoe1112$Data$nasas$obscat.kg),
              sum(jflcrusoe1213$Data$nasas$obscat.kg),
              sum(jflcrusoe1314$Data$nasas$obscat.kg),
              sum(jflcrusoe1415$Data$nasas$obscat.kg),
              sum(jflcrusoe1516$Data$nasas$obscat.kg),
              sum(jflcrusoe1617$Data$nasas$obscat.kg),
              sum(jflcrusoe1718$Data$nasas$obscat.kg),
              sum(jflcrusoe1819$Data$nasas$obscat.kg),
              sum(jflcrusoe1920$Data$nasas$obscat.kg),
              sum(jflcrusoe2021$Data$nasas$obscat.kg),
              sum(jflcrusoe2122$Data$nasas$obscat.kg),
              sum(jflcrusoe2223$Data$nasas$obscat.kg)),
       type="h",
       lwd=15,
       col="blue")
#dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.20.- Initial values for ADMB from toy Surplus production model           #
################################################################################
#
FYrInd                 <- 2009 # Use starting year of each season
LYrInd                 <- 2022
FYrLan                 <- 2009
LYrLan                 <- 2022
nyears                 <- LYrLan-FYrLan+1
JFLSelkirk.InniBiom.ton <- data.frame(Year=FYrLan:LYrLan,
                                     Landings.ton=1e-3*c(sum(jflselkirk0910$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1011$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1112$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1213$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1314$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1415$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1516$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1617$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1718$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1819$Data$nasas$obscat.kg),
                                                         sum(jflselkirk1920$Data$nasas$obscat.kg),
                                                         sum(jflselkirk2021$Data$nasas$obscat.kg),
                                                         sum(jflselkirk2122$Data$nasas$obscat.kg),
                                                         sum(jflselkirk2223$Data$nasas$obscat.kg)))
JFLSelkirk.InniBiom.ton$B0.CatDyn    <- JFLSelkirk.StartBiom$B0Tot.ton
JFLSelkirk.InniBiom.ton$SE.B0.CatDyn <- JFLSelkirk.StartBiom$B0Tot.ton.SE
#
# Initial values of parameters for PT model under constant parameters           HERE
#
B0.ini              <- 0.2*800
K.ini               <- 700
p.ini               <- 1.2
r.ini               <- 0.9
Stock.pt    <- rep(0,LYrLan-FYrLan+1)
Stock.pt[1] <- B0.ini
for(i in 2:(LYrLan-FYrLan+1))
{
  Stock.pt[i] <- Stock.pt[i-1]+r.ini*Stock.pt[i-1]*(1-(Stock.pt[i-1]/K.ini)^(p.ini-1))-JFLSelkirk.InniBiom.ton$Landings.ton[i-1];
}
#
par(mfrow=c(1,1),mar=c(4,4,1,1),oma=c(4,4,1,1))
plot(JFLSelkirk.InniBiom.ton$Year,JFLSelkirk.InniBiom.ton$B0.CatDyn,ylim=c(0,300),pch=19)
lines(JFLSelkirk.InniBiom.ton$Year,Stock.pt,col="blue",lwd=2)
lines(JFLSelkirk.InniBiom.ton$Year,JFLSelkirk.InniBiom.ton$Landings.ton,col="red",lwd=2)
#
# x        <- Stock.pt[1:13]
# y        <- JFLSelkirk.InniBiom.ton$Landings.ton[1:13]
# z        <- Stock.pt[2:14]
# pt.nlreg <- nls(z ~ x+r.ini*x*(1-(x/K.ini)^p.ini)-y,
#                 start = list(r.ini = r.ini, K.ini = K.ini, p.ini=p.ini),
#                 control=list(maxiter=500000,tol=1e-3))
(log.B0.ini  <- log(B0.ini))
#[1] 5.075174
(log.K.ini   <- log(K.ini))
#[1] 6.55108
(log.p.ini   <- log(p.ini))
#[1] 0.1823216
(log.r.ini   <- log(r.ini))
#[1] -0.1053605
#
t(JFLSelkirk.InniBiom.ton$Landings.ton)
JFLSelkirk.InniBiom.ton[,c(1,3,4)]
#
save.image("JFLobsters.0203.2021.RData")
#
################################################################################
# 2.2.21.- Bringing output from ADMB and model selection                       #
################################################################################
#
# Variant 2
npar.jfjfas.1reg4p            <- 4
maxgrad.admb.pt.jfjfas.1reg4p <- read.table("marlikptjfjfas1reg4p.par",comment.char="",nrows=1)$V16
# [1] 9.020362e-07
lik.admb.pt.jfjfas.1reg4p     <- read.table("marlikptjfjfas1reg4p.par",comment.char="",nrows=1)$V11
AIC.admb.pt.jfjfas.1reg4p     <- 2*npar.jfjfas.1reg4p - 2*lik.admb.pt.jfjfas.1reg4p
# [1] -166.4785
#
Correlations
# Variant 2
cor.admb.pt.jfjfas.1reg4p <- read.table("marlikptjfjfas1reg4p.cor",
                                        header=TRUE,
                                        skip=1,
                                        fill=TRUE)
cor.admb.pt.jfjfas.1reg4p                                   <- cor.admb.pt.jfjfas.1reg4p[(npar.jfjfas.1reg4p+1):(dim(cor.admb.pt.jfjfas.1reg4p)[1]),(4+npar.jfjfas.1reg4p+1):dim(cor.admb.pt.jfjfas.1reg4p)[2]]
cor.admb.pt.jfjfas.1reg4p[is.na(cor.admb.pt.jfjfas.1reg4p)] <- 0
cor.admb.pt.jfjfas.1reg4p                                   <- as.matrix(cor.admb.pt.jfjfas.1reg4p)
cor.admb.pt.jfjfas.1reg4p                                   <- cor.admb.pt.jfjfas.1reg4p + t(cor.admb.pt.jfjfas.1reg4p) - diag(diag(cor.admb.pt.jfjfas.1reg4p))
cor.admb.pt.jfjfas.1reg4p                                   <- forceSymmetric(cor.admb.pt.jfjfas.1reg4p)
cor.admb.pt.jfjfas.1reg4p                                   <- as.matrix(cor.admb.pt.jfjfas.1reg4p)
row.names(cor.admb.pt.jfjfas.1reg4p)                        <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
colnames(cor.admb.pt.jfjfas.1reg4p)                         <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
#
# Summary table
pt.pars.admb.jfjfas <- data.frame(Variant=c(rep(2,npar.jfjfas.1reg4p)),
                                  Max.Abs.Grad=c(rep(round(maxgrad.admb.pt.jfjfas.1reg4p,7),npar.jfjfas.1reg4p)),
                                  AIC=c(rep(round(AIC.admb.pt.jfjfas.1reg4p),npar.jfjfas.1reg4p)),
                                  N.pars=c(rep(npar.jfjfas.1reg4p,npar.jfjfas.1reg4p)),
                                  Description=c(rep("B0!=K",npar.jfjfas.1reg4p)),
                                  Par=c("B0","K","p","r"),
                                  MLE=c(read.table("marlikptjfjfas1reg4p.std",skip=(npar.jfjfas.1reg4p+1),header=FALSE)[1:npar.jfjfas.1reg4p,3]),
                                  SE=c(read.table("marlikptjfjfas1reg4p.std",skip=(npar.jfjfas.1reg4p+1),header=FALSE)[1:npar.jfjfas.1reg4p,4]))
pt.pars.admb.jfjfas$CV.pc   <- c(round(100*pt.pars.admb.jfjfas$SE/pt.pars.admb.jfjfas$MLE,1))
pt.pars.admb.jfjfas$SelMod  <- c(rep(1,npar.jfjfas.1reg4p))
#
# PT parameters and biomass time series
pars.admb.pt.jfjfas.1reg4p           <- read.table("marlikptjfjfas1reg4p.std",skip=(npar.jfjfas.1reg4p+1),header=FALSE)[1:npar.jfjfas.1reg4p,3:4]
names(pars.admb.pt.jfjfas.1reg4p)    <- c("MLE","SD")
rownames(pars.admb.pt.jfjfas.1reg4p) <- c("B0","K","p","r")
K.jfjfas.1reg4p                      <- round(pars.admb.pt.jfjfas.1reg4p["K","MLE"])
p.jfjfas.1reg4p                      <- pars.admb.pt.jfjfas.1reg4p["p","MLE"]
r.jfjfas.1reg4p                      <- pars.admb.pt.jfjfas.1reg4p["r","MLE"]   
Stock.admb.pt.jfjfas.1reg4p          <- cbind(FYrLan:(LYrLan+1),read.table("marlikptjfjfas1reg4p.std",skip=1+2*npar.jfjfas.1reg4p,header=FALSE)[,3:4])
names(Stock.admb.pt.jfjfas.1reg4p)   <- c("Year","Biomass.ton","SD.Biomass.ton")
Stock.admb.pt.jfjfas.1reg4p$CV.pc    <- 100*Stock.admb.pt.jfjfas.1reg4p$SD.Biomass.ton/Stock.admb.pt.jfjfas.1reg4p$Biomass.ton
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.22.- Correlations plot                                                   #
################################################################################
#
tiff("Fig45PellaTomlinsonSelkirkCorrelations.tiff",width=12,height=12,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(2,1,1,1),oma=c(4,4,1,1))
# Variant 2
hist(cor.admb.pt.jfjfas.1reg4p[,-1][(lower.tri(as.matrix(cor.admb.pt.jfjfas.1reg4p[,-1])))],
     main="",#expression(paste("Variant 2: ",italic(B)[0]!=italic(K))),
     xlab="",
     ylab="",
     ylim=,
     xlim=c(-1,1),
     cex.axis = 1.5)
legend("topleft",bty="n",legend=c(list(bquote("Max(|gradient|)" ==.(round(maxgrad.admb.pt.jfjfas.1reg4p,7)))),
                                  list(bquote("AIC" ==.(round(AIC.admb.pt.jfjfas.1reg4p,3))))))
#
dev.off()
#
################################################################################
# 2.2.23.- Derived parameters of interest to management                        #
################################################################################
#
jfjfas.popdyn <- data.frame(Year=seq(FYrLan,LYrLan+1,1),
                            #Regime=Stock.admb.pt.jfjfas.1reg3p$EnvCycle,
                            Catch.ton=c(JFLSelkirk.InniBiom.ton$Landings.ton,NA),
                            CatDyn.Biom.ton=c(JFLSelkirk.InniBiom.ton$B0.CatDyn,NA),
                            CatDyn.Biom.SE.ton=c(JFLSelkirk.InniBiom.ton$SE.B0.CatDyn,NA),
                            CatDyn.Biom.CV.pc=c(100*JFLSelkirk.InniBiom.ton$SE.B0.CatDyn/JFLSelkirk.InniBiom.ton$B0.CatDyn,NA),
                            PT.Biom.ton=Stock.admb.pt.jfjfas.1reg4p$Biomass.ton,
                            PT.Biom.SE.ton=Stock.admb.pt.jfjfas.1reg4p$SD.Biomass.ton,
                            PT.Biom.CV.pc=Stock.admb.pt.jfjfas.1reg4p$CV.pc)
#
# Covariance matrix of estimates to use deltamethod on derived parameters
pt.cor.jfjfas             <- cor.admb.pt.jfjfas.1reg4p[c("K","p","r"),c("K","p","r")]
row.names(pt.cor.jfjfas)  <- c("K","p","r")
colnames(pt.cor.jfjfas)   <- c("K","p","r")
pt.sd.jfjfas              <- read.table("marlikptjfjfas1reg4p.std",skip=(1+npar.jfjfas.1reg4p),header=FALSE)[1:npar.jfjfas.1reg4p,4][2:4]
names(pt.sd.jfjfas)       <- c("K","p","r")
pt.cov.jfjfas             <- cor2cov(cor.mat=as.matrix(pt.cor.jfjfas),sd=as.vector(pt.sd.jfjfas))
#
# MSY
MSY.jfjfas    <- round(r.jfjfas.1reg4p*K.jfjfas.1reg4p*(p.jfjfas.1reg4p-1)/(p.jfjfas.1reg4p^(p.jfjfas.1reg4p/(p.jfjfas.1reg4p-1))))
#[1] 43
MSY.SE.jfjfas <- round(deltamethod(g=list(~x3*x1*(x2-1)/(x2^(x2/(x2-1)))),
                                   mean=c(K.jfjfas.1reg4p,p.jfjfas.1reg4p,r.jfjfas.1reg4p),
                                   cov=pt.cov.jfjfas,
                                   ses=TRUE))
#[1] 2
#
# B.MSY
B.MSY.jfjfas    <- round(K.jfjfas.1reg4p*(p.jfjfas.1reg4p^(1/(1-p.jfjfas.1reg4p))))
#[1] 95
B.MSY.SE.jfjfas <- round(deltamethod(g=list(~x1*x2^(1/(1-x2))),
                                     mean=c(K.jfjfas.1reg4p,p.jfjfas.1reg4p),
                                     cov=pt.cov.jfjfas[1:2,1:2],
                                     ses=TRUE))
#[1] 2
#
# Latent productivity
B.jfjfas.all                  <- Stock.admb.pt.jfjfas.1reg4p$Biomass.ton
B.jfjfas.all.sd               <- Stock.admb.pt.jfjfas.1reg4p$SD.Biomass.ton
Lat.Prod.B.jfjfas.all         <- r.jfjfas.1reg4p*B.jfjfas.all*(1-(B.jfjfas.all/K.jfjfas.1reg4p)^(p.jfjfas.1reg4p-1))
Lat.Prod.B.jfjfas.all.Total   <- Lat.Prod.B.jfjfas.all + jfjfas.popdyn$Catch.ton
mean(Lat.Prod.B.jfjfas.all.Total,na.rm=TRUE)
# [1] 78.67845
KBcor.jfjfas  <- cor.admb.pt.jfjfas.1reg4p[(npar.jfjfas.1reg4p+1):(npar.jfjfas.1reg4p+(LYrLan-FYrLan+2)),1]
pBcor.jfjfas  <- cor.admb.pt.jfjfas.1reg4p[(npar.jfjfas.1reg4p+1):(npar.jfjfas.1reg4p+(LYrLan-FYrLan+2)),2]
rBcor.jfjfas  <- cor.admb.pt.jfjfas.1reg4p[(npar.jfjfas.1reg4p+1):(npar.jfjfas.1reg4p+(LYrLan-FYrLan+2)),4]
Lat.Prod.B.jfjfas.all.SE    <- vector("numeric",length(B.jfjfas.all))
for(i in 1:length(B.jfjfas.all))
{
  Lat.Prod.B.jfjfas.all.SE[i] <- round(deltamethod(g=list(~(x1*x2*(1-(x2/x3)^(x4-1)))),
                                                   mean=c(r.jfjfas.1reg4p,B.jfjfas.all[i],K.jfjfas.1reg4p,p.jfjfas.1reg4p),
                                                   cov=matrix(c(pt.cov.jfjfas["r","r"],rBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["r","r"])*B.jfjfas.all[i],pt.cov.jfjfas["r","K"],pt.cov.jfjfas["r","p"],
                                                                rBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["r","r"])*B.jfjfas.all[i],B.jfjfas.all[i]^2,KBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["K","K"])*B.jfjfas.all[i],pBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["p","p"])*B.jfjfas.all[i],
                                                                pt.cov.jfjfas["r","K"],KBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["K","K"])*B.jfjfas.all[i],pt.cov.jfjfas["K","K"],pt.cov.jfjfas["K","p"],
                                                                pt.cov.jfjfas["r","p"],pBcor.jfjfas[i]*sqrt(pt.cov.jfjfas["p","p"])*B.jfjfas.all[i],pt.cov.jfjfas["K","p"],pt.cov.jfjfas["p","p"]),
                                                              4,4),
                                                   ses=TRUE))
}
Lat.Prod.jfjfas.Total       <- data.frame(Year=FYrLan:LYrLan,
                                          #Regime=Stock.admb.pt.omyuc.2regp4p$EnvCycle[1:22],
                                          Biomass.t=Stock.admb.pt.jfjfas.1reg4p$Biomass.ton[1:(LYrLan-FYrLan+1)],
                                          Biomass.SD.t=Stock.admb.pt.jfjfas.1reg4p$SD.Biomass.ton[1:(LYrLan-FYrLan+1)],
                                          Latprodtot.t=Lat.Prod.B.jfjfas.all.Total[1:(LYrLan-FYrLan+1)],
                                          Latprodtot.SE.t=Lat.Prod.B.jfjfas.all.SE[1:(LYrLan-FYrLan+1)])
Lat.Prod.jfjfas.Total$CV.pc <- 100*Lat.Prod.jfjfas.Total$Latprodtot.SE.t/abs(Lat.Prod.jfjfas.Total$Latprodtot.t)
#
# Sustainable harvest rates
harvest.rate.jfjfas <- data.frame(MSY=MSY.jfjfas,
                                  MSY.SE=MSY.SE.jfjfas,
                                  TLP=round(mean(Lat.Prod.jfjfas.Total$Latprodtot.t)),
                                  TLP.SE=round(mean(Lat.Prod.jfjfas.Total$Latprodtot.SE.t,na.rm=TRUE)))
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.24.- Population dynamics plot                                            #
################################################################################
#
options(scipen=3)
tiff("Fig46PellaTomlinsonSelkirkBiomassDynamics.tiff",width=20,height=20,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(1,1,1,1),bty="o",oma=c(3,3,1,1))
# CatDyn biomass
plot(x=seq(FYrLan,LYrLan+1,1),
     y=jfjfas.popdyn$CatDyn.Biom.ton,
     pch=19,
     ylim=c(0,250),
     cex=3e-1/jfjfas.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfas.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE),
     cex.axis=1.25,
     cex.lab=1.25,
     col="green4",
     type="b",
     lwd=2,
     ylab="",
     xlab="",
     main=expression(paste(italic(Jasus~frontalis)," in Alejandro Selkirk")))
# MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(MSY.jfjfas-2*MSY.SE.jfjfas,LYrLan-FYrLan+2),
#             rev(rep(MSY.jfjfas+2*MSY.SE.jfjfas,LYrLan-FYrLan+2))),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(MSY.jfjfas,LYrLan-FYrLan+2),
#       col="blue",
#       lwd=2)
# # Legend MSY
# polygon(x=c(2016,2018,2018,2016),
#         y=c(180,180,190,190),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=c(2016,2018),y=c(185,185),col="blue",lwd=2)
# text(x=2023,y=185,lab=expression(MSY%+-%"2"~standard~deviations),adj=1)
# # B_MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(B.MSY.jfjfas-2*B.MSY.SE.jfjfas,LYrLan-FYrLan+2),
#             rev(rep(B.MSY.jfjfas+2*B.MSY.SE.jfjfas,LYrLan-FYrLan+2))),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(B.MSY.jfjfas,LYrLan-FYrLan+2),
#       col="salmon",
#       lwd=2)
# # Legend B_MSY
# polygon(x=c(2016,2018,2018,2016),
#         y=c(165,165,175,175),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=c(2016,2018),y=c(170,170),col="salmon",lwd=2)
# text(x=2023,y=170,lab=expression(B[MSY]%+-%"2"~standard~deviations),adj=1)
# CatDyn Biomass
points(x=seq(FYrLan,LYrLan+1,1),
       y=jfjfas.popdyn$CatDyn.Biom.ton,
       pch=19,
       lty=1,
       col="green4",
       cex=3e-1/jfjfas.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfas.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE))
lines(x=seq(FYrLan,LYrLan+1,1),
      y=jfjfas.popdyn$CatDyn.Biom.ton,
      lty=1,
      lwd=2,
      col="green4")
# Legend CatDyn biomass
points(x=2017,y=250,pch=19,cex=2,col="green4")
lines(x=c(2016.5,2017.5),y=c(250,250),col="green4",lwd=2)
text(x=2023.5,y=250,lab=expression(CatDyn~biomass~(size%prop%presicion)),cex=1,adj=1)
# PT Biomass
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfas.popdyn$PT.Biom.ton-2*jfjfas.popdyn$PT.Biom.SE.ton,
            rev(jfjfas.popdyn$PT.Biom.ton+2*jfjfas.popdyn$PT.Biom.SE.ton)),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfas.popdyn$PT.Biom.ton-4*jfjfas.popdyn$PT.Biom.SE.ton,
            rev(jfjfas.popdyn$PT.Biom.ton+4*jfjfas.popdyn$PT.Biom.SE.ton)),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfas.popdyn$PT.Biom.ton-6*jfjfas.popdyn$PT.Biom.SE.ton,
            rev(jfjfas.popdyn$PT.Biom.ton+6*jfjfas.popdyn$PT.Biom.SE.ton)),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
lines(seq(FYrLan,LYrLan+1,1),jfjfas.popdyn$PT.Biom.ton,lwd=2)
# Legend PT Biomass
polygon(x=c(2016,2018,2018,2016),
        y=c(230,230,225,225),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2016,2018,2018,2016),
        y=c(235,235,220,220),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2016,2018,2018,2016),
        y=c(240,240,215,215),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
lines(x=c(2016,2018,2018,2016),y=rep(227.5,4),lwd=2)
text(x=2023.5,y=227.5,lab=expression(Pella~Tomlinson~biomass%+-%"2,4,6"),adj=1,cex=1)
text(x=2021.25,y=220.5,lab=expression(standard~deviations),adj=1,cex=1)
# Landings
lines(x=seq(FYrLan,LYrLan+1,1),jfjfas.popdyn$Catch.ton,type="h",lwd=15,col="red")
# Legend landings
segments(x0=2017,x1=2017,y0=200,y1=210,lwd=20,col="red")
text(x=2020.25,y=200,lab="Annual catch",adj=1,cex=1)
#
mtext(side=2,outer=TRUE,text="Biomass at start of season (tonnes)",line=1,cex=1.5)
mtext(side=1,outer=TRUE,text="Year",line=1,cex=1.5)
dev.off()
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.2.25.- Kobe plot                                                           #
################################################################################
#
# B over B_MSY and F over F_MSY
jfjfas.popdyn$B.BMSY  <- (jfjfas.popdyn$PT.Biom.ton)/(B.MSY.jfjfas)
jfjfas.popdyn$F.FMSY  <- (jfjfas.popdyn$Catch.ton/jfjfas.popdyn$PT.Biom.ton)/(MSY.jfjfas/B.MSY.jfjfas)
# Standard errors
jfjfas.popdyn$B.BMSY.SE  <- NA
jfjfas.popdyn$F.FMSY.SE  <- NA
for(i in 1:nyears)
{
  jfjfas.popdyn$B.BMSY.SE[i] <- deltamethod(g=list(~x1/x2),
                                            mean=c(jfjfas.popdyn$PT.Biom.ton[i],B.MSY.jfjfas),
                                            cov=matrix(c(jfjfas.popdyn$PT.Biom.SE.ton[i]^2,0,0,B.MSY.SE.jfjfas^2),2,2),
                                            ses=TRUE)
}
for(i in 1:nyears)
{
  yield <- jfjfas.popdyn$Catch.ton[i]
  jfjfas.popdyn$F.FMSY.SE[i] <- deltamethod(g=list(~(yield/x1)/(x2/x3)),
                                            mean=c(jfjfas.popdyn$PT.Biom.ton[i],MSY.jfjfas,B.MSY.jfjfas),
                                            cov=matrix(c(jfjfas.popdyn$PT.Biom.SE.ton[i]^2,0,0,0,MSY.SE.jfjfas^2,0,0,0,B.MSY.SE.jfjfas^2),3,3),
                                            ses=TRUE)
  
}
# Stock status for pie chart
jfjfas.popdyn$Status <- ifelse(jfjfas.popdyn$B.BMSY > 1 & jfjfas.popdyn$F.FMSY < 1,1,
                               ifelse(jfjfas.popdyn$B.BMSY < 1 & jfjfas.popdyn$F.FMSY < 1,2,
                                      ifelse(jfjfas.popdyn$B.BMSY < 1 & jfjfas.popdyn$F.FMSY > 1,3,4)))
#
tiff("Fig47PellaTomlinsonSelkirkKobe.tiff",width=22,height=20,units="cm",res=350,type="cairo")
par(mfrow=c(1,1),mar=c(4,5,2,1))
plot(jfjfas.popdyn$B.BMSY,
     jfjfas.popdyn$F.FMSY,
     type="b",
     xlim=c(0,2),
     ylim=c(0,2),
     xlab=expression(B/B[MSY]),
     ylab=expression(F/F[MSY]),
     main=expression(paste(italic(Jasus~frontalis)," in Alejandro Selkirk")),
     cex.axis=2,
     cex.lab=2,
     cex.main=2)
abline(h=1)
abline(v=1)
rect(xleft=-1,xright=1,ybottom=-1,ytop=1,col="yellow")
rect(xleft=-1,xright=1,ybottom=1,ytop=3,col="red")
rect(xleft=1,xright=3,ybottom=1,ytop=3,col="orange1")
rect(xleft=1,xright=3,ybottom=-1,ytop=1,col="green")
text(x=0.2,y=2,lab="Overfished",cex=2)
text(x=2.0,y=1.75,lab="Overfishing",srt=90,cex=2)
text(x=1.8,y=0,lab="Sustainable",cex=2)
text(x=0.2,y=0,lab="Rebuilding",cex=2)
points(jfjfas.popdyn$B.BMSY,
       jfjfas.popdyn$F.FMSY,
       pch=19,
       cex=3,
       col="blue")
lines(jfjfas.popdyn$B.BMSY,
      jfjfas.popdyn$F.FMSY,
      col="blue",
      lwd=2)
segments(x0=jfjfas.popdyn$B.BMSY[nyears]-2*jfjfas.popdyn$B.BMSY.SE[nyears],
         x1=jfjfas.popdyn$B.BMSY[nyears]+2*jfjfas.popdyn$B.BMSY.SE[nyears],
         y0=jfjfas.popdyn$F.FMSY[nyears],
         y1=jfjfas.popdyn$F.FMSY[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfas.popdyn$B.BMSY[nyears]+2*jfjfas.popdyn$B.BMSY.SE[nyears],
         x1=jfjfas.popdyn$B.BMSY[nyears]+2*jfjfas.popdyn$B.BMSY.SE[nyears],
         y0=jfjfas.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfas.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfas.popdyn$B.BMSY[nyears]-2*jfjfas.popdyn$B.BMSY.SE[nyears],
         x1=jfjfas.popdyn$B.BMSY[nyears]-2*jfjfas.popdyn$B.BMSY.SE[nyears],
         y0=jfjfas.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfas.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfas.popdyn$B.BMSY[nyears],
         x1=jfjfas.popdyn$B.BMSY[nyears],
         y0=jfjfas.popdyn$F.FMSY[nyears]-2*jfjfas.popdyn$F.FMSY.SE[nyears],
         y1=jfjfas.popdyn$F.FMSY[nyears]+2*jfjfas.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfas.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfas.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfas.popdyn$F.FMSY[nyears]-2*jfjfas.popdyn$F.FMSY.SE[nyears],
         y1=jfjfas.popdyn$F.FMSY[nyears]-2*jfjfas.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfas.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfas.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfas.popdyn$F.FMSY[nyears]+2*jfjfas.popdyn$F.FMSY.SE[nyears],
         y1=jfjfas.popdyn$F.FMSY[nyears]+2*jfjfas.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
text(jfjfas.popdyn$B.BMSY,
     jfjfas.popdyn$F.FMSY,
     lab=substring(jfjfas.popdyn$Year,3,4),
     col="yellow")
par(new=TRUE,mai=c(4.5,5.5,1,1))
barplot(table(jfjfas.popdyn$Status[1:14]),
        width=c(1,1),
        col=c("green","yellow","red","orange1"),
        names.arg=c("28.6%","7.1%","50.0%","14.3%"),
        cex.names=1)
dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.- Islas Desventuradas                                                    #
################################################################################
#
################################################################################
# 2.3.1.- Depletion models season: 2010-2011                                   #
################################################################################
#
# Data object
cateff1.Desvent.1011 <- rbind(cateff1.Desvent.1011[1:6,],
                              c(2010,1,45,0,0,118.1734,0.1090667,118.0484,763.8136),
                              cateff1.Desvent.1011[7:25,])
#
jfldesvent1011  <- as.CatDynData(x=cateff1.Desvent.1011,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2010-09-27","2011-03-14"))
#
plot(x=jfldesvent1011,mark=TRUE,offset=c(9,10,4),hem="S")                       # 41, 46, 47 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1011$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 27.5839
M.ini       <- 5*0.001937482
N0.ini      <- 7*27.5839
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                              # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1011$Data$nasas$time.step,1),                   # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1011$Data$nasas$time.step,1))                   # just start and end week
#
jfldesvent1011.0P.apn.ini <- catdynexp(x=jfldesvent1011,                        # creating a toy model with
                                       p=0,                                     # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1011.0P.apn.ini,                                               # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1011.0P.apn.fit  <- CatDynFit(x=jfldesvent1011,                       # once happy with initial par values
                                        p=0,                                    # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                        # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead),
                                        itnmax=50000)
#
# jfldesvent1011.0P.apn.pred.spg <- CatDynPred(jfldesvent1011.0P.apn.fit,"spg")   
# plot(x=jfldesvent1011.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1011.0P.apn.pred.CG <- CatDynPred(jfldesvent1011.0P.apn.fit,"CG")     
# plot(x=jfldesvent1011.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1011.0P.apn.pred.NM <- CatDynPred(jfldesvent1011.0P.apn.fit,"Nelder-Mead")     
plot(x=jfldesvent1011.0P.apn.pred.NM,                                           # 47
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.0P.apln.fit  <- CatDynFit(x=jfldesvent1011,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG","Nelder-Mead"),#"Nelder-Mead",#
                                         itnmax=50000)
#
jfldesvent1011.0P.apln.pred.spg <- CatDynPred(jfldesvent1011.0P.apln.fit,"spg")
plot(x=jfldesvent1011.0P.apln.pred.spg,                                         # 47
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.0P.apln.pred.CG <- CatDynPred(jfldesvent1011.0P.apln.fit,"CG")
plot(x=jfldesvent1011.0P.apln.pred.CG,                                          # 47
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.0P.apln.pred.NM <- CatDynPred(jfldesvent1011.0P.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.0P.apln.pred.NM,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 5*0.001937482
N0.ini      <- 5*27.5839
P1.ini      <- 20
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1011$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jfldesvent1011$Data$nasas$time.step,1))
#
jfldesvent1011.1P.apn.ini <- catdynexp(x=jfldesvent1011,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1011.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1011.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1011,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1011.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1011.1P.1.apn.fit,"spg")
plot(x=jfldesvent1011.1P.1.apn.pred.spg,                                        ###01 44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1011.1P.1.apn.fit,"CG")
plot(x=jfldesvent1011.1P.1.apn.pred.CG,                                         ###02 44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1011.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.1P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1011.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1011,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1011.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1011.1P.1.apln.fit,"spg")
plot(x=jfldesvent1011.1P.1.apln.pred.spg,                                       ###03 44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1011.1P.1.apln.fit,"CG")
plot(x=jfldesvent1011.1P.1.apln.pred.CG,                                        ###04 44
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1011.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.1P.1.apln.pred.NM,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1011$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1011$Data$nasas$obscat.thou+0.1))^2)
#
jfldesvent1011.1P.1.n.fit  <- CatDynFit(x=jfldesvent1011,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1011.1P.1.n.pred.spg <- CatDynPred(jfldesvent1011.1P.1.n.fit,"spg")
plot(x=jfldesvent1011.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.n.pred.CG <- CatDynPred(jfldesvent1011.1P.1.n.fit,"CG")
plot(x=jfldesvent1011.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.n.pred.NM <- CatDynPred(jfldesvent1011.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1011.1P.1.n.pred.NM,                                           ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1011,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1011.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1011.1P.1.ln.fit,"spg")
plot(x=jfldesvent1011.1P.1.ln.pred.spg,                                         ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1011.1P.1.ln.fit,"CG")
plot(x=jfldesvent1011.1P.1.ln.pred.CG,                                          ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1011.1P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1011.1P.1.ln.pred.NM,                                          ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 5*0.001937482
N0.ini      <- 2*27.5839
P1.ini      <- 20
P2.ini      <- 15
k.ini       <- 9.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1.1                                                              # always close to 1
beta.ini    <- 1.1                                                              # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1011$Data$nasas$time.step,1),                   # now the dates vector also has
                 44,
                 47,                                                            # the week of one input of abundance
                 tail(jfldesvent1011$Data$nasas$time.step,1))
#
jfldesvent1011.2P.apn.ini <- catdynexp(x=jfldesvent1011,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1011.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1011.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1011,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1011.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1011.2P.1.apn.fit,"spg")
plot(x=jfldesvent1011.2P.1.apn.pred.spg,                                        ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1011.2P.1.apn.fit,"CG")   
plot(x=jfldesvent1011.2P.1.apn.pred.CG,                                         ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1011.2P.1.apn.fit,"Nelder-Mead")   
# plot(x=jfldesvent1011.2P.1.apn.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1011.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1011,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1011.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1011.2P.1.apln.fit,"spg")
plot(x=jfldesvent1011.2P.1.apln.pred.spg,                                       ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1011.2P.1.apln.fit,"CG")
plot(x=jfldesvent1011.2P.1.apln.pred.CG,                                        ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1011.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.2P.1.apln.pred.NM,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1011.2P.1.n.fit  <- CatDynFit(x=jfldesvent1011,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG"),#"Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1011.2P.1.n.pred.spg <- CatDynPred(jfldesvent1011.2P.1.n.fit,"spg")
plot(x=jfldesvent1011.2P.1.n.pred.spg,                                          ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.2P.1.n.pred.CG <- CatDynPred(jfldesvent1011.2P.1.n.fit,"CG")
plot(x=jfldesvent1011.2P.1.n.pred.CG,                                           ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.2P.1.n.pred.NM <- CatDynPred(jfldesvent1011.2P.1.n.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.2P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1011.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1011,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1011.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1011.2P.1.ln.fit,"spg")
plot(x=jfldesvent1011.2P.1.ln.pred.spg,                                         ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1011.2P.1.ln.fit,"CG")
plot(x=jfldesvent1011.2P.1.ln.pred.CG,                                          ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1011.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1011.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1011.2P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1011.1P.1.apn.fit, ###01
           jfldesvent1011.1P.1.apn.fit, ###02
           jfldesvent1011.1P.1.apln.fit,###03
           jfldesvent1011.1P.1.apln.fit,###04
           jfldesvent1011.1P.1.n.fit,   ###05
           jfldesvent1011.1P.1.n.fit,   ###06
           jfldesvent1011.1P.1.n.fit,   ###07
           jfldesvent1011.1P.1.ln.fit,  ###08
           jfldesvent1011.1P.1.ln.fit,  ###09
           jfldesvent1011.1P.1.ln.fit,  ###10
           jfldesvent1011.2P.1.apn.fit, ###11
           jfldesvent1011.2P.1.apn.fit, ###12
           jfldesvent1011.2P.1.apln.fit,###13
           jfldesvent1011.2P.1.apln.fit,###14
           jfldesvent1011.2P.1.n.fit,   ###15
           jfldesvent1011.2P.1.n.fit,   ###16
           jfldesvent1011.2P.1.ln.fit,  ###17
           jfldesvent1011.2P.1.ln.fit)  ###18
m1 <- c(rep(c("spg","CG"),2),
        rep(c("spg","CG","Nelder-Mead"),2),
        rep(c("spg","CG"),4))
# Take out variants with gradients > 1
jfldesvent1011.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
jfldesvent1011.sum.1  <- jfldesvent1011.sum.0[jfldesvent1011.sum.0$Max.Abs.Grads.<1,]
# AIC within variants with same likelihood
jfldesvent1011.sum.1[jfldesvent1011.sum.1$Distribution=="apnormal",]
jfldesvent1011.sum.1[jfldesvent1011.sum.1$Distribution=="aplnormal",]
jfldesvent1011.sum.1[jfldesvent1011.sum.1$Distribution=="normal",]
jfldesvent1011.sum.1[jfldesvent1011.sum.1$Distribution=="lognormal",]
# 1P better in all likelihoods
jfldesvent1011.sum.2  <- jfldesvent1011.sum.1[jfldesvent1011.sum.1$Model=="1P",]
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1011.sum.2))],                     
          ttl=paste(jfldesvent1011.sum.2$Model,
                    substring(jfldesvent1011.sum.2$Distribution, 1,8),
                    jfldesvent1011.sum.2$Method,
                    as.numeric(row.names(jfldesvent1011.sum.2))),
          method=m1[as.numeric(row.names(jfldesvent1011.sum.2))],
          arr=c(3,3))
# Worst correlations in variants ###04, ###05, ###06, ###18
jfldesvent1011.sum.3 <- jfldesvent1011.sum.2[which(!row.names(jfldesvent1011.sum.2) %in% 
                                                     c("4","5","6")),]
#
(jfldesvent1011.1P.1.apn.spg.partable <- CatDynPar(x=jfldesvent1011.1P.1.apn.fit,method="spg"))         ###01
(jfldesvent1011.1P.1.apn.CG.partable  <- CatDynPar(x=jfldesvent1011.1P.1.apn.fit,method="CG"))          ###02
(jfldesvent1011.1P.1.apn.NM.partable  <- CatDynPar(x=jfldesvent1011.1P.1.apln.fit,method="spg"))        ###03
(jfldesvent1011.1P.1.n.NM.partable    <- CatDynPar(x=jfldesvent1011.1P.1.n.fit,method="Nelder-Mead"))   ###07
(jfldesvent1011.1P.1.ln.spg.partable  <- CatDynPar(x=jfldesvent1011.1P.1.ln.fit,method="spg"))          ###08
(jfldesvent1011.1P.1.ln.CG.partable   <- CatDynPar(x=jfldesvent1011.1P.1.ln.fit,method="CG"))           ###09
#
plot(x=jfldesvent1011.1P.1.n.pred.NM,                                           ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1011$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1011.sum.0$Sel.Model[7] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.2.- Depletion models season: 2011-2012                                   #
################################################################################
#
# Data object
#
jfldesvent1112  <- as.CatDynData(x=cateff1.Desvent.1112,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2011-10-03","2012-03-26"))
#
plot(x=jfldesvent1112,mark=TRUE,offset=c(9,10,4),hem="S")                       # 41 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1112$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 10.71535
M.ini       <- 3*0.001937482
N0.ini      <- 10*10.71535
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1112$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1112$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1112.0P.apn.ini <- catdynexp(x=jfldesvent1112,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1112.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1112.0P.apn.fit  <- CatDynFit(x=jfldesvent1112,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1112.0P.apn.pred.spg <- CatDynPred(jfldesvent1112.0P.apn.fit,"spg")   # 41 49 53
plot(x=jfldesvent1112.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.0P.apn.pred.CG <- CatDynPred(jfldesvent1112.0P.apn.fit,"CG")     # 41 49 53
plot(x=jfldesvent1112.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.0P.apln.fit  <- CatDynFit(x=jfldesvent1112,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jfldesvent1112.0P.apln.pred.spg <- CatDynPred(jfldesvent1112.0P.apln.fit,"spg") 
# plot(x=jfldesvent1112.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.0P.apln.pred.CG <- CatDynPred(jfldesvent1112.0P.apln.fit,"CG")   
# plot(x=jfldesvent1112.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*9.210188
P1.ini      <- 45
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1112$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,                                                            # the week of one input of abundance
                 tail(jfldesvent1112$Data$nasas$time.step,1))
#
jfldesvent1112.1P.apn.ini <- catdynexp(x=jfldesvent1112,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1112.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1112.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1112,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1112.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1112.1P.1.apn.fit,"spg")
plot(x=jfldesvent1112.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1112.1P.1.apn.fit,"CG")
# plot(x=jfldesvent1112.1P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1112.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1112.1P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1112.1P.1.apn.pred.NM,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1112,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1112.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1112.1P.1.apln.fit,"spg") 
# plot(x=jfldesvent1112.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1112.1P.1.apln.fit,"CG") 
# plot(x=jfldesvent1112.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1112.1P.1.apln.fit,"Nelder-Mead") 
# plot(x=jfldesvent1112.1P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1112$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1112$Data$nasas$obscat.thou))^2)
#
jfldesvent1112.1P.1.n.fit  <- CatDynFit(x=jfldesvent1112,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1112.1P.1.n.pred.spg <- CatDynPred(jfldesvent1112.1P.1.n.fit,"spg")
plot(x=jfldesvent1112.1P.1.n.pred.spg,                                          ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.n.pred.CG <- CatDynPred(jfldesvent1112.1P.1.n.fit,"CG")
# plot(x=jfldesvent1112.1P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1112.1P.1.n.pred.NM <- CatDynPred(jfldesvent1112.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1112.1P.1.n.pred.NM,                                           ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1112,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1112.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1112.1P.1.ln.fit,"spg")   
# plot(x=jfldesvent1112.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1112.1P.1.ln.fit,"CG")     
# plot(x=jfldesvent1112.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1112.1P.1.ln.fit,"Nelder-Mead")     
# plot(x=jfldesvent1112.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 10*0.001937482
N0.ini      <- 5*9.210188
P1.ini      <- 45
P2.ini      <- 20
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1112$Data$nasas$time.step,1),                   # now the dates vector also has
                 41,
                 49,                                                            # the week of one input of abundance
                 tail(jfldesvent1112$Data$nasas$time.step,1))
#
jfldesvent1112.2P.apn.ini <- catdynexp(x=jfldesvent1112,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1112.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1112.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1112,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1112.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1112.2P.1.apn.fit,"spg")
plot(x=jfldesvent1112.2P.1.apn.pred.spg,                                        ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1112.2P.1.apn.fit,"CG")   
plot(x=jfldesvent1112.2P.1.apn.pred.CG,                                         ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1112.2P.1.apn.fit,"Nelder-Mead")   
plot(x=jfldesvent1112.2P.1.apn.pred.NM,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1112,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1112.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1112.2P.1.apln.fit,"spg") 
# plot(x=jfldesvent1112.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1112.2P.1.apln.fit,"CG")
# plot(x=jfldesvent1112.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1112.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1112.2P.1.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1112.2P.1.apln.pred.NM,                                        ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.n.fit  <- CatDynFit(x=jfldesvent1112,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1112.2P.1.n.pred.spg <- CatDynPred(jfldesvent1112.2P.1.n.fit,"spg")
plot(x=jfldesvent1112.2P.1.n.pred.spg,                                          ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.n.pred.CG <- CatDynPred(jfldesvent1112.2P.1.n.fit,"CG")
plot(x=jfldesvent1112.2P.1.n.pred.CG,                                           ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.n.pred.NM <- CatDynPred(jfldesvent1112.2P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1112.2P.1.n.pred.NM,                                           ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1112,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1112.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1112.2P.1.ln.fit,"spg")
# plot(x=jfldesvent1112.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1112.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1112.2P.1.ln.fit,"CG")
# plot(x=jfldesvent1112.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1112.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1112.2P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1112.2P.1.ln.pred.NM,                                          ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1112.1P.1.apn.fit, ###01
           jfldesvent1112.1P.1.apn.fit, ###02
           jfldesvent1112.1P.1.n.fit,   ###03
           jfldesvent1112.1P.1.n.fit,   ###04
           jfldesvent1112.2P.1.apn.fit, ###05
           jfldesvent1112.2P.1.apn.fit, ###06
           jfldesvent1112.2P.1.apn.fit, ###07
           jfldesvent1112.2P.1.apln.fit,###08
           jfldesvent1112.2P.1.n.fit,   ###09
           jfldesvent1112.2P.1.n.fit,   ###10
           jfldesvent1112.2P.1.n.fit,   ###11
           jfldesvent1112.2P.1.ln.fit)  ###12
m1 <- c(rep(c("spg","Nelder-Mead"),2),
        c("spg","CG","Nelder-Mead"),
        "Nelder-Mead",
        c("spg","CG","Nelder-Mead"),
        "Nelder-Mead")
# Take out variants with gradients > 1
jfldesvent1112.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
# All gradients ok
# AIC within variants weith same likelihood
jfldesvent1112.sum.0[jfldesvent1112.sum.0$Distribution=="apnormal",]
jfldesvent1112.sum.0[jfldesvent1112.sum.0$Distribution=="aplnormal",]
jfldesvent1112.sum.0[jfldesvent1112.sum.0$Distribution=="normal",]
jfldesvent1112.sum.0[jfldesvent1112.sum.0$Distribution=="lognormal",]
# 2P better
jfldesvent1112.sum.1  <- jfldesvent1112.sum.0[jfldesvent1112.sum.0$Model=="2P",]
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1112.sum.1))],                     
          ttl=paste(jfldesvent1112.sum.1$Model,
                    substring(jfldesvent1112.sum.1$Distribution, 1,8),
                    jfldesvent1112.sum.1$Method,
                    as.numeric(row.names(jfldesvent1112.sum.1))),
          method=m1[as.numeric(row.names(jfldesvent1112.sum.1))],
          arr=c(4,2))
# Worst correlations in variants ###08, ###11, ###12
jfldesvent1112.sum.2 <- jfldesvent1112.sum.1[which(!row.names(jfldesvent1112.sum.1) %in% 
                                                     c("8","11","12")),]
#
(jfldesvent1112.2P.1.apn.spg.partable <- CatDynPar(x=jfldesvent1112.2P.1.apn.fit,method="spg"))         ###05
(jfldesvent1112.2P.1.apn.CG.partable  <- CatDynPar(x=jfldesvent1112.2P.1.apn.fit,method="CG"))          ###06
(jfldesvent1112.2P.1.apn.NM.partable  <- CatDynPar(x=jfldesvent1112.2P.1.apn.fit,method="Nelder-Mead")) ###07
(jfldesvent1112.2P.1.n.spg.partable   <- CatDynPar(x=jfldesvent1112.2P.1.n.fit,method="spg"))           ###09
(jfldesvent1112.2P.1.n.CG.partable    <- CatDynPar(x=jfldesvent1112.2P.1.n.fit,method="CG"))            ###10
#
plot(x=jfldesvent1112.2P.1.apn.pred.spg,                                         ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1112$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1112.sum.0$Sel.Model[5] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.3.- Depletion models season: 2012-2013                                   #
################################################################################
#
# Data object
#
jfldesvent1213  <- as.CatDynData(x=cateff1.Desvent.1213,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2012-10-01","2013-03-25"))
#
plot(x=jfldesvent1213,mark=TRUE,offset=c(9,10,4),hem="S")                       # 43, 45, 50 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1213$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 6.374789
M.ini       <- 3*0.001937482
N0.ini      <- 10*6.374789
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1213$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1213$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1213.0P.apn.ini <- catdynexp(x=jfldesvent1213,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1213.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1213.0P.apn.fit  <- CatDynFit(x=jfldesvent1213,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1213.0P.apn.pred.spg <- CatDynPred(jfldesvent1213.0P.apn.fit,"spg")   # 43 45 50
plot(x=jfldesvent1213.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.0P.apn.pred.CG <- CatDynPred(jfldesvent1213.0P.apn.fit,"CG")     # 43 45 50
plot(x=jfldesvent1213.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.0P.apln.fit  <- CatDynFit(x=jfldesvent1213,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jfldesvent1213.0P.apln.pred.spg <- CatDynPred(jfldesvent1213.0P.apln.fit,"spg") # 50
plot(x=jfldesvent1213.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.0P.apln.pred.CG <- CatDynPred(jfldesvent1213.0P.apln.fit,"CG")   # 50
plot(x=jfldesvent1213.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*9.210188
P1.ini      <- 35
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1213$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jfldesvent1213$Data$nasas$time.step,1))
#
jfldesvent1213.1P.apn.ini <- catdynexp(x=jfldesvent1213,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1213.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1213.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1213,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1213.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1213.1P.1.apn.fit,"spg")
plot(x=jfldesvent1213.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1213.1P.1.apn.fit,"CG")
plot(x=jfldesvent1213.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1213.1P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1213.1P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1213,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1213.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1213.1P.1.apln.fit,"spg")
plot(x=jfldesvent1213.1P.1.apln.pred.spg,                                       ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1213.1P.1.apln.fit,"CG")
plot(x=jfldesvent1213.1P.1.apln.pred.CG,                                        ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1213.1P.1.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1213.1P.1.apln.pred.NM,                                        ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1213$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1213$Data$nasas$obscat.thou))^2)
#
jfldesvent1213.1P.1.n.fit  <- CatDynFit(x=jfldesvent1213,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1213.1P.1.n.pred.spg <- CatDynPred(jfldesvent1213.1P.1.n.fit,"spg")
plot(x=jfldesvent1213.1P.1.n.pred.spg,                                          ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.n.pred.CG <- CatDynPred(jfldesvent1213.1P.1.n.fit,"CG")
plot(x=jfldesvent1213.1P.1.n.pred.CG,                                           ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.n.pred.NM <- CatDynPred(jfldesvent1213.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1213.1P.1.n.pred.NM,                                           ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1213,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1213.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1213.1P.1.ln.fit,"spg")
plot(x=jfldesvent1213.1P.1.ln.pred.spg,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1213.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1213.1P.1.ln.fit,"CG")     
# plot(x=jfldesvent1213.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1213.1P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1213.1P.1.ln.pred.NM,                                          ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 10*0.001937482
N0.ini      <- 3*9.210188
P1.ini      <- 25
P2.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1213$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 45,                                                            # the week of one input of abundance
                 tail(jfldesvent1213$Data$nasas$time.step,1))
#
jfldesvent1213.2P.apn.ini <- catdynexp(x=jfldesvent1213,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1213.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1213.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1213,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1213.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1213.2P.1.apn.fit,"spg")
plot(x=jfldesvent1213.2P.1.apn.pred.spg,                                        ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1213.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1213.2P.1.apn.fit,"CG")   
# plot(x=jfldesvent1213.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1213.2P.1.apn.fit,"Nelder-Mead")   
# plot(x=jfldesvent1213.2P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1213,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1213.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1213.2P.1.apln.fit,"spg") 
# plot(x=jfldesvent1213.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1213.2P.1.apln.fit,"CG")
# plot(x=jfldesvent1213.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1213.2P.1.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1213.2P.1.apln.pred.NM,                                        ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.2P.1.n.fit  <- CatDynFit(x=jfldesvent1213,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1213.2P.1.n.pred.spg <- CatDynPred(jfldesvent1213.2P.1.n.fit,"spg")
plot(x=jfldesvent1213.2P.1.n.pred.spg,                                          ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1213.2P.1.n.pred.CG <- CatDynPred(jfldesvent1213.2P.1.n.fit,"CG")
# plot(x=jfldesvent1213.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.2P.1.n.pred.NM <- CatDynPred(jfldesvent1213.2P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1213.2P.1.n.pred.NM,                                           ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1213,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1213.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1213.2P.1.ln.fit,"spg")
# plot(x=jfldesvent1213.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1213.2P.1.ln.fit,"CG")
# plot(x=jfldesvent1213.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1213.2P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1213.2P.1.ln.pred.NM,                                          ###16
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 10*0.001937482
N0.ini      <- 3*9.210188
P1.ini      <- 25
P2.ini      <- 5
P3.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.3P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,P3.ini,k.ini,alpha.ini,beta.ini))
#
dates.3P    <- c(head(jfldesvent1213$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 45,
                 50,                                                            # the week of one input of abundance
                 tail(jfldesvent1213$Data$nasas$time.step,1))
#
jfldesvent1213.3P.apn.ini <- catdynexp(x=jfldesvent1213,
                                       p=3,
                                       par=pars.ini.3P,
                                       dates=dates.3P,
                                       distr="apnormal")
#
plot(x=jfldesvent1213.3P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1213.3P.1.apn.fit  <- CatDynFit(x=jfldesvent1213,
                                          p=3,
                                          par=pars.ini.3P,
                                          dates=dates.3P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1213.3P.1.apn.pred.spg <- CatDynPred(jfldesvent1213.3P.1.apn.fit,"spg")
plot(x=jfldesvent1213.3P.1.apn.pred.spg,                                        ###17
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.apn.pred.CG <- CatDynPred(jfldesvent1213.3P.1.apn.fit,"CG")   
# plot(x=jfldesvent1213.3P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.3P.1.apn.pred.NM <- CatDynPred(jfldesvent1213.3P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1213.3P.1.apn.pred.NM,                                         ###18
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.3P.1.apln.fit  <- CatDynFit(x=jfldesvent1213,
                                           p=3,
                                           par=pars.ini.3P,
                                           dates=dates.3P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1213.3P.1.apln.pred.spg <- CatDynPred(jfldesvent1213.3P.1.apln.fit,"spg") 
# plot(x=jfldesvent1213.3P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.apln.pred.CG <- CatDynPred(jfldesvent1213.3P.1.apln.fit,"CG")
# plot(x=jfldesvent1213.3P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.apln.pred.NM <- CatDynPred(jfldesvent1213.3P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1213.3P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.3P.1.n.fit  <- CatDynFit(x=jfldesvent1213,
                                        p=3,
                                        par=c(pars.ini.3P,psi.n.ini),
                                        dates=dates.3P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1213.3P.1.n.pred.spg <- CatDynPred(jfldesvent1213.3P.1.n.fit,"spg")
plot(x=jfldesvent1213.3P.1.n.pred.spg,                                          ###19
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.n.pred.CG <- CatDynPred(jfldesvent1213.3P.1.n.fit,"CG")
# plot(x=jfldesvent1213.3P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1213.3P.1.n.pred.NM <- CatDynPred(jfldesvent1213.3P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1213.3P.1.n.pred.NM,                                           ###20
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.3P.1.ln.fit  <- CatDynFit(x=jfldesvent1213,
                                         p=3,
                                         par=c(pars.ini.3P,psi.ln.ini),
                                         dates=dates.3P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1213.3P.1.ln.pred.spg <- CatDynPred(jfldesvent1213.3P.1.ln.fit,"spg")
# plot(x=jfldesvent1213.3P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.ln.pred.CG <- CatDynPred(jfldesvent1213.3P.1.ln.fit,"CG")
# plot(x=jfldesvent1213.3P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1213.3P.1.ln.pred.NM <- CatDynPred(jfldesvent1213.3P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1213.3P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1213.1P.1.apn.fit,   ###01
           jfldesvent1213.1P.1.apn.fit,   ###02
           jfldesvent1213.1P.1.apn.fit,   ###03
           jfldesvent1213.1P.1.apln.fit,  ###04
           jfldesvent1213.1P.1.apln.fit,  ###05
           jfldesvent1213.1P.1.apln.fit,  ###06
           jfldesvent1213.1P.1.n.fit,     ###07
           jfldesvent1213.1P.1.n.fit,     ###08
           jfldesvent1213.1P.1.n.fit,     ###09
           jfldesvent1213.1P.1.ln.fit,    ###10
           jfldesvent1213.1P.1.ln.fit,    ###11
           jfldesvent1213.2P.1.apn.fit,   ###12
           jfldesvent1213.2P.1.apln.fit,  ###13
           jfldesvent1213.2P.1.n.fit,     ###14
           jfldesvent1213.2P.1.n.fit,     ###15
           jfldesvent1213.2P.1.ln.fit,    ###16
           jfldesvent1213.3P.1.apn.fit,   ###17
           jfldesvent1213.3P.1.apn.fit,   ###18
           jfldesvent1213.3P.1.n.fit,     ###19
           jfldesvent1213.3P.1.n.fit)     ###20
m1 <- c(rep(c("spg","CG","Nelder-Mead"),3),"spg","Nelder-Mead",
        "spg","Nelder-Mead","spg","Nelder-Mead","Nelder-Mead",
        rep(c("spg","Nelder-Mead"),2))
# Take out variants with gradients > 1
jfldesvent1213.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
# All gradients ok
# AIC within variants weith same likelihood
jfldesvent1213.sum.0[jfldesvent1213.sum.0$Distribution=="apnormal",]
jfldesvent1213.sum.0[jfldesvent1213.sum.0$Distribution=="aplnormal",]
jfldesvent1213.sum.0[jfldesvent1213.sum.0$Distribution=="normal",]
jfldesvent1213.sum.0[jfldesvent1213.sum.0$Distribution=="lognormal",]
# 2P and 3P better
jfldesvent1213.sum.1  <- jfldesvent1213.sum.0[jfldesvent1213.sum.0$Model!="1P",]
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1213.sum.1))],                     
          ttl=paste(jfldesvent1213.sum.1$Model,
                    substring(jfldesvent1213.sum.1$Distribution, 1,8),
                    jfldesvent1213.sum.1$Method,
                    as.numeric(row.names(jfldesvent1213.sum.1))),
          method=m1[as.numeric(row.names(jfldesvent1213.sum.1))],
          arr=c(3,3))
# Worst correlations in variants ###12, ###13, ###14, ###17, ###18, ###20
jfldesvent1213.sum.2 <- jfldesvent1213.sum.1[which(!row.names(jfldesvent1213.sum.1) %in% 
                                                     c("12","13","14","17","18","20")),]
#
(jfldesvent1213.2P.1.n.NM.partable  <- CatDynPar(x=jfldesvent1213.2P.1.n.fit,method="Nelder-Mead"))  ###15
(jfldesvent1213.2P.1.ln.NM.partable <- CatDynPar(x=jfldesvent1213.2P.1.ln.fit,method="Nelder-Mead")) ###16
(jfldesvent1213.3P.1.n.spg.partable <- CatDynPar(x=jfldesvent1213.3P.1.n.fit,method="spg"))          ###19
#
plot(x=jfldesvent1213.2P.1.n.pred.NM,                                           ###15
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1213$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1213.sum.0$Sel.Model[15] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.4.- Depletion models season: 2013-2014                                   #
################################################################################
#
# Data object
#
jfldesvent1314  <- as.CatDynData(x=cateff1.Desvent.1314[1:11,],
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2013-12-30","2014-03-03"))
#
plot(x=jfldesvent1314,mark=TRUE,offset=c(9,10,4),hem="S")                       # 54 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1314$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 8.874482
M.ini       <- 5*0.001937482
N0.ini      <- 12*8.874482
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1314$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1314$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1314.0P.apn.ini <- catdynexp(x=jfldesvent1314,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1314.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1314.0P.apn.fit  <- CatDynFit(x=jfldesvent1314,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1314.0P.apn.pred.spg <- CatDynPred(jfldesvent1314.0P.apn.fit,"spg")   # 57
plot(x=jfldesvent1314.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1314.0P.apn.pred.CG <- CatDynPred(jfldesvent1314.0P.apn.fit,"CG")     # 57
plot(x=jfldesvent1314.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1314.0P.apln.fit  <- CatDynFit(x=jfldesvent1314,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
# jfldesvent1314.0P.apln.pred.spg <- CatDynPred(jfldesvent1314.0P.apln.fit,"spg") 
# plot(x=jfldesvent1314.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1314.0P.apln.pred.CG <- CatDynPred(jfldesvent1314.0P.apln.fit,"CG")   
# plot(x=jfldesvent1314.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 10*8.874482
P1.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1314$Data$nasas$time.step,1),                    # now the dates vector also has
                 57,                                                            # the week of one input of abundance
                 tail(jfldesvent1314$Data$nasas$time.step,1))
#
jfldesvent1314.1P.apn.ini <- catdynexp(x=jfldesvent1314,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1314.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1314.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1314,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1314.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1314.1P.1.apn.fit,"spg")
plot(x=jfldesvent1314.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1314.1P.1.apn.fit,"CG")
plot(x=jfldesvent1314.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1314.1P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1314.1P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1314,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1314.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1314.1P.1.apln.fit,"spg")
plot(x=jfldesvent1314.1P.1.apln.pred.spg,                                       ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1314.1P.1.apln.fit,"CG")
plot(x=jfldesvent1314.1P.1.apln.pred.CG,                                        ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1314.1P.1.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1314.1P.1.apln.pred.NM,                                        ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1314$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1314$Data$nasas$obscat.thou+0.1))^2)
#
jfldesvent1314.1P.1.n.fit  <- CatDynFit(x=jfldesvent1314,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1314.1P.1.n.pred.spg <- CatDynPred(jfldesvent1314.1P.1.n.fit,"spg")
plot(x=jfldesvent1314.1P.1.n.pred.spg,                                          ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.n.pred.CG <- CatDynPred(jfldesvent1314.1P.1.n.fit,"CG")
plot(x=jfldesvent1314.1P.1.n.pred.CG,                                           ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.n.pred.NM <- CatDynPred(jfldesvent1314.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1314.1P.1.n.pred.NM,                                           ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1314,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1314.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1314.1P.1.ln.fit,"spg")
plot(x=jfldesvent1314.1P.1.ln.pred.spg,                                         ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1314.1P.1.ln.fit,"CG")
plot(x=jfldesvent1314.1P.1.ln.pred.CG,                                          ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1314.1P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1314.1P.1.ln.pred.NM,                                          ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1314.1P.1.apn.fit,   ###01
           jfldesvent1314.1P.1.apn.fit,   ###02
           jfldesvent1314.1P.1.apn.fit,   ###03
           jfldesvent1314.1P.1.apln.fit,  ###04
           jfldesvent1314.1P.1.apln.fit,  ###05
           jfldesvent1314.1P.1.apln.fit,  ###06
           jfldesvent1314.1P.1.n.fit,     ###07
           jfldesvent1314.1P.1.n.fit,     ###08
           jfldesvent1314.1P.1.n.fit,     ###09
           jfldesvent1314.1P.1.ln.fit,    ###10
           jfldesvent1314.1P.1.ln.fit,    ###11
           jfldesvent1314.1P.1.ln.fit)    ###12
m1 <- c(rep(c("spg","CG","Nelder-Mead"),4))
# Take out variants with gradients > 1
jfldesvent1314.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
jfldesvent1314.sum.1  <- jfldesvent1314.sum.0[jfldesvent1314.sum.0$Max.Abs.Grads.<1,]
# AIC within variants with same likelihood
jfldesvent1314.sum.1[jfldesvent1314.sum.1$Distribution=="apnormal",]
jfldesvent1314.sum.1[jfldesvent1314.sum.1$Distribution=="aplnormal",]
jfldesvent1314.sum.1[jfldesvent1314.sum.1$Distribution=="normal",]
jfldesvent1314.sum.1[jfldesvent1314.sum.1$Distribution=="lognormal",]
# Not useful as they are all 1P
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1314.sum.1))],                     
          ttl=paste(jfldesvent1314.sum.1$Model,
                    substring(jfldesvent1314.sum.1$Distribution, 1,8),
                    jfldesvent1314.sum.1$Method,
                    as.numeric(row.names(jfldesvent1314.sum.1))),
          method=m1[as.numeric(row.names(jfldesvent1314.sum.1))],
          arr=c(4,3))
# Worst correlations in variants ###07, ###08, ###10, ###11
jfldesvent1314.sum.2 <- jfldesvent1314.sum.1[which(!row.names(jfldesvent1314.sum.1) %in% 
                                                     c("7","8","10","11")),]
#
(jfldesvent1314.1P.1.apn.spg.partable  <- CatDynPar(x=jfldesvent1314.1P.1.apn.fit,method="spg"))         ###01
(jfldesvent1314.1P.1.apn.CG.partable   <- CatDynPar(x=jfldesvent1314.1P.1.apn.fit,method="CG"))          ###02
(jfldesvent1314.1P.1.apn.NM.partable   <- CatDynPar(x=jfldesvent1314.1P.1.apn.fit,method="Nelder-Mead")) ###03
(jfldesvent1314.1P.1.apln.spg.partable <- CatDynPar(x=jfldesvent1314.1P.1.apln.fit,method="spg"))        ###04
(jfldesvent1314.1P.1.apln.CG.partable  <- CatDynPar(x=jfldesvent1314.1P.1.apln.fit,method="CG"))         ###05
(jfldesvent1314.1P.1.apln.NM.partable  <- CatDynPar(x=jfldesvent1314.1P.1.apln.fit,method="Nelder-Mead"))###06
(jfldesvent1314.1P.1.ln.NM.partable    <- CatDynPar(x=jfldesvent1314.1P.1.ln.fit,method="Nelder-Mead"))  ###12
#
plot(x=jfldesvent1314.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1314$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.85,
     Cat.xpos=0.9,
     Cat.ypos=0.8)
#
jfldesvent1314.sum.0$Sel.Model[01] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.5.- Depletion models season: 2014-2015                                   #
################################################################################
#
# Data object
#
jfldesvent1415  <- as.CatDynData(x=cateff1.Desvent.1415[1:14,],
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2014-09-22","2014-12-22"))
#
plot(x=jfldesvent1415,mark=TRUE,offset=c(9,10,4),hem="S")                       # 41 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1415$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 14.79733
M.ini       <- 3*0.001937482
N0.ini      <- 8*14.79733
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1415$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1415$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1415.0P.apn.ini <- catdynexp(x=jfldesvent1415,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1415.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1415.0P.apn.fit  <- CatDynFit(x=jfldesvent1415,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1415.0P.apn.pred.spg <- CatDynPred(jfldesvent1415.0P.apn.fit,"spg")   # 41
plot(x=jfldesvent1415.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.0P.apn.pred.CG <- CatDynPred(jfldesvent1415.0P.apn.fit,"CG")     # 41
plot(x=jfldesvent1415.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.0P.apln.fit  <- CatDynFit(x=jfldesvent1415,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jfldesvent1415.0P.apln.pred.spg <- CatDynPred(jfldesvent1415.0P.apln.fit,"spg") # 41
plot(x=jfldesvent1415.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.0P.apln.pred.CG <- CatDynPred(jfldesvent1415.0P.apln.fit,"CG")   # 41
plot(x=jfldesvent1415.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*14.79733
P1.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1415$Data$nasas$time.step,1),                    # now the dates vector also has
                 41,                                                            # the week of one input of abundance
                 tail(jfldesvent1415$Data$nasas$time.step,1))
#
jfldesvent1415.1P.apn.ini <- catdynexp(x=jfldesvent1415,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1415.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1415.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1415,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1415.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1415.1P.1.apn.fit,"spg")
plot(x=jfldesvent1415.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1415.1P.1.apn.fit,"CG")
plot(x=jfldesvent1415.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1415.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1415.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jfldesvent1415.1P.1.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1415.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1415,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1415.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1415.1P.1.apln.fit,"spg")
# plot(x=jfldesvent1415.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1415.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1415.1P.1.apln.fit,"CG")
# plot(x=jfldesvent1415.1P.1.apln.pred.CG,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1415.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1415.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1415.1P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1415$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1415$Data$nasas$obscat.thou))^2)
#
jfldesvent1415.1P.1.n.fit  <- CatDynFit(x=jfldesvent1415,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1415.1P.1.n.pred.spg <- CatDynPred(jfldesvent1415.1P.1.n.fit,"spg")
plot(x=jfldesvent1415.1P.1.n.pred.spg,                                          ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.1P.1.n.pred.CG <- CatDynPred(jfldesvent1415.1P.1.n.fit,"CG")
plot(x=jfldesvent1415.1P.1.n.pred.CG,                                           ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.1P.1.n.pred.NM <- CatDynPred(jfldesvent1415.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1415.1P.1.n.pred.NM,                                           ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1415,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1415.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1415.1P.1.ln.fit,"spg")
# plot(x=jfldesvent1415.1P.1.ln.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1415.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1415.1P.1.ln.fit,"CG")     
# plot(x=jfldesvent1415.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1415.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1415.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1415.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1415.1P.1.apn.fit,   ###01
           jfldesvent1415.1P.1.apn.fit,   ###02
           jfldesvent1415.1P.1.n.fit,     ###03
           jfldesvent1415.1P.1.n.fit,     ###04
           jfldesvent1415.1P.1.n.fit)     ###05
m1 <- c("spg","CG","spg","CG","Nelder-Mead")
# Take out variants with gradients > 1
jfldesvent1415.sum.0  <- CatDynSum(x=x1,season="2014-2015",method=m1)
# All gradients ok
# AIC within variants weith same likelihood
jfldesvent1415.sum.0[jfldesvent1415.sum.0$Distribution=="apnormal",]
jfldesvent1415.sum.0[jfldesvent1415.sum.0$Distribution=="aplnormal",]
jfldesvent1415.sum.0[jfldesvent1415.sum.0$Distribution=="normal",]
jfldesvent1415.sum.0[jfldesvent1415.sum.0$Distribution=="lognormal",]
# All variants are 1P
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1415.sum.0))],                     
          ttl=paste(jfldesvent1415.sum.0$Model,
                    substring(jfldesvent1415.sum.0$Distribution, 1,8),
                    jfldesvent1415.sum.0$Method,
                    as.numeric(row.names(jfldesvent1415.sum.0))),
          method=m1[as.numeric(row.names(jfldesvent1415.sum.0))],
          arr=c(3,2))
# Worst correlations in variants ###12, ###13, ###14, ###17, ###18, ###20
jfldesvent1415.sum.1 <- jfldesvent1415.sum.0[which(!row.names(jfldesvent1415.sum.0) %in% 
                                                     c("3","5")),]
#
(jfldesvent1415.1P.1.apn.spg.partable  <- CatDynPar(x=jfldesvent1415.1P.1.apn.fit,method="spg"))###01
(jfldesvent1415.1P.1.apn.CG.partable   <- CatDynPar(x=jfldesvent1415.1P.1.apn.fit,method="CG")) ###02
(jfldesvent1415.1P.1.n.NM.partable     <- CatDynPar(x=jfldesvent1415.1P.1.n.fit,method="CG"))   ###04
#
plot(x=jfldesvent1415.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1415$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1415.sum.0$Sel.Model[2] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#

################################################################################
# 2.3.6.- Depletion models season: 2015-2016                                   #
################################################################################
#
# Data object
#
jfldesvent1516  <- as.CatDynData(x=cateff1.Desvent.1516[1:19,],
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2012-09-28","2013-01-21"))
#
plot(x=jfldesvent1516,mark=TRUE,offset=c(9,10,4),hem="S")                       # 41, 43 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1516$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 19.26258
M.ini       <- 3*0.001937482
N0.ini      <- 7*19.26258
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1516$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1516$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1516.0P.apn.ini <- catdynexp(x=jfldesvent1516,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1516.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1516.0P.apn.fit  <- CatDynFit(x=jfldesvent1516,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method="Nelder-Mead",#c("spg","CG"),
                                        itnmax=50000)
#
# jfldesvent1516.0P.apn.pred.spg <- CatDynPred(jfldesvent1516.0P.apn.fit,"spg")   
# plot(x=jfldesvent1516.0P.apn.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1516.0P.apn.pred.CG <- CatDynPred(jfldesvent1516.0P.apn.fit,"CG")     
# plot(x=jfldesvent1516.0P.apn.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.0P.apn.pred.CG <- CatDynPred(jfldesvent1516.0P.apn.fit,"Nelder-Mead")     
plot(x=jfldesvent1516.0P.apn.pred.CG,                                           # 42
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.0P.apln.fit  <- CatDynFit(x=jfldesvent1516,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jfldesvent1516.0P.apln.pred.spg <- CatDynPred(jfldesvent1516.0P.apln.fit,"spg") # 42
plot(x=jfldesvent1516.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.0P.apln.pred.CG <- CatDynPred(jfldesvent1516.0P.apln.fit,"CG")   # 42
plot(x=jfldesvent1516.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*19.26258
P1.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,                                                            # the week of one input of abundance
                 tail(jfldesvent1516$Data$nasas$time.step,1))
#
jfldesvent1516.1P.apn.ini <- catdynexp(x=jfldesvent1516,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1516.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1516.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1516,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1516.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1516.1P.1.apn.fit,"spg")
plot(x=jfldesvent1516.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1516.1P.1.apn.fit,"CG")
plot(x=jfldesvent1516.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1516.1P.1.apn.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.1P.1.apn.pred.NM,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1516,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1516.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1516.1P.1.apln.fit,"spg")
plot(x=jfldesvent1516.1P.1.apln.pred.spg,                                       ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1516.1P.1.apln.fit,"CG")
plot(x=jfldesvent1516.1P.1.apln.pred.CG,                                        ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1516.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.1P.1.apln.pred.NM,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1516$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1516$Data$nasas$obscat.thou))^2)
#
jfldesvent1516.1P.1.n.fit  <- CatDynFit(x=jfldesvent1516,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1516.1P.1.n.pred.spg <- CatDynPred(jfldesvent1516.1P.1.n.fit,"spg")
plot(x=jfldesvent1516.1P.1.n.pred.spg,                                          ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.1P.1.n.pred.CG <- CatDynPred(jfldesvent1516.1P.1.n.fit,"CG")
plot(x=jfldesvent1516.1P.1.n.pred.CG,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.1P.1.n.pred.NM <- CatDynPred(jfldesvent1516.1P.1.n.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.1P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1516,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1516.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1516.1P.1.ln.fit,"spg")
plot(x=jfldesvent1516.1P.1.ln.pred.spg,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1516.1P.1.ln.fit,"CG")
plot(x=jfldesvent1516.1P.1.ln.pred.CG,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1516.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*19.26258
P1.ini      <- 15
P2.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1516$Data$nasas$time.step,1),                    # now the dates vector also has
                 42,  
                 54,                                                            # the week of one input of abundance
                 tail(jfldesvent1516$Data$nasas$time.step,1))
#
jfldesvent1516.2P.apn.ini <- catdynexp(x=jfldesvent1516,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1516.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1516.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1516,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
# jfldesvent1516.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1516.2P.1.apn.fit,"spg")
# plot(x=jfldesvent1516.2P.1.apn.pred.spg,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1516.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1516.2P.1.apn.fit,"CG")
# plot(x=jfldesvent1516.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1516.2P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1516.2P.1.apn.pred.NM,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1516,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1516.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1516.2P.1.apln.fit,"spg")
plot(x=jfldesvent1516.2P.1.apln.pred.spg,                                       ###10
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1516.2P.1.apln.fit,"CG")
plot(x=jfldesvent1516.2P.1.apln.pred.CG,                                        ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1516.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.2P.1.apln.pred.NM,                                      
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.2P.1.n.fit  <- CatDynFit(x=jfldesvent1516,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jfldesvent1516.2P.1.n.pred.spg <- CatDynPred(jfldesvent1516.2P.1.n.fit,"spg")
# plot(x=jfldesvent1516.2P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1516.2P.1.n.pred.CG <- CatDynPred(jfldesvent1516.2P.1.n.fit,"CG")
# plot(x=jfldesvent1516.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1516.2P.1.n.pred.NM <- CatDynPred(jfldesvent1516.2P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1516.2P.1.n.pred.NM,                                           ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1516,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1516.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1516.2P.1.ln.fit,"spg")
plot(x=jfldesvent1516.2P.1.ln.pred.spg,                                         ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1516.2P.1.ln.fit,"CG")
plot(x=jfldesvent1516.2P.1.ln.pred.CG,                                          ###14
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1516.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1516.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1516.2P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1516.1P.1.apn.fit,   ###01
           jfldesvent1516.1P.1.apn.fit,   ###02
           jfldesvent1516.1P.1.apln.fit,  ###03
           jfldesvent1516.1P.1.apln.fit,  ###04
           jfldesvent1516.1P.1.n.fit,     ###05
           jfldesvent1516.1P.1.n.fit,     ###06
           jfldesvent1516.1P.1.ln.fit,    ###07
           jfldesvent1516.1P.1.ln.fit,    ###08
           jfldesvent1516.2P.1.apn.fit,   ###09
           jfldesvent1516.2P.1.apln.fit,  ###10
           jfldesvent1516.2P.1.apln.fit,  ###11
           jfldesvent1516.2P.1.n.fit,     ###12
           jfldesvent1516.2P.1.ln.fit,    ###13
           jfldesvent1516.2P.1.ln.fit)    ###14
m1 <- c(rep(c("spg","CG"),4),
        "Nelder-Mead","spg","CG","Nelder-Mead","spg","CG")
# Take out variants with gradients > 1
jfldesvent1516.sum.0  <- CatDynSum(x=x1,season="2015-2016",method=m1)
jfldesvent1516.sum.1  <- jfldesvent1516.sum.0[jfldesvent1516.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jfldesvent1516.sum.1[jfldesvent1516.sum.1$Distribution=="apnormal",]
jfldesvent1516.sum.1[jfldesvent1516.sum.1$Distribution=="aplnormal",]
jfldesvent1516.sum.1[jfldesvent1516.sum.1$Distribution=="normal",]
jfldesvent1516.sum.1[jfldesvent1516.sum.1$Distribution=="lognormal",]
# 2P Variants better
jfldesvent1516.sum.2 <- jfldesvent1516.sum.1[jfldesvent1516.sum.1$Model %in% "2P",]
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1516.sum.2))],                     
          ttl=paste(jfldesvent1516.sum.2$Model,
                    substring(jfldesvent1516.sum.2$Distribution, 1,8),
                    jfldesvent1516.sum.2$Method,
                    as.numeric(row.names(jfldesvent1516.sum.2))),
          method=m1[as.numeric(row.names(jfldesvent1516.sum.2))],
          arr=c(3,2))
# Worst correlations in variants ###13, ###14
jfldesvent1516.sum.3 <- jfldesvent1516.sum.2[which(!row.names(jfldesvent1516.sum.2) %in% 
                                                     c("13","14")),]
#
(jfldesvent1516.2P.1.apn.NM.partable   <- CatDynPar(x=jfldesvent1516.2P.1.apn.fit,method="Nelder-Mead"))###09
(jfldesvent1516.2P.1.apln.spg.partable <- CatDynPar(x=jfldesvent1516.2P.1.apln.fit,method="spg"))       ###10
(jfldesvent1516.2P.1.apln.CG.partable  <- CatDynPar(x=jfldesvent1516.2P.1.apln.fit,method="CG"))        ###11
#
plot(x=jfldesvent1516.2P.1.apn.pred.NM,                                         ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1516$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1516.sum.0$Sel.Model[9] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.7.- Depletion models season: 2016-2017                                   #
################################################################################
#
# Data object
#
cateff1.Desvent.1617 <- rbind(cateff1.Desvent.1617[1:17,],
                              c(2017,7,3,0,0,118.3454,0.1435525,118.2615,767.5648),
                              cateff1.Desvent.1617[18:19,])
jfldesvent1617  <- as.CatDynData(x=cateff1.Desvent.1617,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2016-09-26","2017-01-30"))
#
plot(x=jfldesvent1617,mark=TRUE,offset=c(9,10,4),hem="S")                       # 44, 45 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1617$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 7.077571
M.ini       <- 3*0.001937482
N0.ini      <- 7*7.077571
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1617$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1617$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1617.0P.apn.ini <- catdynexp(x=jfldesvent1617,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1617.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1617.0P.apn.fit  <- CatDynFit(x=jfldesvent1617,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1617.0P.apn.pred.spg <- CatDynPred(jfldesvent1617.0P.apn.fit,"spg")   # 47
plot(x=jfldesvent1617.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.0P.apn.pred.CG <- CatDynPred(jfldesvent1617.0P.apn.fit,"CG")     # 47
plot(x=jfldesvent1617.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.0P.apln.fit  <- CatDynFit(x=jfldesvent1617,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method="Nelder-Mead",#c("spg","CG"),
                                         itnmax=50000)
#
# jfldesvent1617.0P.apln.pred.spg <- CatDynPred(jfldesvent1617.0P.apln.fit,"spg") 
# plot(x=jfldesvent1617.0P.apln.pred.spg,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.0P.apln.pred.CG <- CatDynPred(jfldesvent1617.0P.apln.fit,"CG")   
# plot(x=jfldesvent1617.0P.apln.pred.CG,
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1617.0P.apln.pred.NM <- CatDynPred(jfldesvent1617.0P.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1617.0P.apln.pred.NM,                                          # 39, 48
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*7.077571
P1.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 47,                                                            # the week of one input of abundance
                 tail(jfldesvent1617$Data$nasas$time.step,1))
#
jfldesvent1617.1P.apn.ini <- catdynexp(x=jfldesvent1617,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1617.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1617.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1617,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1617.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1617.1P.1.apn.fit,"spg")
plot(x=jfldesvent1617.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1617.1P.1.apn.fit,"CG")
plot(x=jfldesvent1617.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1617.1P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1617.1P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1617,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1617.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1617.1P.1.apln.fit,"spg")
# plot(x=jfldesvent1617.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1617.1P.1.apln.fit,"CG")
# plot(x=jfldesvent1617.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1617.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1617.1P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1617$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1617$Data$nasas$obscat.thou+0.1))^2)
#
jfldesvent1617.1P.1.n.fit  <- CatDynFit(x=jfldesvent1617,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1617.1P.1.n.pred.spg <- CatDynPred(jfldesvent1617.1P.1.n.fit,"spg")
plot(x=jfldesvent1617.1P.1.n.pred.spg,                                          ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.n.pred.CG <- CatDynPred(jfldesvent1617.1P.1.n.fit,"CG")
plot(x=jfldesvent1617.1P.1.n.pred.CG,                                           ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.n.pred.NM <- CatDynPred(jfldesvent1617.1P.1.n.fit,"Nelder-Mead")
plot(x=jfldesvent1617.1P.1.n.pred.NM,                                           ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1617,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1617.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1617.1P.1.ln.fit,"spg")
# plot(x=jfldesvent1617.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1617.1P.1.ln.fit,"CG")     
# plot(x=jfldesvent1617.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1617.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1617.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 5*7.077571
P1.ini      <- 2
P2.ini      <- 2
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1617$Data$nasas$time.step,1),                    # now the dates vector also has
                 45,
                 47,                                                            # the week of one input of abundance
                 tail(jfldesvent1617$Data$nasas$time.step,1))
#
jfldesvent1617.2P.apn.ini <- catdynexp(x=jfldesvent1617,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1617.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1617.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1617,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1617.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1617.2P.1.apn.fit,"spg")
plot(x=jfldesvent1617.2P.1.apn.pred.spg,                                        ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1617.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1617.2P.1.apn.fit,"CG")
# plot(x=jfldesvent1617.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1617.2P.1.apn.fit,"Nelder-Mead")
# plot(x=jfldesvent1617.2P.1.apn.pred.NM,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1617.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1617,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
jfldesvent1617.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1617.2P.1.apln.fit,"spg")
plot(x=jfldesvent1617.2P.1.apln.pred.spg,                                       ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1617.2P.1.apln.fit,"CG")
plot(x=jfldesvent1617.2P.1.apln.pred.CG,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1617.2P.1.apln.fit,"Nelder-Mead")
plot(x=jfldesvent1617.2P.1.apln.pred.NM,                                        ###10
     leg.pos="topright", 
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.2P.1.n.fit  <- CatDynFit(x=jfldesvent1617,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
# jfldesvent1617.2P.1.n.pred.spg <- CatDynPred(jfldesvent1617.2P.1.n.fit,"spg")
# plot(x=jfldesvent1617.2P.1.n.pred.spg,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.2P.1.n.pred.CG <- CatDynPred(jfldesvent1617.2P.1.n.fit,"CG")
# plot(x=jfldesvent1617.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1617.2P.1.n.pred.NM <- CatDynPred(jfldesvent1617.2P.1.n.fit,"Nelder-Mead")
# plot(x=jfldesvent1617.2P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1617.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1617,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
jfldesvent1617.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1617.2P.1.ln.fit,"spg")
plot(x=jfldesvent1617.2P.1.ln.pred.spg,                                         ###11
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1617.2P.1.ln.fit,"CG")
plot(x=jfldesvent1617.2P.1.ln.pred.CG,                                          ###12
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1617.2P.1.ln.fit,"Nelder-Mead")
plot(x=jfldesvent1617.2P.1.ln.pred.NM,                                          ###13
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1617.1P.1.apn.fit,   ###01
           jfldesvent1617.1P.1.apn.fit,   ###02
           jfldesvent1617.1P.1.apn.fit,   ###03
           jfldesvent1617.1P.1.n.fit,     ###04
           jfldesvent1617.1P.1.n.fit,     ###05
           jfldesvent1617.1P.1.n.fit,     ###06
           jfldesvent1617.2P.1.apn.fit,   ###07
           jfldesvent1617.2P.1.apln.fit,  ###08
           jfldesvent1617.2P.1.apln.fit,  ###09
           jfldesvent1617.2P.1.apln.fit,  ###10
           jfldesvent1617.2P.1.ln.fit,    ###11
           jfldesvent1617.2P.1.ln.fit,    ###12
           jfldesvent1617.2P.1.ln.fit)    ###13
m1 <- c(rep(c("spg","CG","Nelder-Mead"),2),
        "spg",rep(c("spg","CG","Nelder-Mead"),2))
# Take out variants with gradients > 1
jfldesvent1617.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
jfldesvent1617.sum.1  <- jfldesvent1617.sum.0[jfldesvent1617.sum.0$Max.Abs.Grads.<1,]
# AIC within variants weith same likelihood
jfldesvent1617.sum.1[jfldesvent1617.sum.1$Distribution=="apnormal",]
jfldesvent1617.sum.2  <- jfldesvent1617.sum.1[jfldesvent1617.sum.1$Model %in% "2P",]
# Variant 2P better
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1617.sum.2))],                     
          ttl=paste(jfldesvent1617.sum.2$Model,
                    substring(jfldesvent1617.sum.2$Distribution, 1,8),
                    jfldesvent1617.sum.2$Method,
                    as.numeric(row.names(jfldesvent1617.sum.2))),
          method=m1[as.numeric(row.names(jfldesvent1617.sum.2))],
          arr=c(3,2))
# Worst correlations in ###08, ###12
#
(jfldesvent1617.2P.1.apln.CG.partable <- CatDynPar(x=jfldesvent1617.2P.1.apn.fit,method="spg")) ###07
(jfldesvent1617.2P.1.apln.CG.partable <- CatDynPar(x=jfldesvent1617.2P.1.apln.fit,method="CG")) ###09
(jfldesvent1617.2P.1.apln.CG.partable <- CatDynPar(x=jfldesvent1617.2P.1.ln.fit,method="spg"))  ###11
#
plot(x=jfldesvent1617.2P.1.apln.pred.CG,                                        ###09
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1617$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1617.sum.0$Sel.Model[9] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.8.- Depletion models season: 2017-2018                                   #
################################################################################
#
# Data object
#
cateff1.Desvent.1718 <- rbind(cateff1.Desvent.1718[1:22,],
                              c(2018,8,11,0,0,119.1488,0.1200801,119.1172,782.7434),
                              cateff1.Desvent.1718[23:24,])
jfldesvent1718  <- as.CatDynData(x=cateff1.Desvent.1718,
                                 step="week",
                                 fleet.name="nasas",
                                 coleff=4,
                                 colcat=5,
                                 colmbw=9,
                                 unitseff="ndays",
                                 unitscat="kg",
                                 unitsmbw="g",
                                 nmult="thou",
                                 season.dates=c("2017-10-01","2018-03-07"))
#
plot(x=jfldesvent1718,mark=TRUE,offset=c(9,10,4),hem="S")                       # 40, 43, 46, 50 candidate input weeks
#
# Initial values for pure depletion variant
sum(jfldesvent1718$Data$nasas$obscat.thou)                                       # for N0.ini
#[1] 15.08578
M.ini       <- 3*0.001937482
N0.ini      <- 6*15.08578
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 0.9                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.0P <- log(c(M.ini,N0.ini,k.ini,alpha.ini,beta.ini))                    # Always transform to log
#
dates.0P    <- c(head(jfldesvent1718$Data$nasas$time.step,1),                    # for pure depletion models (0 in-season inputs/outputs)
                 tail(jfldesvent1718$Data$nasas$time.step,1))                    # just start and end week
#
jfldesvent1718.0P.apn.ini <- catdynexp(x=jfldesvent1718,                          # creating a toy model with
                                       p=0,                                      # catdynexp
                                       par=pars.ini.0P,
                                       dates=dates.0P,
                                       distr="apnormal")
#
plot(x=jfldesvent1718.0P.apn.ini,                                                # plot the toy model to check
     leg.pos="topleft",                                                         # quality of initial parameter values
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of pure depletion model to confirm/add week of input
jfldesvent1718.0P.apn.fit  <- CatDynFit(x=jfldesvent1718,                         # once happy with initial par values
                                        p=0,                                     # proceed to statistical fit with CatDynFit
                                        par=pars.ini.0P,                         # starting with apnormal likelihood
                                        dates=dates.0P,
                                        distr="apnormal",
                                        method=c("spg","CG"),
                                        itnmax=50000)
#
jfldesvent1718.0P.apn.pred.spg <- CatDynPred(jfldesvent1718.0P.apn.fit,"spg")   # 43 50
plot(x=jfldesvent1718.0P.apn.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.0P.apn.pred.CG <- CatDynPred(jfldesvent1718.0P.apn.fit,"CG")     # 43 50
plot(x=jfldesvent1718.0P.apn.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.0P.apln.fit  <- CatDynFit(x=jfldesvent1718,                      # next with aplnormal likelihood
                                         p=0,
                                         par=pars.ini.0P,
                                         dates=dates.0P,
                                         distr="aplnormal",
                                         method=c("spg","CG"),
                                         itnmax=50000)
#
jfldesvent1718.0P.apln.pred.spg <- CatDynPred(jfldesvent1718.0P.apln.fit,"spg") 
plot(x=jfldesvent1718.0P.apln.pred.spg,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.0P.apln.pred.CG <- CatDynPred(jfldesvent1718.0P.apln.fit,"CG")   
plot(x=jfldesvent1718.0P.apln.pred.CG,
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 1 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 4*15.08578
P1.ini      <- 15
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.1P <- log(c(M.ini,N0.ini,P1.ini,k.ini,alpha.ini,beta.ini))
#
dates.1P    <- c(head(jfldesvent1718$Data$nasas$time.step,1),                    # now the dates vector also has
                 43,                                                            # the week of one input of abundance
                 tail(jfldesvent1718$Data$nasas$time.step,1))
#
jfldesvent1718.1P.apn.ini <- catdynexp(x=jfldesvent1718,
                                       p=1,
                                       par=pars.ini.1P,
                                       dates=dates.1P,
                                       distr="apnormal")
#
plot(x=jfldesvent1718.1P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1718.1P.1.apn.fit  <- CatDynFit(x=jfldesvent1718,
                                          p=1,
                                          par=pars.ini.1P,
                                          dates=dates.1P,
                                          distr="apnormal",
                                          method=c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1718.1P.1.apn.pred.spg <- CatDynPred(jfldesvent1718.1P.1.apn.fit,"spg")
plot(x=jfldesvent1718.1P.1.apn.pred.spg,                                        ###01
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.1P.1.apn.pred.CG <- CatDynPred(jfldesvent1718.1P.1.apn.fit,"CG")
plot(x=jfldesvent1718.1P.1.apn.pred.CG,                                         ###02
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.1P.1.apn.pred.NM <- CatDynPred(jfldesvent1718.1P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1718.1P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.1P.1.apln.fit  <- CatDynFit(x=jfldesvent1718,
                                           p=1,
                                           par=pars.ini.1P,
                                           dates=dates.1P,
                                           distr="aplnormal",
                                           method=c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1718.1P.1.apln.pred.spg <- CatDynPred(jfldesvent1718.1P.1.apln.fit,"spg")
# plot(x=jfldesvent1718.1P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.1P.1.apln.pred.CG <- CatDynPred(jfldesvent1718.1P.1.apln.fit,"CG")
# plot(x=jfldesvent1718.1P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.1P.1.apln.pred.NM <- CatDynPred(jfldesvent1718.1P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.1P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
psi.n.ini  <- 0.25*log(sd(jfldesvent1718$Data$nasas$obscat.thou)^2)
psi.ln.ini <- 0.25*log(sd(log(jfldesvent1718$Data$nasas$obscat.thou+0.1))^2)
#
jfldesvent1718.1P.1.n.fit  <- CatDynFit(x=jfldesvent1718,
                                        p=1,
                                        par=c(pars.ini.1P,psi.n.ini),
                                        dates=dates.1P,
                                        distr="normal",
                                        method=c("spg","CG"),#c("spg","CG","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1718.1P.1.n.pred.spg <- CatDynPred(jfldesvent1718.1P.1.n.fit,"spg")
plot(x=jfldesvent1718.1P.1.n.pred.spg,                                          ###04
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.1P.1.n.pred.CG <- CatDynPred(jfldesvent1718.1P.1.n.fit,"CG")
plot(x=jfldesvent1718.1P.1.n.pred.CG,                                           ###05
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1718.1P.1.n.pred.NM <- CatDynPred(jfldesvent1718.1P.1.n.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.1P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1718.1P.1.ln.fit  <- CatDynFit(x=jfldesvent1718,
                                         p=1,
                                         par=c(pars.ini.1P,psi.ln.ini),
                                         dates=dates.1P,
                                         distr="lognormal",
                                         method=c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1718.1P.1.ln.pred.spg <- CatDynPred(jfldesvent1718.1P.1.ln.fit,"spg")
# plot(x=jfldesvent1718.1P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.1P.1.ln.pred.CG <- CatDynPred(jfldesvent1718.1P.1.ln.fit,"CG")     
# plot(x=jfldesvent1718.1P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.1P.1.ln.pred.NM <- CatDynPred(jfldesvent1718.1P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.1P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Initial values for 2 input depletion variant
M.ini       <- 3*0.001937482
N0.ini      <- 3*15.08578
P1.ini      <- 15
P2.ini      <- 5
k.ini       <- 8.5e-4                                                           # always between 1e-3 and 1e-6
alpha.ini   <- 1                                                                # always close to 1
beta.ini    <- 1                                                                # always close to 1
pars.ini.2P <- log(c(M.ini,N0.ini,P1.ini,P2.ini,k.ini,alpha.ini,beta.ini))
#
dates.2P    <- c(head(jfldesvent1718$Data$nasas$time.step,1),                   # now the dates vector also has
                 43,
                 50,                                                            # the week of one input of abundance
                 tail(jfldesvent1718$Data$nasas$time.step,1))
#
jfldesvent1718.2P.apn.ini <- catdynexp(x=jfldesvent1718,
                                       p=2,
                                       par=pars.ini.2P,
                                       dates=dates.2P,
                                       distr="apnormal")
#
plot(x=jfldesvent1718.2P.apn.ini,
     leg.pos="topleft",
     Biom.tstep=1,
     Biom.xpos=0.8,
     Biom.ypos=0.8,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Cat.xpos=0.8,
     Cat.ypos=0.7)
#
# Statistical fit of 1-input depletion variant
jfldesvent1718.2P.1.apn.fit  <- CatDynFit(x=jfldesvent1718,
                                          p=2,
                                          par=pars.ini.2P,
                                          dates=dates.2P,
                                          distr="apnormal",
                                          method=c("spg","Nelder-Mead"),#c("spg","CG","Nelder-Mead"),
                                          itnmax=50000)
#
jfldesvent1718.2P.1.apn.pred.spg <- CatDynPred(jfldesvent1718.2P.1.apn.fit,"spg")
plot(x=jfldesvent1718.2P.1.apn.pred.spg,                                        ###06
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.apn.pred.CG <- CatDynPred(jfldesvent1718.2P.1.apn.fit,"CG")   
# plot(x=jfldesvent1718.2P.1.apn.pred.CG,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1718.2P.1.apn.pred.NM <- CatDynPred(jfldesvent1718.2P.1.apn.fit,"Nelder-Mead")
plot(x=jfldesvent1718.2P.1.apn.pred.NM,                                         ###07
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.2P.1.apln.fit  <- CatDynFit(x=jfldesvent1718,
                                           p=2,
                                           par=pars.ini.2P,
                                           dates=dates.2P,
                                           distr="aplnormal",
                                           method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                           itnmax=50000)
#
# jfldesvent1718.2P.1.apln.pred.spg <- CatDynPred(jfldesvent1718.2P.1.apln.fit,"spg") 
# plot(x=jfldesvent1718.2P.1.apln.pred.spg,                                       
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.apln.pred.CG <- CatDynPred(jfldesvent1718.2P.1.apln.fit,"CG")
# plot(x=jfldesvent1718.2P.1.apln.pred.CG,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.apln.pred.NM <- CatDynPred(jfldesvent1718.2P.1.apln.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.2P.1.apln.pred.NM,                                        
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1718.2P.1.n.fit  <- CatDynFit(x=jfldesvent1718,
                                        p=2,
                                        par=c(pars.ini.2P,psi.n.ini),
                                        dates=dates.2P,
                                        distr="normal",
                                        method="spg",#c("spg","Nelder-Mead"),
                                        itnmax=50000)
#
jfldesvent1718.2P.1.n.pred.spg <- CatDynPred(jfldesvent1718.2P.1.n.fit,"spg")
plot(x=jfldesvent1718.2P.1.n.pred.spg,                                          ###08
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.n.pred.CG <- CatDynPred(jfldesvent1718.2P.1.n.fit,"CG")
# plot(x=jfldesvent1718.2P.1.n.pred.CG,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.n.pred.NM <- CatDynPred(jfldesvent1718.2P.1.n.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.2P.1.n.pred.NM,                                           
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
jfldesvent1718.2P.1.ln.fit  <- CatDynFit(x=jfldesvent1718,
                                         p=2,
                                         par=c(pars.ini.2P,psi.ln.ini),
                                         dates=dates.2P,
                                         distr="lognormal",
                                         method="Nelder-Mead",#c("spg","CG","Nelder-Mead"),
                                         itnmax=50000)
#
# jfldesvent1718.2P.1.ln.pred.spg <- CatDynPred(jfldesvent1718.2P.1.ln.fit,"spg")
# plot(x=jfldesvent1718.2P.1.ln.pred.spg,                                         
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.ln.pred.CG <- CatDynPred(jfldesvent1718.2P.1.ln.fit,"CG")
# plot(x=jfldesvent1718.2P.1.ln.pred.CG,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
# jfldesvent1718.2P.1.ln.pred.NM <- CatDynPred(jfldesvent1718.2P.1.ln.fit,"Nelder-Mead")
# plot(x=jfldesvent1718.2P.1.ln.pred.NM,                                          
#      leg.pos="topright",
#      Biom.tstep=1,
#      Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
#      Biom.xpos=0.8,
#      Biom.ypos=0.9,
#      Cat.xpos=0.8,
#      Cat.ypos=0.85)
#
save.image("JFLobsters.0203.2223.RData")
#
# Model variant selection
x1 <- list(jfldesvent1718.1P.1.apn.fit,   ###01
           jfldesvent1718.1P.1.apn.fit,   ###02
           jfldesvent1718.1P.1.apn.fit,   ###03
           jfldesvent1718.1P.1.n.fit,     ###04
           jfldesvent1718.1P.1.n.fit,     ###05
           jfldesvent1718.2P.1.apn.fit,   ###06
           jfldesvent1718.2P.1.apn.fit,   ###07
           jfldesvent1718.2P.1.n.fit)     ###08
           
m1 <- c("spg","CG","Nelder-Mead","spg","CG",
        "spg","Nelder-Mead","spg")
# Take out variants with gradients > 1
jfldesvent1718.sum.0  <- CatDynSum(x=x1,season="2011-2012",method=m1)
# All gradients ok
# AIC within variants weith same likelihood
jfldesvent1718.sum.0[jfldesvent1718.sum.0$Distribution=="apnormal",]
jfldesvent1718.sum.0[jfldesvent1718.sum.0$Distribution=="normal",]
# 1P better
jfldesvent1718.sum.1  <- jfldesvent1718.sum.0[jfldesvent1718.sum.0$Model=="1P",]
#
CatDynCor(x=x1[as.numeric(row.names(jfldesvent1718.sum.1))],                     
          ttl=paste(jfldesvent1718.sum.1$Model,
                    substring(jfldesvent1718.sum.1$Distribution, 1,8),
                    jfldesvent1718.sum.1$Method,
                    as.numeric(row.names(jfldesvent1718.sum.1))),
          method=m1[as.numeric(row.names(jfldesvent1718.sum.1))],
          arr=c(3,2))
# Worst correlations in variants ###04, ###05
jfldesvent1718.sum.2 <- jfldesvent1718.sum.1[which(!row.names(jfldesvent1718.sum.1) %in% 
                                                     c("4","5")),]
#
(jfldesvent1718.1P.1.apn.spg.partable <- CatDynPar(x=jfldesvent1718.1P.1.apn.fit,method="spg"))        ###01
(jfldesvent1718.1P.1.apn.CG.partable  <- CatDynPar(x=jfldesvent1718.1P.1.apn.fit,method="CG"))         ###02
(jfldesvent1718.1P.1.apn.NM.partable  <- CatDynPar(x=jfldesvent1718.1P.1.apn.fit,method="Nelder-Mead"))###03
#
plot(x=jfldesvent1718.1P.1.apn.pred.NM,                                         ###03
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jfldesvent1718$Data$nasas)[1],
     Biom.xpos=0.8,
     Biom.ypos=0.9,
     Cat.xpos=0.8,
     Cat.ypos=0.85)
#
jfldesvent1718.sum.0$Sel.Model[3] <- 1
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.9.- All selected models                                                  #
################################################################################
#                                                                               
# Overview of all fitted and selected variants
JFLDesvent.SelMods <- data.frame(YearStart=2010:2017,
                                 YearEnd=2011:2018,
                                 NumberFits=c(3*length(ls()[grep("fit",ls())][grep("desvent1011",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1112",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1213",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1314",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1415",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1516",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1617",ls()[grep("fit",ls())])]),
                                              3*length(ls()[grep("fit",ls())][grep("desvent1718",ls()[grep("fit",ls())])])),
                                 RetainedFits=c(dim(jfldesvent1011.sum.0)[1],
                                                dim(jfldesvent1112.sum.0)[1],
                                                dim(jfldesvent1213.sum.0)[1],
                                                dim(jfldesvent1314.sum.0)[1],
                                                dim(jfldesvent1415.sum.0)[1],
                                                dim(jfldesvent1516.sum.0)[1],
                                                dim(jfldesvent1617.sum.0)[1],
                                                dim(jfldesvent1718.sum.0)[1]),
                                 SelMod.name=c("jfldesvent1011.1P.1.n.fit",
                                               "jfldesvent1112.2P.1.apn.fit",
                                               "jfldesvent1213.2P.1.n.fit",
                                               "jfldesvent1314.1P.1.apn.fit",
                                               "jfldesvent1415.1P.1.apn.fit",
                                               "jfldesvent1516.2P.1.apn.fit",
                                               "jfldesvent1617.2P.1.apln.fit",
                                               "jfldesvent1718.1P.1.apn.fit"),
                                 SelMod.lik=c("n",
                                              "apn",
                                              "n",
                                              "apn",
                                              "apn",
                                              "apn",
                                              "apln",
                                              "apn"),
                                 SelMod.meth=c("Nelder-Mead",
                                               "spg",
                                               "Nelder-Mead",
                                               "spg",
                                               "CG",
                                               "Nelder-Mead",
                                               "CG",
                                               "Nelder-Mead"),
                                 FirstWeek=c(39,40,40,52,38,39,39,39),
                                 P1.timing=c(47,41,43,57,41,42,45,43),
                                 P2.timing=c("",49,45,"","",54,47,""),
                                 LastWeek =c(64,66,66,62,51,57,58,63))
#                                            10 11 12 13 14 15 16 17 
#
# List with fits that contain the selected variant
JFLDesvent.Iagdfits <- list(jfldesvent1011.1P.1.n.fit,
                            jfldesvent1112.2P.1.apn.fit,
                            jfldesvent1213.2P.1.n.fit,
                            jfldesvent1314.1P.1.apn.fit,
                            jfldesvent1415.1P.1.apn.fit,
                            jfldesvent1516.2P.1.apn.fit,
                            jfldesvent1617.2P.1.apln.fit,
                            jfldesvent1718.1P.1.apn.fit)
names(JFLDesvent.Iagdfits) <- paste(2010:2017,2011:2018,sep="-")
#
# List of predictions of the selected variant
JFLDesvent.Iagdpreds <- list(jfldesvent1011.1P.1.n.pred.NM,
                             jfldesvent1112.2P.1.apn.pred.spg,
                             jfldesvent1213.2P.1.n.pred.NM,
                             jfldesvent1314.1P.1.apn.pred.spg,
                             jfldesvent1415.1P.1.apn.pred.CG,
                             jfldesvent1516.2P.1.apn.pred.NM,
                             jfldesvent1617.2P.1.apln.pred.CG,
                             jfldesvent1718.1P.1.apn.pred.NM)
x <- paste(2010:2017,2011:2018,sep="-")
for(i in 1:8)
{
  names(JFLDesvent.Iagdpreds)[i] <- x[i]
}
#
# All seasons summary table
JFLDesvent.sum.1011.1718           <- CatDynSum(x=JFLDesvent.Iagdfits,season="0910-2023",method=JFLDesvent.SelMods$SelMod.meth)
JFLDesvent.sum.1011.1718$N0        <- as.numeric(JFLDesvent.sum.1011.1718$N0)
JFLDesvent.sum.1011.1718$Season    <- paste(2010:2017,2011:2018,sep="-")
JFLDesvent.sum.1011.1718$Sel.Model <- 1
JFLDesvent.sum.1011.1718$Besc.ton  <- sapply(1:length(JFLDesvent.Iagdpreds), function(u) tail(JFLDesvent.Iagdpreds[[u]]$Model$Results$Predicted.Biomass.tonnes,1))
#
# Fixing missing standard errors with multivariate imputation technique
cbind(1:dim(JFLDesvent.sum.1011.1718)[2],names(JFLDesvent.sum.1011.1718))
# library(mice)
imp1                             <- mice(JFLDesvent.sum.1011.1718[,9:10], method="pmm",m=1,maxit=1000)  #M and SE.M
JFLDesvent.sum.1011.1718[,9:10]  <- complete(imp1)
imp1                             <- mice(JFLDesvent.sum.1011.1718[,11:12], method="pmm",m=1,maxit=1000) #N0 and SE.N0
JFLDesvent.sum.1011.1718[,11:12] <- complete(imp1)
imp1                             <- mice(JFLDesvent.sum.1011.1718[,19:20], method="pmm",m=1,maxit=1000) #k and SE.k
JFLDesvent.sum.1011.1718[,19:20] <- complete(imp1)
imp1                             <- mice(JFLDesvent.sum.1011.1718[,21:22], method="pmm",m=1,maxit=1000) #alpha and SE.alpha
JFLDesvent.sum.1011.1718[,21:22] <- complete(imp1)
imp1                             <- mice(JFLDesvent.sum.1011.1718[,23:24], method="pmm",m=1,maxit=1000) #beta and SE.beta
JFLDesvent.sum.1011.1718[,23:24] <- complete(imp1)
rm(imp1)
#
# Calculating standard error of starting biomass prediction
# mbw.sd <- data.frame(Season=paste(2009:2022,2010:2023,sep="-"),
#                      Start.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==38],
#                      Start.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==38],
#                      End.Mean.weekly.length.mm=wbl.trend$Mbl.mm[wbl.trend$Week==(71-53)],
#                      End.SD.Mean.weekly.length.mm=wbl.trend$Sd.Mbl.mm[wbl.trend$Week==(71-53)])
# #
# mbw.sd$Start.Mean.weekly.weight.kg     <- 1e-3*lw.a*mbw.sd$Start.Mean.weekly.length.mm^lw.b
# mbw.sd$Start.SD.mean.weekly.weight.kg  <- 1e-3*lw.a*mbw.sd$Start.SD.Mean.weekly.length.mm^lw.b
# mbw.sd$End.Mean.weekly.weight.kg       <- 1e-3*lw.a*mbw.sd$End.Mean.weekly.length.mm^lw.b
# mbw.sd$End.SD.mean.weekly.weight.kg    <- 1e-3*lw.a*mbw.sd$End.SD.Mean.weekly.length.mm^lw.b
JFLDesvent.StartBiom                    <- CatDynBSD(x=JFLDesvent.Iagdfits,     
                                                     method=JFLDesvent.SelMods$SelMod.meth,
                                                     multi=FALSE,
                                                     mbw.sd=mbw.sd[c(9:16),c(1,6,7)])
JFLDesvent.StartBiom$B0Tot.ton.CV       <- 100*JFLDesvent.StartBiom$B0Tot.ton.SE/JFLDesvent.StartBiom$B0Tot.ton
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.10.- Fit plots                                                           #
################################################################################
#
tiff("Fig48CatDynDesventFit1011.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2010-2011']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1011$Data$nasas)[1],
     Biom.xpos=0.75,
     Biom.ypos=0.8,
     Cat.xpos=0.75,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig49CatDynDesventFit1112.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2011-2012']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1112$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig50CatDynDesventFit1213.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2012-2013']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1213$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig51CatDynDesventFit1314.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2013-2014']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1314$Data$nasas)[1],
     Biom.xpos=0.95,
     Biom.ypos=0.8,
     Cat.xpos=0.95,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig52CatDynDesventFit1415.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2014-2015']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1415$Data$nasas)[1],
     Biom.xpos=0.95,
     Biom.ypos=0.8,
     Cat.xpos=0.95,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig53CatDynDesventFit1516.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2015-2016']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1516$Data$nasas)[1],
     Biom.xpos=0.85,
     Biom.ypos=0.8,
     Cat.xpos=0.85,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig54CatDynDesventFit1617.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2016-2017']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1617$Data$nasas)[1],
     Biom.xpos=0.9,
     Biom.ypos=0.8,
     Cat.xpos=0.9,
     Cat.ypos=0.75)
dev.off()
#
tiff("Fig55CatDynDesventFit1718.tiff",width=18,height=15,units="cm",type="cairo",res=350)
plot(x=JFLDesvent.Iagdpreds[['2017-2018']],                                                
     leg.pos="topright",
     Biom.tstep=1,
     Cat.tstep=dim(jflcrusoe1718$Data$nasas)[1],
     Biom.xpos=0.7,
     Biom.ypos=0.8,
     Cat.xpos=0.7,
     Cat.ypos=0.75)
dev.off()
#
################################################################################
# 2.3.11.- Parameters plot                                                     #
################################################################################
#
tiff("Fig56CatDynDesventPars.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(3,2),mar=c(2,2,1,1),oma=c(3,3,1,1))
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=53*JFLDesvent.sum.1011.1718$M,
       yplus=53*(JFLDesvent.sum.1011.1718$M+2*JFLDesvent.sum.1011.1718$SE.M),
       yminus=53*(JFLDesvent.sum.1011.1718$M-2*JFLDesvent.sum.1011.1718$SE.M),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,5))
legend("top",legend=expression(paste("Annualized ",italic(M),sep="")),bty="n")
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=JFLDesvent.sum.1011.1718$N0,
       yplus=(JFLDesvent.sum.1011.1718$N0+2*JFLDesvent.sum.1011.1718$SE.N0),
       yminus=(JFLDesvent.sum.1011.1718$N0-2*JFLDesvent.sum.1011.1718$SE.N0),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,75))
legend("top",legend=expression(paste(N[0]," (thousands)",sep="")),bty="n")
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=JFLDesvent.sum.1011.1718$P1.nasas,
       yplus=(JFLDesvent.sum.1011.1718$P1.nasas+2*JFLDesvent.sum.1011.1718$SE.P1.nasas),
       yminus=(JFLDesvent.sum.1011.1718$P1.nasas-2*JFLDesvent.sum.1011.1718$SE.P1.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,150))
legend("top",legend=expression(paste(R[1]," (thousands)",sep="")),bty="n")
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=1e4*JFLDesvent.sum.1011.1718$k.nasas,
       yplus=1e4*(JFLDesvent.sum.1011.1718$k.nasas+2*JFLDesvent.sum.1011.1718$SE.k.nasas),
       yminus=1e4*(JFLDesvent.sum.1011.1718$k.nasas-2*JFLDesvent.sum.1011.1718$SE.k.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,100))
legend("top",legend=expression(paste(10^4*italic(k)," (1/days)",sep="")),bty="n")
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=JFLDesvent.sum.1011.1718$alpha.nasas,
       yplus=(JFLDesvent.sum.1011.1718$alpha.nasas+2*JFLDesvent.sum.1011.1718$SE.alpha.nasas),
       yminus=(JFLDesvent.sum.1011.1718$alpha.nasas-2*JFLDesvent.sum.1011.1718$SE.alpha.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,2))
abline(v=1)
legend("top",legend=expression(alpha),bty="n")
errbar(x=JFLDesvent.sum.1011.1718$Season,
       y=JFLDesvent.sum.1011.1718$beta.nasas,
       yplus=(JFLDesvent.sum.1011.1718$beta.nasas+2*JFLDesvent.sum.1011.1718$SE.beta.nasas),
       yminus=(JFLDesvent.sum.1011.1718$beta.nasas-2*JFLDesvent.sum.1011.1718$SE.beta.nasas),
       type="b",lwd=2, pch=19, xlab="", ylab="",ylim=c(0,6))
abline(v=1)
legend("top",legend=expression(beta),bty="n")
dev.off()
#
################################################################################
# 2.3.12.- Exploitation rate plot                                              #
################################################################################
#
cbind(JFLDesvent.SelMods$Year,JFLDesvent.SelMods$SelMod.meth)
tiff("Fig57CatDynDesventFM.tiff",width=20,height=25,units="cm",type="cairo",res=350)
par(mfrow=c(4,2),oma=c(1,1,1,1),mar=c(1,1,1,1))
#2010-2011
plot(JFLDesvent.Iagdpreds[["2010-2011"]]$Model$Results$Period.week,
     JFLDesvent.Iagdpreds[["2010-2011"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[1]+0.1))
abline(h=JFLDesvent.Iagdfits[["2010-2011"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2010-2011")
#2011-2012
plot(JFLDesvent.Iagdpreds[["2011-2012"]]$Model$Results$Period.week,
     JFLDesvent.Iagdpreds[["2011-2012"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[2]+0.05))
abline(h=JFLDesvent.Iagdfits[["2011-2012"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2011-2012")
#2012-2013
plot(JFLDesvent.Iagdpreds[["2012-2013"]]$Model$Results$Period.week,
     JFLDesvent.Iagdpreds[["2012-2013"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[3]+0.03))
abline(h=JFLDesvent.Iagdfits[["2012-2013"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2012-2013")
#2013-2014
plot(JFLDesvent.Iagdpreds[["2013-2014"]]$Model$Results$Period.week,
     JFLDesvent.Iagdpreds[["2013-2014"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[4]+0.15))
abline(h=JFLDesvent.Iagdfits[["2013-2014"]]$Model$spg$bt.par$M,col="green4")
legend("topright",bty="n",legend="2013-2014")
#2014-2015
plot(JFLDesvent.Iagdpreds[["2014-2015"]]$Model$Results$Period.week-53,
     JFLDesvent.Iagdpreds[["2014-2015"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[5]+0.05))
abline(h=JFLDesvent.Iagdfits[["2014-2015"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2014-2015")
#2015-2016
plot(JFLDesvent.Iagdpreds[["2015-2016"]]$Model$Results$Period.week,                              
     JFLDesvent.Iagdpreds[["2015-2016"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[6]+0.12))
abline(h=JFLDesvent.Iagdfits[["2015-2016"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2015-2016")
#2016-2017
plot(JFLDesvent.Iagdpreds[["2016-2017"]]$Model$Results$Period.week,
     JFLDesvent.Iagdpreds[["2016-2017"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[7]+0.12))
abline(h=JFLDesvent.Iagdfits[["2016-2017"]]$Model$CG$bt.par$M,col="green4")
legend("topright",bty="n",legend="2016-2017")
#2017-2018
plot(JFLDesvent.Iagdpreds[["2017-2018"]]$Model$Results$Period.week,                   
     JFLDesvent.Iagdpreds[["2017-2018"]]$Model$Results$'Predicted.F.1/week',
     type="l",
     lty=1,
     col="red",
     xlab="",
     ylab="",
     ylim=c(0,JFLDesvent.sum.1011.1718$M[8]+0.14))
abline(h=JFLDesvent.Iagdfits[["2017-2018"]]$Model$'Nelder-Mead'$bt.par$M,col="green4")
legend("topright",bty="n",legend="2017-2018")
#
dev.off()
#
################################################################################
# 2.3.13.- Starting biomass plot                                               #
################################################################################
#
#tiff("FigXXCatDynSelkirkStartBiom.tiff",width=15,height=15,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(4,4,1,1))
plot(JFLDesvent.StartBiom$Year,
     JFLDesvent.StartBiom$B0Tot.ton,
     ylim=c(0,75),
     cex=10*1/JFLDesvent.StartBiom$B0Tot.ton.CV,
     pch=19,
     col="green4",
     type="b",
     xlab="Year",
     ylab="Start of season biomass (tonnes)",
     main=expression(italic(Jasus~frontalis)))
points(JFLDesvent.StartBiom$Year,
       1e-3*c(sum(jfldesvent1011$Data$nasas$obscat.kg),
              sum(jfldesvent1112$Data$nasas$obscat.kg),
              sum(jfldesvent1213$Data$nasas$obscat.kg),
              sum(jfldesvent1314$Data$nasas$obscat.kg),
              sum(jfldesvent1415$Data$nasas$obscat.kg),
              sum(jfldesvent1516$Data$nasas$obscat.kg),
              sum(jfldesvent1617$Data$nasas$obscat.kg),
              sum(jfldesvent1718$Data$nasas$obscat.kg)),
       type="h",
       lwd=15,
       col="blue")
#dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.3.14.- Initial values for ADMB from toy Surplus production model           #
################################################################################
#
FYrInd                 <- 2010 # Use starting year of each season
LYrInd                 <- 2017
FYrLan                 <- 2010
LYrLan                 <- 2017
nyears                 <- LYrLan-FYrLan+1
JFLDesvent.InniBiom.ton <- data.frame(Year=FYrLan:LYrLan,
                                      Landings.ton=1e-3*c(sum(jfldesvent1011$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1112$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1213$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1314$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1415$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1516$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1617$Data$nasas$obscat.kg),
                                                          sum(jfldesvent1718$Data$nasas$obscat.kg)))
JFLDesvent.InniBiom.ton$B0.CatDyn    <- JFLDesvent.StartBiom$B0Tot.ton
JFLDesvent.InniBiom.ton$SE.B0.CatDyn <- JFLDesvent.StartBiom$B0Tot.ton.SE
#
# Initial values of parameters for PT model under constant parameters           
#
B0.ini              <- 0.2*350
K.ini               <- 350
p.ini               <- 2.7
r.ini               <- 0.5
Stock.pt    <- rep(0,LYrLan-FYrLan+1)
Stock.pt[1] <- B0.ini
for(i in 2:(LYrLan-FYrLan+1))
{
  Stock.pt[i] <- Stock.pt[i-1]+r.ini*Stock.pt[i-1]*(1-(Stock.pt[i-1]/K.ini)^(p.ini-1))-JFLDesvent.InniBiom.ton$Landings.ton[i-1];
}
#
par(mfrow=c(1,1),mar=c(4,4,1,1),oma=c(4,4,1,1))
plot(JFLDesvent.InniBiom.ton$Year,JFLDesvent.InniBiom.ton$B0.CatDyn,ylim=c(0,70),pch=19)
lines(JFLDesvent.InniBiom.ton$Year,Stock.pt,col="blue",lwd=2)
lines(JFLDesvent.InniBiom.ton$Year,JFLDesvent.InniBiom.ton$Landings.ton,col="red",lwd=2)
#
# x        <- Stock.pt[1:13]
# y        <- JFLDesvent.InniBiom.ton$Landings.ton[1:13]
# z        <- Stock.pt[2:14]
# pt.nlreg <- nls(z ~ x+r.ini*x*(1-(x/K.ini)^p.ini)-y,
#                 start = list(r.ini = r.ini, K.ini = K.ini, p.ini=p.ini),
#                 control=list(maxiter=500000,tol=1e-3))
(log.B0.ini  <- log(B0.ini))
#[1] 3.401197
(log.K.ini   <- log(K.ini))
#[1] 5.857933
(log.p.ini   <- log(p.ini))
#[1] 0.2623643
(log.r.ini   <- log(r.ini))
#[1] -0.3566749
#
t(JFLDesvent.InniBiom.ton$Landings.ton)
JFLDesvent.InniBiom.ton[,c(1,3,4)]
#
save.image("JFLobsters.0203.2021.RData")
#
################################################################################
# 2.2.21.- Bringing output from ADMB and model selection                       #
################################################################################
#
# Variant 2
npar.jfjfid.1reg4p            <- 4
maxgrad.admb.pt.jfjfid.1reg4p <- read.table("marlikptjfjfid1reg4p.par",comment.char="",nrows=1)$V16
# [1] 3.067699e-05
lik.admb.pt.jfjfid.1reg4p     <- read.table("marlikptjfjfid1reg4p.par",comment.char="",nrows=1)$V11
AIC.admb.pt.jfjfid.1reg4p     <- 2*npar.jfjfid.1reg4p - 2*lik.admb.pt.jfjfid.1reg4p
# [1] -75.70075
#
Correlations
# Variant 2
cor.admb.pt.jfjfid.1reg4p <- read.table("marlikptjfjfid1reg4p.cor",
                                        header=TRUE,
                                        skip=1,
                                        fill=TRUE)
cor.admb.pt.jfjfid.1reg4p                                   <- cor.admb.pt.jfjfid.1reg4p[(npar.jfjfid.1reg4p+1):(dim(cor.admb.pt.jfjfid.1reg4p)[1]),(4+npar.jfjfid.1reg4p+1):dim(cor.admb.pt.jfjfid.1reg4p)[2]]
cor.admb.pt.jfjfid.1reg4p[is.na(cor.admb.pt.jfjfid.1reg4p)] <- 0
cor.admb.pt.jfjfid.1reg4p                                   <- as.matrix(cor.admb.pt.jfjfid.1reg4p)
cor.admb.pt.jfjfid.1reg4p                                   <- cor.admb.pt.jfjfid.1reg4p + t(cor.admb.pt.jfjfid.1reg4p) - diag(diag(cor.admb.pt.jfjfid.1reg4p))
cor.admb.pt.jfjfid.1reg4p                                   <- forceSymmetric(cor.admb.pt.jfjfid.1reg4p)
cor.admb.pt.jfjfid.1reg4p                                   <- as.matrix(cor.admb.pt.jfjfid.1reg4p)
row.names(cor.admb.pt.jfjfid.1reg4p)                        <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
colnames(cor.admb.pt.jfjfid.1reg4p)                         <- c("B0","K","p","r",paste("Biom",FYrLan:(LYrLan+1),sep=""))
#
# Summary table
pt.pars.admb.jfjfid <- data.frame(Variant=c(rep(2,npar.jfjfid.1reg4p)),
                                  Max.Abs.Grad=c(rep(round(maxgrad.admb.pt.jfjfid.1reg4p,7),npar.jfjfid.1reg4p)),
                                  AIC=c(rep(round(AIC.admb.pt.jfjfid.1reg4p),npar.jfjfid.1reg4p)),
                                  N.pars=c(rep(npar.jfjfid.1reg4p,npar.jfjfid.1reg4p)),
                                  Description=c(rep("B0!=K",npar.jfjfid.1reg4p)),
                                  Par=c("B0","K","p","r"),
                                  MLE=c(read.table("marlikptjfjfid1reg4p.std",skip=(npar.jfjfid.1reg4p+1),header=FALSE)[1:npar.jfjfid.1reg4p,3]),
                                  SE=c(read.table("marlikptjfjfid1reg4p.std",skip=(npar.jfjfid.1reg4p+1),header=FALSE)[1:npar.jfjfid.1reg4p,4]))
pt.pars.admb.jfjfid$CV.pc   <- c(round(100*pt.pars.admb.jfjfid$SE/pt.pars.admb.jfjfid$MLE,1))
pt.pars.admb.jfjfid$SelMod  <- c(rep(1,npar.jfjfid.1reg4p))
#
# PT parameters and biomass time series
pars.admb.pt.jfjfid.1reg4p           <- read.table("marlikptjfjfid1reg4p.std",skip=(npar.jfjfid.1reg4p+1),header=FALSE)[1:npar.jfjfid.1reg4p,3:4]
names(pars.admb.pt.jfjfid.1reg4p)    <- c("MLE","SD")
rownames(pars.admb.pt.jfjfid.1reg4p) <- c("B0","K","p","r")
K.jfjfid.1reg4p                      <- round(pars.admb.pt.jfjfid.1reg4p["K","MLE"])
p.jfjfid.1reg4p                      <- pars.admb.pt.jfjfid.1reg4p["p","MLE"]
r.jfjfid.1reg4p                      <- pars.admb.pt.jfjfid.1reg4p["r","MLE"]   
Stock.admb.pt.jfjfid.1reg4p          <- cbind(FYrLan:(LYrLan+1),read.table("marlikptjfjfid1reg4p.std",skip=1+2*npar.jfjfid.1reg4p,header=FALSE)[,3:4])
names(Stock.admb.pt.jfjfid.1reg4p)   <- c("Year","Biomass.ton","SD.Biomass.ton")
Stock.admb.pt.jfjfid.1reg4p$CV.pc    <- 100*Stock.admb.pt.jfjfid.1reg4p$SD.Biomass.ton/Stock.admb.pt.jfjfid.1reg4p$Biomass.ton
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.22.- Correlations plot                                                   #
################################################################################
#
tiff("Fig58PellaTomlinsonDesventCorrelations.tiff",width=12,height=12,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(2,1,1,1),oma=c(4,4,1,1))
# Variant 2
hist(cor.admb.pt.jfjfid.1reg4p[,-1][(lower.tri(as.matrix(cor.admb.pt.jfjfid.1reg4p[,-1])))],
     main="",#expression(paste("Variant 2: ",italic(B)[0]!=italic(K))),
     xlab="",
     ylab="",
     ylim=,
     xlim=c(-1,1),
     cex.axis = 1.5)
legend("topleft",bty="n",legend=c(list(bquote("Max(|gradient|)" ==.(round(maxgrad.admb.pt.jfjfid.1reg4p,7)))),
                                  list(bquote("AIC" ==.(round(AIC.admb.pt.jfjfid.1reg4p,3))))))
#
dev.off()
#
################################################################################
# 2.2.23.- Derived parameters of interest to management                        #
################################################################################
#
jfjfid.popdyn <- data.frame(Year=seq(FYrLan,LYrLan+1,1),
                            #Regime=Stock.admb.pt.jfjfid.1reg3p$EnvCycle,
                            Catch.ton=c(JFLDesvent.InniBiom.ton$Landings.ton,NA),
                            CatDyn.Biom.ton=c(JFLDesvent.InniBiom.ton$B0.CatDyn,NA),
                            CatDyn.Biom.SE.ton=c(JFLDesvent.InniBiom.ton$SE.B0.CatDyn,NA),
                            CatDyn.Biom.CV.pc=c(100*JFLDesvent.InniBiom.ton$SE.B0.CatDyn/JFLDesvent.InniBiom.ton$B0.CatDyn,NA),
                            PT.Biom.ton=Stock.admb.pt.jfjfid.1reg4p$Biomass.ton,
                            PT.Biom.SE.ton=Stock.admb.pt.jfjfid.1reg4p$SD.Biomass.ton,
                            PT.Biom.CV.pc=Stock.admb.pt.jfjfid.1reg4p$CV.pc)
#
# Covariance matrix of estimates to use deltamethod on derived parameters
pt.cor.jfjfid             <- cor.admb.pt.jfjfid.1reg4p[c("K","p","r"),c("K","p","r")]
row.names(pt.cor.jfjfid)  <- c("K","p","r")
colnames(pt.cor.jfjfid)   <- c("K","p","r")
pt.sd.jfjfid              <- read.table("marlikptjfjfid1reg4p.std",skip=(1+npar.jfjfid.1reg4p),header=FALSE)[1:npar.jfjfid.1reg4p,4][2:4]
names(pt.sd.jfjfid)       <- c("K","p","r")
pt.cov.jfjfid             <- cor2cov(cor.mat=as.matrix(pt.cor.jfjfid),sd=as.vector(pt.sd.jfjfid))
#
# MSY
MSY.jfjfid    <- round(r.jfjfid.1reg4p*K.jfjfid.1reg4p*(p.jfjfid.1reg4p-1)/(p.jfjfid.1reg4p^(p.jfjfid.1reg4p/(p.jfjfid.1reg4p-1))))
#[1] 124
MSY.SE.jfjfid <- round(deltamethod(g=list(~x3*x1*(x2-1)/(x2^(x2/(x2-1)))),
                                   mean=c(K.jfjfid.1reg4p,p.jfjfid.1reg4p,r.jfjfid.1reg4p),
                                   cov=pt.cov.jfjfid,
                                   ses=TRUE))
#[1] 20
#
# B.MSY
B.MSY.jfjfid    <- round(K.jfjfid.1reg4p*(p.jfjfid.1reg4p^(1/(1-p.jfjfid.1reg4p))))
#[1] 372
B.MSY.SE.jfjfid <- round(deltamethod(g=list(~x1*x2^(1/(1-x2))),
                                     mean=c(K.jfjfid.1reg4p,p.jfjfid.1reg4p),
                                     cov=pt.cov.jfjfid[1:2,1:2],
                                     ses=TRUE))
#[1] 41
#
# Latent productivity
B.jfjfid.all                  <- Stock.admb.pt.jfjfid.1reg4p$Biomass.ton
B.jfjfid.all.sd               <- Stock.admb.pt.jfjfid.1reg4p$SD.Biomass.ton
Lat.Prod.B.jfjfid.all         <- r.jfjfid.1reg4p*B.jfjfid.all*(1-(B.jfjfid.all/K.jfjfid.1reg4p)^(p.jfjfid.1reg4p-1))
Lat.Prod.B.jfjfid.all.Total   <- Lat.Prod.B.jfjfid.all + jfjfid.popdyn$Catch.ton
mean(Lat.Prod.B.jfjfid.all.Total,na.rm=TRUE)
# [1] 19.73897
KBcor.jfjfid  <- cor.admb.pt.jfjfid.1reg4p[(npar.jfjfid.1reg4p+1):(npar.jfjfid.1reg4p+(LYrLan-FYrLan+2)),1]
pBcor.jfjfid  <- cor.admb.pt.jfjfid.1reg4p[(npar.jfjfid.1reg4p+1):(npar.jfjfid.1reg4p+(LYrLan-FYrLan+2)),2]
rBcor.jfjfid  <- cor.admb.pt.jfjfid.1reg4p[(npar.jfjfid.1reg4p+1):(npar.jfjfid.1reg4p+(LYrLan-FYrLan+2)),4]
Lat.Prod.B.jfjfid.all.SE    <- vector("numeric",length(B.jfjfid.all))
for(i in 1:length(B.jfjfid.all))
{
  Lat.Prod.B.jfjfid.all.SE[i] <- round(deltamethod(g=list(~(x1*x2*(1-(x2/x3)^(x4-1)))),
                                                   mean=c(r.jfjfid.1reg4p,B.jfjfid.all[i],K.jfjfid.1reg4p,p.jfjfid.1reg4p),
                                                   cov=matrix(c(pt.cov.jfjfid["r","r"],rBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["r","r"])*B.jfjfid.all[i],pt.cov.jfjfid["r","K"],pt.cov.jfjfid["r","p"],
                                                                rBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["r","r"])*B.jfjfid.all[i],B.jfjfid.all[i]^2,KBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["K","K"])*B.jfjfid.all[i],pBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["p","p"])*B.jfjfid.all[i],
                                                                pt.cov.jfjfid["r","K"],KBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["K","K"])*B.jfjfid.all[i],pt.cov.jfjfid["K","K"],pt.cov.jfjfid["K","p"],
                                                                pt.cov.jfjfid["r","p"],pBcor.jfjfid[i]*sqrt(pt.cov.jfjfid["p","p"])*B.jfjfid.all[i],pt.cov.jfjfid["K","p"],pt.cov.jfjfid["p","p"]),
                                                              4,4),
                                                   ses=TRUE))
}
Lat.Prod.jfjfid.Total       <- data.frame(Year=FYrLan:LYrLan,
                                          #Regime=Stock.admb.pt.omyuc.2regp4p$EnvCycle[1:22],
                                          Biomass.t=Stock.admb.pt.jfjfid.1reg4p$Biomass.ton[1:(LYrLan-FYrLan+1)],
                                          Biomass.SD.t=Stock.admb.pt.jfjfid.1reg4p$SD.Biomass.ton[1:(LYrLan-FYrLan+1)],
                                          Latprodtot.t=Lat.Prod.B.jfjfid.all.Total[1:(LYrLan-FYrLan+1)],
                                          Latprodtot.SE.t=Lat.Prod.B.jfjfid.all.SE[1:(LYrLan-FYrLan+1)])
Lat.Prod.jfjfid.Total$CV.pc <- 100*Lat.Prod.jfjfid.Total$Latprodtot.SE.t/abs(Lat.Prod.jfjfid.Total$Latprodtot.t)
#
# Sustainable harvest rates
harvest.rate.jfjfid <- data.frame(MSY=MSY.jfjfid,
                                  MSY.SE=MSY.SE.jfjfid,
                                  TLP=round(mean(Lat.Prod.jfjfid.Total$Latprodtot.t)),
                                  TLP.SE=round(mean(Lat.Prod.jfjfid.Total$Latprodtot.SE.t)))
#
save.image("JFLobsters.0203.2223.RData")
#
################################################################################
# 2.2.24.- Population dynamics plot                                            #
################################################################################
#
options(scipen=3)
tiff("Fig59PellaTomlinsonDesventBiomassDynamics.tiff",width=20,height=20,units="cm",type="cairo",res=350)
par(mfrow=c(1,1),mar=c(1,1,1,1),bty="o",oma=c(3,3,1,1))
# CatDyn biomass
plot(x=seq(FYrLan,LYrLan+1,1),
     y=jfjfid.popdyn$CatDyn.Biom.ton,
     pch=19,
     ylim=c(0,75),
     cex=3e-1/jfjfid.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfid.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE),
     cex.axis=1.25,
     cex.lab=1.25,
     col="green4",
     type="b",
     lwd=2,
     ylab="",
     xlab="",
     main=expression(paste(italic(Jasus~frontalis)," in Islas Desventuradas")))
# # MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(MSY.jfjfid-2*MSY.SE.jfjfid,LYrLan-FYrLan+2),
#             rev(rep(MSY.jfjfid+2*MSY.SE.jfjfid,LYrLan-FYrLan+2))),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(MSY.jfjfid,LYrLan-FYrLan+2),
#       col="blue",
#       lwd=2)
# # Legend MSY
# polygon(x=c(2012,2014,2014,2012),
#         y=c(60,60,64,64),
#         col="lightblue", border=NA, fillOddEven=TRUE)
# lines(x=c(2012,2014),y=c(62,62),col="blue",lwd=2)
# text(x=2016.85,y=62,lab=expression(MSY%+-%"2"~standard~deviations),adj=1)
# # B_MSY
# polygon(x=c(seq(FYrLan,LYrLan+1),seq(LYrLan+1,FYrLan)),
#         y=c(rep(B.MSY.jfjfid-2*B.MSY.SE.jfjfid,LYrLan-FYrLan+2),
#             rev(rep(B.MSY.jfjfid+2*B.MSY.SE.jfjfid,LYrLan-FYrLan+2))),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=FYrLan:(LYrLan+1),rep(B.MSY.jfjfid,LYrLan-FYrLan+2),
#       col="salmon",
#       lwd=2)
# # Legend B_MSY
# polygon(x=c(2012,2014,2014,2012),
#         y=c(55,55,59,59),
#         col="orange1", border=NA, fillOddEven=TRUE)
# lines(x=c(2012,2014),y=c(57,57),col="salmon",lwd=2)
# text(x=2016.85,y=57,lab=expression(B[MSY]%+-%"2"~standard~deviations),adj=1)
# CatDyn Biomass
points(x=seq(FYrLan,LYrLan+1,1),
       y=jfjfid.popdyn$CatDyn.Biom.ton,
       pch=19,
       lty=1,
       col="green4",
       cex=3e-1/jfjfid.popdyn$CatDyn.Biom.CV.pc/min(1/jfjfid.popdyn$CatDyn.Biom.CV.pc,na.rm=TRUE))
lines(x=seq(FYrLan,LYrLan+1,1),
      y=jfjfid.popdyn$CatDyn.Biom.ton,
      lty=1,
      lwd=2,
      col="green4")
# Legend CatDyn biomass
points(x=2013,y=75,pch=19,cex=2,col="green4")
lines(x=c(2012.5,2013.5),y=c(75,75),col="green4",lwd=2)
text(x=2017.5,y=75,lab=expression(CatDyn~biomass~(size%prop%presicion)),cex=1,adj=1)
# PT Biomass
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfid.popdyn$PT.Biom.ton-2*jfjfid.popdyn$PT.Biom.SE.ton,
            rev(jfjfid.popdyn$PT.Biom.ton+2*jfjfid.popdyn$PT.Biom.SE.ton)),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfid.popdyn$PT.Biom.ton-4*jfjfid.popdyn$PT.Biom.SE.ton,
            rev(jfjfid.popdyn$PT.Biom.ton+4*jfjfid.popdyn$PT.Biom.SE.ton)),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(seq(FYrLan,LYrLan+1,1),seq(LYrLan+1,FYrLan,-1)),
        y=c(jfjfid.popdyn$PT.Biom.ton-6*jfjfid.popdyn$PT.Biom.SE.ton,
            rev(jfjfid.popdyn$PT.Biom.ton+6*jfjfid.popdyn$PT.Biom.SE.ton)),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
lines(seq(FYrLan,LYrLan+1,1),jfjfid.popdyn$PT.Biom.ton,lwd=2)
# Legend PT Biomass
polygon(x=c(2012,2014,2014,2012),
        y=c(73,73,67,67),
        col=gray(0.55,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2012,2014,2014,2012),
        y=c(72,72,68,68),
        col=gray(0.35,0.45), border=NA, fillOddEven=TRUE)
polygon(x=c(2012,2014,2014,2012),
        y=c(71,71,69,69),
        col=gray(0.15,0.45), border=NA, fillOddEven=TRUE)
lines(x=c(2012,2014,2014,2012),y=rep(70,4),lwd=2)
text(x=2017.3,y=71,lab=expression(Pella~Tomlinson~biomass%+-%"2,4,6"),adj=1,cex=1)
text(x=2016,y=69,lab=expression(standard~deviations),adj=1,cex=1)
# Landings
lines(x=seq(FYrLan,LYrLan+1,1),jfjfid.popdyn$Catch.ton,type="h",lwd=15,col="red")
# Legend landings
segments(x0=2013,x1=2013,y0=50,y1=53,lwd=20,col="red")
text(x=2014.5,y=51,lab="Annual catch",adj=1,cex=1)
#
mtext(side=2,outer=TRUE,text="Biomass at start of season (tonnes)",line=1,cex=1.5)
mtext(side=1,outer=TRUE,text="Year",line=1,cex=1.5)
dev.off()
#
save.image("JFCrusoeLobsters.0203.2223.RData")
#
################################################################################
# 2.2.25.- Kobe plot                                                           #
################################################################################
#
# B over B_MSY and F over F_MSY
jfjfid.popdyn$B.BMSY  <- (jfjfid.popdyn$PT.Biom.ton)/(B.MSY.jfjfid)
jfjfid.popdyn$F.FMSY  <- (jfjfid.popdyn$Catch.ton/jfjfid.popdyn$PT.Biom.ton)/(MSY.jfjfid/B.MSY.jfjfid)
# Standard errors
jfjfid.popdyn$B.BMSY.SE  <- NA
jfjfid.popdyn$F.FMSY.SE  <- NA
for(i in 1:nyears)
{
  jfjfid.popdyn$B.BMSY.SE[i] <- deltamethod(g=list(~x1/x2),
                                            mean=c(jfjfid.popdyn$PT.Biom.ton[i],B.MSY.jfjfid),
                                            cov=matrix(c(jfjfid.popdyn$PT.Biom.SE.ton[i]^2,0,0,B.MSY.SE.jfjfid^2),2,2),
                                            ses=TRUE)
}
for(i in 1:nyears)
{
  yield <- jfjfid.popdyn$Catch.ton[i]
  jfjfid.popdyn$F.FMSY.SE[i] <- deltamethod(g=list(~(yield/x1)/(x2/x3)),
                                            mean=c(jfjfid.popdyn$PT.Biom.ton[i],MSY.jfjfid,B.MSY.jfjfid),
                                            cov=matrix(c(jfjfid.popdyn$PT.Biom.SE.ton[i]^2,0,0,0,MSY.SE.jfjfid^2,0,0,0,B.MSY.SE.jfjfid^2),3,3),
                                            ses=TRUE)
  
}
# Stock status for pie chart
jfjfid.popdyn$Status <- ifelse(jfjfid.popdyn$B.BMSY > 1 & jfjfid.popdyn$F.FMSY < 1,1,
                               ifelse(jfjfid.popdyn$B.BMSY < 1 & jfjfid.popdyn$F.FMSY < 1,2,
                                      ifelse(jfjfid.popdyn$B.BMSY < 1 & jfjfid.popdyn$F.FMSY > 1,3,4)))
#
tiff("Fig60PellaTomlinsonDesventKobe.tiff",width=22,height=20,units="cm",res=350,type="cairo")
par(mfrow=c(1,1),mar=c(4,5,2,1))
plot(jfjfid.popdyn$B.BMSY,
     jfjfid.popdyn$F.FMSY,
     type="b",
     xlim=c(0,2),
     ylim=c(0,3.5),
     xlab=expression(B/B[MSY]),
     ylab=expression(F/F[MSY]),
     main=expression(paste(italic(Jasus~frontalis)," in Islas Desventuradas")),
     cex.axis=2,
     cex.lab=2,
     cex.main=2)
abline(h=1)
abline(v=1)
rect(xleft=-1,xright=1,ybottom=-1,ytop=1,col="yellow")
rect(xleft=-1,xright=1,ybottom=1,ytop=4.2,col="red")
rect(xleft=1,xright=3,ybottom=1,ytop=4.2,col="orange1")
rect(xleft=1,xright=3,ybottom=-1,ytop=1,col="green")
text(x=0.2,y=2,lab="Overfished",cex=2)
text(x=2.0,y=1.75,lab="Overfishing",srt=90,cex=2)
text(x=1.8,y=0,lab="Sustainable",cex=2)
text(x=0.2,y=0,lab="Rebuilding",cex=2)
points(jfjfid.popdyn$B.BMSY,
       jfjfid.popdyn$F.FMSY,
       pch=19,
       cex=3,
       col="blue")
lines(jfjfid.popdyn$B.BMSY,
      jfjfid.popdyn$F.FMSY,
      col="blue",
      lwd=2)
segments(x0=jfjfid.popdyn$B.BMSY[nyears]-2*jfjfid.popdyn$B.BMSY.SE[nyears],
         x1=jfjfid.popdyn$B.BMSY[nyears]+2*jfjfid.popdyn$B.BMSY.SE[nyears],
         y0=jfjfid.popdyn$F.FMSY[nyears],
         y1=jfjfid.popdyn$F.FMSY[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfid.popdyn$B.BMSY[nyears]+2*jfjfid.popdyn$B.BMSY.SE[nyears],
         x1=jfjfid.popdyn$B.BMSY[nyears]+2*jfjfid.popdyn$B.BMSY.SE[nyears],
         y0=jfjfid.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfid.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfid.popdyn$B.BMSY[nyears]-2*jfjfid.popdyn$B.BMSY.SE[nyears],
         x1=jfjfid.popdyn$B.BMSY[nyears]-2*jfjfid.popdyn$B.BMSY.SE[nyears],
         y0=jfjfid.popdyn$F.FMSY[nyears]-0.05,
         y1=jfjfid.popdyn$F.FMSY[nyears]+0.05,
         lwd=4,
         col="blue")
segments(x0=jfjfid.popdyn$B.BMSY[nyears],
         x1=jfjfid.popdyn$B.BMSY[nyears],
         y0=jfjfid.popdyn$F.FMSY[nyears]-2*jfjfid.popdyn$F.FMSY.SE[nyears],
         y1=jfjfid.popdyn$F.FMSY[nyears]+2*jfjfid.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfid.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfid.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfid.popdyn$F.FMSY[nyears]-2*jfjfid.popdyn$F.FMSY.SE[nyears],
         y1=jfjfid.popdyn$F.FMSY[nyears]-2*jfjfid.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
segments(x0=jfjfid.popdyn$B.BMSY[nyears]-0.05,
         x1=jfjfid.popdyn$B.BMSY[nyears]+0.05,
         y0=jfjfid.popdyn$F.FMSY[nyears]+2*jfjfid.popdyn$F.FMSY.SE[nyears],
         y1=jfjfid.popdyn$F.FMSY[nyears]+2*jfjfid.popdyn$F.FMSY.SE[nyears],
         lwd=4,
         col="blue")
text(jfjfid.popdyn$B.BMSY,
     jfjfid.popdyn$F.FMSY,
     lab=substring(jfjfid.popdyn$Year,3,4),
     col="yellow")
par(new=TRUE,mai=c(5.0,5.0,1,1))
barplot(c(0,0,8,0),
        width=c(1,1),
        col=c("green","yellow","red","orange1"),
        names.arg=c("0.0%","0.0%","100.0%","0.0%"),
        cex.names=1)
dev.off()
#
save.image("JFLobsters.0203.2223.RData")
#
#############################   END OF SCRIPT  #################################
