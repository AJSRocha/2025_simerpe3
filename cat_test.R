# Input data
Ct <- c(1.58685127, 1.68611132, 1.45710255, 2.29896449, 1.27183889, 1.59284344, 0.85857989, 1.04140994, 1.48127223,
        1.82125129, 3.31810633, 4.45063048, 1.42978666, 2.13073974, 2.14613841, 1.39558200, 1.49791465, 0.91111765,
        1.01808912, 1.54762952, 0.55122767, 2.22368327, 1.34410198, 3.34666927, 1.90105515, 2.48779710, 2.49082190,
        0.79668490, 1.21314444, 1.55373082, 1.19348922, 1.17019951, 1.05859087, 1.77789344, 1.86831882, 2.55015403,
        1.15493466, 1.21956915, 1.75869207, 2.15646005, 1.92234236, 2.15384319, 1.93231958, 0.97636377, 1.37077148,
        2.13160997, 2.99961795, 3.02530605, 1.40612459, 1.99868627, 1.39132916, 2.24588805, 2.46381900, 2.29621400,
        1.01856580, 1.31557190, 1.57111308, 1.87292689, 1.82463964, 4.31244597, 1.69010499, 3.64267469, 1.72298308,
        0.03303439, 1.31288279, 1.51604793, 0.78600755, 0.60493590, 0.76499449, 0.98280863, 0.66380335, 0.78815358,
        0.51162190, 0.75612872, 2.53026831, 0.73917184, 2.92083780, 1.88078378, 2.07804676, 3.26643725, 2.12951238,
        2.66802775, 4.08511699, 6.44053322, 3.57619744, 2.78589542, 3.06931281, 2.45818888, 2.91372416, 1.73493131,
        2.31063150, 2.36497248, 5.47016024, 3.95186383, 6.29682503, 7.11543782, 3.98843731, 4.25948703, 4.98121511,
        3.90825361, 4.67315801, 5.10052158, 4.46040685, 3.68578644, 3.40118865, 3.55710423, 3.97063119, 3.94569295)

Et <- c(812, 778, 1545, 1589, 1705, 1476, 1831, 1330, 1729, 2010, 1339, 1377, 869, 953, 1484, 1605, 1583, 1473,
        2277, 1868, 1671, 2744, 2456, 2980, 2914, 2278, 3601, 2680, 3048, 2768, 2891, 3171, 3341, 2254, 1479, 1655,
        2924, 2697, 2851, 2531, 3238, 2740, 2852, 2708, 2650, 2420, 2429, 2374, 4168, 2767, 2223, 2098, 1944, 2264,
        1719, 1691, 1517, 1790, 1654, 1778, 874, 1110, 627, 46, 1425, 1702, 1737, 1521, 1164, 1684, 1634, 1329, 1484,
        1214, 1280, 759, 1584, 2422, 2202, 1975, 2191, 2264, 2308, 2501, 2964, 3510, 3021, 2094, 3176, 3201, 2840,
        3051, 2881, 2912, 3033, 3080, 4112, 4778, 3508, 3105, 3124, 2863, 2897, 2744, 2693, 2711, 2137, 2682)

u <- c(12, 24, 36, 47, 60, 72, 84, 96, 107)

# Parameter sets
params_catdyn <- list(alpha = 0.13912215, beta = 2.12859840, k = 0.00000233, M = 0.01463568, N0 = 370.52101481,
                      R = c(120.90821130, 45.78874157, 81.69288708, 110.19527207, 86.90507099, 61.12573782,
                            230.21540426, 203.67263167, 48.64361287))
params_rtmb <- list(alpha = 0.08025888, beta = 1.19026676, k = 0.00167959, M = 0.02819187, N0 = 225.74863494,
                    R = c(132.24618816, 61.56005445, 89.34587328, 122.13173719, 86.81400464, 73.68834969,
                          288.19510819, 290.64788727, 49.78624314))

# Prediction function
predict_catch <- function(params, Et, u) {
  T <- length(Et)
  Ct_pred <- numeric(T)
  Nt <- numeric(T + 1)
  Nt[1] <- params$N0
  
  Rt <- numeric(T)
  Rt[u] <- params$R
  
  for (t in 1:T) {
    Ct_pred[t] <- params$k * exp(-params$M / 2) * Et[t]^params$alpha * Nt[t]^params$beta
    Nt[t + 1] <- Nt[t] * exp(-params$M) - Ct_pred[t] + Rt[t]
  }
  return(Ct_pred)
}

# Simulate predictions
Ct_catdyn <- predict_catch(params_catdyn, Et, u)
Ct_rtmb   <- predict_catch(params_rtmb, Et, u)

# Plot results
plot(Ct, type = "l", lwd = 2, col = "black", ylim = range(c(Ct, Ct_catdyn, Ct_rtmb)),
     ylab = "Catch", xlab = "Time step", main = "Observed vs Predicted Catch")
lines(Ct_catdyn, col = "blue", lwd = 2, lty = 2)
lines(Ct_rtmb, col = "red", lwd = 2, lty = 3)
legend("topright", legend = c("Observed", "CatDyn", "RTMB"),
       col = c("black", "blue", "red"), lty = c(1, 2, 3), lwd = 2)

# RMSE comparisons
rmse <- function(obs, pred) sqrt(mean((obs - pred)^2))
cat("RMSE (CatDyn vs Observed):", rmse(Ct, Ct_catdyn), "\n")
cat("RMSE (RTMB vs Observed):", rmse(Ct, Ct_rtmb), "\n")
cat("RMSE (CatDyn vs RTMB):", rmse(Ct_catdyn, Ct_rtmb), "\n")